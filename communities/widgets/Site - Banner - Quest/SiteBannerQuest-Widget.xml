<scriptedContentFragments>
	<scriptedContentFragment name="${resource:SiteBanner} - Quest" version="9.2.0.1667" description="${resource:SiteBannerDescription}" instanceIdentifier="b8476577f75348f294c9a2e161119e5d" theme="" isCacheable="true" varyCacheByUser="true" showHeaderByDefault="false" cssClass="site-banner">
		<contentScript><![CDATA[#set ($links = $core_v2_page.ParseQueryString($core_v2_widget.GetCustomValue('links','Link=Notifications&amp;Link=Inbox&amp;Link=Bookmarks&amp;Link=User')))
#set ($hasLinks = false)

#set ($user = $core_v2_user.Accessing)
#set ($isRegistered = $core_v2_user.IsRegistered($user.Id))
#set ($isImpersonated = $core_v2_authentication.IsImpersonated())
#set ($impersonator = $core_v2_authentication.Impersonator())

#set ($listTemplate = 'site-banner-list-template')
#set ($notificationPreferenceTemplate = 'site-banner-notification-preferences-template')
#set ($bookmarkFilterTemplate = 'site-banner-bookmark-filter-template')
#set ($notificationFilterTemplate = 'site-banner-notification-filter-template')
#set ($userTemplate = 'site-banner-user-template')
#set ($searchFilterTemplate = 'site-banner-search-filter-template')
#set ($notificationsUnread = 0)
#set ($conversationsUnread = 0)
#set ($includeJavascript = false)
#set ($isBookmarked = false)
#set ($currentContentId = '')

#set ($currentContent = false)
#set ($currentContent = $core_v2_content.Current)
#set ($currentApplication = false)
#set ($currentApplication = $core_v2_application.Current)
#set ($currentGroup = false)
#set ($currentGroup = $core_v2_group.Current)
#set ($rootGroup = false)
#set ($rootGroup = $core_v2_group.Root)
#if ($rootGroup.Id == $currentGroup.Id)
	#set ($currentGroup = false)
#end

#set($siteSearch = $core_v2_widget.GetCustomValue('siteSearch', ''))
#set($useQuestFooter = $core_v2_widget.GetCustomValue('useQuestFooter', ''))
#set($siteBrand = $core_v2_widget.GetCustomValue('siteBrand', 'dsg'))
#set($navHTML = $core_v2_ui.Render($core_v2_widget.GetHtmlValue('navHTML','')))

## mark any unread notifications for the current piece of content as read
#if ($currentContent && $isRegistered)

	## detect if current content is actually an application
	#set ($isApplication = false)
	#set ($application = $currentContent.Application)
	#if (!$application || $application.ApplicationId == $currentContent.ContentId)
		#set ($isApplication = true)
	#end

	#if (!$isApplication)
		## load and mark as read any unread notifications for this content
		#set ($unreadContentNotifications = $core_v2_notification.List("%{ ContentId = $currentContent.ContentId, ContentTypeId = $currentContent.ContentTypeId, IsRead = 'false' }"))
		#foreach ($unreadNotification in $unreadContentNotifications)
			#set ($updatedNotification = $core_v2_notification.Update($unreadNotification.NotificationId, "%{ MarkAsRead = 'true' }"))
		#end

		## Forum Reply Notifications are generally made against Forum Threads, not Replies. So also, mark any notifications for their parent threads, explicitly.
		#if ($currentContent.ContentTypeId == $core_v2_forumReply.ContentTypeId)
			#set ($forumReply = $core_v2_forumReply.Get($currentContent.ContentId))
			#if ($forumReply)
				#set ($forumThread = $core_v2_forumThread.Get($forumReply.ThreadId))
				#if ($forumThread)
					## load and mark as read any unread notifications for this forum thread
					#set ($unreadContentNotifications = $core_v2_notification.List("%{ ContentId = $forumThread.ContentId, ContentTypeId = $forumThread.forumThreadContentTypeId, IsRead = 'false' }"))
					#foreach ($unreadNotification in $unreadContentNotifications)
						#set ($updatedNotification = $core_v2_notification.Update($unreadNotification.NotificationId, "%{ MarkAsRead = 'true' }"))
					#end
				#end
			#end
		#end
	#end

#end

## site navigation
#set ($hasSiteNavigation = false)
#set ($siteNavigationUrl = '')
#set ($siteNavigationType = $core_v2_widget.GetStringValue('siteNavigation', 'exclude'))

#set ($searchId = $core_v2_widget.UniqueId('Search'))
#set ($bannerId = $core_v2_widget.UniqueId('banner'))
#set ($searchFieldsId = $core_v2_widget.UniqueId('searchFields'))
#set ($bannerSiteLinksId = $core_v2_widget.UniqueId('bannerSiteLinks'))
#set ($bannerUserLinksId = $core_v2_widget.UniqueId('bannerLinks'))
#set ($handheldSearchFieldsId = $core_v2_widget.UniqueId('handheldSearchFields'))
#set ($handheldBannerUserLinksId = $core_v2_widget.UniqueId('handheldBannerLinks'))
#set ($handheldSearchFieldsLinkId = $core_v2_widget.UniqueId('handheldSearchFieldsLink'))
#set ($handheldSiteNavigationLinkId = $core_v2_widget.UniqueId('handheldSiteNavigationLink'))
#set ($handheldBannerUserLinksLinkId = $core_v2_widget.UniqueId('handheldBannerLinksLink'))
#set ($handheldBannerUserLinksCountId = $core_v2_widget.UniqueId('handheldBannerLinksCount'))
#set ($handheldSiteLinksLinkId = $core_v2_widget.UniqueId('handheldSiteLinksLink'))
#set ($handheldSiteLinksId = $core_v2_widget.UniqueId('handheldSiteLinks'))
#set ($utilityDropdown = $core_v2_widget.UniqueId('utilityDropdown'))

#set ($currentSeachQuery = '')
#set ($currentSeachQuery = $core_v2_encoding.HtmlEncode($core_v2_page.GetQueryStringValue('q')))

<header class="masthead" id="$core_v2_encoding.HtmlAttributeEncode($bannerId)">
	<nav class="navbar" role="navigation">
		<div class="utility-section-wrapper">
			<div class="utility-section">
				<div class="navbar-brand">
					<a href="/">
					    #if ($siteBrand == "quest")
						<img src="/images/shared/quest-logo.png">
						#elseif ($siteBrand == "dsg")
						<img src="/images/shared/logo-blue.png">
						#end
					</a>
				</div>

				<div id="$core_v2_encoding.HtmlAttributeEncode($searchFieldsId)" class="search-container">
					<div>
						<input class="search-query form-control" autocomplete="off" type="search" placeholder="$core_v2_encoding.HtmlAttributeEncode($core_v2_language.GetResource('Search'))" id="$core_v2_encoding.HtmlAttributeEncode($searchId)" value="$!currentSeachQuery" />
						<button class="btn">
							<i class="glyphicon glyphicon-search"></i>
						</button>
					</div>
					<div class="autocomplete"></div>
				</div>

				<div class="nav-container">
			    #if ($siteNavigationType == "quest")
			    <div class="main-nav-section" data-ajax="true">
			        <div class="shadow-overlay-left"></div>
			    </div>
			    #elseif ($siteNavigationType == "custom")
			    <div class="main-nav-section">
					<div class="shadow-overlay-left"></div>
						$navHTML
					</div>
				#elseif ($siteNavigationType == "default")
				<div class="main-nav-section">
				    <div class="shadow-overlay-left"></div>
				    <ul class="tier1">
                    	<li><a href="/community/">Home</a></li>
                    	<li><a href="/community/b/en">Blog</a></li>
                    	<li><a href="/community/products/">Forums</a></li>
                    	<li><a href="/community/beta/">Beta</a></li>
                    	<li><a href="/community/about/">About</a></li>
                    </ul>
                </div>
				#end
				</div>

				<ul class="utility desktop" id="$core_v2_encoding.HtmlAttributeEncode($bannerUserLinksId)">
					<li class="dropdown mobile-search-button search-button">
						<a href="#">
							<span class="top-search-icon"><i class="glyphicon glyphicon-search"></i></span>
						</a>
					</li>
            #set ($bannerLinks = $links.Values('Link'))
            #foreach($link in $bannerLinks)
            #beforeall
            #each
              #set($url = false)
              #if($link == 'Bookmarks' && $isRegistered)
                <li class="mobile">
                  <a href="#" class="bookmarks" id="$core_v2_widget.UniqueId('bookmarks')" title="$core_v2_encoding.HtmlAttributeEncode($core_v2_language.GetResource('Bookmarks'))">$core_v2_language.GetResource('Bookmarks')</a>
                </li>
                #set ($hasLinks = true)

                ## build dynamic lists of all content types, application types, and container types for filtering
                #set ($allContentTypes = $core_v2_contentType.List())
                #set ($contentTypes = "")
                #set ($applicationContentTypes = "")
                #set ($containerContentTypes = "")
                #foreach ($type in $allContentTypes)
                  #if ($core_v2_bookmark.SupportsBookmarks($type.Id))
                    #set ($containerType = false)
                    #set ($containerType = $core_v2_containerType.Get($type.Id))
                    #if ($containerType && $containerType.Id)
                      #set ($containerContentTypes = "${containerContentTypes}${type.Id}:${type.Name},")
                    #else
                      #set ($applicationType = false)
                      #set ($applicationType = $core_v2_applicationType.Get($type.Id))
                      #if ($applicationType && $applicationType.Id)
                        #set ($applicationContentTypes = "${applicationContentTypes}${type.Id},")
                      #else
                        #set ($contentTypes = "${contentTypes}${type.Id},")
                      #end
                    #end
                  #end
                #end

              #elseif($link == 'Notifications' && $isRegistered)
                <li class="mobile">
                  <a href="#" class="notifications" id="$core_v2_widget.UniqueId('notifications')">$core_v2_language.GetResource('Notifications')</a>
                </li>
                #set ($hasLinks = true)
                #set ($options = "%{ IsRead = 'False', PageSize = 1 }")
                #set ($conversationMessageNotificationFilterName = "_Filters_${core_v2_conversationMessage.NotificationTypeId}")
                $options.Add($conversationMessageNotificationFilterName, 'Exclude')
                #set ($notificationsUnread = $core_v2_notification.List($options).TotalCount)

              #elseif($link == 'User')
                #if ($isRegistered)
                  <li class="mobile">
                    <a href="#" class="internal-link user" id="$core_v2_encoding.HtmlAttributeEncode($core_v2_widget.UniqueId('user'))" title="$core_v2_encoding.HtmlAttributeEncode($core_v2_user.Accessing.DisplayName)">
                    #set($avatarAnonymousCheck = $core_v2_utility.IsMatch($user.AvatarUrl, '.*anonymous.*'))
                    #if($avatarAnonymousCheck)
                      <span class="glyphicon glyphicon-user"><span class="badge"><i class="glyphicon glyphicon-ok"></i></span></span>
                    #else
	                  $core_v2_ui.GetResizedImageHtml($user.AvatarUrl, 22, 22, "%{ ResizeMethod = 'ZoomAndCrop' }")
                    #end
                    </a>
                  </li>
                  #set($hasLinks = true)
                #else
                  #set($url = $core_v2_urls.Login())
                  #if ($url)
                    <li class="mobile">
                      <a href="$core_v2_encoding.HtmlAttributeEncode($url)" class="internal-link user" title="$core_v2_encoding.HtmlAttributeEncode($core_v2_language.GetResource('JoinSignIn'))">
                          <span class="glyphicon glyphicon-user"></span>
                      </a>
                    </li>
                    #set($hasLinks = true)
                  #end
                #end
                
              #elseif($link == 'Inbox' && $isRegistered)
                #set($url = $core_v2_urls.Conversations())
                #if ($url)
                  #set($conversationsUnread = $core_v2_conversation.UnreadCount())
                  <li class="mobile">
                    <a href="#" class="conversations" id="$core_v2_widget.UniqueId('conversations')">$core_v2_language.GetResource('Conversations_Inbox')</a>
                  </li>
                  #set($hasLinks = true)
                #end
              #end
            #afterall
            #end
				</ul>

				<ul class="utility mobile">
					<li class="dropdown mobile-search-button search-button">
            <a href="#">
              <span class="top-search-icon"><i class="glyphicon glyphicon-search"></i></span>
            </a>
          </li>
          #if ($isRegistered)
            <li>
              <a href="#" class="user logged-in" id="$core_v2_encoding.HtmlAttributeEncode($handheldBannerUserLinksLinkId)">
                  $core_v2_language.GetResource('user')
              </a>
              <a href="#" class="popup-list-count" id="$core_v2_encoding.HtmlAttributeEncode($handheldBannerUserLinksCountId)"></a>
            </li>
          #else
            #set($url = $core_v2_urls.Login())
            #if ($url)
            <li>
              <a href="$core_v2_encoding.HtmlAttributeEncode($url)" class="user">
                <span class="glyphicon glyphicon-user"></span>
              </a>
            </li>
            #end
          #end
					<li class="hamburger">
            <a href="#" class="navbar-toggle" data-toggle="site-menu">
              <span class="glyphicon glyphicon-menu-hamburger"></span>
            </a>
          </li>
				</ul>

				<div class="utility-dropdown mobile" id="$core_v2_encoding.HtmlAttributeEncode($utilityDropdown)">
          <div class="user-links" style="display:none" id="$core_v2_encoding.HtmlAttributeEncode($handheldBannerUserLinksId)">
						<ul class="utility"></ul>
          </div>
        </div>

			</div>
		</div>
	</nav>
</header>

#registerEndOfPageHtml('telligent.evolution.widgets.siteBanner')


	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($notificationPreferenceTemplate)">
		<div class="notification-preference">
			<span class="description">$core_v2_language.GetResource('TurnOffQuestion') <strong><%: notificationTypeName %></strong>$core_v2_language.GetResource('TurnOffQuestionSuffix')</span>
			<a href="#" class="confirm internal-link button submit-button" data-notificationtypeid="<%: notificationTypeId %>">$core_v2_language.GetResource('TurnOff')</a>
			<a href="#" class="cancel internal-link button submit-button">$core_v2_language.GetResource('Cancel')</a>
		</div>
	</script>


	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($listTemplate)">
		<div>
			<div class="multiple-column-list columns-1">
				<div class="multiple-column-item column-1">
					<ul class="content-list content">
					</ul>
					<div class="loading">$core_v2_language.GetResource('loading')</div>
					<% if(footerContent) { %>
						<div class="content-list-footer">
							<%= footerContent %>
						</div>
					<% } %>
				</div>
			</div>
		</div>
	</script>


	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($bookmarkFilterTemplate)">
		<ul class="navigation-list filter">
			<% if(contentTypeIds && contentTypeIds.length > 0) { %>
				<li class="navigation-item conversations">
					<a class="internal-link" href="#" data-contenttypeids="<%: contentTypeIds %>">$core_v2_language.GetResource('Bookmark_Filter_Content')</a>
				</li>
			<% } %>
			<% if(applicationContentTypeIds && applicationContentTypeIds.length > 0) { %>
				<li class="navigation-item conversations">
					<a class="internal-link" href="#" data-contenttypeids="<%: applicationContentTypeIds %>">$core_v2_language.GetResource('Bookmark_Filter_Application')</a>
				</li>
			<% } %>
			<% if(containerTypes && containerTypes.length > 0) { %>
				<% foreach(containerTypes, function(containerType) {  %>
					<li class="navigation-item conversations">
						<a class="internal-link" href="#" data-contenttypeids="<%: containerType.id %>"><%: containerType.name %></a>
					</li>
				<% }); %>
			<% } %>
		</ul>
	</script>

	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($notificationFilterTemplate)">
		<ul class="navigation-list filter">
			<li class="navigation-item all">
				<a class="internal-link" href="#" data-filter="all">$core_v2_language.GetResource('Notification_Filter_All')</a>
			</li>
			<li class="navigation-item unread">
				<a class="internal-link" href="#" data-filter="unread">$core_v2_language.GetResource('Notification_Filter_Unread')</a>
			</li>
		</ul>
	</script>

	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($searchFilterTemplate)">
		<% if(places && places.length > 0) { %>
			<ul class="navigation-list filter">
				<% foreach(places, function(place) { %>
					<li class="navigation-item">
						<a class="place internal-link" href="#" data-key="<%: place.key %>" data-value="<%: place.value %>" data-searchparam="<%: place.searchParameter %>" data-searchvalue="<%: place.searchValue %>"><%= place.name %></a>
				<% }); %>
			</ul>
		<% } %>

		<% if(filters && filters.length > 0) { %>
			<ul class="navigation-list filter">
			<% foreach(filters, function(filter) {  %>
				<li class="navigation-item">
					<a class="type internal-link" href="#" data-key="<%: filter.key %>"><%= filter.name %></a>
				</li>
			<% }); %>
			</ul>
		<% } %>
	</script>

	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($userTemplate)">
		<div class="user">
			<div class="avatar">
				<a href="$core_v2_encoding.HtmlAttributeEncode($user.ProfileUrl)">
					$core_v2_ui.GetResizedImageHtml($user.AvatarUrl, 40, 40, "%{ ResizeMethod = 'ZoomAndCrop' }")
				</a>
			</div>
			<span class="user-name">
				<a href="$core_v2_encoding.HtmlAttributeEncode($user.ProfileUrl)">$core_v2_encoding.JavascriptEncode($user.DisplayName)</a>
			</span>

			#set($authType = false)
			#set($authType = $core_v2_authentication.GetLastLoginType())
			#if ($authType && $authType != '')
				#set($oathProvider = false)
				#set($oathProvider = $core_v2_authentication.GetOAuthProvider($authType))
				#if ($oathProvider)
					<span class="oauth-provider">
						$core_v2_ui.GetResizedImageHtml($oathProvider.IconUrl, 18, 18, "%{ border='0', alt = $oathProvider.ClientName, class = 'ui-tip', ResizeMethod = 'ZoomAndCrop' }")
					</span>
				#end
			#end
		</div>

		#set($hasUserLinks = true)
		#set ($userLinks = $links.Values('Link'))
		#foreach($link in $userLinks)
		#beforeall
			<ul class="navigation-list user">
		#each
			#if($link == 'UserInformation')
				#set($url = false)
				#set($url = $user.ProfileUrl)
				#if ($url)
					<li class="navigation-list-item">
						<a href="$core_v2_encoding.HtmlAttributeEncode($user.ProfileUrl)">$core_v2_language.GetResource('Links_User_Profile')</a>
					</li>
					#set($hasUserLinks = true)
				#end
			#elseif($link == 'Settings')
				#set($url = false)
				#set($url = $core_v2_urls.Settings())
				#if ($url)
					<li class="navigation-list-item">
						<a href="$core_v2_encoding.HtmlAttributeEncode($url)">$core_v2_language.GetResource('Links_User_Settings')</a>
					</li>
					#set($hasUserLinks = true)
				#end
			#elseif($link == 'Invite')
				#set($url = false)
				#set($url = $core_v2_urls.Invite())
				#if ($url)
					<li class="navigation-list-item">
						<a href="$core_v2_encoding.HtmlAttributeEncode($url)">$core_v2_language.GetResource('Links_User_Invite')</a>
					</li>
					#set($hasUserLinks = true)
				#end
			#elseif($link == 'SignOut')
				#set($url = false)
				#set($url = $core_v2_urls.LogOut())
				#if ($url)
					<li class="navigation-list-item logout">
						<a href="$core_v2_encoding.HtmlAttributeEncode($url)" class="internal-link logout">
							#if($isImpersonated)$core_v2_language.GetResource('StopImpersonating')#else$core_v2_language.GetResource('Links_User_Logout')#end
						</a>
					</li>
					#set($hasUserLinks = true)
				#end
			#end
		#afterall
			</ul>
		#end
	</script>


	<script type="text/javascript" src="$core_v2_encoding.HtmlAttributeEncode($core_v2_widget.GetFileUrl('ui.js'))"></script>
#end
#registerEndOfPageHtml()
	<script type="text/javascript">
		#set($DQ = '"')

		#set($conversationListFooterContent = "<a href=${DQ}${core_v2_urls.Conversations()}${DQ} class=${DQ}left${DQ}>$core_v2_language.GetResource('Conversations_More')</a><a href=${DQ}#${DQ} data-messagename=${DQ}widget.${core_v2_widget.WrapperElementId}.startconversation${DQ} class=${DQ}right${DQ}>$core_v2_language.GetResource('Conversation_Send')</a>")


		#set($notificationSettingsUrl = $core_v2_urls.Settings())
		#set($notificationListFooterContent = "<a href=${DQ}#${DQ} class=${DQ}mark-read left${DQ} #if ($notificationsUnread == 0) style=${DQ}display:none${DQ} #end>$core_v2_language.GetResource('Notifications_Mark')</a><a class=${DQ}right${DQ} href=${DQ}${notificationSettingsUrl}${DQ}>$core_v2_language.GetResource('Links_User_Settings')</a>")

		#set($bookmarksUrl = $core_v2_urls.Favorites($core_v2_user.Accessing.Id))
		#set($bookmarksListFooterContent = "<a class=${DQ}left${DQ} href=${DQ}${bookmarksUrl}${DQ}>$core_v2_language.GetResource('Bookmarks_More')</a>")
		## possibly show bookmark/unbookmark link
		#if ($isRegistered && $currentContent && $user && $currentContent.ContentId != $user.ContentId)
			#set ($currentContentBookmark = $core_v2_bookmark.Get($currentContent.ContentId))
			#if ($currentContentBookmark)
				#set ($isBookmarked = true)
			#end
			#set ($currentContentId = $currentContent.ContentId)
			#set ($bookmarkComponent = $core_v2_ui.Bookmark($currentContent.ContentId, $currentContent.ContentTypeId, "%{ CssClass = 'right' }"))
			#set ($bookmarksListFooterContent = "${bookmarksListFooterContent}${bookmarkComponent}")
		#end

		#set($searchListFooterContent = "<a data-messagename=${DQ}widget.${core_v2_widget.WrapperElementId}.advancedsearch${DQ} id=${DQ}$core_v2_widget.UniqueId('advancedsearch')${DQ} href=${DQ}#${DQ}>$core_v2_language.GetResource('Advanced_Search')</a>")

		jQuery(function(){
			jQuery.telligent.evolution.widgets.siteBanner.register({
				wrapper: '#$core_v2_widget.WrapperElementId',

				messagePrefix: 'widget.${core_v2_widget.WrapperElementId}.',
				banner: jQuery('#$core_v2_encoding.JavascriptEncode($bannerId)'),

        useQuestFooter: '$core_v2_encoding.JavascriptEncode($useQuestFooter)',
				handheldSearchFieldsLink: jQuery('#$core_v2_encoding.JavascriptEncode($handheldSearchFieldsLinkId)'),
				handheldSearchFields: jQuery('#$core_v2_encoding.JavascriptEncode($searchFieldsId)'),
				handheldBannerLinksLink: jQuery('#$core_v2_encoding.JavascriptEncode($handheldBannerUserLinksLinkId)'),
				handheldBannerLinks: jQuery('#$core_v2_encoding.JavascriptEncode($handheldBannerUserLinksId)'),
				searchFields: jQuery('#$core_v2_encoding.JavascriptEncode($searchFieldsId)'),

				utilityDropdown: jQuery('#$core_v2_encoding.JavascriptEncode($utilityDropdown)'),

				bannerLinks: jQuery('#$core_v2_encoding.JavascriptEncode($bannerUserLinksId)'),
				handheldBannerLinksCount: jQuery('#$core_v2_encoding.JavascriptEncode($handheldBannerUserLinksCountId)'),
				bannerSiteLinks: jQuery('#$core_v2_encoding.JavascriptEncode($bannerSiteLinksId)'),
				handheldSiteLinksLink: jQuery('#$core_v2_encoding.JavascriptEncode($handheldSiteLinksLinkId)'),
				handheldSiteLinks: jQuery('#$core_v2_encoding.JavascriptEncode($handheldSiteLinksId)'),

				notificationsTemplate: '$core_v2_encoding.JavascriptEncode($listTemplate)',
				notificationsUrl: '$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('notifications.vm'))',
				notificationsLink: jQuery('#$core_v2_widget.UniqueId('notifications')'),
				notificationsUnread: $notificationsUnread,
				notificationListFooterContent: '$core_v2_encoding.JavascriptEncode($notificationListFooterContent)',
				notificationPreferenceTemplate: '$core_v2_encoding.JavascriptEncode($notificationPreferenceTemplate)',
				notificationssUnreadCountMessageSingular: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Notifications_UnreadCountMessageSingular'))',
				notificationssUnreadCountMessagePlural: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Notifications_UnreadCountMessagePlural'))',
				notificationsFilterTemplate: '$core_v2_encoding.JavascriptEncode($notificationFilterTemplate)',

				conversationsTemplate: '$core_v2_encoding.JavascriptEncode($listTemplate)',
				conversationsUrl: '$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('conversations.vm'))',
				conversationsLink: jQuery('#$core_v2_widget.UniqueId('conversations')'),
				conversationsUnread: $conversationsUnread,
				conversationNotificationTypeId: '$core_v2_conversationMessage.NotificationTypeId',
				conversationListFooterContent: '$core_v2_encoding.JavascriptEncode($conversationListFooterContent)',
				conversationsUnreadCountMessageSingular: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Conversations_UnreadCountMessageSingular'))',
				conversationsUnreadCountMessagePlural: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Conversations_UnreadCountMessagePlural'))',
				conversationNewConversationModalUrl: '$core_v2_encoding.JavascriptEncode($core_v2_urls.AddConversation())',

				bookmarksTemplate: '$core_v2_encoding.JavascriptEncode($listTemplate)',
				bookmarksUrl: '$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('bookmarks.vm'))',
				bookmarksLink: jQuery('#$core_v2_widget.UniqueId('bookmarks')'),
				bookmarksListFooterContent: '$core_v2_encoding.JavascriptEncode($bookmarksListFooterContent)',
				bookmarksContentTypes: '$core_v2_encoding.JavascriptEncode($contentTypes)',
				bookmarksApplicationContentTypes: '$core_v2_encoding.JavascriptEncode($applicationContentTypes)',
				bookmarksContainerContentTypes: '$core_v2_encoding.JavascriptEncode($containerContentTypes)',
				bookmarksFilterTemplate: '$core_v2_encoding.JavascriptEncode($bookmarkFilterTemplate)',
				bookmarksIsBookmarked: #if($isBookmarked) true #else false #end,
				bookmarksCurrentContentId: '$currentContentId',
				bookmarksBookmarks: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Bookmarks'))',
				bookmarkAdded: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Bookmark_Added'))',
				bookmarkRemoved: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Bookmark_Removed'))',

				userPopupTemplate: '$core_v2_encoding.JavascriptEncode($listTemplate)',
				userContentTemplate: '$core_v2_encoding.JavascriptEncode($userTemplate)',
				userLink: jQuery('#$core_v2_widget.UniqueId('user')'),

				searchType: '$siteSearch',
				#if ($siteSearch == "Default")
				searchTemplate: '$core_v2_encoding.JavascriptEncode($listTemplate)',
				searchUrl: '$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('search.vm'))',
				searchInput: jQuery('#$core_v2_encoding.JavascriptEncode($searchId)'),
				searchFooterContent: '$core_v2_encoding.JavascriptEncode($searchListFooterContent)',
				searchFilterTemplate: '$core_v2_encoding.JavascriptEncode($searchFilterTemplate)',
				searchAdvancedUrl: '$core_v2_encoding.JavascriptEncode($core_v2_urls.Search("%{ QueryString = '{0}' }"))',
				searchAdvancedUserUrl: '$core_v2_encoding.JavascriptEncode($core_v2_urls.UserList("%{ QueryString = '{0}' }"))',
				searchFilterContentName: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Search_Filter_Content'))',
				searchFilterGroupsName: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Search_Filter_Groups'))',
				searchFilterPeopleName: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Search_Filter_People'))',
				searchPlaceApplicationId: #if ($currentApplication) '$currentApplication.ApplicationId' #else null #end,
				searchPlaceApplicationName: #if ($currentApplication) '$core_v2_encoding.JavascriptEncode($core_v2_language.FormatString($core_v2_language.GetResource('Search_Filter_In'), $currentApplication.HtmlName('')))' #else null #end,
				searchPlaceGroupId: #if ($currentGroup) '$currentGroup.ContainerId' #else null #end,
        searchPlaceGroupLocalId: #if ($currentGroup) '$currentGroup.Id' #else null #end,
				searchPlaceGroupName: #if ($currentGroup) '$core_v2_encoding.JavascriptEncode($core_v2_language.FormatString($core_v2_language.GetResource('Search_Filter_In'), $currentGroup.Name))' #else null #end,
				searchPlaceAnywhereName: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Search_Filter_Anywhere'))',
				advancedSearchId: '$core_v2_widget.UniqueId('advancedsearch')',
				searchShowPeople: #if($core_v2_nodePermission.Get('Site_ReadProfiles').IsAllowed) true#else false#end,
				#else
				searchInput: jQuery('#$core_v2_encoding.JavascriptEncode($searchId)'),
				#end

				siteNavigationType: '$core_v2_encoding.JavascriptEncode($siteNavigationType)'
			});
		});
	</script>
#end]]></contentScript>
		<headerScript><![CDATA[
$core_v2_widget.ApplyTokens($core_v2_widget.GetStringValue('fragmentHeader', '${resource:SiteBanner}'))
			]]></headerScript>
		<configuration><![CDATA[<propertyGroup id="options" resourceName="Options">
	<property id="fragmentHeader" resourceName="CF_Title" dataType="string" defaultValue="${resource:SiteBanner}" controlType="Telligent.Evolution.Controls.ContentFragmentTokenStringControl, Telligent.Evolution.Controls" />
	<property id="siteBrand" dataType="string" resourceName="Site_Brand" descriptionResourceName="Site_Brand_Description" defaultValue="exclude" controlType="Telligent.Evolution.Controls">
		<propertyValue value="dsg" resourceName="Site_Brand_DSG"/>
		<propertyValue value="quest" resourceName="Site_Brand_Quest"/>
	</property>
	<property id="siteSearch" dataType="string" resourceName="Site_Search" descriptionResourceName="Site_Search_Description" defaultValue="Default">
		<propertyValue value="Default" resourceName="Site_Search_Default"/>
		<propertyValue value="Quest" resourceName="Site_Search_Quest"/>
	</property>
	<property id="useQuestFooter" resourceName="CF_Quest_Footer" dataType="bool" defaultValue="false" />
	<property id="links" resourceName="Links" descriptionResourceName="Links_Description" dataType="custom" defaultValue="Link=Notifications&amp;Link=Inbox&amp;Link=Bookmarks&amp;Link=User&amp;Link=Invite&amp;Link=UserInformation&amp;Link=Settings&amp;Link=SignOut" controlType="Telligent.Evolution.Controls.SortableListControl, Telligent.Evolution.Controls" height="275" key="Link" >
		<propertyValue value="Notifications" resourceName="Links_Notifications" />
		<propertyValue value="Inbox" resourceName="Links_Inbox" />
		<propertyValue value="Bookmarks" resourceName="Links_Bookmarks" />
		<propertyValue value="User" resourceName="Links_User" />
		<propertyValue value="Invite" resourceName="Links_User_Invite" />
		<propertyValue value="Settings" resourceName="Links_User_Settings" />
		<propertyValue value="UserInformation" resourceName="Links_User_Profile" />
		<propertyValue value="SignOut" resourceName="Links_User_Logout" />
	</property>
</propertyGroup>
<propertyGroup id="group2" resourceName="NavigationTab">
    <property id="siteNavigation" dataType="string" resourceName="Site_Navigation" descriptionResourceName="Site_Navigation_Description" defaultValue="exclude" controlType="Telligent.Evolution.Controls.PropertyVisibilityValueSelectionControl, Telligent.Evolution.Controls">
		<propertyValue value="exclude" resourceName="Site_Navigation_Exclude" propertiesToHide="navHTML"/>
		<propertyValue value="default" resourceName="Site_Navigation_Default" propertiesToHide="navHTML"/>
		<propertyValue value="custom" resourceName="Site_Navigation_Custom" propertiesToShow="navHTML"/>
		<propertyValue value="quest" resourceName="Site_Navigation_Quest" propertiesToHide="navHTML"/>
	</property>
	<property id="navHTML" resourceName="CF_Navigation_Content" dataType="html" controlType="Telligent.Evolution.Controls.HtmlEditorStringControl, Telligent.Evolution.Controls" width="100%" height="250px"/>
</propertyGroup>]]></configuration>
		<languageResources><language key="en-us">
  <resource name="SiteBanner">Site - Banner</resource>
  <resource name="SiteBannerDescription">Provides site-level navigation for users.</resource>
  <resource name="Options">Options</resource>
  <resource name="CF_Title">Widget Title</resource>
  <resource name="Site_Navigation">Site Navigation</resource>
  <resource name="Site_Navigation_Description">Optionally include group browsing or custom navigation alongside search and user links.</resource>
  <resource name="Site_Navigation_Exclude">Exclude</resource>
  <resource name="Site_Navigation_Group">Include Group Navigation</resource>
  <resource name="Site_Navigation_MyGroup">Include Accessing User's Group Navigation</resource>
  <resource name="Site_Navigation_Custom">Include Custom Navigation</resource>
  <resource name="Custom_Navigation">Custom Navigation Items</resource>
  <resource name="Custom_Navigation_Description">Add, edit, delete, and reorder custom navigation items.</resource>
  <resource name="navigation_custom"></resource>
  <resource name="Site_Navigation_Groups_More">All Groups</resource>
  <resource name="GroupInclusion">Include Groups</resource>
  <resource name="Site">Site</resource>
  <resource name="Links">User Links</resource>
  <resource name="Links_Description">Select, rearrange, and enable the links to be displayed</resource>
  <resource name="Links_Notifications">Notifications</resource>
  <resource name="Links_Inbox">Inbox</resource>
  <resource name="Links_Bookmarks">Bookmarks</resource>
  <resource name="Links_User">User</resource>
  <resource name="Links_User_Invite">Invite a member</resource>
  <resource name="Links_User_Settings">Settings</resource>
  <resource name="Links_User_Profile">Profile</resource>
  <resource name="Links_User_Logout">Sign Out</resource>
  <resource name="JoinSignIn">Join or Sign In</resource>
  <resource name="Cancel">Cancel</resource>
  <resource name="Bookmarks">Bookmarks</resource>
  <resource name="Bookmarks_More">View All</resource>
  <resource name="Bookmarks_None">You have no bookmarks.</resource>
  <resource name="Bookmark_Filter_Content">Content</resource>
  <resource name="Bookmark_Filter_Application">Application</resource>
  <resource name="Bookmark_Added">Bookmark Added</resource>
  <resource name="Bookmark_Removed">Bookmark Removed</resource>
  <resource name="Notifications">Notifications</resource>
  <resource name="Notifications_None">No notifications. Go get busy in the community!</resource>
  <resource name="TurnOffNotifications">Turn off</resource>
  <resource name="TurnOff">Confirm</resource>
  <resource name="TurnOffQuestion">Do not notify me when someone</resource>
  <resource name="TurnOffQuestionSuffix">?</resource>
  <resource name="Notifications_UnreadCountMessageSingular">You have {0} unread notification</resource>
  <resource name="Notifications_UnreadCountMessagePlural">You have {0} unread notifications</resource>
  <resource name="Notifications_Mark">Mark as Read</resource>
  <resource name="Notification_Filter_Unread">Unread</resource>
  <resource name="Notification_Filter_All">All</resource>
  <resource name="Conversations_Inbox">Inbox</resource>
  <resource name="Conversations_More">View All</resource>
  <resource name="Conversations_None">You have no messages.</resource>
  <resource name="Conversation_Send">New Message</resource>
  <resource name="Conversations_UnreadCountMessageSingular">You have {0} unread message</resource>
  <resource name="Conversations_UnreadCountMessagePlural">You have {0} unread messages</resource>
  <resource name="user">User</resource>
  <resource name="StopImpersonating">Stop Impersonating</resource>
  <resource name="Search_Filter_In">In {0}</resource>
  <resource name="Search_Filter_Anywhere">Anywhere</resource>
  <resource name="Search_Filter_Content">Content</resource>
  <resource name="Search_Filter_Groups">Groups</resource>
  <resource name="Search_Filter_People">People</resource>
  <resource name="Advanced_Search">Advanced Search</resource>
  <resource name="No_Results">No Results</resource>
  <resource name="Groups_NoGroups">There are no groups created in this site yet.</resource>
  <resource name="Core_SiteUserNavigation_Logo">Logo (optimal image size is 250*88px)</resource>
  <resource name="Core_SiteUserNavigation_Home">Home</resource>
  <resource name="Search">What can we help you find?</resource>
  <resource name="TourTipSearch">Use search within the community to find people, content and groups. You can also use it to help navigate through the community.</resource>
  <resource name="TourTipNavigation">Navigate the community</resource>
  <resource name="TourTipSignIn">Sign in or Join the community.</resource>
  <resource name="TourTipNotifications">View recent notifications.</resource>
  <resource name="TourTipBookmarks">View bookmarks or bookmark the current page.</resource>
  <resource name="TourTipMessages">View your latest conversations.</resource>
  <resource name="TourTipProfile">Update your profile, change your settings or sign out.</resource>
  <resource name="loading">Loading...</resource>
  <resource name="Site_Navigation_Quest">Use Quest Navigation</resource>
  <resource name="Site_Search">Site Search</resource>
  <resource name="Site_Search_Description">Choose search methods</resource>
  <resource name="Site_Search_Default">Default search provided by Telligent</resource>
  <resource name="Site_Search_Quest">Utilize Quest Search</resource>
  <resource name="CF_Quest_Footer">Use Quest Footer</resource>
  <resource name="Site_Brand_Description">Select Brand</resource>
  <resource name="Site_Brand">Brand</resource>
  <resource name="Site_Brand_DSG">Dell Software</resource>
  <resource name="Site_Brand_Quest">Quest Software</resource>
  <resource name="NavigationTab">Navigation</resource>
  <resource name="CF_Navigation_Content">Please enter navigation HTML</resource>
  <resource name="Site_Navigation_Default">Default site navigation</resource>
</language></languageResources>
		<additionalCssScript><![CDATA[masthead-container]]></additionalCssScript>
		<files>
			<file name="bookmarks.vm">77u/I3NldCAoJHBhZ2VJbmRleCA9ICRjb3JlX3YyX3V0aWxpdHkuUGFyc2VJbnQoJGNvcmVfdjJfcGFnZS5HZXRRdWVyeVN0cmluZ1ZhbHVlKCd3X3BhZ2VJbmRleCcpKSkNCiNzZXQgKCRjb250ZW50VHlwZUlkcyA9ICRjb3JlX3YyX3BhZ2UuR2V0UXVlcnlTdHJpbmdWYWx1ZSgnd19jb250ZW50VHlwZUlkcycpKQ0KI2lmICgkY29udGVudFR5cGVJZHMgJiYgJGNvbnRlbnRUeXBlSWRzLkxlbmd0aCA+IDApDQoJI3NldCAoJGJvb2ttYXJrcyA9ICRjb3JlX3YyX2Jvb2ttYXJrLkxpc3QoIiV7IFBhZ2VJbmRleCA9ICRwYWdlSW5kZXgsIFBhZ2VTaXplID0gMTAsIFNvcnRCeSA9ICdEYXRlJywgU29ydE9yZGVyID0gJ0Rlc2NlbmRpbmcnLCBDb250ZW50VHlwZUlkcyA9ICRjb250ZW50VHlwZUlkcyB9IikpDQojZWxzZQ0KCSNzZXQgKCRib29rbWFya3MgPSAkY29yZV92Ml9ib29rbWFyay5MaXN0KCIleyBQYWdlSW5kZXggPSAkcGFnZUluZGV4LCBQYWdlU2l6ZSA9IDEwLCBTb3J0QnkgPSAnRGF0ZScsIFNvcnRPcmRlciA9ICdEZXNjZW5kaW5nJyB9IikpDQojZW5kDQojc2V0ICgkYWNjZXNzaW5nVXNlciA9ICRjb3JlX3YyX3VzZXIuQWNjZXNzaW5nKQ0KDQojc2V0ICgkaGFzTW9yZSA9IGZhbHNlKQ0KI3NldCAoJGN1cnJlbnRQYWdlZFF1YW50aXR5ID0gKCRib29rbWFya3MuUGFnZUluZGV4ICsgMSkgKiAkYm9va21hcmtzLlBhZ2VTaXplKQ0KI2lmICgkYm9va21hcmtzLlRvdGFsQ291bnQgPiAkY3VycmVudFBhZ2VkUXVhbnRpdHkpDQoJI3NldCAoJGhhc01vcmUgPSB0cnVlKQ0KI2VuZA0KDQojc2V0ICgkcm9vdEdyb3VwID0gJGNvcmVfdjJfZ3JvdXAuUm9vdCkNCg0KI2ZvcmVhY2ggKCRib29rbWFyayBpbiAkYm9va21hcmtzKQ0KCSMjIHJlbmRlciBib29rbWFyaw0KCSNzZXQgKCRjb250ZW50ID0gZmFsc2UpDQoJI3NldCAoJGNvbnRlbnQgPSAkYm9va21hcmsuQ29udGVudCkNCgkjaWYgKCRjb250ZW50KQ0KCQkjIyBkZXRlcm1pbmUgYW4gaW1hZ2UgdG8gdXNlLiBQcmVmZXJyaW5nIGNvbnRlbnQgb3ZlciBhcHBsaWNhdGlvbiBvdmVyIGNvbnRhaW5lcg0KCQkjc2V0ICgkaW1hZ2VVcmwgPSBmYWxzZSkNCgkJI3NldCAoJGltYWdlVXJsID0gJGNvbnRlbnQuQXZhdGFyVXJsKQ0KCQkjaWYgKCghJGltYWdlVXJsIHx8ICRpbWFnZVVybCA9PSAnJykgJiYgJGNvbnRlbnQuQXBwbGljYXRpb24pDQoJCQkjc2V0ICgkaW1hZ2VVcmwgPSAkY29udGVudC5BcHBsaWNhdGlvbi5BdmF0YXJVcmwpDQoJCQkjaWYgKCghJGltYWdlVXJsIHx8ICRpbWFnZVVybCA9PSAnJykgJiYgJGNvbnRlbnQuQXBwbGljYXRpb24uQ29udGFpbmVyKQ0KCQkJCSNzZXQgKCRpbWFnZVVybCA9ICRjb250ZW50LkFwcGxpY2F0aW9uLkNvbnRhaW5lci5BdmF0YXJVcmwpDQoJCQkjZW5kDQoJCSNlbmQNCgkJPGxpIGNsYXNzPSJjb250ZW50LWl0ZW0iIGRhdGEtY29udGVudHVybD0iJGNvbnRlbnQuVXJsIiAjaWYoJGhhc01vcmUpIGRhdGEtaGFzbW9yZT0idHJ1ZSIgI2VuZD4NCgkJCSNpZiAoJGltYWdlVXJsKQ0KCQkJCTxkaXYgY2xhc3M9InBvc3QtYXV0aG9yIj4NCgkJCQkJPHNwYW4gY2xhc3M9ImF2YXRhciI+DQoJCQkJCQk8YSBocmVmPSIkY29yZV92Ml9lbmNvZGluZy5IdG1sQXR0cmlidXRlRW5jb2RlKCRjb250ZW50LlVybCkiIGNsYXNzPSJpbnRlcm5hbC1saW5rIj4NCgkJCQkJCQkkY29yZV92Ml91aS5HZXRSZXNpemVkSW1hZ2VIdG1sKCRpbWFnZVVybCwgNDAsIDQwLCAiJXtib3JkZXI9JzAnLCBhbHQ9JGNvbnRlbnQuSHRtbE5hbWUoJ1dlYicpLCBSZXNpemVNZXRob2Q9J1pvb21BbmRDcm9wJyxib3JkZXI9JzAnfSIpDQoJCQkJCQk8L2E+DQoJCQkJCTwvc3Bhbj4NCgkJCQk8L2Rpdj4NCgkJCSNlbmQNCgkJCTxkaXYgY2xhc3M9ImNvbnRlbnQiPg0KCQkJCSNzZXQgKCRuYW1lID0gJGNvcmVfdjJfbGFuZ3VhZ2UuVHJ1bmNhdGUoJGNvbnRlbnQuSHRtbE5hbWUoJ1dlYicpLCA1MCwgJ+KApicpKQ0KCQkJCSNpZiAoJG5hbWUubGVuZ3RoID09IDApDQoJCQkJCSNzZXQgKCRuYW1lID0gJGNvcmVfdjJfbGFuZ3VhZ2UuVHJ1bmNhdGUoJGNvbnRlbnQuSHRtbERlc2NyaXB0aW9uKCdXZWInKSwgNTAsICfigKYnKSkNCgkJCQkjZW5kDQoJCQkJJG5hbWUNCgkJCTwvZGl2Pg0KCQkJI2lmICgkY29udGVudCAmJiAkY29udGVudC5BcHBsaWNhdGlvbiAmJiAkY29udGVudC5BcHBsaWNhdGlvbi5Db250YWluZXIgJiYgJGNvbnRlbnQuVXJsICE9ICRjb250ZW50LkFwcGxpY2F0aW9uLkNvbnRhaW5lci5VcmwpDQoJCQkJI2lmICgkcm9vdEdyb3VwLkNvbnRhaW5lcklkICE9ICRjb250ZW50LkFwcGxpY2F0aW9uLkNvbnRhaW5lci5Db250YWluZXJJZCkNCgkJCQkJPHNwYW4gY2xhc3M9ImNvbnRlbnQtZ3JvdXAiPg0KCQkJCQkJPGEgaHJlZj0iJGNvcmVfdjJfZW5jb2RpbmcuSHRtbEF0dHJpYnV0ZUVuY29kZSgkY29udGVudC5BcHBsaWNhdGlvbi5Db250YWluZXIuVXJsKSI+JGNvbnRlbnQuQXBwbGljYXRpb24uQ29udGFpbmVyLkh0bWxOYW1lKCdXZWInKTwvYT4NCgkJCQkJPC9zcGFuPg0KCQkJCSNlbmQNCgkJCSNlbmQNCgkJPC9saT4NCgkjZW5kDQojbm9kYXRhDQoJPGRpdiBjbGFzcz0ibWVzc2FnZSBub3JlY29yZHMiPiRjb3JlX3YyX2xhbmd1YWdlLkdldFJlc291cmNlKCdCb29rbWFya3NfTm9uZScpPC9kaXY+DQojZW5k</file>
			<file name="conversations.vm">77u/I3NldCAoJHBhZ2VJbmRleCA9ICRjb3JlX3YyX3V0aWxpdHkuUGFyc2VJbnQoJGNvcmVfdjJfcGFnZS5HZXRRdWVyeVN0cmluZ1ZhbHVlKCd3X3BhZ2VJbmRleCcpKSkNCiNzZXQgKCRjb252ZXJzYXRpb25zID0gJGNvcmVfdjJfY29udmVyc2F0aW9uLkxpc3QoIiV7IFBhZ2VJbmRleCA9ICRwYWdlSW5kZXgsIFBhZ2VTaXplID0gMTAgfSIpKQ0KI3NldCAoJGFjY2Vzc2luZ1VzZXIgPSAkY29yZV92Ml91c2VyLkFjY2Vzc2luZykNCiNzZXQgKCRtYXhQYXJ0aWNpcGFudEF2YXRhcnMgPSA1KQ0KDQojc2V0ICgkaGFzTW9yZSA9IGZhbHNlKQ0KI3NldCAoJGN1cnJlbnRQYWdlZFF1YW50aXR5ID0gKCRjb252ZXJzYXRpb25zLlBhZ2VJbmRleCArIDEpICogJGNvbnZlcnNhdGlvbnMuUGFnZVNpemUpDQojaWYgKCRjb252ZXJzYXRpb25zLlRvdGFsQ291bnQgPiAkY3VycmVudFBhZ2VkUXVhbnRpdHkpDQoJI3NldCAoJGhhc01vcmUgPSB0cnVlKQ0KI2VuZA0KDQojZm9yZWFjaCAoJGNvbnZlcnNhdGlvbiBpbiAkY29udmVyc2F0aW9ucykNCgkjc2V0ICgkbGFzdE1lc3NhZ2UgPSAkY29udmVyc2F0aW9uLkxhc3RNZXNzYWdlKQ0KDQoJIyMgcmVuZGVyIGNvbnZlcnNhdGlvbg0KCTxsaSBjbGFzcz0iY29udGVudC1pdGVtICNpZighJGNvbnZlcnNhdGlvbi5IYXNSZWFkKSB1bnJlYWQgI2VuZCIgZGF0YS1jb250ZW50dXJsPSIkY29udmVyc2F0aW9uLlVybCIgI2lmKCRoYXNNb3JlKSBkYXRhLWhhc21vcmU9InRydWUiICNlbmQ+DQoJCTxkaXYgY2xhc3M9InBvc3QtYXV0aG9yIj4NCgkJCTxzcGFuIGNsYXNzPSJhdmF0YXIiPg0KCQkJCTxhIGhyZWY9IiRjb3JlX3YyX2VuY29kaW5nLkh0bWxBdHRyaWJ1dGVFbmNvZGUoJGxhc3RNZXNzYWdlLkF1dGhvci5VcmwpIiBjbGFzcz0iaW50ZXJuYWwtbGluayI+DQoJCQkJCSRjb3JlX3YyX3VpLkdldFJlc2l6ZWRJbWFnZUh0bWwoJGxhc3RNZXNzYWdlLkF1dGhvci5BdmF0YXJVcmwsIDQwLCA0MCwgIiV7Ym9yZGVyPScwJywgYWx0PSRjb250ZW50Lkh0bWxOYW1lKCdXZWInKSwgUmVzaXplTWV0aG9kPSdab29tQW5kQ3JvcCcsYm9yZGVyPScwJ30iKQ0KCQkJCTwvYT4NCgkJCTwvc3Bhbj4NCgkJPC9kaXY+DQoJCTxkaXYgY2xhc3M9InBvc3QtYXV0aG9ycyI+DQoJCQkjc2V0ICgkRFEgPSAnIicpDQoJCQkjc2V0ICgkYXV0aG9ycyA9ICIiKQ0KCQkJI2ZvcmVhY2ggKCRwYXJ0aWNpcGFudCBpbiAkY29udmVyc2F0aW9uLlBhcnRpY2lwYW50cykNCgkJCQkjc2V0ICgkYXV0aG9ycyA9ICIkYXV0aG9yczxhIGNsYXNzPSR7RFF9aW50ZXJuYWwtbGluayB2aWV3LXVzZXItcHJvZmlsZSR7RFF9IGhyZWY9JHtEUX0kY29yZV92Ml9lbmNvZGluZy5IdG1sQXR0cmlidXRlRW5jb2RlKCRwYXJ0aWNpcGFudC5Qcm9maWxlVXJsKSR7RFF9PiRwYXJ0aWNpcGFudC5EaXNwbGF5TmFtZTwvYT4iKQ0KCQkJI2JldHdlZW4NCgkJCQkjc2V0ICgkYXV0aG9ycyA9ICIkYXV0aG9ycywgIikNCgkJCSNlbmQNCgkJCSRhdXRob3JzDQoJCTwvZGl2Pg0KCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4NCgkJCSNzZXQgKCRleGNlcnB0ID0gJGNvcmVfdjJfbGFuZ3VhZ2UuVHJ1bmNhdGUoJGxhc3RNZXNzYWdlLkh0bWxEZXNjcmlwdGlvbignV2ViJyksIDUwLCAn4oCmJykpDQoJCQkjaWYgKCRleGNlcnB0Lmxlbmd0aCA9PSAwKQ0KCQkJCSNzZXQgKCRleGNlcnB0ID0gJGNvcmVfdjJfbGFuZ3VhZ2UuVHJ1bmNhdGUoJGNvbnZlcnNhdGlvbi5GaXJzdE1lc3NhZ2UuU3ViamVjdCwgNTAsICfigKYnKSkNCgkJCSNlbmQNCgkJCSRleGNlcnB0DQoJCTwvZGl2Pg0KCQk8ZGl2IGNsYXNzPSJwb3N0LWRhdGUiPg0KCQkJPHNwYW4gY2xhc3M9InZhbHVlIj4kY29yZV92Ml9sYW5ndWFnZS5Gb3JtYXRBZ29EYXRlKCRjb252ZXJzYXRpb24uTGFzdE1lc3NhZ2UuQ3JlYXRlZERhdGUpPC9zcGFuPg0KCQk8L2Rpdj4NCgk8L2xpPg0KI25vZGF0YQ0KCTxkaXYgY2xhc3M9Im1lc3NhZ2Ugbm9yZWNvcmRzIj4kY29yZV92Ml9sYW5ndWFnZS5HZXRSZXNvdXJjZSgnQ29udmVyc2F0aW9uc19Ob25lJyk8L2Rpdj4NCiNlbmQ=</file>
			<file name="notifications.vm">77u/I3NldCAoJGZpbHRlciA9ICRjb3JlX3YyX3BhZ2UuR2V0UXVlcnlTdHJpbmdWYWx1ZSgnd19maWx0ZXInKSkNCiNzZXQgKCRwYWdlSW5kZXggPSAkY29yZV92Ml91dGlsaXR5LlBhcnNlSW50KCRjb3JlX3YyX3BhZ2UuR2V0UXVlcnlTdHJpbmdWYWx1ZSgnd19wYWdlSW5kZXgnKSkpDQojc2V0ICgkcGFnZVNpemUgPSAxMCkNCg0KI3NldCAoJG9wdGlvbnMgPSAiJXsgUGFnZUluZGV4ID0gJHBhZ2VJbmRleCwgUGFnZVNpemUgPSAkcGFnZVNpemUgfSIpDQojc2V0ICgkY29udmVyc2F0aW9uTWVzc2FnZU5vdGlmaWNhdGlvbkZpbHRlck5hbWUgPSAiX0ZpbHRlcnNfJHtjb3JlX3YyX2NvbnZlcnNhdGlvbk1lc3NhZ2UuTm90aWZpY2F0aW9uVHlwZUlkfSIpDQokb3B0aW9ucy5BZGQoJGNvbnZlcnNhdGlvbk1lc3NhZ2VOb3RpZmljYXRpb25GaWx0ZXJOYW1lLCAnRXhjbHVkZScpDQojaWYgKCRmaWx0ZXIgPT0gJ3VucmVhZCcpDQoJJG9wdGlvbnMuQWRkKCdJc1JlYWQnLCAnZmFsc2UnKQ0KI2VuZA0KI3NldCAoJG5vdGlmaWNhdGlvbnMgPSAkY29yZV92Ml9ub3RpZmljYXRpb24uTGlzdCgkb3B0aW9ucykpDQoNCiNzZXQgKCRoYXNNb3JlID0gZmFsc2UpDQojc2V0ICgkY3VycmVudFBhZ2VkUXVhbnRpdHkgPSAoJG5vdGlmaWNhdGlvbnMuUGFnZUluZGV4ICsgMSkgKiAkbm90aWZpY2F0aW9ucy5QYWdlU2l6ZSkNCiNpZiAoJG5vdGlmaWNhdGlvbnMuVG90YWxDb3VudCA+ICRjdXJyZW50UGFnZWRRdWFudGl0eSkNCgkjc2V0ICgkaGFzTW9yZSA9IHRydWUpDQojZW5kDQoNCiNmb3JlYWNoICgkbm90aWZpY2F0aW9uIGluICRub3RpZmljYXRpb25zKQ0KCSNzZXQgKCRsYXN0QWN0b3IgPSBmYWxzZSkNCgkjc2V0ICgkYWN0b3JzID0gJG5vdGlmaWNhdGlvbi5BY3RvcnMpDQoJI3NldCAoJGxhc3RJbmRleCA9ICRhY3RvcnMuQ291bnQgLSAxKQ0KCSNzZXQgKCRsYXN0QWN0b3IgPSAkYWN0b3JzLlRvQXJyYXkoKS5nZXQoJGxhc3RJbmRleCkuVXNlcikNCgkjc2V0ICgkbm90aWZpY2F0aW9uVHlwZSA9ICRjb3JlX3YyX25vdGlmaWNhdGlvblR5cGUuR2V0KCRub3RpZmljYXRpb24uTm90aWZpY2F0aW9uVHlwZUlkKSkNCg0KCSNpZiAoJG5vdGlmaWNhdGlvblR5cGUuTm90aWZpY2F0aW9uVHlwZUlkID09ICRjb3JlX3YyX3JhdGVkSXRlbS5Ob3RpZmljYXRpb25UeXBlSWQpDQoJCSNzZXQgKCRsYXN0QWN0b3IgPSBmYWxzZSkNCgkjZW5kDQoNCgkjIyByZW5kZXIgbm90aWZpY2F0aW9uDQoJI3NldCAoJG5vdGlmaWNhdGlvbk1lc3NhZ2UgPSBmYWxzZSkNCgkjc2V0ICgkbm90aWZpY2F0aW9uTWVzc2FnZSA9ICRub3RpZmljYXRpb24uTWVzc2FnZSgnSHRtbCcpKQ0KCSNpZiAoJG5vdGlmaWNhdGlvbk1lc3NhZ2UpDQoJCTxsaSBjbGFzcz0iY29udGVudC1pdGVtICNpZighJG5vdGlmaWNhdGlvbi5Jc1JlYWQpIHVucmVhZCAjZW5kICNpZiAoISRsYXN0QWN0b3IpIG5vLWF1dGhvciAjZW5kIiBkYXRhLWNvbnRlbnR1cmw9IiRub3RpZmljYXRpb24uVGFyZ2V0VXJsIg0KCQkJZGF0YS1ub3RpZmljYXRpb25pZD0iJG5vdGlmaWNhdGlvbi5Ob3RpZmljYXRpb25JZCINCgkJCWRhdGEtbm90aWZpY2F0aW9udHlwZWlkPSIkbm90aWZpY2F0aW9uLk5vdGlmaWNhdGlvblR5cGVJZCINCgkJCWRhdGEtbm90aWZpY2F0aW9udHlwZW5hbWU9IiRjb3JlX3YyX2VuY29kaW5nLkh0bWxBdHRyaWJ1dGVFbmNvZGUoJG5vdGlmaWNhdGlvblR5cGUuRGVzY3JpcHRpb24pIg0KCQkJI2lmKCRoYXNNb3JlKSBkYXRhLWhhc21vcmU9InRydWUiICNlbmQ+DQoNCgkJCSNpZiAoJGxhc3RBY3RvcikNCgkJCQk8ZGl2IGNsYXNzPSJwb3N0LWF1dGhvciI+DQoJCQkJCTxzcGFuIGNsYXNzPSJhdmF0YXIiPg0KCQkJCQkJI2lmICgkbGFzdEFjdG9yLlByb2ZpbGVVcmwpDQoJCQkJCQkJPGEgaHJlZj0iJGNvcmVfdjJfZW5jb2RpbmcuSHRtbEF0dHJpYnV0ZUVuY29kZSgkbGFzdEFjdG9yLlByb2ZpbGVVcmwpIiBjbGFzcz0iaW50ZXJuYWwtbGluayB2aWV3LXVzZXItcHJvZmlsZSI+DQoJCQkJCQkJCSRjb3JlX3YyX3VpLkdldFJlc2l6ZWRJbWFnZUh0bWwoJGxhc3RBY3Rvci5BdmF0YXJVcmwsIDQwLCA0MCwgIiV7Ym9yZGVyPScwJywgYWx0PSRsYXN0QWN0b3IuRGlzcGxheU5hbWUsIFJlc2l6ZU1ldGhvZD0nWm9vbUFuZENyb3AnLGJvcmRlcj0nMCd9IikNCgkJCQkJCQk8L2E+DQoJCQkJCQkjZWxzZQ0KCQkJCQkJCSRjb3JlX3YyX3VpLkdldFJlc2l6ZWRJbWFnZUh0bWwoJGxhc3RBY3Rvci5BdmF0YXJVcmwsIDQwLCA0MCwgIiV7Ym9yZGVyPScwJywgYWx0PSRsYXN0QWN0b3IuRGlzcGxheU5hbWUsIFJlc2l6ZU1ldGhvZD0nWm9vbUFuZENyb3AnLGJvcmRlcj0nMCd9IikNCgkJCQkJCSNlbmQNCgkJCQkJPC9zcGFuPg0KCQkJCQk8c3BhbiBjbGFzcz0idXNlci1uYW1lIj4NCgkJCQkJCSNpZiAoJGxhc3RBY3Rvci5Qcm9maWxlVXJsKQ0KCQkJCQkJCTxhIGhyZWY9IiRjb3JlX3YyX2VuY29kaW5nLkh0bWxBdHRyaWJ1dGVFbmNvZGUoJGxhc3RBY3Rvci5Qcm9maWxlVXJsKSIgY2xhc3M9ImludGVybmFsLWxpbmsgdmlldy11c2VyLXByb2ZpbGUiPg0KCQkJCQkJCQkkbGFzdEFjdG9yLkRpc3BsYXlOYW1lDQoJCQkJCQkJPC9hPg0KCQkJCQkJI2Vsc2UNCgkJCQkJCQkkbGFzdEFjdG9yLkRpc3BsYXlOYW1lDQoJCQkJCQkjZW5kDQoJCQkJCTwvc3Bhbj4NCgkJCQk8L2Rpdj4NCgkJCSNlbmQNCgkJCTxkaXYgY2xhc3M9ImNvbnRlbnQiPg0KCQkJCSRub3RpZmljYXRpb25NZXNzYWdlDQoJCQk8L2Rpdj4NCgkJCTxkaXYgY2xhc3M9InBvc3QtZGF0ZSI+DQoJCQkJPHNwYW4gY2xhc3M9InZhbHVlIj4kY29yZV92Ml9sYW5ndWFnZS5Gb3JtYXRBZ29EYXRlKCRub3RpZmljYXRpb24uTGFzdFVwZGF0ZWREYXRlKTwvc3Bhbj4NCgkJCTwvZGl2Pg0KCQkJPGRpdiBjbGFzcz0icHJlZmVyZW5jZSI+DQoJCQkJPGEgaHJlZj0iIyIgdGl0bGU9IiRjb3JlX3YyX2VuY29kaW5nLkh0bWxBdHRyaWJ1dGVFbmNvZGUoJGNvcmVfdjJfbGFuZ3VhZ2UuR2V0UmVzb3VyY2UoJ1R1cm5PZmZOb3RpZmljYXRpb25zJykpIiBjbGFzcz0idWktdGlwIj5YPC9hPg0KCQkJPC9kaXY+DQoJCQkjaWYoISRub3RpZmljYXRpb24uSXNSZWFkKQ0KCQkJCTxkaXYgY2xhc3M9Im1hcmsiPg0KCQkJCQk8YSBocmVmPSIjIiB0aXRsZT0iJGNvcmVfdjJfZW5jb2RpbmcuSHRtbEF0dHJpYnV0ZUVuY29kZSgkY29yZV92Ml9sYW5ndWFnZS5HZXRSZXNvdXJjZSgnTm90aWZpY2F0aW9uc19NYXJrJykpIiBjbGFzcz0idWktdGlwIiBkYXRhLW1lc3NhZ2VuYW1lPSJ0ZWxsaWdlbnQuZXZvbHV0aW9uLndpZGdldHMudGhyZWFkLmhpZGVhdHRhY2htZW50Ij5PPC9hPg0KCQkJCTwvZGl2Pg0KCQkJI2VuZA0KCQk8L2xpPg0KCSNlbmQNCiNub2RhdGENCgk8ZGl2IGNsYXNzPSJtZXNzYWdlIG5vcmVjb3JkcyI+JGNvcmVfdjJfbGFuZ3VhZ2UuR2V0UmVzb3VyY2UoJ05vdGlmaWNhdGlvbnNfTm9uZScpPC9kaXY+DQojZW5kDQo=</file>
			<file name="search.vm">77u/I3NldCAoJHF1ZXJ5ID0gJGNvcmVfdjJfdXRpbGl0eS5UcmltKCRjb3JlX3YyX3BhZ2UuR2V0UXVlcnlTdHJpbmdWYWx1ZSgnd19xdWVyeScpKSkNCiNzZXQgKCRwYWdlU2l6ZSA9IDEwKQ0KI3NldCAoJHBhZ2VJbmRleCA9ICRjb3JlX3YyX3V0aWxpdHkuUGFyc2VJbnQoJGNvcmVfdjJfcGFnZS5HZXRRdWVyeVN0cmluZ1ZhbHVlKCd3X3BhZ2VJbmRleCcpKSkNCiNzZXQgKCRwbGFjZUtleSA9ICRjb3JlX3YyX3BhZ2UuR2V0UXVlcnlTdHJpbmdWYWx1ZSgnd19wbGFjZUtleScpKQ0KI3NldCAoJHBsYWNlVmFsdWUgPSAkY29yZV92Ml9wYWdlLkdldFF1ZXJ5U3RyaW5nVmFsdWUoJ3dfcGxhY2VWYWx1ZScpKQ0KI3NldCAoJHR5cGUgPSAkY29yZV92Ml9wYWdlLkdldFF1ZXJ5U3RyaW5nVmFsdWUoJ3dfdHlwZScpKQ0KDQojc2V0ICgkc2VhcmNoUXVlcnkgPSAiJXt9IikNCiRzZWFyY2hRdWVyeS5BZGQoIlF1ZXJ5IiwgJHF1ZXJ5KQ0KJHNlYXJjaFF1ZXJ5LkFkZCgiUGFnZVNpemUiLCAkcGFnZVNpemUpDQokc2VhcmNoUXVlcnkuQWRkKCJQYWdlSW5kZXgiLCAkcGFnZUluZGV4KQ0KJHNlYXJjaFF1ZXJ5LkFkZCgnQ29sbGFwc2UnLCAnVHJ1ZScpDQoNCiNpZiAoJHBsYWNlS2V5ID09ICdhcHBsaWNhdGlvbicpDQoJJHNlYXJjaFF1ZXJ5LkFkZCgiQXBwbGljYXRpb25JZCIsICRwbGFjZVZhbHVlKQ0KI2Vsc2VpZiAoJHBsYWNlS2V5ID09ICdncm91cCcgJiYgJHR5cGUgIT0gJ2dyb3VwcycpDQoJJHNlYXJjaFF1ZXJ5LkFkZCgiQ29udGFpbmVySWQiLCAkcGxhY2VWYWx1ZSkNCiNlbmQNCg0KI2lmICgkdHlwZSA9PSAnZ3JvdXBzJykNCgkjaWYgKCRwbGFjZUtleSA9PSAnZ3JvdXAnKQ0KCQkjc2V0KCRwYXJlbnRHcm91cEZpbHRlciA9ICcnKQ0KCQkjc2V0KCRncm91cCA9ICRjb3JlX3YyX2dyb3VwLkdldCgkY29yZV92Ml91dGlsaXR5LlBhcnNlR3VpZCgkcGxhY2VWYWx1ZSkpKQ0KCQkjaWYgKCRncm91cCkNCgkJCSNzZXQoJHBhcmVudEdyb3VwRmlsdGVyID0gInx8cGFyZW50Z3JvdXA6OiR7Z3JvdXAuSWR9IikNCgkJI2VuZA0KCQkkc2VhcmNoUXVlcnkuQWRkKCdGaWx0ZXJzJywgImNvbnRlbnR0eXBlaWQ6OiR7Y29yZV92Ml9ncm91cC5Db250ZW50VHlwZUlkfSR7cGFyZW50R3JvdXBGaWx0ZXJ9IikNCgkjZWxzZQ0KCQkkc2VhcmNoUXVlcnkuQWRkKCdGaWx0ZXJzJywgImNvbnRlbnR0eXBlaWQ6OiRjb3JlX3YyX2dyb3VwLkNvbnRlbnRUeXBlSWQiKQ0KCSNlbmQNCiNlbHNlaWYgKCR0eXBlID09ICd1c2VycycpDQoJJHNlYXJjaFF1ZXJ5LkFkZCgnRmlsdGVycycsICJjb250ZW50dHlwZWlkOjokY29yZV92Ml91c2VyLkNvbnRlbnRUeXBlSWQiKQ0KI2Vsc2UNCgkjc2V0KCRmaWx0ZXJzID0gJycpDQoJI2ZvcmVhY2goJGNvbnRlbnRUeXBlIGluICRjb3JlX3YyX2NvbnRlbnRUeXBlLkxpc3QoKSkNCgkJI3NldCgkYXBwbGljYXRpb25UeXBlID0gZmFsc2UpDQoJCSNzZXQoJGFwcGxpY2F0aW9uVHlwZSA9ICRjb3JlX3YyX2FwcGxpY2F0aW9uVHlwZS5HZXQoJGNvbnRlbnRUeXBlLklkKSkNCgkJI3NldCgkY29udGFpbmVyVHlwZSA9IGZhbHNlKQ0KCQkjc2V0KCRjb250YWluZXJUeXBlID0gJGNvcmVfdjJfY29udGFpbmVyVHlwZS5HZXQoJGNvbnRlbnRUeXBlLklkKSkNCgkJI2lmICgoISRhcHBsaWNhdGlvblR5cGUgfHwgJGFwcGxpY2F0aW9uVHlwZS5IYXNFcnJvcnMoKSkgJiYgKCEkY29udGFpbmVyVHlwZSB8fCAkY29udGFpbmVyVHlwZS5IYXNFcnJvcnMoKSkpDQoJCQkjaWYgKCRmaWx0ZXJzLkxlbmd0aCA9PSAwKQ0KCQkJCSNzZXQoJGZpbHRlcnMgPSAiY29udGVudHR5cGVpZDo6KCR7Y29udGVudFR5cGUuSWR9IikNCgkJCSNlbHNlDQoJCQkJI3NldCgkZmlsdGVycyA9ICIke2ZpbHRlcnN9IE9SICR7Y29udGVudFR5cGUuSWR9IikNCgkJI2VuZA0KCQkjZW5kDQoJI2VuZA0KCSNpZigkZmlsdGVycy5MZW5ndGggPiAwKQ0KCQkkc2VhcmNoUXVlcnkuQWRkKCdGaWx0ZXJzJywgIiR7ZmlsdGVyc30pIikNCgkjZW5kDQojZW5kDQoNCg0KI3NldCAoJHNlYXJjaFJlc3VsdHMgPSAkY29yZV92Ml9zZWFyY2hSZXN1bHQuTGlzdCgkc2VhcmNoUXVlcnkpKQ0KDQojc2V0ICgkaGFzTW9yZSA9IGZhbHNlKQ0KI3NldCAoJGN1cnJlbnRQYWdlZFF1YW50aXR5ID0gKCRzZWFyY2hSZXN1bHRzLlBhZ2VJbmRleCArIDEpICogJHNlYXJjaFJlc3VsdHMuUGFnZVNpemUpDQojaWYgKCRzZWFyY2hSZXN1bHRzLlRvdGFsQ291bnQgPiAkY3VycmVudFBhZ2VkUXVhbnRpdHkpDQogICAgI3NldCAoJGhhc01vcmUgPSB0cnVlKQ0KI2VuZA0KDQojZm9yZWFjaCAoJHNlYXJjaFJlc3VsdCBpbiAkc2VhcmNoUmVzdWx0cykNCgk8bGkgY2xhc3M9ImNvbnRlbnQtaXRlbSIgZGF0YS1jb250ZW50dXJsPSIkY29yZV92Ml9lbmNvZGluZy5IdG1sQXR0cmlidXRlRW5jb2RlKCRzZWFyY2hSZXN1bHQuVXJsKSIgI2lmKCRoYXNNb3JlKSBkYXRhLWhhc21vcmU9InRydWUiICNlbmQ+DQoJCSNzZXQgKCRyZXN1bHRIdG1sID0gZmFsc2UpDQoJCSNzZXQgKCRyZXN1bHRIdG1sID0gJHNlYXJjaFJlc3VsdC5WaWV3SHRtbCgpKQ0KCQkjaWYgKCRyZXN1bHRIdG1sKQ0KCQkJJHJlc3VsdEh0bWwNCgkJI2VuZA0KCTwvbGk+DQojbm9kYXRhDQoJPGRpdiBjbGFzcz0ibWVzc2FnZSBub3JlY29yZHMiPiRjb3JlX3YyX2xhbmd1YWdlLkdldFJlc291cmNlKCdOb19SZXN1bHRzJyk8L2Rpdj4NCiNlbmQNCg==</file>
			<file name="ui.js">KGZ1bmN0aW9uICgkLCBnbG9iYWwsIHVuZGVmKSB7Cgl2YXIgb3BlbkhlYWRlckxpc3RDb250ZXh0ID0gbnVsbDsKCXZhciBhY3RpdmF0ZU1lc3NhZ2UgPSAndGVsbGlnZW50LmV2b2x1dGlvbi53aWRnZXRzLnNpdGVCYW5uZXIuYWN0aXZhdGUnOwoJdmFyIGRlYWN0aXZhdGVNZXNzYWdlID0gJ3RlbGxpZ2VudC5ldm9sdXRpb24ud2lkZ2V0cy5zaXRlQmFubmVyLmRlYWN0aXZhdGUnOwoKCWZ1bmN0aW9uIHN1cHBvcnRzVG91Y2goKSB7CgkJcmV0dXJuICdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdzsKCX0KCgl2YXIgdXRpbCA9IHsKCQl0aHJvdHRsZTogZnVuY3Rpb24gKGZuLCBsaW1pdCkgewoJCQl2YXIgbGFzdFJhbkF0LCB0aW1lb3V0OwoJCQlyZXR1cm4gZnVuY3Rpb24gKCkgewoJCQkJdmFyIHNjb3BlID0gdGhpcywKCQkJCQlhdHRlbXB0QXQgPSAobmV3IERhdGUoKS5nZXRUaW1lKCkpLAoJCQkJCWFyZ3MgPSBhcmd1bWVudHM7CgkJCQlpZiAobGFzdFJhbkF0ICYmIChsYXN0UmFuQXQgKyAobGltaXQgfHwgNTApKSA+IGF0dGVtcHRBdCkgewoJCQkJCWdsb2JhbC5jbGVhclRpbWVvdXQodGltZW91dCk7CgkJCQkJdGltZW91dCA9IGdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKCQkJCQkJbGFzdFJhbkF0ID0gYXR0ZW1wdEF0OwoJCQkJCQlmbi5hcHBseShzY29wZSwgYXJncyk7CgkJCQkJfSwgKGxpbWl0IHx8IDUwKSk7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlsYXN0UmFuQXQgPSBhdHRlbXB0QXQ7CgkJCQkJZm4uYXBwbHkoc2NvcGUsIGFyZ3MpOwoJCQkJfQoJCQl9OwoJCX0KCX07CgoJLy8gVUkgd2hpY2ggY2FuIHJlbmRlciBlbmRsZXNzbHktc2Nyb2xsaW5nIGl0ZW1zIGluIGEgcG9wdXAuCgkvLyBTdXBwb3J0cyBkZWZpbmluZyBmaWx0ZXJzCgkvLyBVcGRhdGluZyBzaXRlLXdpZGUgYnViYmxlIGNvdW50cwoJdmFyIEhlYWRlckxpc3QgPSAoZnVuY3Rpb24gKCQpIHsKCQkvLyBwcml2YXRlIHN0YXRpYyBtZW1iZXJzIG9mIGEgSGVhZGVyTGlzdAoJCXZhciB0aXRsZUNvdW50ID0gL15cKFswLTldK1wpXHMrLywKCQkJdG90YWxUaXRsZUNvdW50ID0gMCwgLy8gdGl0bGUgYmFyIGNvdW50IHdoaWNoIG11bHRpcGxlIGluc3RhbmNlcyBjYW4gY29udHJpYnV0ZSB0bwoJCQltYXNrLAoJCQlkZWZhdWx0cyA9IHsKCQkJCWtleTogJycsCgkJCQlhY3RpdmF0aW9uTGluazogbnVsbCwKCQkJCWFjdGl2YXRpb25JbnB1dDogbnVsbCwKCQkJCWluaXRpYWxVbnJlYWRDb3VudDogMCwKCQkJCWZvb3RlckNvbnRlbnQ6IG51bGwsCgkJCQlzaG93Q291bnQ6IHRydWUsCgkJCQllbmRsZXNzU2Nyb2xsOiBmYWxzZSwKCQkJCWNzc0NsYXNzOiAnJywKCQkJCXRlbXBsYXRlOiAnJywKCQkJCWxvYWRpbmc6IGZhbHNlLAoJCQkJdGl0bGVDb3VudDogZmFsc2UsCgkJCQl0aXRsZUNvdW50Q2xhc3M6ICcnLAoJCQkJcHJldmlvdXNDb3VudDogMCwKCQkJCXdyYXBwZXI6IG51bGwsCgkJCQl1bnJlYWRDb3VudE1lc3NhZ2VTaW5ndWxhcjogJ1lvdSBoYXZlIHswfSB1bnJlYWQgaXRlbScsCgkJCQl1bnJlYWRDb3VudE1lc3NhZ2VQbHVyYWw6ICdZb3UgaGF2ZSB7MH0gdW5yZWFkIGl0ZW1zJywKCQkJCW9uU2hvd0xvYWRpbmdJbmRpY2F0b3I6IGZ1bmN0aW9uICgpIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0sCgkJCQlvbkxvYWQ6IGZ1bmN0aW9uIChwYWdlSW5kZXgsIHNob3VsZFJlZnJlc2hVbnJlYWRDb3VudCwgZmlsdGVyLCBjb21wbGV0ZSkgewoJCQkJCS8vIGxvYWQgbW9yZSBpdGVtcwoJCQkJCS8vIGZvciBlYWNoIGl0ZW0gbG9hZGVkLCBtYXJrcyBpdCBhcyByZWFkCgkJCQkJLy8gYWZ0ZXIgaXRlbXMgbG9hZGVkIGFuZCBtYXJrcyBhcyByZWFkLCBnZXRzIG5ldyB1bnJlYWQgY291bnQgYW5kIHVwZGF0ZXMgdmlhIHVwZGF0ZVVucmVhZENvdW50IHZpYSByZWZyZXNoVW5yZWFkQ291bnQKCQkJCQkvLyBjb21wbGV0ZShjb250ZW50VG9TaG93KQoJCQkJCWNvbXBsZXRlKCcnKTsKCQkJCX0sCgkJCQlvblJlZnJlc2hVbnJlYWRDb3VudDogZnVuY3Rpb24gKGNvbXBsZXRlKSB7CgkJCQkJLy8gZ2V0IG5ldyB1bnJlYWQgY291bnQKCQkJCQkvLyB1cGRhdGUgaXQgdmlhIGNvbXBsZXRlKCkKCQkJCQljb21wbGV0ZSg1KTsKCQkJCX0sCgkJCQlvbkJ1aWxkRmlsdGVyOiBudWxsLCAvLyBmdW5jdGlvbihmaWx0ZXJlZCkgewoJCQkJLy8gd2hlbiBkZWZpbmVkLCByZXR1cm5zIGEgRE9NIG5vZGUgdG8gYmUgaW5zZXJ0ZWQgYXQgdGhlIHRvcCB3aGljaCBwcmVzZW50ZXMgYSBmaWx0ZXJpbmcgVUkKCQkJCS8vIGZpbHRlcmVkKGZpbHRlcikgY2FuIGJlIGNhbGxlZCB0byByYWlzZSBhIGZpbHRlcgoJCQkJLy8gfQoJCQkJb25TaG93OiBmdW5jdGlvbiAoYWN0aXZhdG9yLCBjb21wbGV0ZSkgeyAvLyBkZWZlcnJlZCBkaXNwbGF5IG9wdGlvbnMKCQkJCQkvLyBjYWxscyBjb21wbGV0ZSB3aXRoIGRpc3BsYXkgb3B0aW9ucyB0byB1c2Ugd2hlbiBkaXNwbGF5aW5nCgkJCQkJLy8gY29tcGxldGUoewoJCQkJCS8vd2lkdGg6IDI4MAoJCQkJCS8vbWF4SGVpZ2h0OiAzMDAKCQkJCQkvL2F0dGFjaFRvOiBhY3RpdmF0b3IKCQkJCQkvL30pCgkJCQkJY29tcGxldGUoe30pOwoJCQkJfSwKCQkJCW9uSGlkZTogZnVuY3Rpb24gKCkgewoKCQkJCX0sCgkJCQlvblNlbGVjdDogZnVuY3Rpb24gKGl0ZW0pIHsKCQkJCQl2YXIgdXJsID0gJChpdGVtKS5kYXRhKCdjb250ZW50dXJsJyk7CgkJCQkJaWYgKHVybCkgewoJCQkJCQl3aW5kb3cubG9jYXRpb24gPSB1cmw7CgkJCQkJfQoJCQkJfQoJCQl9LAoJCQlkZWZhdWx0U2hvd1NldHRpbmdzID0gewoJCQkJYXR0YWNoVG86IG51bGwsCgkJCQl3aWR0aDogMjgwLAoJCQkJbWF4SGVpZ2h0OiAzMDAsCgkJCQljc3NDbGFzczogbnVsbAoJCQl9OwoKCQlmdW5jdGlvbiB1cGRhdGVUaXRsZShjb250ZXh0KSB7CgkJCWlmICh0b3RhbFRpdGxlQ291bnQgPD0gMCkgewoJCQkJY29udGV4dC5oYW5kaGVsZEJhbm5lckxpbmtzQ291bnQuaGlkZSgpOwoJCQkJZG9jdW1lbnQudGl0bGUgPSBkb2N1bWVudC50aXRsZS5yZXBsYWNlKHRpdGxlQ291bnQsICcnKTsKCQkJfQoJCQllbHNlIHsKCQkJCWNvbnRleHQuaGFuZGhlbGRCYW5uZXJMaW5rc0NvdW50Lmh0bWwodG90YWxUaXRsZUNvdW50KS5zaG93KCk7CgkJCQlkb2N1bWVudC50aXRsZSA9ICcoJyArIHRvdGFsVGl0bGVDb3VudCArICcpICcgKyBkb2N1bWVudC50aXRsZS5yZXBsYWNlKHRpdGxlQ291bnQsICcnKTsKCQkJfQoJCX0KCgkJZnVuY3Rpb24gYmxvY2tXaW5kb3dTY3JvbGxpbmcoY29udGV4dCkgewoJCQlpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdzdG9wLXNjcm9sbGluZycpKQoJCQkJcmV0dXJuOwoKCQkJLy8gYmxvY2sgd2luZG93IHNjcm9sbGluZyBub3QgaW4gdGhlIHBvcHVwLCBvciBwb3B1cCBzY3JvbGxpbmcgYXQgaXRzIGJvdW5kYXJpZXMKCQkJY29udGV4dC5wb3B1cENvbnRlbnRMaXN0Lm9uKCdET01Nb3VzZVNjcm9sbCBtb3VzZXdoZWVsJywgZnVuY3Rpb24gKGUpIHsKCQkJCXZhciBlID0gZSB8fCB3aW5kb3cuZXZlbnQsCgkJCQkJb3JpZ2luYWxFdmVudCA9IGUub3JpZ2luYWxFdmVudCB8fCBlLAoJCQkJCWRlbHRhID0gMCwKCQkJCQlzY3JvbGxUb3AgPSBjb250ZXh0LnBvcHVwQ29udGVudExpc3QuZ2V0KDApLnNjcm9sbFRvcCwKCQkJCQlzY3JvbGxIZWlnaHQgPSBjb250ZXh0LnBvcHVwQ29udGVudExpc3QuZ2V0KDApLnNjcm9sbEhlaWdodCwKCQkJCQloZWlnaHQgPSBjb250ZXh0LnBvcHVwQ29udGVudExpc3QuaGVpZ2h0KCk7CgoJCQkJaWYgKG9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSkKCQkJCQlkZWx0YSA9IG9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSAvIDEyMDsKCQkJCWlmIChvcmlnaW5hbEV2ZW50LmRldGFpbCkKCQkJCQlkZWx0YSA9IC1vcmlnaW5hbEV2ZW50LmRldGFpbCAvIDM7CgoJCQkJaWYgKChzY3JvbGxUb3AgPT09IChzY3JvbGxIZWlnaHQgLSBoZWlnaHQpICYmIGRlbHRhIDwgMCkgfHwKCQkJCQkoc2Nyb2xsVG9wID09PSAwICYmIGRlbHRhID4gMCkpIHsKCQkJCQlpZiAoZS5wcmV2ZW50RGVmYXVsdCkKCQkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCWUucmV0dXJuVmFsdWUgPSBmYWxzZTsKCQkJCX0KCQkJfSk7CgoJCQkvLyBibG9jayB0b3VjaCBzY3JvbGxpbmcKCQkJdmFyIGxhc3RZOwoJCQkkKCdib2R5JykuYWRkQ2xhc3MoJ3N0b3Atc2Nyb2xsaW5nJykKCQkJCS5vbigncG9pbnRlcnN0YXJ0LnNjcm9sbGZpeCcsIGZ1bmN0aW9uIChlKSB7CgkJCQkJbGFzdFkgPSBlLnBvaW50ZXJzWzBdLnBhZ2VZOwoJCQkJfSkKCQkJCS5vbigncG9pbnRlcmVuZC5zY3JvbGxmaXgnLCBmdW5jdGlvbiAoZSkgewoJCQkJCWxhc3RZID0gbnVsbDsKCQkJCX0pCgkJCQkub24oJ3BvaW50ZXJtb3ZlLnNjcm9sbGZpeCcsIGZ1bmN0aW9uIChlKSB7CgkJCQkJaWYgKCFlLnBvaW50ZXJzIHx8IGUucG9pbnRlcnMubGVuZ3RoID09IDApCgkJCQkJCXJldHVybjsKCgkJCQkJdmFyIGlzRGlyZWN0aW9uRG93biA9IGUucG9pbnRlcnNbMF0ucGFnZVkgLSBsYXN0WSA+IDA7CgoJCQkJCXZhciBsaXN0ID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLnBvcHVwLWxpc3QgdWwuY29udGVudC1saXN0LmNvbnRlbnQnKTsKCQkJCQlpZiAoIWxpc3QgfHwgbGlzdC5sZW5ndGggPT0gMCkgewoJCQkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgoJCQkJCXZhciB1bCA9IGNvbnRleHQucG9wdXBDb250ZW50TGlzdC5nZXQoMCksCgkJCQkJCXVsU2Nyb2xsVG9wID0gdWwuc2Nyb2xsVG9wLAoJCQkJCQl1bFNjcm9sbEhlaWdodCA9IHVsLnNjcm9sbEhlaWdodCwKCQkJCQkJdWxIZWlnaHQgPSB1bC5vZmZzZXRIZWlnaHQ7CgoJCQkJCWlmICh1bEhlaWdodCA9PSAwIHx8IHVsU2Nyb2xsSGVpZ2h0ID09IDApCgkJCQkJCXJldHVybjsKCgkJCQkJLy8gbGlzdCBpc24ndCBzY3JvbGxhYmxlLCBzbyBibG9jayBzY3JvbGxpbmcKCQkJCQlpZiAodWxTY3JvbGxIZWlnaHQgLSB1bEhlaWdodCA8PSAwKSB7CgkJCQkJCWUucHJldmVudERlZmF1bHQoKQoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoKCQkJCQkvLyBsaXN0IGlzIHNjcm9sbGFibGUgYW5kIGF0IHRoZSB0b3AKCQkJCQlpZiAodWxTY3JvbGxUb3AgPT0gMCAmJiBpc0RpcmVjdGlvbkRvd24pIHsKCQkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJCS8vIGxpc3QgaXMgc2Nyb2xsYWJsZSBhbmQgYXQgZW5kCgkJCQkJaWYgKCh1bFNjcm9sbFRvcCArIHVsSGVpZ2h0ID49IHVsU2Nyb2xsSGVpZ2h0KSAmJiAhaXNEaXJlY3Rpb25Eb3duKSB7CgkJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCX0pOwoKCQkJaWYgKCFtYXNrKQoJCQkJbWFzayA9ICQoJzxkaXY+PC9kaXY+JykKCQkJCQkuYWRkQ2xhc3MoJ21hc2snKQoJCQkJCS5hcHBlbmRUbygnYm9keScpCgkJCQkJLmNzcyh7b3BhY2l0eTogMC4wMSwgekluZGV4OiAxfSkKCQkJCQkuZXZvbHV0aW9uVHJhbnNmb3JtKHtvcGFjaXR5OiAwLjd9LCB7ZHVyYXRpb246IDE1MH0pCgkJCQkJLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKCQkJCQkJYXBpLmhpZGVDdXJyZW50KCk7CgkJCQkJfSk7CgoJCQlwcmV2ZW50Qm9keUJvdW5jZSgkKCdib2R5JykuY2hpbGRyZW4oKS5maXJzdCgpKTsKCQl9CgoJCWZ1bmN0aW9uIHVuYmxvY2tXaW5kb3dTY3JvbGxpbmcoY29udGV4dCkgewoJCQlpZiAoISQoJ2JvZHknKS5oYXNDbGFzcygnc3RvcC1zY3JvbGxpbmcnKSkKCQkJCXJldHVybgoKCQkJJCgnYm9keScpLnJlbW92ZUNsYXNzKCdzdG9wLXNjcm9sbGluZycpLm9mZignLnNjcm9sbGZpeCcpOwoKCQkJaWYgKGNvbnRleHQucG9wdXBDb250ZW50TGlzdCkKCQkJCWNvbnRleHQucG9wdXBDb250ZW50TGlzdC5vZmYoJ0RPTU1vdXNlU2Nyb2xsIG1vdXNld2hlZWwnKTsKCgkJCWlmIChtYXNrKSB7CgkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKCQkJCQlpZiAobWFzaykgewoJCQkJCQlpZiAoISQoJ2JvZHknKS5oYXNDbGFzcygnc3RvcC1zY3JvbGxpbmcnKSkgewoJCQkJCQkJbWFzay5ldm9sdXRpb25UcmFuc2Zvcm0oe29wYWNpdHk6IDAuMDF9LCB7ZHVyYXRpb246IDEwMH0pOwoJCQkJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCQkJCQkJaWYgKG1hc2spCgkJCQkJCQkJCW1hc2sucmVtb3ZlKCk7CgkJCQkJCQkJbWFzayA9IG51bGw7CgkJCQkJCQl9LCAxMDApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfSwgMTAwKTsKCQkJfQoKCQkJYWxsb3dCb2R5Qm91bmNlKCQoJ2JvZHknKS5jaGlsZHJlbigpLmZpcnN0KCkpOwoJCX0KCgkJZnVuY3Rpb24gYWxsb3dCb2R5Qm91bmNlKHNlbGVjdGlvbikgewoJCQlzZWxlY3Rpb24ub2ZmKCcuc2Nyb2xsZml4Jyk7CgkJfQoKCQlmdW5jdGlvbiBwcmV2ZW50Qm9keUJvdW5jZShzZWxlY3Rpb24pIHsKCQkJdmFyIG9yaWdpbmFsU2Nyb2xsVG9wLAoJCQkJZWxlbSA9IHNlbGVjdGlvbi5nZXQoMCk7CgkJCXNlbGVjdGlvbi5vbigncG9pbnRlcnN0YXJ0LnNjcm9sbGZpeCcsIGZ1bmN0aW9uIChlKSB7CgkJCQlvcmlnaW5hbFNjcm9sbFRvcCA9IGVsZW0uc2Nyb2xsVG9wOwoKCQkJCWlmIChvcmlnaW5hbFNjcm9sbFRvcCA8PSAwKQoJCQkJCWVsZW0uc2Nyb2xsVG9wID0gMTsKCgkJCQlpZiAob3JpZ2luYWxTY3JvbGxUb3AgKyBlbGVtLm9mZnNldEhlaWdodCA+PSBlbGVtLnNjcm9sbEhlaWdodCkKCQkJCQllbGVtLnNjcm9sbFRvcCA9IGVsZW0uc2Nyb2xsSGVpZ2h0IC0gZWxlbS5vZmZzZXRIZWlnaHQgLSAxOwoKCQkJCW9yaWdpbmFsU2Nyb2xsTGVmdCA9IGVsZW0uc2Nyb2xsTGVmdDsKCgkJCQlpZiAob3JpZ2luYWxTY3JvbGxMZWZ0IDw9IDApCgkJCQkJZWxlbS5zY3JvbGxMZWZ0ID0gMTsKCgkJCQlpZiAob3JpZ2luYWxTY3JvbGxMZWZ0ICsgZWxlbS5vZmZzZXRXaWR0aCA+PSBlbGVtLnNjcm9sbFdpZHRoKQoJCQkJCWVsZW0uc2Nyb2xsTGVmdCA9IGVsZW0uc2Nyb2xsV2lkdGggLSBlbGVtLm9mZnNldFdpZHRoIC0gMTsKCQkJfSk7CgkJfQoKCQlmdW5jdGlvbiBidWlsZENvdW50QnViYmxlKGNvbnRleHQpIHsKCQkJLyp2YXIgd3JhcHBlciA9IGNvbnRleHQuYWN0aXZhdGlvbkxpbmsud3JhcCgnPHNwYW4+PC9zcGFuPicpLnBhcmVudCgnc3BhbicpLmNzcyh7CgkJCSBwb3NpdGlvbjogJ3JlbGF0aXZlJwoJCQkgfSk7Ki8KCQkJdmFyIHdyYXBwZXIgPSBjb250ZXh0LmFjdGl2YXRpb25MaW5rLnBhcmVudCgpOwoJCQl2YXIgY291bnQgPSAkKCc8YSBocmVmPSIjIiBjbGFzcz0icG9wdXAtbGlzdC1jb3VudCAnICsgY29udGV4dC50aXRsZUNvdW50Q2xhc3MgKyAnIj48L2E+Jyk7CgkJCWNvdW50LmFwcGVuZFRvKHdyYXBwZXIpLmhpZGUoKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkgewoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJY29udGV4dC5hY3RpdmF0aW9uTGluay5jbGljaygpOwoJCQl9KTsKCQkJcmV0dXJuIGNvdW50OwoJCX0KCgkJZnVuY3Rpb24gYnVpbGRVbnJlYWRDb3VudE1lc3NhZ2UoY29udGV4dCwgY291bnQpIHsKCQkJY291bnQgPSBjb3VudCB8fCAwOwoJCQlpZiAoY291bnQgPT09IDEpIHsKCQkJCXJldHVybiBjb250ZXh0LnVucmVhZENvdW50TWVzc2FnZVNpbmd1bGFyLnJlcGxhY2UoL1x7MFx9L2dpLCBjb3VudCk7CgkJCX0KCQkJZWxzZSB7CgkJCQlyZXR1cm4gY29udGV4dC51bnJlYWRDb3VudE1lc3NhZ2VQbHVyYWwucmVwbGFjZSgvXHswXH0vZ2ksIGNvdW50KTsKCQkJfQoJCX0KCgkJZnVuY3Rpb24gc2hvd1VucmVhZENvdW50KGNvbnRleHQsIGNvdW50KSB7CgkJCWlmICghY29udGV4dC5zaG93Q291bnQpCgkJCQlyZXR1cm47CgkJCXZhciBkaWZmZXJlbmNlID0gY291bnQgLSBjb250ZXh0LnByZXZpb3VzQ291bnQ7CgkJCWNvbnRleHQucHJldmlvdXNDb3VudCA9IGNvdW50OwoJCQlpZiAoY29udGV4dC50aXRsZUNvdW50KSB7CgkJCQl0b3RhbFRpdGxlQ291bnQgKz0gZGlmZmVyZW5jZTsKCQkJCXVwZGF0ZVRpdGxlKGNvbnRleHQpOwoJCQl9CgkJCXZhciB1bnJlYWRDb3VudE1lc3NhZ2UgPSBidWlsZFVucmVhZENvdW50TWVzc2FnZShjb250ZXh0LCBjb3VudCk7CgkJCWlmIChjb3VudCA8PSAwKSB7CgkJCQkvLyByZW1vdmUgYnViYmxlIHVpCgkJCQlpZiAoY29udGV4dC5jb3VudCkKCQkJCQljb250ZXh0LmNvdW50LmZhZGVPdXQoMjAwKTsKCQkJCWNvbnRleHQuYWN0aXZhdGlvbkxpbmsuYXR0cignZGF0YS10aXAnLCB1bnJlYWRDb3VudE1lc3NhZ2UpLmF0dHIoJ3RpdGxlJywgdW5yZWFkQ291bnRNZXNzYWdlKTsKCQkJfQoJCQllbHNlIHsKCQkJCS8vIGFkZCBidWJibGUgdWkgaWYgbm90IHRoZXJlCgkJCQljb250ZXh0LmNvdW50ID0gY29udGV4dC5jb3VudCB8fCBidWlsZENvdW50QnViYmxlKGNvbnRleHQpOwoJCQkJLy8gc2V0IHRoZSBjb3VudCBhbmQgZGlzcGxheSBpdAoJCQkJY29udGV4dC5jb3VudAoJCQkJCS5odG1sKChjb250ZXh0LmxpbWl0Q291bnQgJiYgY29udGV4dC5saW1pdENvdW50IDwgY291bnQpID8gY29udGV4dC5saW1pdENvdW50ICsgIisiIDogY291bnQpCgkJCQkJLmF0dHIoJ3RpdGxlJywgdW5yZWFkQ291bnRNZXNzYWdlKQoJCQkJCS5mYWRlSW4oMjAwKTsKCQkJCWNvbnRleHQuYWN0aXZhdGlvbkxpbmsuYXR0cignZGF0YS10aXAnLCB1bnJlYWRDb3VudE1lc3NhZ2UpLmF0dHIoJ3RpdGxlJywgdW5yZWFkQ291bnRNZXNzYWdlKTsKCQkJfQoJCX0KCgkJZnVuY3Rpb24gbG9hZFNob3dTZXR0aW5ncyhhY3RpdmF0b3IsIGNvbnRleHQpIHsKCQkJcmV0dXJuICQuRGVmZXJyZWQoZnVuY3Rpb24gKGRmZCkgewoJCQkJY29udGV4dC5vblNob3coYWN0aXZhdG9yLCBmdW5jdGlvbiAoc2V0dGluZ3MpIHsKCQkJCQlkZmQucmVzb2x2ZSgkLmV4dGVuZCh7fSwgZGVmYXVsdFNob3dTZXR0aW5ncywgc2V0dGluZ3MgfHwge30pKTsKCQkJCX0pOwoJCQl9KS5wcm9taXNlKCk7CgkJfQoKCQlmdW5jdGlvbiBsb2FkQ29udGVudChjb250ZXh0LCBwYWdlSW5kZXgsIHNob3VsZFJlZnJlc2hVbnJlYWRDb3VudCkgewoJCQljb250ZXh0LmxvYWRpbmcgPSB0cnVlOwoJCQkvLyBjYWxsIHRoZSBpbmplY3RlZCBsb2FkaW5nIG1ldGhvZCwgYW5kIHJldHVybiBhIHByb21pc2UKCQkJLy8gd2hpY2gsIHdoZW4gZG9uZSwgcHJvdmlkZXMgdGhlIGNvbnRlbnQgZnJvbSB0aGUgbG9hZGluZyBtZXRob2QKCQkJcmV0dXJuICQuRGVmZXJyZWQoZnVuY3Rpb24gKGRmZCkgewoJCQkJaWYgKGNvbnRleHQub25TaG93TG9hZGluZ0luZGljYXRvcigpKSB7CgkJCQkJc2hvd0xvYWRpbmcoY29udGV4dCwgKHBhZ2VJbmRleCA+IDApKTsKCQkJCX0KCQkJCWNvbnRleHQub25Mb2FkKHBhZ2VJbmRleCwgc2hvdWxkUmVmcmVzaFVucmVhZENvdW50LCBjb250ZXh0LmZpbHRlciB8fCAnJywgZnVuY3Rpb24gKGNvbnRlbnQpIHsKCQkJCQlpZiAoY29udGVudCA9PT0gbnVsbCB8fCBjb250ZW50ID09PSB1bmRlZikgewoJCQkJCQlkZmQucmVqZWN0KCk7CgkJCQkJfQoJCQkJCWVsc2UgewoJCQkJCQlpZiAoY29udGV4dC5vblNob3dMb2FkaW5nSW5kaWNhdG9yKCkpCgkJCQkJCQloaWRlTG9hZGluZyhjb250ZXh0LCAocGFnZUluZGV4ID4gMCkpOwoJCQkJCQlkZmQucmVzb2x2ZShjb250ZW50KTsKCQkJCQl9CgkJCQl9KTsKCQkJfSkucHJvbWlzZSgpOwoJCX0KCgkJZnVuY3Rpb24gYnVpbGRQb3BVcChjb250ZXh0KSB7CgkJCWNvbnRleHQuY29tcGlsZWRUZW1wbGF0ZSA9IGNvbnRleHQuY29tcGlsZWRUZW1wbGF0ZSB8fCAkLnRlbGxpZ2VudC5ldm9sdXRpb24udGVtcGxhdGUuY29tcGlsZShjb250ZXh0LnRlbXBsYXRlKTsKCgkJCWNvbnRleHQucG9wdXAgPSAkKGNvbnRleHQuY29tcGlsZWRUZW1wbGF0ZShjb250ZXh0KSk7CgkJCWNvbnRleHQubG9hZGluZ0luZGljYXRvciA9IGNvbnRleHQucG9wdXAuZmluZCgnLmxvYWRpbmcnKS5oaWRlKCk7CgkJCWNvbnRleHQucG9wdXBDb250ZW50TGlzdCA9IGNvbnRleHQucG9wdXAuZmluZCgnLmNvbnRlbnQtbGlzdCcpOwoJCQljb250ZXh0LmZvb3RlciA9IGNvbnRleHQucG9wdXAuZmluZCgnLmNvbnRlbnQtbGlzdC1mb290ZXInKTsKCQkJY29udGV4dC5wb3B1cC5nbG93UG9wVXBQYW5lbCh7CgkJCQljc3NDbGFzczogJ3BvcHVwLWxpc3QgJyArIGNvbnRleHQuY3NzQ2xhc3MsCgkJCQloaWRlT25Eb2N1bWVudENsaWNrOiBmYWxzZSwKCQkJCWhpZGVPblJlc2l6ZTogKHN1cHBvcnRzVG91Y2goKSA/IGZhbHNlIDogdHJ1ZSksCgkJCQlwb3NpdGlvbjogJ2Rvd24nLAoJCQkJekluZGV4OiAxMDAwCgkJCX0pLm9uKCdnbG93UG9wVXBQYW5lbEhpZGRlbicsIGZ1bmN0aW9uICgpIHsKCQkJCShjb250ZXh0LmFjdGl2YXRvcikucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwoJCQkJY29udGV4dC5vbkhpZGUoKTsKCQkJCXVuYmxvY2tXaW5kb3dTY3JvbGxpbmcoY29udGV4dCk7CgkJCX0pOwoJCQkkKGRvY3VtZW50KS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CgkJCQljb250ZXh0LnBvcHVwLmdsb3dQb3BVcFBhbmVsKCdoaWRlJyk7CgkJCX0pOwoJCQlpZiAoY29udGV4dC5vbkJ1aWxkRmlsdGVyICE9PSBudWxsKSB7CgkJCQl2YXIgZmlsdGVyID0gY29udGV4dC5vbkJ1aWxkRmlsdGVyKGZ1bmN0aW9uIChyZXN1bHQpIHsKCQkJCQlpZiAoIWlzT3Blbk9yT3BlbmluZyhjb250ZXh0KSkKCQkJCQkJcmV0dXJuOwoJCQkJCWNvbnRleHQuZmlsdGVyID0gcmVzdWx0OwoJCQkJCWNvbnRleHQuY3VycmVudFBhZ2VJbmRleCA9IDA7CgkJCQkJbG9hZENvbnRlbnQoY29udGV4dCwgY29udGV4dC5jdXJyZW50UGFnZUluZGV4LCB0cnVlKS50aGVuKGZ1bmN0aW9uIChjb250ZW50KSB7CgkJCQkJCWFwcGVuZFRvUG9wdXAoY29udGV4dCwgY29udGVudCwgdHJ1ZSk7CgkJCQkJfSk7CgkJCQl9KTsKCQkJCWlmIChmaWx0ZXIpIHsKCQkJCQkkKGZpbHRlcikuaW5zZXJ0QmVmb3JlKGNvbnRleHQucG9wdXBDb250ZW50TGlzdCk7CgkJCQl9CgkJCX0KCQl9CgoJCWZ1bmN0aW9uIHNob3dMb2FkaW5nKGNvbnRleHQsIGFwcGVuZCkgewoJCQlpZiAoYXBwZW5kKSB7CgkJCQljb250ZXh0LmxvYWRpbmdJbmRpY2F0b3Iuc2hvdygpOwoJCQl9CgkJCWVsc2UgewoJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCQkJaWYgKCFjb250ZXh0LmxvYWRpbmcpCgkJCQkJCXJldHVybjsKCQkJCQlpZiAob3BlbkhlYWRlckxpc3RDb250ZXh0KSB7CgkJCQkJCWhpZGVQb3B1cChvcGVuSGVhZGVyTGlzdENvbnRleHQpOwoJCQkJCX0KCQkJCQlvcGVuSGVhZGVyTGlzdENvbnRleHQgPSBjb250ZXh0OwoJCQkJCWNvbnRleHQucG9wdXAuZ2xvd1BvcFVwUGFuZWwoJ3Nob3cnLCAoY29udGV4dC5zaG93U2V0dGluZ3MuYXR0YWNoVG8gfHwgY29udGV4dC5hY3RpdmF0b3IpLCB0cnVlKTsKCQkJCQljb250ZXh0LmxvYWRpbmdJbmRpY2F0b3Iuc2hvdygpOwoJCQkJCShjb250ZXh0LmFjdGl2YXRvcikucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpOwoJCQkJCWJsb2NrV2luZG93U2Nyb2xsaW5nKGNvbnRleHQpOwoJCQkJfSwgMjApOwoJCQl9CgkJfQoKCQlmdW5jdGlvbiBoaWRlTG9hZGluZyhjb250ZXh0LCBhcHBlbmQpIHsKCQkJY29udGV4dC5sb2FkaW5nSW5kaWNhdG9yLmhpZGUoKS5yZW1vdmUoKTsKCQl9CgoJCWZ1bmN0aW9uIHNob3dQb3B1cChjb250ZXh0LCBjb250ZW50LCBzaG93U2V0dGluZ3MpIHsKCQkJaWYgKG9wZW5IZWFkZXJMaXN0Q29udGV4dCkgewoJCQkJaGlkZVBvcHVwKG9wZW5IZWFkZXJMaXN0Q29udGV4dCk7CgkJCX0KCQkJb3BlbkhlYWRlckxpc3RDb250ZXh0ID0gY29udGV4dDsKCQkJY29udGV4dC5wb3B1cENvbnRlbnRMaXN0Lmh0bWwoY29udGVudCk7CgkJCWNvbnRleHQucG9wdXAuZ2xvd1BvcFVwUGFuZWwoJ3Nob3cnLCAoc2hvd1NldHRpbmdzLmF0dGFjaFRvIHx8IGNvbnRleHQuYWN0aXZhdG9yKSwgdHJ1ZSk7CgkJCWNvbnRleHQubG9hZGluZyA9IGZhbHNlOwoJCQljb250ZXh0Lmhhc01vcmUgPSBjb250ZXh0LnBvcHVwQ29udGVudExpc3QuY2hpbGRyZW4oJ2xpOmxhc3QnKS5kYXRhKCdoYXNtb3JlJykgPyB0cnVlIDogZmFsc2U7CgkJCShjb250ZXh0LmFjdGl2YXRvcikucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpOwoJCQljb250ZXh0LnBvcHVwQ29udGVudCA9IGNvbnRleHQucG9wdXBDb250ZW50TGlzdC5jbG9zZXN0KCcucG9wdXAtbGlzdCcpOwoJCQljb250ZXh0LnBvcHVwQ29udGFpbmVyID0gY29udGV4dC5wb3B1cENvbnRlbnQucGFyZW50KCk7CgkJCWNvbnRleHQucG9wdXBDb250YWluZXIuY3NzKHtoZWlnaHQ6IGNvbnRleHQucG9wdXBDb250ZW50Lm91dGVySGVpZ2h0KCl9KTsKCQkJY29udGV4dC5wb3B1cENvbnRlbnQuZmluZCgnLnVpLXZpZXdodG1sJykub24oJ3JlbmRlcmVkJywgZnVuY3Rpb24gKCkgewoJCQkJZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCQkJCWNvbnRleHQucG9wdXBDb250YWluZXIuY3NzKHtoZWlnaHQ6IGNvbnRleHQucG9wdXBDb250ZW50Lm91dGVySGVpZ2h0KCl9KTsKCQkJCX0sIDI1MCk7CgkJCX0pOwoJCQlibG9ja1dpbmRvd1Njcm9sbGluZyhjb250ZXh0KTsKCQkJY29udGV4dC5jdXJyZW50SXRlbUluZGV4ID0gbnVsbDsKCQkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm1lc3NhZ2luZy5wdWJsaXNoKGFjdGl2YXRlTWVzc2FnZSwge2tleTogY29udGV4dC5rZXl9KTsKCQl9CgoJCWZ1bmN0aW9uIGhpZGVQb3B1cChjb250ZXh0KSB7CgkJCWNvbnRleHQucG9wdXAuZ2xvd1BvcFVwUGFuZWwoJ2hpZGUnKTsKCQkJdW5ibG9ja1dpbmRvd1Njcm9sbGluZyhjb250ZXh0KTsKCQkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm1lc3NhZ2luZy5wdWJsaXNoKGRlYWN0aXZhdGVNZXNzYWdlLCB7a2V5OiBjb250ZXh0LmtleX0pOwoJCX0KCgkJZnVuY3Rpb24gYXBwZW5kVG9Qb3B1cChjb250ZXh0LCBjb250ZW50LCBzaG91bGRSZXBsYWNlKSB7CgkJCWlmIChjb250ZW50ID09PSBudWxsKQoJCQkJcmV0dXJuOwoJCQlpZiAoc2hvdWxkUmVwbGFjZSkgewoJCQkJY29udGV4dC5wb3B1cENvbnRlbnRMaXN0Lmh0bWwoY29udGVudCk7CgkJCX0KCQkJZWxzZSB7CgkJCQljb250ZXh0LnBvcHVwQ29udGVudExpc3QuYXBwZW5kKGNvbnRlbnQpOwoJCQl9CgkJCWNvbnRleHQubG9hZGluZyA9IGZhbHNlOwoJCQljb250ZXh0Lmhhc01vcmUgPSBjb250ZXh0LnBvcHVwQ29udGVudExpc3QuY2hpbGRyZW4oJ2xpOmxhc3QnKS5kYXRhKCdoYXNtb3JlJykgPyB0cnVlIDogZmFsc2U7CgkJCWNvbnRleHQucG9wdXBDb250ZW50ID0gY29udGV4dC5wb3B1cENvbnRlbnRMaXN0LmNsb3Nlc3QoJy5wb3B1cC1saXN0Jyk7CgkJCWNvbnRleHQucG9wdXBDb250YWluZXIgPSBjb250ZXh0LnBvcHVwQ29udGVudC5wYXJlbnQoKTsKCQkJY29udGV4dC5wb3B1cENvbnRhaW5lci5jc3Moe2hlaWdodDogY29udGV4dC5wb3B1cENvbnRlbnQub3V0ZXJIZWlnaHQoKX0pOwoJCQljb250ZXh0LnBvcHVwQ29udGVudC5maW5kKCcudWktdmlld2h0bWwnKS5vbigncmVuZGVyZWQnLCBmdW5jdGlvbiAoKSB7CgkJCQlnbG9iYWwuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCQkJY29udGV4dC5wb3B1cENvbnRhaW5lci5jc3Moe2hlaWdodDogY29udGV4dC5wb3B1cENvbnRlbnQub3V0ZXJIZWlnaHQoKX0pOwoJCQkJfSwgMjUwKTsKCQkJfSk7CgkJfQoKCQlmdW5jdGlvbiBkZWFjdGl2YXRlKGNvbnRleHQpIHsKCQkJaGlkZVBvcHVwKGNvbnRleHQpOwoJCX0KCgkJZnVuY3Rpb24gYWN0aXZhdGUoYWN0aXZhdG9yLCBjb250ZXh0KSB7CgkJCWNvbnRleHQuY3VycmVudFBhZ2VJbmRleCA9IDA7CgkJCWNvbnRleHQuaGFzTW9yZSA9IHRydWU7CgkJCWFjdGl2YXRvci5wYXJlbnQoKS5hZGRDbGFzcygnYWN0aXZlJyk7CgkJCWxvYWRTaG93U2V0dGluZ3MoYWN0aXZhdG9yLCBjb250ZXh0KS50aGVuKGZ1bmN0aW9uIChzaG93U2V0dGluZ3MpIHsKCQkJCWNvbnRleHQuc2hvd1NldHRpbmdzID0gc2hvd1NldHRpbmdzOwoJCQkJY29udGV4dC5wb3B1cENvbnRlbnRMaXN0LmNzcyh7CgkJCQkJd2lkdGg6IHNob3dTZXR0aW5ncy53aWR0aCwKCQkJCQltYXhIZWlnaHQ6IHNob3dTZXR0aW5ncy5tYXhIZWlnaHQKCQkJCX0pOwoJCQkJbG9hZENvbnRlbnQoY29udGV4dCwgY29udGV4dC5jdXJyZW50UGFnZUluZGV4LCB0cnVlKS50aGVuKGZ1bmN0aW9uIChjb250ZW50KSB7CgkJCQkJc2hvd1BvcHVwKGNvbnRleHQsIGNvbnRlbnQsIHNob3dTZXR0aW5ncyk7CgkJCQkJY29udGV4dC5wb3B1cENvbnRhaW5lci5yZW1vdmVDbGFzcygpLmFkZENsYXNzKHNob3dTZXR0aW5ncy5jb250YWluZXJDc3NDbGFzcyk7CgkJCQl9KTsKCQkJfSk7CgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVQb3BvdXBPcGVuZXJDbGljayhsaW5rLCBjb250ZXh0KSB7CgkJCWlmIChjb250ZXh0LnBvcHVwLmdsb3dQb3BVcFBhbmVsKCdpc09wZW5pbmcnKSkgewoJCQkJcmV0dXJuOwoJCQl9CgkJCWVsc2UgaWYgKGNvbnRleHQucG9wdXAuZ2xvd1BvcFVwUGFuZWwoJ2lzU2hvd24nKSkgewoJCQkJaGlkZVBvcHVwKGNvbnRleHQpOwoJCQkJZGVhY3RpdmF0ZShjb250ZXh0KTsKCQkJfQoJCQllbHNlIHsKCQkJCWFjdGl2YXRlKGxpbmssIGNvbnRleHQpOwoJCQl9CgkJfQoKCQlmdW5jdGlvbiBpc09wZW5Pck9wZW5pbmcoY29udGV4dCkgewoJCQlyZXR1cm4gY29udGV4dC5wb3B1cC5nbG93UG9wVXBQYW5lbCgnaXNPcGVuaW5nJykgfHwKCQkJCWNvbnRleHQucG9wdXAuZ2xvd1BvcFVwUGFuZWwoJ2lzU2hvd24nKTsKCQl9CgoJCWZ1bmN0aW9uIG1vdmUoY29udGV4dCwgZGlyZWN0aW9uLCBoYW5kbGVyKSB7CgkJCXZhciBhdmFpbGFibGVJdGVtcyA9ICQoY29udGV4dC5wb3B1cENvbnRlbnRMaXN0LmNoaWxkcmVuKCdsaS5jb250ZW50LWl0ZW0nKSk7CgkJCWlmIChhdmFpbGFibGVJdGVtcy5sZW5ndGggPT0gMCkKCQkJCXJldHVybjsKCgkJCWF2YWlsYWJsZUl0ZW1zLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpOwoKCQkJaWYgKGNvbnRleHQuY3VycmVudEl0ZW1JbmRleCA9PT0gbnVsbCkgewoJCQkJY29udGV4dC5jdXJyZW50SXRlbUluZGV4ID0gMDsKCQkJfQoJCQllbHNlIGlmIChkaXJlY3Rpb24gPT0gJ2Rvd24nKSB7CgkJCQljb250ZXh0LmN1cnJlbnRJdGVtSW5kZXgrKzsKCQkJCWlmIChjb250ZXh0LmN1cnJlbnRJdGVtSW5kZXggPj0gYXZhaWxhYmxlSXRlbXMubGVuZ3RoKQoJCQkJCWNvbnRleHQuY3VycmVudEl0ZW1JbmRleCA9IDA7CgkJCX0KCQkJZWxzZSBpZiAoZGlyZWN0aW9uID09ICd1cCcpIHsKCQkJCWNvbnRleHQuY3VycmVudEl0ZW1JbmRleC0tOwoJCQkJaWYgKGNvbnRleHQuY3VycmVudEl0ZW1JbmRleCA8IDApCgkJCQkJY29udGV4dC5jdXJyZW50SXRlbUluZGV4ID0gKGF2YWlsYWJsZUl0ZW1zLmxlbmd0aCAtIDEpOwoJCQl9CgoJCQkvLyBnZXQgaXRlbSB0byBzY3JvbGwgdG8KCQkJdmFyIHNlbGVjdGVkSXRlbSA9ICQoYXZhaWxhYmxlSXRlbXNbY29udGV4dC5jdXJyZW50SXRlbUluZGV4XSk7CgkJCWlmICghc2VsZWN0ZWRJdGVtKQoJCQkJcmV0dXJuOwoKCQkJLy8gc2Nyb2xsIHRvIGl0CgkJCWNvbnRleHQucG9wdXBDb250ZW50TGlzdC5hbmltYXRlKHsKCQkJCXNjcm9sbFRvcDogKGNvbnRleHQucG9wdXBDb250ZW50TGlzdC5zY3JvbGxUb3AoKSAtCgkJCQljb250ZXh0LnBvcHVwQ29udGVudExpc3Qub2Zmc2V0KCkudG9wICsKCQkJCXNlbGVjdGVkSXRlbS5vZmZzZXQoKS50b3AgLQoJCQkJc2VsZWN0ZWRJdGVtLmhlaWdodCgpKQoJCQl9LCAxMDApOwoKCQkJLy8gaGlnaGxpZ2h0IGl0CgkJCXNlbGVjdGVkSXRlbS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsKCgkJCS8vIGluZm9ybSBjYWxsaW5nIGNvZGUgb2Ygc2VsZWN0aW9uCgkJCWhhbmRsZXIoc2VsZWN0ZWRJdGVtKTsKCQl9CgoJCWZ1bmN0aW9uIGhhbmRsZUV2ZW50cyhjb250ZXh0KSB7CgkJCWNvbnRleHQuYWN0aXZhdGlvbkxpbmsub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHsKCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCWhhbmRsZVBvcG91cE9wZW5lckNsaWNrKGNvbnRleHQuYWN0aXZhdGlvbkxpbmssIGNvbnRleHQpOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9KTsKCQkJLy8gZ28gYWhlYWQgYW5kIGltbWVpZGF0ZWx5IGhhbmRsZSwgYXMgaGFuZGxlRXZlbnRzIGlzIG9ubHkKCQkJLy8gZmlyc3QgY2FsbGVkIGZyb20gYSBkZWZlcnJlZCBjbGljawoJCQkvLyBoYW5kbGVQb3BvdXBPcGVuZXJDbGljayhjb250ZXh0LmFjdGl2YXRpb25MaW5rLCBjb250ZXh0KTsKCgkJCWNvbnRleHQuYWN0aXZhdGlvbklucHV0Lm9uKHsKCQkJCWZvY3VzOiBmdW5jdGlvbiAoZSkgewoJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCgkJCQkJdmFyIHZhbCA9ICQudHJpbShjb250ZXh0LmFjdGl2YXRpb25JbnB1dC52YWwoKSk7CgkJCQkJaWYgKCFpc09wZW5Pck9wZW5pbmcoY29udGV4dCkgJiYgdmFsLmxlbmd0aCA+PSAzKSB7CgkJCQkJCWFjdGl2YXRlKCQoZS50YXJnZXQpLCBjb250ZXh0KTsKCQkJCQl9CgoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0sCgkJCQlibHVyOiBmdW5jdGlvbiAoZSkgewoJCQkJfSwKCQkJCSdpbnB1dCBwcm9wZXJ0eWNoYW5nZSc6IGZ1bmN0aW9uIChlKSB7CgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoKCQkJCQlpZiAoZS50eXBlID09ICdwcm9wZXJ0eWNoYW5nZScgJiYgZS5vcmlnaW5hbEV2ZW50LnByb3BlcnR5TmFtZSAhPSAidmFsdWUiKQoJCQkJCQlyZXR1cm4gZmFsc2U7CgoJCQkJCXZhciB2YWwgPSAkLnRyaW0oY29udGV4dC5hY3RpdmF0aW9uSW5wdXQudmFsKCkpOwoJCQkJCWlmICghaXNPcGVuT3JPcGVuaW5nKGNvbnRleHQpICYmIHZhbC5sZW5ndGggPj0gMykgewoJCQkJCQlhY3RpdmF0ZSgkKGUudGFyZ2V0KSwgY29udGV4dCk7CgkJCQkJfQoJCQkJCWVsc2UgaWYgKGlzT3Blbk9yT3BlbmluZyhjb250ZXh0KSAmJiB2YWwubGVuZ3RoIDwgMykgewoJCQkJCQlkZWFjdGl2YXRlKGNvbnRleHQpOwoJCQkJCX0KCgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoKCgkJCX0pOwoJCQkvLyBoYW5kbGUgZW5kbGVzcyBzY3JvbGxpbmcgaWYgZW5hYmxlZAoJCQlpZiAoY29udGV4dC5lbmRsZXNzU2Nyb2xsKSB7CgkJCQljb250ZXh0LnBvcHVwQ29udGVudExpc3Qub24oJ3Njcm9sbGVuZCcsIGZ1bmN0aW9uICgpIHsKCQkJCQlpZiAoIWNvbnRleHQuaGFzTW9yZSkgewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJCWlmIChjb250ZXh0LmxvYWRpbmcpIHsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCQljb250ZXh0LmN1cnJlbnRQYWdlSW5kZXgrKzsKCQkJCQlsb2FkQ29udGVudChjb250ZXh0LCBjb250ZXh0LmN1cnJlbnRQYWdlSW5kZXgsIHRydWUpLmRvbmUoZnVuY3Rpb24gKGNvbnRlbnQpIHsKCQkJCQkJYXBwZW5kVG9Qb3B1cChjb250ZXh0LCBjb250ZW50KTsKCQkJCQl9KTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9KTsKCQkJfQoKCQkJY29udGV4dC5wb3B1cENvbnRlbnRMaXN0Lm9uKCdjbGljaycsICcuY29udGVudC1pdGVtJywgZnVuY3Rpb24gKGUpIHsKCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCWNvbnRleHQub25TZWxlY3QodGhpcyk7CgkJCX0pOwoJCQljb250ZXh0LnBvcHVwQ29udGVudExpc3Qub24oJ2NsaWNrJywgJ2EnLCBmdW5jdGlvbiAoZSkgewoJCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQkJfSk7CgkJfQoKCQlmdW5jdGlvbiBpbml0Q29udGV4dChjb250ZXh0KSB7CgkJCWNvbnRleHQuYWN0aXZhdGlvbkxpbmsgPSAkKGNvbnRleHQuYWN0aXZhdGlvbkxpbmspOwoJCQljb250ZXh0LmFjdGl2YXRpb25JbnB1dCA9ICQoY29udGV4dC5hY3RpdmF0aW9uSW5wdXQpOwoJCQljb250ZXh0LmFjdGl2YXRvciA9IGNvbnRleHQuYWN0aXZhdGlvbkxpbmsubGVuZ3RoID4gMCA/IGNvbnRleHQuYWN0aXZhdGlvbkxpbmsgOiBjb250ZXh0LmFjdGl2YXRpb25JbnB1dDsKCQl9CgoJCWZ1bmN0aW9uIGFwaShvcHRpb25zKSB7CgkJCS8vIHByaXZhdGUgaW5zdGFuY2UgbWVtYmVycyBvZiBhIEhlYWRlckxpc3QKCQkJdmFyIGNvbnRleHQgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIG9wdGlvbnMgfHwge30pOwoJCQlpbml0Q29udGV4dChjb250ZXh0KTsKCQkJdmFyIGluaXRlZCA9IGZhbHNlOwoKCQkJZnVuY3Rpb24gaW5pdCgpIHsKCQkJCWlmIChpbml0ZWQpCgkJCQkJcmV0dXJuOwoJCQkJaW5pdGVkID0gdHJ1ZTsKCQkJCWJ1aWxkUG9wVXAoY29udGV4dCk7CgkJCQloYW5kbGVFdmVudHMoY29udGV4dCk7CgkJCX0KCgkJCS8vIGxhenktc2V0dXAgdW50aWwgY2xpY2tlZAoJCQljb250ZXh0LmFjdGl2YXRpb25MaW5rLm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoZSkgewoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJaW5pdCgpOwoJCQkJY29udGV4dC5hY3RpdmF0aW9uTGluay5jbGljaygpOwoJCQl9KTsKCQkJY29udGV4dC5hY3RpdmF0aW9uSW5wdXQub25lKCdmb2N1cycsIGZ1bmN0aW9uIChlKSB7CgkJCQlpbml0KCk7CgkJCQljb250ZXh0LmFjdGl2YXRpb25JbnB1dC5mb2N1cygpOwoJCQl9KTsKCQkJc2hvd1VucmVhZENvdW50KGNvbnRleHQsIGNvbnRleHQuaW5pdGlhbFVucmVhZENvdW50KTsKCgkJCS8vIHB1YmxpYyBpbnN0YW5jZSBtZW1iZXJzIG9mIGEgSGVhZGVyTGlzdAoJCQlyZXR1cm4gewoJCQkJcmVmcmVzaFVucmVhZENvdW50OiBmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuIGNvbnRleHQub25SZWZyZXNoVW5yZWFkQ291bnQoZnVuY3Rpb24gKG5ld0NvdW50KSB7CgkJCQkJCXNob3dVbnJlYWRDb3VudChjb250ZXh0LCBuZXdDb3VudCk7CgkJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCQkJCQkJaWYgKGNvbnRleHQucG9wdXBDb250YWluZXIpCgkJCQkJCQkJY29udGV4dC5wb3B1cENvbnRhaW5lci5jc3Moe2hlaWdodDogY29udGV4dC5wb3B1cENvbnRlbnQub3V0ZXJIZWlnaHQoKX0pOwoJCQkJCQl9LCAxMTApCgkJCQkJfSk7CgkJCQl9LAoJCQkJcmVmcmVzaENvbnRlbnQ6IGZ1bmN0aW9uICgpIHsKCQkJCQkvLyByZWZyZXNoaW5nIGNvbnRlbnQgb25seSBoYXMgYW4gZWZmZWN0IGlmIGFscmVhZHkgc2hvd24KCQkJCQlpZiAoY29udGV4dC5wb3B1cCAmJiBjb250ZXh0LnBvcHVwLmdsb3dQb3BVcFBhbmVsKCdpc1Nob3duJykpIHsKCQkJCQkJY29udGV4dC5jdXJyZW50UGFnZUluZGV4ID0gMDsKCQkJCQkJbG9hZENvbnRlbnQoY29udGV4dCwgY29udGV4dC5jdXJyZW50UGFnZUluZGV4LCBmYWxzZSkudGhlbihmdW5jdGlvbiAoY29udGVudCkgewoJCQkJCQkJYXBwZW5kVG9Qb3B1cChjb250ZXh0LCBjb250ZW50LCB0cnVlKTsKCQkJCQkJfSk7CgkJCQkJfQoJCQkJfSwKCQkJCWNvbnRlbnQ6IGZ1bmN0aW9uICgpIHsKCQkJCQlyZXR1cm4gY29udGV4dC5wb3B1cENvbnRlbnRMaXN0OwoJCQkJfSwKCQkJCWZvb3RlcjogZnVuY3Rpb24gKCkgewoJCQkJCXJldHVybiBjb250ZXh0LmZvb3RlcjsKCQkJCX0sCgkJCQlhY3RpdmF0ZTogZnVuY3Rpb24gKCkgewoJCQkJCWluaXQoKTsKCQkJCQlhY3RpdmF0ZSgkKGNvbnRleHQuYWN0aXZhdGlvbklucHV0IHx8IGNvbnRleHQuYWN0aXZhdGlvbkxpbmspLCBjb250ZXh0KTsKCQkJCX0sCgkJCQlkZWFjdGl2YXRlOiBmdW5jdGlvbiAoKSB7CgkJCQkJZGVhY3RpdmF0ZShjb250ZXh0KTsKCQkJCX0sCgkJCQltb3ZlVXA6IGZ1bmN0aW9uIChoYW5kbGVyKSB7CgkJCQkJbW92ZShjb250ZXh0LCAndXAnLCBoYW5kbGVyKTsKCQkJCX0sCgkJCQltb3ZlRG93bjogZnVuY3Rpb24gKGhhbmRsZXIpIHsKCQkJCQltb3ZlKGNvbnRleHQsICdkb3duJywgaGFuZGxlcik7CgkJCQl9CgkJCX07CgkJfQoKCQkvLyBwdWJsaWMgc3RhdGljIG1lbWJlcnMgb2YgYSBIZWFkZXJMaXN0CgkJYXBpLmhpZGVDdXJyZW50ID0gZnVuY3Rpb24gKCkgewoJCQlpZiAob3BlbkhlYWRlckxpc3RDb250ZXh0KSB7CgkJCQloaWRlUG9wdXAob3BlbkhlYWRlckxpc3RDb250ZXh0KTsKCQkJfQoJCX07CgoJCXJldHVybiBhcGk7CgoJfSkoJCk7CgoJZnVuY3Rpb24gaW5pdE5vdGlmaWNhdGlvbkxpc3QoY29udGV4dCkgewoJCXZhciBkZWJvdW5jZWROb3RpZmljYXRpb25SZWFkVGltZW91dDsKCQl2YXIgc3VwcHJlc3NOb3RpZmljYXRpb25zUmVhZE1lc3NhZ2UgPSBmYWxzZTsKCQl2YXIgc3VwcHJlc3NOb3RpZmljYXRpb25zUmVhZE1lc3NhZ2VUaW1lb3V0OwoJCXZhciBjdXJyZW50VG90YWxDb3VudCA9IDA7CgoJCWZ1bmN0aW9uIGRpc3BsYXlOb3RpZmljYXRpb25QcmVmZXJlbmNlKGNvbnRleHQsIG5vdGlmaWNhdGlvbkl0ZW0pIHsKCQkJLy8gc2V0IHRoZSBub3RpZmljYXRpb24gbGlzdCBzaXplIGR1cmluZyBwcmVmZXJlbmNlLWRpc3BsYXlpbmcgc28gdGhhdCBpdCBkb2VzIG5vdCByZXNpemUgb3V0IG9mIHRoZSBib3VuZHMgb2YgdGhlIHBvcHVwCgkJCWNvbnRleHQubm90aWZpY2F0aW9uTGlzdCA9IGNvbnRleHQubm90aWZpY2F0aW9uTGlzdCB8fCBub3RpZmljYXRpb25JdGVtLmNsb3Nlc3QoJ3VsJyk7CgkJCWNvbnRleHQubm90aWZpY2F0aW9uTGlzdC5jc3MoewoJCQkJaGVpZ2h0OiBjb250ZXh0Lm5vdGlmaWNhdGlvbkxpc3QuaGVpZ2h0KCkKCQkJfSk7CgkJCWlmIChjb250ZXh0LnByZWZlcmVuY2VVaSkgewoJCQkJaGlkZU5vdGlmaWNhdGlvblByZWZlcmVuY2UoY29udGV4dCwgY29udGV4dC5wcmVmZXJlbmNlVWkpOwoJCQkJY29udGV4dC5wcmVmZXJlbmNlVWkgPSBudWxsOwoJCQl9CgkJCWNvbnRleHQucHJlZmVyZW5jZVRlbXBsYXRlID0gY29udGV4dC5wcmVmZXJlbmNlVGVtcGxhdGUgfHwgJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnRlbXBsYXRlLmNvbXBpbGUoY29udGV4dC5ub3RpZmljYXRpb25QcmVmZXJlbmNlVGVtcGxhdGUpOwoJCQljb250ZXh0LnByZWZlcmVuY2VVaSA9ICQoY29udGV4dC5wcmVmZXJlbmNlVGVtcGxhdGUoewoJCQkJbm90aWZpY2F0aW9uVHlwZU5hbWU6IG5vdGlmaWNhdGlvbkl0ZW0uZGF0YSgnbm90aWZpY2F0aW9udHlwZW5hbWUnKSwKCQkJCW5vdGlmaWNhdGlvblR5cGVJZDogbm90aWZpY2F0aW9uSXRlbS5kYXRhKCdub3RpZmljYXRpb250eXBlaWQnKQoJCQl9KSkKCQkJCS5oaWRlKCkKCQkJCS5hcHBlbmRUbyhub3RpZmljYXRpb25JdGVtKTsKCQkJY29udGV4dC5wcmVmZXJlbmNlVWkuY3NzKHsKCQkJCXBvc2l0aW9uOiAnYWJzb2x1dGUnLAoJCQkJdG9wOiAwLAoJCQkJbGVmdDogMCwKCQkJCXpJbmRleDogMjAwMAoJCQl9KTsKCgkJCW5vdGlmaWNhdGlvbkl0ZW0uYWRkQ2xhc3MoJ3dpdGgtcHJlZmVyZW5jZScpOwoJCQlub3RpZmljYXRpb25JdGVtLmRhdGEoJ29yaWdpbmFsSGVpZ2h0Jywgbm90aWZpY2F0aW9uSXRlbS5vdXRlckhlaWdodCgpKTsKCQkJbm90aWZpY2F0aW9uSXRlbS5hbmltYXRlKHtoZWlnaHQ6IGNvbnRleHQucHJlZmVyZW5jZVVpLmhlaWdodCgpfSwgMTUwKTsKCgkJCWNvbnRleHQucHJlZmVyZW5jZVVpLmZhZGVUbygxNTAsIDAuOTgpOwoJCX0KCgkJZnVuY3Rpb24gaGlkZU5vdGlmaWNhdGlvblByZWZlcmVuY2UoY29udGV4dCwgcHJlZmVyZW5jZUl0ZW0pIHsKCQkJY29udGV4dC5ub3RpZmljYXRpb25MaXN0LmNzcyh7aGVpZ2h0OiAnYXV0byd9KTsKCQkJaWYgKHByZWZlcmVuY2VJdGVtKSB7CgkJCQl2YXIgbm90aWZpY2F0aW9uSXRlbSA9IHByZWZlcmVuY2VJdGVtLnBhcmVudCgpOwoJCQkJbm90aWZpY2F0aW9uSXRlbS5hbmltYXRlKHtoZWlnaHQ6IG5vdGlmaWNhdGlvbkl0ZW0uZGF0YSgnb3JpZ2luYWxIZWlnaHQnKX0sIDE1MCk7CgkJCQlwcmVmZXJlbmNlSXRlbS5mYWRlT3V0KDE1MCwgZnVuY3Rpb24gKCkgewoJCQkJCW5vdGlmaWNhdGlvbkl0ZW0ucmVtb3ZlQ2xhc3MoJ3dpdGgtcHJlZmVyZW5jZScpOwoJCQkJCXByZWZlcmVuY2VJdGVtLnJlbW92ZSgpOwoJCQkJfSk7CgkJCX0KCQl9CgoJCWZ1bmN0aW9uIGRpc2FibGVOb3RpZmljYXRpb25UeXBlKGNvbnRleHQsIG5vdGlmaWNhdGlvblR5cGVJZCkgewoJCQlyZXR1cm4gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnB1dCh7CgkJCQl1cmw6ICQudGVsbGlnZW50LmV2b2x1dGlvbi5zaXRlLmdldEJhc2VVcmwoKSArICdhcGkuYXNoeC92Mi9ub3RpZmljYXRpb25wcmVmZXJlbmNlLmpzb24nLAoJCQkJZGF0YTogewoJCQkJCU5vdGlmaWNhdGlvblR5cGVJZDogbm90aWZpY2F0aW9uVHlwZUlkLAoJCQkJCUlzRW5hYmxlZDogZmFsc2UKCQkJCX0sCgkJCQlkYXRhVHlwZTogJ2pzb24nCgkJCX0pOwoJCX0KCgkJZnVuY3Rpb24gaW5pdE5vdGlmaWNhdGlvbkl0ZW1IYW5kbGVycygpIHsKCQkJLy8gbWFyayBpbmRpdmlkdWFsIG5vdGlmaWNhdGlvbnMgYXMgcmVhZAoJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LmNvbnRlbnQoKS5vbignY2xpY2snLCAnLm1hcmsgYScsIGZ1bmN0aW9uIChlKSB7CgkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQl2YXIgbWFya0xpbmsgPSAkKGUudGFyZ2V0KTsKCQkJCXZhciBub3RpZmljYXRpb25MaW5lSXRlbSA9ICQodGhpcykuY2xvc2VzdCgnbGknKTsKCQkJCXZhciBub3RpZmljYXRpb25JZCA9IG5vdGlmaWNhdGlvbkxpbmVJdGVtLmRhdGEoJ25vdGlmaWNhdGlvbmlkJyk7CgkJCQltYXJrTm90aWZpY2F0aW9uQXNSZWFkKG5vdGlmaWNhdGlvbklkKS50aGVuKGZ1bmN0aW9uICgpIHsKCQkJCQltYXJrTGluay5oaWRlKCk7CgkJCQkJbm90aWZpY2F0aW9uTGluZUl0ZW0ucmVtb3ZlQ2xhc3MoJ3VucmVhZCcpOwoJCQkJCWNvbnRleHQubm90aWZpY2F0aW9uc0xpc3QucmVmcmVzaFVucmVhZENvdW50KCkKCQkJCX0pOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9KTsKCgkJCS8vIGRpc3BsYXkgcHJlZmVyZW5jZSBjaGFuZ2UgdWkgb24gJ3gnIGNsaWNrCgkJCWNvbnRleHQubm90aWZpY2F0aW9uc0xpc3QuY29udGVudCgpLm9uKCdjbGljaycsICcucHJlZmVyZW5jZSBhJywgZnVuY3Rpb24gKGUpIHsKCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCWRpc3BsYXlOb3RpZmljYXRpb25QcmVmZXJlbmNlKGNvbnRleHQsICQodGhpcykuY2xvc2VzdCgnbGknKSk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0pOwoKCQkJLy8gaGFuZGxlIGNhbmNlbHMgb2YgcHJlZmVyZW5jZSBjaGFuZ2Ugd2hlbiBjbGlja2luZyAnY2FuY2VsJwoJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LmNvbnRlbnQoKS5vbignY2xpY2snLCAnLm5vdGlmaWNhdGlvbi1wcmVmZXJlbmNlIC5jYW5jZWwnLCBmdW5jdGlvbiAoZSkgewoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQkJCWhpZGVOb3RpZmljYXRpb25QcmVmZXJlbmNlKGNvbnRleHQsICQodGhpcykuY2xvc2VzdCgnLm5vdGlmaWNhdGlvbi1wcmVmZXJlbmNlJykpOwoJCQkJY29udGV4dC5wcmVmZXJlbmNlVWkgPSBudWxsOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9KTsKCgkJCS8vIGhhbmRsZSBjYW5jZWxzIG9mIHByZWZlcmVuY2UgY2hhbmdlIGJ5IGNsaWNraW5nIGFueXRoaW5nIG90aGVyIHRoYW4gJ3R1cm4gb2ZmJwoJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LmNvbnRlbnQoKS5vbignY2xpY2snLCAnLm5vdGlmaWNhdGlvbi1wcmVmZXJlbmNlJywgZnVuY3Rpb24gKGUpIHsKCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7CgkJCQloaWRlTm90aWZpY2F0aW9uUHJlZmVyZW5jZShjb250ZXh0LCAkKHRoaXMpKTsKCQkJCWNvbnRleHQucHJlZmVyZW5jZVVpID0gbnVsbDsKCQkJCXJldHVybiBmYWxzZTsKCQkJfSk7CgoJCQkvLyBoYW5kbGUgY29uZmlybWVkIHByZWZlcmVuY2UgY2hhbmdlcwoJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LmNvbnRlbnQoKS5vbignY2xpY2snLCAnLm5vdGlmaWNhdGlvbi1wcmVmZXJlbmNlIC5jb25maXJtJywgZnVuY3Rpb24gKGUpIHsKCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCXZhciBub3RpZmljYXRpb25QcmVmZXJlbmNlID0gJCh0aGlzKS5jbG9zZXN0KCcubm90aWZpY2F0aW9uLXByZWZlcmVuY2UnKSwKCQkJCQlub3RpZmljYXRpb25JdGVtID0gbm90aWZpY2F0aW9uUHJlZmVyZW5jZS5jbG9zZXN0KCdsaScpOwoJCQkJZGlzYWJsZU5vdGlmaWNhdGlvblR5cGUoY29udGV4dCwgJCh0aGlzKS5kYXRhKCdub3RpZmljYXRpb250eXBlaWQnKSkudGhlbihmdW5jdGlvbiAoKSB7CgkJCQkJbm90aWZpY2F0aW9uSXRlbS5mYWRlT3V0KDIwMCwgZnVuY3Rpb24gKCkgewoJCQkJCQlub3RpZmljYXRpb25QcmVmZXJlbmNlLnJlbW92ZSgpOwoJCQkJCQlub3RpZmljYXRpb25JdGVtLnJlbW92ZSgpOwoJCQkJCX0pOwoJCQkJCWNvbnRleHQucHJlZmVyZW5jZVVpID0gbnVsbDsKCQkJCX0pOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9KTsKCQl9CgoJCWZ1bmN0aW9uIG1hcmtOb3RpZmljYXRpb25Bc1JlYWQobm90aWZpY2F0aW9uSWQpIHsKCQkJY2xlYXJUaW1lb3V0KHN1cHByZXNzTm90aWZpY2F0aW9uc1JlYWRNZXNzYWdlVGltZW91dCk7CgkJCXN1cHByZXNzTm90aWZpY2F0aW9uc1JlYWRNZXNzYWdlID0gdHJ1ZTsKCQkJdmFyIG1hcmtOb3RpZmljYXRpb25Qcm9taXNlID0gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnB1dCh7CgkJCQl1cmw6ICQudGVsbGlnZW50LmV2b2x1dGlvbi5zaXRlLmdldEJhc2VVcmwoKSArICdhcGkuYXNoeC92Mi9ub3RpZmljYXRpb24ve05vdGlmaWNhdGlvbklkfS5qc29uJywKCQkJCWRhdGE6IHsKCQkJCQlOb3RpZmljYXRpb25JZDogbm90aWZpY2F0aW9uSWQsCgkJCQkJTWFya0FzUmVhZDogdHJ1ZQoJCQkJfQoJCQl9KTsKCQkJbWFya05vdGlmaWNhdGlvblByb21pc2UuZG9uZShmdW5jdGlvbiAoKSB7CgkJCQlzdXBwcmVzc05vdGlmaWNhdGlvbnNSZWFkTWVzc2FnZVRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKCQkJCQlzdXBwcmVzc05vdGlmaWNhdGlvbnNSZWFkTWVzc2FnZSA9IGZhbHNlOwoJCQkJfSwgNTAwMCk7CgkJCX0pOwoJCQlyZXR1cm4gbWFya05vdGlmaWNhdGlvblByb21pc2U7CgkJfQoKCQlmdW5jdGlvbiBtYXJrQWxsQXNSZWFkKCkgewoJCQl2YXIgdW5yZWFkSXRlbXMgPSBjb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LmNvbnRlbnQoKS5maW5kKCc+IGxpLnVucmVhZCcpOwoJCQkvLyByZW1vdmUgdW5yZWFkIFVJIHN0YXRlIGltbWVkaWF0ZWx5IGJlZm9yZSB3YWl0aW5nIGZvciBzZXJ2ZXIgY2hhbmdlCgkJCXVucmVhZEl0ZW1zLnJlbW92ZUNsYXNzKCd1bnJlYWQnKTsKCQkJY2xlYXJUaW1lb3V0KHN1cHByZXNzTm90aWZpY2F0aW9uc1JlYWRNZXNzYWdlVGltZW91dCk7CgkJCXN1cHByZXNzTm90aWZpY2F0aW9uc1JlYWRNZXNzYWdlID0gdHJ1ZTsKCQkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLmJhdGNoKGZ1bmN0aW9uICgpIHsKCQkJCS8vIGxvb3AgdGhyb3VnaCBhbGwgb2YgdGhlIGN1cnJlbnRseSB2aXNpYmxlIHVucmVhZCBub3RpZmljYXRpb24gaXRlbXMKCQkJCXVucmVhZEl0ZW1zLmVhY2goZnVuY3Rpb24gKCkgewoJCQkJCS8vIGFuZCBtYXJrIHRoZSBub3RpZmljYWl0b24gYXMgcmVhZAoJCQkJCW1hcmtOb3RpZmljYXRpb25Bc1JlYWQoJCh0aGlzKS5kYXRhKCdub3RpZmljYXRpb25pZCcpKTsKCQkJCX0pOwoJCQl9KS50aGVuKGZ1bmN0aW9uICgpIHsKCQkJCWNvbnRleHQubm90aWZpY2F0aW9uc0xpc3QucmVmcmVzaENvbnRlbnQoKTsKCQkJCWNvbnRleHQubm90aWZpY2F0aW9uc0xpc3QucmVmcmVzaFVucmVhZENvdW50KCkKCQkJCXN1cHByZXNzTm90aWZpY2F0aW9uc1JlYWRNZXNzYWdlVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCQkJCXN1cHByZXNzTm90aWZpY2F0aW9uc1JlYWRNZXNzYWdlID0gZmFsc2U7CgkJCQl9LCA1MDAwKTsKCQkJfSk7CgkJfQoKCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0ID0gSGVhZGVyTGlzdCh7CgkJCWtleTogJ25vdGlmaWNhdGlvbnMnLAoJCQlmb290ZXJDb250ZW50OiBjb250ZXh0Lm5vdGlmaWNhdGlvbkxpc3RGb290ZXJDb250ZW50LAoJCQlpbml0aWFsVW5yZWFkQ291bnQ6IGNvbnRleHQubm90aWZpY2F0aW9uc1VucmVhZCwKCQkJYWN0aXZhdGlvbkxpbms6IGNvbnRleHQubm90aWZpY2F0aW9uc0xpbmssCgkJCWVuZGxlc3NTY3JvbGw6IHRydWUsCgkJCXRpdGxlQ291bnQ6IHRydWUsCgkJCWxpbWl0Q291bnQ6IDk5LAoJCQljc3NDbGFzczogJ25vdGlmaWNhdGlvbnMnLAoJCQl1bnJlYWRDb3VudE1lc3NhZ2VTaW5ndWxhcjogY29udGV4dC5ub3RpZmljYXRpb25zc1VucmVhZENvdW50TWVzc2FnZVNpbmd1bGFyLAoJCQl1bnJlYWRDb3VudE1lc3NhZ2VQbHVyYWw6IGNvbnRleHQubm90aWZpY2F0aW9uc3NVbnJlYWRDb3VudE1lc3NhZ2VQbHVyYWwsCgkJCXdyYXBwZXI6IGNvbnRleHQuYmFubmVyLAoJCQloYW5kaGVsZEJhbm5lckxpbmtzQ291bnQ6IGNvbnRleHQuaGFuZGhlbGRCYW5uZXJMaW5rc0NvdW50LAoJCQlvbkxvYWQ6IGZ1bmN0aW9uIChwYWdlSW5kZXgsIHNob3VsZFJlZnJlc2hVbnJlYWRDb3VudCwgZmlsdGVyLCBjb21wbGV0ZSkgewoJCQkJaWYgKCFjb250ZXh0LmlzSW5pdGVkKSB7CgkJCQkJY29udGV4dC5pc0luaXRlZCA9IHRydWU7CgkJCQkJaW5pdE5vdGlmaWNhdGlvbkl0ZW1IYW5kbGVycygpOwoJCQkJfQoJCQkJaWYgKGNvbnRleHQubm90aWZpY2F0aW9uTGlzdCkgewoJCQkJCWNvbnRleHQubm90aWZpY2F0aW9uTGlzdC5jc3Moe2hlaWdodDogJ2F1dG8nfSk7CgkJCQl9CgkJCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24uZ2V0KHsKCQkJCQl1cmw6IGNvbnRleHQubm90aWZpY2F0aW9uc1VybCwKCQkJCQlkYXRhOiB7CgkJCQkJCXdfcGFnZUluZGV4OiBwYWdlSW5kZXgsCgkJCQkJCXdfZmlsdGVyOiAoY3VycmVudFRvdGFsQ291bnQgPiAwID8gKGZpbHRlciB8fCAnYWxsJykgOiAnYWxsJykKCQkJCQl9LAoJCQkJCXN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkgewoJCQkJCQkvLyBzaG93IHJlc3BvbnNlCgkJCQkJCWNvbXBsZXRlKHJlc3BvbnNlKTsKCQkJCQkJLy8gdXBkYXRlIGNvdW50CgkJCQkJCWlmIChzaG91bGRSZWZyZXNoVW5yZWFkQ291bnQpCgkJCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LnJlZnJlc2hVbnJlYWRDb3VudCgpOwoJCQkJCX0KCQkJCX0pOwoJCQl9LAoJCQlvblJlZnJlc2hVbnJlYWRDb3VudDogZnVuY3Rpb24gKGNvbXBsZXRlKSB7CgkJCQkvLyBmaW5kIHRoZSBtYXJrIGFzIHJlYWQgbGluayBpZiBub3QgYWxyZWFkeSBmb3VuZAoJCQkJaWYgKCFjb250ZXh0Lm5vdGlmaWNhdGlvbk1hcmtBc1JlYWRMaW5rICYmIGNvbnRleHQubm90aWZpY2F0aW9uc0xpc3QpIHsKCQkJCQl2YXIgZm9vdGVyID0gY29udGV4dC5ub3RpZmljYXRpb25zTGlzdC5mb290ZXIoKTsKCQkJCQlpZiAoZm9vdGVyKSB7CgkJCQkJCWNvbnRleHQubm90aWZpY2F0aW9uTWFya0FzUmVhZExpbmsgPSBmb290ZXIuZmluZCgnYS5tYXJrLXJlYWQnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkgewoJCQkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCQkJbWFya0FsbEFzUmVhZCgpOwoJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQl9KTsKCQkJCQl9CgkJCQl9CgkJCQl2YXIgcXVlcnkgPSB7CgkJCQkJSXNSZWFkOiBmYWxzZSwKCQkJCQlQYWdlU2l6ZTogMSwKCQkJCQlQYWdlSW5kZXg6IDAKCQkJCX07CgkJCQkvLyBleGNsdWRlIGNvbnZlcnNhdGlvbiBub3RpZmljYXRpb25zCgkJCQlxdWVyeVsnX0ZpbHRlcnNfJyArIGNvbnRleHQuY29udmVyc2F0aW9uTm90aWZpY2F0aW9uVHlwZUlkXSA9ICdFeGNsdWRlJzsKCQkJCXJldHVybiAkLnRlbGxpZ2VudC5ldm9sdXRpb24uZ2V0KHsKCQkJCQl1cmw6ICQudGVsbGlnZW50LmV2b2x1dGlvbi5zaXRlLmdldEJhc2VVcmwoKSArICdhcGkuYXNoeC92Mi9ub3RpZmljYXRpb25zLmpzb24nLAoJCQkJCWNhY2hlOiBmYWxzZSwKCQkJCQlkYXRhOiBxdWVyeSwKCQkJCQlzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKCQkJCQkJY29tcGxldGUocmVzcG9uc2UuVG90YWxDb3VudCk7CgkJCQkJCWlmIChjb250ZXh0Lm5vdGlmaWNhdGlvbk1hcmtBc1JlYWRMaW5rKSB7CgkJCQkJCQljdXJyZW50VG90YWxDb3VudCA9IHJlc3BvbnNlLlRvdGFsQ291bnQ7CgkJCQkJCQlpZiAocmVzcG9uc2UuVG90YWxDb3VudCA+IDApIHsKCQkJCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbk1hcmtBc1JlYWRMaW5rLnNob3coKTsKCQkJCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNGaWx0ZXIuc2xpZGVEb3duKDEwMCk7CgkJCQkJCQl9CgkJCQkJCQllbHNlIHsKCQkJCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbk1hcmtBc1JlYWRMaW5rLmhpZGUoKTsKCQkJCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNGaWx0ZXIuc2xpZGVVcCgxMDApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfSwKCQkJCQllcnJvcjoge30KCQkJCX0pOwoJCQl9LAoJCQl0ZW1wbGF0ZTogY29udGV4dC5ub3RpZmljYXRpb25zVGVtcGxhdGUsCgkJCW9uU2hvdzogZnVuY3Rpb24gKGFjdGl2YXRvciwgY29tcGxldGUpIHsKCQkJCWNvbXBsZXRlKGJ1aWxkU2hvd1NldHRpbmdzKGNvbnRleHQsIGFjdGl2YXRvciwge30pKTsKCgkJCQltb2RpZnlQb3B1cCh0cnVlKTsKCQkJfSwKCQkJb25TZWxlY3Q6IGZ1bmN0aW9uIChpdGVtKSB7CgkJCQlpdGVtID0gJChpdGVtKTsKCQkJCXZhciBub3RpZmljYXRpb25JZCA9IGl0ZW0uZGF0YSgnbm90aWZpY2F0aW9uaWQnKSwKCQkJCQljb250ZW50VXJsID0gaXRlbS5kYXRhKCdjb250ZW50dXJsJyk7CgoJCQkJaWYgKGl0ZW0uaGFzQ2xhc3MoJ3VucmVhZCcpKSB7CgkJCQkJLy8gbWFyayBhcyByZWFkCgkJCQkJbWFya05vdGlmaWNhdGlvbkFzUmVhZChub3RpZmljYXRpb25JZCkudGhlbihmdW5jdGlvbiAoKSB7CgkJCQkJCS8vIHRoZW4gbmF2aWdhdGUgdG8gaXQgaWYgZGlmZmVyZW50IG9yIGp1c3QgcmVmcmVzaCB0aGUgdW5yZWFkIGNvdW50CgkJCQkJCWlmICh3aW5kb3cubG9jYXRpb24uaHJlZiAhPSBjb250ZW50VXJsKSB7CgkJCQkJCQl3aW5kb3cubG9jYXRpb24uaHJlZiA9IGNvbnRlbnRVcmw7CgkJCQkJCX0KCQkJCQkJZWxzZSB7CgkJCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LnJlZnJlc2hVbnJlYWRDb3VudCgpOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQl3aW5kb3cubG9jYXRpb24uaHJlZiA9IGNvbnRlbnRVcmw7CgkJCQl9CgkJCX0sCgkJCW9uQnVpbGRGaWx0ZXI6IGZ1bmN0aW9uIChmaWx0ZXJlZCkgewoJCQkJdmFyIGZpbHRlclRlbXBsYXRlID0gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnRlbXBsYXRlLmNvbXBpbGUoY29udGV4dC5ub3RpZmljYXRpb25zRmlsdGVyVGVtcGxhdGUpOwoJCQkJY29udGV4dC5ub3RpZmljYXRpb25zRmlsdGVyID0gJChmaWx0ZXJUZW1wbGF0ZSh7fSkpOwoJCQkJY29udGV4dC5ub3RpZmljYXRpb25zRmlsdGVyLmZpbmQoJ2E6Zmlyc3QnKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsKCQkJCWNvbnRleHQubm90aWZpY2F0aW9uc0ZpbHRlci5vbignY2xpY2snLCAnYScsIGZ1bmN0aW9uIChlKSB7CgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7CgkJCQkJdmFyIHRhcmdldCA9ICQoZS50YXJnZXQpOwoJCQkJCXRhcmdldC5jbG9zZXN0KCd1bCcpLmZpbmQoJ2EnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTsKCQkJCQl0YXJnZXQuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7CgkJCQkJZmlsdGVyZWQodGFyZ2V0LmRhdGEoJ2ZpbHRlcicpKTsKCQkJCX0pOwoKCQkJCXJldHVybiBjb250ZXh0Lm5vdGlmaWNhdGlvbnNGaWx0ZXIuaGlkZSgpOwoJCQl9CgkJfSk7CgoJCS8vIHVwZGF0ZSB0aGUgbm90aWZpY2F0aW9uIGxpc3QncyBjb3VudCB3aGVuIGEgbmV3IG5vdGlmaWNhdGlvbiBpcyByZWNlaXZlZCB3aGljaCBpc24ndCBhIGNvbnZlcnNhdGlvbiB0eXBlCgkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm1lc3NhZ2luZy5zdWJzY3JpYmUoJ25vdGlmaWNhdGlvbi5yYWlzZWQnLCBmdW5jdGlvbiAobm90aWZpY2F0aW9uKSB7CgkJCWlmIChub3RpZmljYXRpb24udHlwZUlkICE9PSBjb250ZXh0LmNvbnZlcnNhdGlvbk5vdGlmaWNhdGlvblR5cGVJZCkgewoJCQkJY29udGV4dC5ub3RpZmljYXRpb25zTGlzdC5yZWZyZXNoVW5yZWFkQ291bnQoKS50aGVuKGZ1bmN0aW9uICgpIHsKCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LnJlZnJlc2hDb250ZW50KCk7CgkJCQl9KTsKCQkJfQoJCX0pOwoKCQkvLyB1cGRhdGUgdGhlIG5vdGlmaWNhdGlvbiBsaXN0J3MgY291bnQgd2hlbiBhIG5ldyBub3RpZmljYXRpb24gaXMgcmVjZWl2ZWQgd2hpY2ggaXNuJ3QgYSBjb252ZXJzYXRpb24gdHlwZQoJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5tZXNzYWdpbmcuc3Vic2NyaWJlKCdub3RpZmljYXRpb24ucmVhZCcsIGZ1bmN0aW9uIChub3RpZmljYXRpb24pIHsKCQkJaWYgKG5vdGlmaWNhdGlvbi50eXBlSWQgIT09IGNvbnRleHQuY29udmVyc2F0aW9uTm90aWZpY2F0aW9uVHlwZUlkKSB7CgkJCQkvLyB3YWl0IHVudGlsIGEgZ2FwIGluIG5vdGlmaWNhdGlvbi5yZWFkIGV2ZW50cywgaW4gY2FzZSBtYW55IGhhdmUganVzdCBiZWVuIHJlY2VpdmVkCgkJCQljbGVhclRpbWVvdXQoZGVib3VuY2VkTm90aWZpY2F0aW9uUmVhZFRpbWVvdXQpOwoJCQkJZGVib3VuY2VkTm90aWZpY2F0aW9uUmVhZFRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKCQkJCQlpZiAoc3VwcHJlc3NOb3RpZmljYXRpb25zUmVhZE1lc3NhZ2UpIHsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LnJlZnJlc2hVbnJlYWRDb3VudCgpLnRoZW4oZnVuY3Rpb24gKCkgewoJCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LnJlZnJlc2hDb250ZW50KCk7CgkJCQkJfSk7CgkJCQl9LCAxMDApOwoJCQl9CgkJfSk7CgoJCXJldHVybiBjb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0OwoJfQoKCWZ1bmN0aW9uIGluaXRDb252ZXJzYXRpb25MaXN0KGNvbnRleHQpIHsKCgkJY29udGV4dC5jb252ZXJzYXRpb25zTGlzdCA9IEhlYWRlckxpc3QoewoJCQlrZXk6ICdjb252ZXJzYXRpb25zJywKCQkJZm9vdGVyQ29udGVudDogY29udGV4dC5jb252ZXJzYXRpb25MaXN0Rm9vdGVyQ29udGVudCwKCQkJaW5pdGlhbFVucmVhZENvdW50OiBjb250ZXh0LmNvbnZlcnNhdGlvbnNVbnJlYWQsCgkJCWFjdGl2YXRpb25MaW5rOiBjb250ZXh0LmNvbnZlcnNhdGlvbnNMaW5rLAoJCQllbmRsZXNzU2Nyb2xsOiB0cnVlLAoJCQl0aXRsZUNvdW50OiB0cnVlLAoJCQljc3NDbGFzczogJ2NvbnZlcnNhdGlvbnMnLAoJCQl1bnJlYWRDb3VudE1lc3NhZ2VTaW5ndWxhcjogY29udGV4dC5jb252ZXJzYXRpb25zVW5yZWFkQ291bnRNZXNzYWdlU2luZ3VsYXIsCgkJCXVucmVhZENvdW50TWVzc2FnZVBsdXJhbDogY29udGV4dC5jb252ZXJzYXRpb25zVW5yZWFkQ291bnRNZXNzYWdlUGx1cmFsLAoJCQl3cmFwcGVyOiBjb250ZXh0LmJhbm5lciwKCQkJaGFuZGhlbGRCYW5uZXJMaW5rc0NvdW50OiBjb250ZXh0LmhhbmRoZWxkQmFubmVyTGlua3NDb3VudCwKCQkJb25Mb2FkOiBmdW5jdGlvbiAocGFnZUluZGV4LCBzaG91bGRSZWZyZXNoVW5yZWFkQ291bnQsIGZpbHRlciwgY29tcGxldGUpIHsKCQkJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5nZXQoewoJCQkJCXVybDogY29udGV4dC5jb252ZXJzYXRpb25zVXJsLAoJCQkJCWRhdGE6IHsKCQkJCQkJd19wYWdlSW5kZXg6IHBhZ2VJbmRleAoJCQkJCX0sCgkJCQkJc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CgkJCQkJCS8vIHNob3cgcmVzcG9uc2UKCQkJCQkJY29tcGxldGUocmVzcG9uc2UpOwoJCQkJCQkvLyB1cGRhdGUgY291bnQKCQkJCQkJaWYgKHNob3VsZFJlZnJlc2hVbnJlYWRDb3VudCkKCQkJCQkJCWNvbnRleHQuY29udmVyc2F0aW9uc0xpc3QucmVmcmVzaFVucmVhZENvdW50KCk7CgkJCQkJfQoJCQkJfSk7CgkJCX0sCgkJCW9uUmVmcmVzaFVucmVhZENvdW50OiBmdW5jdGlvbiAoY29tcGxldGUpIHsKCQkJCXJldHVybiAkLnRlbGxpZ2VudC5ldm9sdXRpb24uZ2V0KHsKCQkJCQl1cmw6ICQudGVsbGlnZW50LmV2b2x1dGlvbi5zaXRlLmdldEJhc2VVcmwoKSArICdhcGkuYXNoeC92Mi9jb252ZXJzYXRpb25zLmpzb24nLAoJCQkJCWNhY2hlOiBmYWxzZSwKCQkJCQlkYXRhOiB7CgkJCQkJCVJlYWRTdGF0dXM6ICdVbnJlYWQnCgkJCQkJfSwKCQkJCQlzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKCQkJCQkJY29tcGxldGUocmVzcG9uc2UuVG90YWxDb3VudCk7CgkJCQkJfSwKCQkJCQllcnJvcjoge30KCQkJCX0pOwoJCQl9LAoJCQl0ZW1wbGF0ZTogY29udGV4dC5jb252ZXJzYXRpb25zVGVtcGxhdGUsCgkJCW9uU2hvdzogZnVuY3Rpb24gKGFjdGl2YXRvciwgY29tcGxldGUpIHsKCQkJCWNvbXBsZXRlKGJ1aWxkU2hvd1NldHRpbmdzKGNvbnRleHQsIGFjdGl2YXRvciwge30pKTsKCgkJCQltb2RpZnlQb3B1cCh0cnVlKTsKCQkJfQoJCX0pOwoKCQkvLyB1cGRhdGUgdGhlIG1lc3NhZ2UgbGlzdCdzIGNvdW50IHdoZW4gYSBuZXcgbm90aWZpY2F0aW9uIGlzIHJlY2VpdmVkIHdoaWNoIGlzIGEgY29udmVyc2F0aW9uIHR5cGUKCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubWVzc2FnaW5nLnN1YnNjcmliZSgnbm90aWZpY2F0aW9uLnJhaXNlZCcsIGZ1bmN0aW9uIChub3RpZmljYXRpb24pIHsKCQkJaWYgKG5vdGlmaWNhdGlvbi50eXBlSWQgPT09IGNvbnRleHQuY29udmVyc2F0aW9uTm90aWZpY2F0aW9uVHlwZUlkKSB7CgkJCQljb250ZXh0LmNvbnZlcnNhdGlvbnNMaXN0LnJlZnJlc2hVbnJlYWRDb3VudCgpLnRoZW4oZnVuY3Rpb24gKCkgewoJCQkJCWNvbnRleHQuY29udmVyc2F0aW9uc0xpc3QucmVmcmVzaENvbnRlbnQoKTsKCQkJCX0pOwoJCQl9CgkJfSk7CgoJCS8vIHVwZGF0ZSB0aGUgbWVzc2FnZSBsaXN0J3MgY291bnQgd2hlbiBhIG1lc3NhZ2Ugd2FzIHJlYWQgb24gdGhlIGNvbnZlcnNhdGlvbiBsaXN0CgkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm1lc3NhZ2luZy5zdWJzY3JpYmUoJ3VpLm1lc3NhZ2VyZWFkJywgZnVuY3Rpb24gKG5vdGlmaWNhdGlvbikgewoJCQljb250ZXh0LmNvbnZlcnNhdGlvbnNMaXN0LnJlZnJlc2hVbnJlYWRDb3VudCgpOwoJCX0pOwoKCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubWVzc2FnaW5nLnN1YnNjcmliZShjb250ZXh0Lm1lc3NhZ2VQcmVmaXggKyAnc3RhcnRjb252ZXJzYXRpb24nLCBmdW5jdGlvbiAoKSB7CgkJCSQuZ2xvd01vZGFsKGNvbnRleHQuY29udmVyc2F0aW9uTmV3Q29udmVyc2F0aW9uTW9kYWxVcmwsIHsKCQkJCXdpZHRoOiA1NTAsCgkJCQloZWlnaHQ6IDM2MAoJCQl9KTsKCQl9KTsKCgkJcmV0dXJuIGNvbnRleHQuY29udmVyc2F0aW9uc0xpc3Q7Cgl9CgoJZnVuY3Rpb24gaW5pdEJvb2ttYXJrc0xpc3QoY29udGV4dCkgewoJCS8vIGdldHMgYWxsIHNlbGVjdGVkIGNvbnRlbnQgdHlwZXMgZnJvbSB0aGUgY29udGVudCB0eXBlIGZpbHRlcgoJCWZ1bmN0aW9uIGdldEN1cnJlbnRDb250ZW50VHlwZXMoYm9va21hcmtGaWx0ZXIpIHsKCQkJdmFyIGNvbnRlbnRUeXBlcyA9IFtdOwoJCQl2YXIgc2VsZWN0ZWRGaWx0ZXJzID0gY29udGV4dC5ib29rbWFya0ZpbHRlci5maW5kKCdhLnNlbGVjdGVkJykuZWFjaChmdW5jdGlvbiAoKSB7CgkJCQljb250ZW50VHlwZXMucHVzaCgkKHRoaXMpLmRhdGEoJ2NvbnRlbnR0eXBlaWRzJykpOwoJCQl9KTsKCQkJcmV0dXJuIGNvbnRlbnRUeXBlcy5qb2luKCcsJyk7CgkJfQoKCQljb250ZXh0LmJvb2ttYXJrc0xpc3QgPSBIZWFkZXJMaXN0KHsKCQkJa2V5OiAnYm9va21hcmtzJywKCQkJZm9vdGVyQ29udGVudDogY29udGV4dC5ib29rbWFya3NMaXN0Rm9vdGVyQ29udGVudCwKCQkJYWN0aXZhdGlvbkxpbms6IGNvbnRleHQuYm9va21hcmtzTGluaywKCQkJZW5kbGVzc1Njcm9sbDogdHJ1ZSwKCQkJaW5pdGlhbFVucmVhZENvdW50OiBjb250ZXh0LmJvb2ttYXJrc0lzQm9va21hcmtlZCA/IDEgOiAwLAoJCQl0aXRsZUNvdW50OiBmYWxzZSwKCQkJc2hvd0NvdW50OiBmYWxzZSwKCQkJY3NzQ2xhc3M6ICdib29rbWFya3MnLAoJCQl3cmFwcGVyOiBjb250ZXh0LmJhbm5lciwKCQkJaGFuZGhlbGRCYW5uZXJMaW5rc0NvdW50OiBjb250ZXh0LmhhbmRoZWxkQmFubmVyTGlua3NDb3VudCwKCQkJdW5yZWFkQ291bnRNZXNzYWdlU2luZ3VsYXI6IGNvbnRleHQuYm9va21hcmtzQm9va21hcmtzLAoJCQl1bnJlYWRDb3VudE1lc3NhZ2VQbHVyYWw6IGNvbnRleHQuYm9va21hcmtzQm9va21hcmtzLAoJCQlvbkxvYWQ6IGZ1bmN0aW9uIChwYWdlSW5kZXgsIHNob3VsZFJlZnJlc2hVbnJlYWRDb3VudCwgZmlsdGVyLCBjb21wbGV0ZSkgewoJCQkJdmFyIGZpbHRlcmVkQ29udGVudFR5cGVJZHMgPSBmaWx0ZXIgfHwgZ2V0Q3VycmVudENvbnRlbnRUeXBlcyhjb250ZXh0LmJvb2ttYXJrRmlsdGVyKTsKCQkJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5nZXQoewoJCQkJCXVybDogY29udGV4dC5ib29rbWFya3NVcmwsCgkJCQkJZGF0YTogewoJCQkJCQl3X3BhZ2VJbmRleDogcGFnZUluZGV4LAoJCQkJCQl3X2NvbnRlbnRUeXBlSWRzOiBmaWx0ZXJlZENvbnRlbnRUeXBlSWRzCgkJCQkJfSwKCQkJCQlzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKCQkJCQkJaWYgKGZpbHRlcmVkQ29udGVudFR5cGVJZHMgJiYgZmlsdGVyZWRDb250ZW50VHlwZUlkcy5sZW5ndGggPiAwICYmIGdldEN1cnJlbnRDb250ZW50VHlwZXMoY29udGV4dC5ib29rbWFya0ZpbHRlcikgIT09IGZpbHRlcmVkQ29udGVudFR5cGVJZHMpCgkJCQkJCQlyZXR1cm47CgkJCQkJCS8vIHNob3cgcmVzcG9uc2UKCQkJCQkJY29tcGxldGUocmVzcG9uc2UpOwoJCQkJCQkvLyB1cGRhdGUgY291bnQKCQkJCQkJaWYgKHNob3VsZFJlZnJlc2hVbnJlYWRDb3VudCkKCQkJCQkJCWNvbnRleHQuYm9va21hcmtzTGlzdC5yZWZyZXNoVW5yZWFkQ291bnQoKTsKCQkJCQl9CgkJCQl9KTsKCQkJfSwKCQkJb25SZWZyZXNoVW5yZWFkQ291bnQ6IGZ1bmN0aW9uIChjb21wbGV0ZSkgewoJCQkJY29tcGxldGUoY29udGV4dC5ib29rbWFya3NJc0Jvb2ttYXJrZWQgPyAxIDogMCk7CgkJCX0sCgkJCW9uQnVpbGRGaWx0ZXI6IGZ1bmN0aW9uIChmaWx0ZXJlZCkgewoJCQkJdmFyIGZpbHRlclRlbXBsYXRlID0gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnRlbXBsYXRlLmNvbXBpbGUoY29udGV4dC5ib29rbWFya3NGaWx0ZXJUZW1wbGF0ZSksCgkJCQkJZmlsdGVyVGVtcGxhdGVEYXRhID0gewoJCQkJCQljb250ZW50VHlwZUlkczogJycsCgkJCQkJCWFwcGxpY2F0aW9uQ29udGVudFR5cGVJZHM6ICcnLAoJCQkJCQljb250YWluZXJUeXBlczogW10KCQkJCQl9OwoJCQkJaWYgKGNvbnRleHQuYm9va21hcmtzQ29udGVudFR5cGVzLmxlbmd0aCA+IDApCgkJCQkJZmlsdGVyVGVtcGxhdGVEYXRhLmNvbnRlbnRUeXBlSWRzID0gY29udGV4dC5ib29rbWFya3NDb250ZW50VHlwZXMuc3Vic3RyKDAsIGNvbnRleHQuYm9va21hcmtzQ29udGVudFR5cGVzLmxlbmd0aCAtIDEpCgkJCQlpZiAoY29udGV4dC5ib29rbWFya3NBcHBsaWNhdGlvbkNvbnRlbnRUeXBlcy5sZW5ndGggPiAwKQoJCQkJCWZpbHRlclRlbXBsYXRlRGF0YS5hcHBsaWNhdGlvbkNvbnRlbnRUeXBlSWRzID0gY29udGV4dC5ib29rbWFya3NBcHBsaWNhdGlvbkNvbnRlbnRUeXBlcy5zdWJzdHIoMCwgY29udGV4dC5ib29rbWFya3NBcHBsaWNhdGlvbkNvbnRlbnRUeXBlcy5sZW5ndGggLSAxKQoJCQkJaWYgKGNvbnRleHQuYm9va21hcmtzQ29udGFpbmVyQ29udGVudFR5cGVzLmxlbmd0aCA+IDApIHsKCQkJCQl2YXIgcmF3Q29udGFpbmVycyA9IGNvbnRleHQuYm9va21hcmtzQ29udGFpbmVyQ29udGVudFR5cGVzLnNwbGl0KCcsJyk7CgkJCQkJJC5lYWNoKHJhd0NvbnRhaW5lcnMsIGZ1bmN0aW9uIChpLCByYXdDb250YWluZXIpIHsKCQkJCQkJaWYgKHJhd0NvbnRhaW5lciAmJiByYXdDb250YWluZXIubGVuZ3RoID4gMCkgewoJCQkJCQkJdmFyIGNvbnRhaW5lckNvbXBvbmVudHMgPSByYXdDb250YWluZXIuc3BsaXQoJzonLCAyKTsKCQkJCQkJCWlmIChjb250YWluZXJDb21wb25lbnRzLmxlbmd0aCA9PT0gMikgewoJCQkJCQkJCWZpbHRlclRlbXBsYXRlRGF0YS5jb250YWluZXJUeXBlcy5wdXNoKHsKCQkJCQkJCQkJbmFtZTogY29udGFpbmVyQ29tcG9uZW50c1sxXSwKCQkJCQkJCQkJaWQ6IGNvbnRhaW5lckNvbXBvbmVudHNbMF0KCQkJCQkJCQl9KTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0pOwoJCQkJfQoKCQkJCWNvbnRleHQuYm9va21hcmtGaWx0ZXIgPSAkKGZpbHRlclRlbXBsYXRlKGZpbHRlclRlbXBsYXRlRGF0YSkpOwoJCQkJY29udGV4dC5ib29rbWFya0ZpbHRlci5maW5kKCdhOmZpcnN0JykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7CgkJCQljb250ZXh0LmJvb2ttYXJrRmlsdGVyLm9uKCdjbGljaycsICdhJywgZnVuY3Rpb24gKGUpIHsKCQkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQkJCQl2YXIgdGFyZ2V0ID0gJChlLnRhcmdldCk7CgkJCQkJdGFyZ2V0LmNsb3Nlc3QoJ3VsJykuZmluZCgnYScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpOwoJCQkJCXRhcmdldC5hZGRDbGFzcygnc2VsZWN0ZWQnKTsKCQkJCQlmaWx0ZXJlZChnZXRDdXJyZW50Q29udGVudFR5cGVzKGNvbnRleHQuYm9va21hcmtGaWx0ZXIpKTsKCQkJCX0pOwoKCQkJCXJldHVybiBjb250ZXh0LmJvb2ttYXJrRmlsdGVyOwoJCQl9LAoJCQl0ZW1wbGF0ZTogY29udGV4dC5ib29rbWFya3NUZW1wbGF0ZSwKCQkJb25TaG93OiBmdW5jdGlvbiAoYWN0aXZhdG9yLCBjb21wbGV0ZSkgewoJCQkJY29tcGxldGUoYnVpbGRTaG93U2V0dGluZ3MoY29udGV4dCwgYWN0aXZhdG9yLCB7fSkpOwoKCQkJCW1vZGlmeVBvcHVwKHRydWUpOwoJCQl9CgkJfSk7CgoJCS8vIHJlZnJlc2ggY29udGVudCB3aGVuIGJvb2ttYXJrcyBhcmUgYWRkZWQvcmVtb3ZlZAoJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5tZXNzYWdpbmcuc3Vic2NyaWJlKCd1aS5ib29rbWFyaycsIGZ1bmN0aW9uIChkYXRhKSB7CgkJCS8vIGlmIHRoaXMgcmVwcmVzZW50cyBhIGNoYW5nZSBpbiBib29rbWFyayBzdGF0ZSBvZiBjdXJyZW50IGNvbnRlbnQsCgkJCS8vIHRyYWNrIHRoYXQKCQkJaWYgKGRhdGEuY29udGVudElkID09IGNvbnRleHQuYm9va21hcmtzQ3VycmVudENvbnRlbnRJZCkgewoJCQkJY29udGV4dC5ib29rbWFya3NJc0Jvb2ttYXJrZWQgPSBkYXRhLmJvb2ttYXJrZWQ7CgkJCQljb250ZXh0LmJvb2ttYXJrc0xpc3QucmVmcmVzaFVucmVhZENvdW50KCk7CgkJCQlpZiAoZGF0YS5ib29rbWFya2VkKSB7CgkJCQkJY29udGV4dC5ib29rbWFya3NMaW5rLmFkZENsYXNzKCdib29rbWFya2VkJyk7CgkJCQkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm5vdGlmaWNhdGlvbnMuc2hvdyhjb250ZXh0LmJvb2ttYXJrQWRkZWQsIHsKCQkJCQkJaWQ6ICdib29rbWFyay0nICsgZGF0YS5jb250ZW50SWQKCQkJCQl9KTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWNvbnRleHQuYm9va21hcmtzTGluay5yZW1vdmVDbGFzcygnYm9va21hcmtlZCcpOwoJCQkJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5ub3RpZmljYXRpb25zLnNob3coY29udGV4dC5ib29rbWFya1JlbW92ZWQsIHsKCQkJCQkJaWQ6ICdib29rbWFyay0nICsgZGF0YS5jb250ZW50SWQKCQkJCQl9KTsKCQkJCX0KCQkJfQoJCQljb250ZXh0LmJvb2ttYXJrc0xpc3QucmVmcmVzaENvbnRlbnQoKTsKCQl9KTsKCgkJaWYgKGNvbnRleHQuYm9va21hcmtzSXNCb29rbWFya2VkKQoJCQljb250ZXh0LmJvb2ttYXJrc0xpbmsuYWRkQ2xhc3MoJ2Jvb2ttYXJrZWQnKTsKCgkJcmV0dXJuIGNvbnRleHQuYm9va21hcmtzTGlzdDsKCX0KCglmdW5jdGlvbiBpbml0VXNlclBvcHVwKGNvbnRleHQpIHsKCQl2YXIgdXNlckNvbnRlbnQgPSAkKCQudGVsbGlnZW50LmV2b2x1dGlvbi50ZW1wbGF0ZS5jb21waWxlKGNvbnRleHQudXNlckNvbnRlbnRUZW1wbGF0ZSkoKSk7CgoJCWNvbnRleHQudXNlclBvcHVwID0gSGVhZGVyTGlzdCh7CgkJCWtleTogJ3VzZXInLAoJCQlhY3RpdmF0aW9uTGluazogY29udGV4dC51c2VyTGluaywKCQkJZW5kbGVzc1Njcm9sbDogZmFsc2UsCgkJCXRpdGxlQ291bnQ6IGZhbHNlLAoJCQljc3NDbGFzczogJ3VzZXInLAoJCQlzaG93Q291bnQ6IGZhbHNlLAoJCQl3cmFwcGVyOiBjb250ZXh0LmJhbm5lciwKCQkJaGFuZGhlbGRCYW5uZXJMaW5rc0NvdW50OiBjb250ZXh0LmhhbmRoZWxkQmFubmVyTGlua3NDb3VudCwKCQkJb25Mb2FkOiBmdW5jdGlvbiAocGFnZUluZGV4LCBzaG91bGRSZWZyZXNoVW5yZWFkQ291bnQsIGZpbHRlciwgY29tcGxldGUpIHsKCQkJCWdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKCQkJCQljb21wbGV0ZSh1c2VyQ29udGVudCkKCQkJCX0sIDEwKQoJCQl9LAoJCQl0ZW1wbGF0ZTogY29udGV4dC51c2VyUG9wdXBUZW1wbGF0ZSwKCQkJb25TaG93OiBmdW5jdGlvbiAoYWN0aXZhdG9yLCBjb21wbGV0ZSkgewoJCQkJY29tcGxldGUoYnVpbGRTaG93U2V0dGluZ3MoY29udGV4dCwgYWN0aXZhdG9yLCB7fSkpOwoKCQkJCW1vZGlmeVBvcHVwKHRydWUpOwoJCQl9CgkJfSk7CgoJCXJldHVybiBjb250ZXh0LnVzZXJQb3B1cDsKCX0KCglmdW5jdGlvbiBpbml0U2VhcmNoUG9wdXAoY29udGV4dCkgewoJCS8vIGdldHMgYWxsIHNlbGVjdGVkIGNvbnRlbnQgdHlwZXMgZnJvbSB0aGUgY29udGVudCB0eXBlIGZpbHRlcgoJCWZ1bmN0aW9uIGdldEN1cnJlbnRTZWFyY2hGaWx0ZXJzKGNvbnRleHQpIHsKCQkJdmFyIHNlbGVjdGVkUGxhY2UgPSBjb250ZXh0LnNlYXJjaEZpbHRlci5maW5kKCdhLnBsYWNlLnNlbGVjdGVkJyk7CgkJCXZhciBzZWxlY3RlZFR5cGUgPSBjb250ZXh0LnNlYXJjaEZpbHRlci5maW5kKCdhLnR5cGUuc2VsZWN0ZWQnKTsKCQkJdmFyIGZpbHRlcnMgPSB7CgkJCQlwbGFjZUtleTogc2VsZWN0ZWRQbGFjZS5kYXRhKCdrZXknKSB8fCAnYW55d2hlcmUnLAoJCQkJcGxhY2VWYWx1ZTogc2VsZWN0ZWRQbGFjZS5kYXRhKCd2YWx1ZScpIHx8ICdhbnl3aGVyZScsCgkJCQl0eXBlOiBzZWxlY3RlZFR5cGUuZGF0YSgna2V5JyksCgkJCQlxdWVyeTogJC50cmltKGNvbnRleHQuc2VhcmNoSW5wdXQudmFsKCkpLAoJCQkJc2VhcmNoUGFyYW1ldGVyOiBzZWxlY3RlZFBsYWNlLmRhdGEoJ3NlYXJjaHBhcmFtJyksCgkJCQlzZWFyY2hWYWx1ZTogc2VsZWN0ZWRQbGFjZS5kYXRhKCdzZWFyY2h2YWx1ZScpCgkJCX07CgoJCQl2YXIgdCA9ICQuZ3JlcChjb250ZXh0LnNlYXJjaEZpbHRlcnMsIGZ1bmN0aW9uIChlKSB7CgkJCQlyZXR1cm4gZS5rZXkgPT0gc2VsZWN0ZWRUeXBlLmRhdGEoJ2tleScpOwoJCQl9KVswXTsKCQkJaWYgKHQgJiYgdC5hZHZhbmNlZFNlYXJjaFVybCkgewoJCQkJZmlsdGVycy5hZHZhbmNlZFNlYXJjaFVybCA9IHQuYWR2YW5jZWRTZWFyY2hVcmw7CgkJCX0KCgkJCXJldHVybiBmaWx0ZXJzOwoJCX0KCgkJZnVuY3Rpb24gbG9hZFNlYXJjaFBsYWNlcyhjb250ZXh0KSB7CgkJCXZhciBwbGFjZXMgPSBbXTsKCgkJCWlmIChjb250ZXh0LnNlYXJjaFBsYWNlQXBwbGljYXRpb25JZCkgewoJCQkJcGxhY2VzLnB1c2goewoJCQkJCWtleTogJ2FwcGxpY2F0aW9uJywKCQkJCQl2YWx1ZTogY29udGV4dC5zZWFyY2hQbGFjZUFwcGxpY2F0aW9uSWQsCgkJCQkJbmFtZTogY29udGV4dC5zZWFyY2hQbGFjZUFwcGxpY2F0aW9uTmFtZSwKCQkJCQlzZWFyY2hQYXJhbWV0ZXI6ICdncm91cCcsCgkJCQkJc2VhcmNoVmFsdWU6IGNvbnRleHQuc2VhcmNoUGxhY2VHcm91cExvY2FsSWQKCQkJCX0pOwoJCQl9CgoJCQlpZiAoY29udGV4dC5zZWFyY2hQbGFjZUdyb3VwSWQpIHsKCQkJCXBsYWNlcy5wdXNoKHsKCQkJCQlrZXk6ICdncm91cCcsCgkJCQkJdmFsdWU6IGNvbnRleHQuc2VhcmNoUGxhY2VHcm91cElkLAoJCQkJCW5hbWU6IGNvbnRleHQuc2VhcmNoUGxhY2VHcm91cE5hbWUsCgkJCQkJc2VhcmNoUGFyYW1ldGVyOiAnZ3JvdXAnLAoJCQkJCXNlYXJjaFZhbHVlOiBjb250ZXh0LnNlYXJjaFBsYWNlR3JvdXBMb2NhbElkCgkJCQl9KTsKCQkJfQoKCQkJaWYgKHBsYWNlcy5sZW5ndGggPiAwKSB7CgkJCQlwbGFjZXMucHVzaCh7CgkJCQkJa2V5OiAnYW55d2hlcmUnLAoJCQkJCXZhbHVlOiAnYW55d2hlcmUnLAoJCQkJCW5hbWU6IGNvbnRleHQuc2VhcmNoUGxhY2VBbnl3aGVyZU5hbWUsCgkJCQkJc2VhcmNoUGFyYW1ldGVyOiAnJywKCQkJCQlzZWFyY2hWYWx1ZTogJycKCQkJCX0pOwoJCQl9CgoJCQljb250ZXh0LnNlYXJjaFBsYWNlcyA9IHBsYWNlczsKCQl9CgoJCWZ1bmN0aW9uIGxvYWRTZWFyY2hGaWx0ZXJzKGNvbnRleHQsIHNjb3BlKSB7CgkJCXZhciBmaWx0ZXJzID0gW107CgoJCQkvLyBidWlsZCBmaXJzdCBwYXJ0eSBmaWx0ZXJzIGZpcnN0CgkJCWZpbHRlcnMucHVzaCh7CgkJCQlrZXk6ICdjb250ZW50JywKCQkJCW5hbWU6IGNvbnRleHQuc2VhcmNoRmlsdGVyQ29udGVudE5hbWUsCgkJCQlzZWFyY2hQYXJhbWV0ZXI6ICcnLAoJCQkJc2VhcmNoVmFsdWU6ICcnCgkJCX0pOwoKCQkJaWYgKHNjb3BlLmtleSA9PSAnYW55d2hlcmUnIHx8IHNjb3BlLmtleSA9PSAnZ3JvdXAnKSB7CgkJCQlmaWx0ZXJzLnB1c2goewoJCQkJCWtleTogJ2dyb3VwcycsCgkJCQkJbmFtZTogY29udGV4dC5zZWFyY2hGaWx0ZXJHcm91cHNOYW1lLAoJCQkJCXNlYXJjaFBhcmFtZXRlcjogJycsCgkJCQkJc2VhcmNoVmFsdWU6ICcnCgkJCQl9KTsKCQkJfQoKCQkJaWYgKHNjb3BlLmtleSA9PSAnYW55d2hlcmUnICYmIGNvbnRleHQuc2VhcmNoU2hvd1Blb3BsZSkgewoJCQkJZmlsdGVycy5wdXNoKHsKCQkJCQlrZXk6ICd1c2VycycsCgkJCQkJbmFtZTogY29udGV4dC5zZWFyY2hGaWx0ZXJQZW9wbGVOYW1lLAoJCQkJCWFkdmFuY2VkU2VhcmNoVXJsOiBmdW5jdGlvbiAocXVlcnkpIHsKCQkJCQkJdmFyIHBhcmFtcyA9IHtxOiBxdWVyeX07CgkJCQkJCXJldHVybiBjb250ZXh0LnNlYXJjaEFkdmFuY2VkVXNlclVybAoJCQkJCQkJLnJlcGxhY2UoL1x7MFx9L2dpLCAkLnBhcmFtKHBhcmFtcykpCgkJCQkJCQkucmVwbGFjZSgvXCsvZ2ksICclMjAnKQoJCQkJCQkJLnJlcGxhY2UoLycvZ2ksICclMjcnKTsKCQkJCQl9CgkJCQl9KTsKCQkJfQoKCQkJLy8gYWRkIGN1c3RvbSBmaWx0ZXJzCgkJCXZhciBpID0gMTsKCQkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm1lc3NhZ2luZy5wdWJsaXNoKCdzZWFyY2gucmVnaXN0ZXJGaWx0ZXJzJywgewoJCQkJc2NvcGU6IHNjb3BlLAoJCQkJcmVnaXN0ZXI6IGZ1bmN0aW9uIChzZXR0aW5ncykgewoJCQkJCWZpbHRlcnMucHVzaCgkLmV4dGVuZCgKCQkJCQkJewoJCQkJCQkJbmFtZTogJycsCgkJCQkJCQlxdWVyeTogZnVuY3Rpb24gKHF1ZXJ5RGF0YSwgY29tcGxldGUpIHsKCQkJCQkJCX0sCgkJCQkJCQlhZHZhbmNlZFNlYXJjaFVybDogZnVuY3Rpb24gKHF1ZXJ5VGV4dCkgewoJCQkJCQkJCXJldHVybiBudWxsOwoJCQkJCQkJfSwKCQkJCQkJCWlzRGVmYXVsdDogZmFsc2UsCgkJCQkJCQlzZWFyY2hQYXJhbWV0ZXI6ICcnLAoJCQkJCQkJc2VhcmNoVmFsdWU6ICcnCgkJCQkJCX0sCgkJCQkJCXNldHRpbmdzLAoJCQkJCQl7CgkJCQkJCQlrZXk6ICdjdXN0b20nICsgKGkrKykKCQkJCQkJfQoJCQkJCSkpOwoJCQkJfQoJCQl9KTsKCgkJCWNvbnRleHQuc2VhcmNoRmlsdGVycyA9IGZpbHRlcnM7CgkJfQoKCQlmdW5jdGlvbiBzZXREZWZhdWx0QWR2YW5jZWRTZWFyY2hVcmwoY29udGV4dCkgewoKCQkJdmFyIGZpbHRlciA9IGdldEN1cnJlbnRTZWFyY2hGaWx0ZXJzKGNvbnRleHQpOwoKCQkJdmFyIHF1ZXJ5ID0gJC50cmltKGZpbHRlci5xdWVyeSk7CgkJCWlmIChxdWVyeSAmJiBxdWVyeS5sZW5ndGggPiAwKSB7CgkJCQl2YXIgcGFyYW1zID0ge3E6IHF1ZXJ5fTsKCgkJCQlpZiAoZmlsdGVyLnNlYXJjaFBhcmFtZXRlciAmJiBmaWx0ZXIuc2VhcmNoVmFsdWUpIHsKCQkJCQlwYXJhbXNbZmlsdGVyLnNlYXJjaFBhcmFtZXRlcl0gPSBmaWx0ZXIuc2VhcmNoVmFsdWU7CgkJCQl9CgoJCQkJY29udGV4dC5jdXJyZW50QWR2YW5jZWRTZWFyY2hVcmwgPSBjb250ZXh0LnNlYXJjaEFkdmFuY2VkVXJsCgkJCQkJLnJlcGxhY2UoL1x7MFx9L2dpLCAkLnBhcmFtKHBhcmFtcykpCgkJCQkJLnJlcGxhY2UoL1wrL2dpLCAnJTIwJykKCQkJCQkucmVwbGFjZSgvJy9naSwgJyUyNycpOwoJCQkJJCgnIycgKyBjb250ZXh0LmFkdmFuY2VkU2VhcmNoSWQpLmNzcygndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7CgkJCX0KCQkJZWxzZSB7CgkJCQkkKCcjJyArIGNvbnRleHQuYWR2YW5jZWRTZWFyY2hJZCkuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpOwoJCQl9CgkJfQoKCQkvLyBkZWZhdWx0IHRvIHN1cHBvcnRpbmcgaW5saW5lU2VhcmNoIHRob3VnaCBzZWFyY2gucmVhZHkgY2FuIG92ZXJyaWRlIGl0CgkJY29udGV4dC5zdXBwb3J0c0lubGluZVNlYXJjaCA9IHRydWU7CgoJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubWVzc2FnaW5nLnB1Ymxpc2goJ3NlYXJjaC5yZWFkeScsIHsKCQkJCWluaXQ6IGZ1bmN0aW9uIChzZXR0aW5ncykgewoJCQkJCXZhciBpbmplY3RlZFNldHRpbmdzID0gJC5leHRlbmQoewoJCQkJCQljdXN0b21SZXN1bHRSZW5kZXJpbmc6IGZhbHNlLAoJCQkJCQlpbml0aWFsUXVlcnk6ICcnCgkJCQkJfSwgc2V0dGluZ3MpOwoJCQkJCWNvbnRleHQuc3VwcG9ydHNJbmxpbmVTZWFyY2ggPSAhaW5qZWN0ZWRTZXR0aW5ncy5jdXN0b21SZXN1bHRSZW5kZXJpbmc7CgkJCQkJaWYgKGluamVjdGVkU2V0dGluZ3MuaW5pdGlhbFF1ZXJ5ICE9PSBudWxsKSB7CgkJCQkJCWNvbnRleHQuc2VhcmNoSW5wdXQudmFsKGluamVjdGVkU2V0dGluZ3MuaW5pdGlhbFF1ZXJ5KTsKCQkJCQl9CgkJCQl9CgkJCX0pOwoJCX0sIDUwKTsKCgkJZnVuY3Rpb24gYnVpbGRTZWFyY2hEYXRhRnJvbUVmZmVjdGl2ZVF1ZXJ5KHBhZ2VJbmRleCwgZWZmZWN0aXZlU2VhcmNoRmlsdGVyKSB7CgkJCXJldHVybiB7CgkJCQl3X3BhZ2VJbmRleDogcGFnZUluZGV4LAoJCQkJd19xdWVyeTogZWZmZWN0aXZlU2VhcmNoRmlsdGVyLnF1ZXJ5LAoJCQkJd19wbGFjZUtleTogZWZmZWN0aXZlU2VhcmNoRmlsdGVyLnBsYWNlS2V5LAoJCQkJd19wbGFjZVZhbHVlOiBlZmZlY3RpdmVTZWFyY2hGaWx0ZXIucGxhY2VWYWx1ZSwKCQkJCXdfdHlwZTogZWZmZWN0aXZlU2VhcmNoRmlsdGVyLnR5cGUKCQkJfTsKCQl9CgoJCWNvbnRleHQuc2VhcmNoUG9wdXAgPSBIZWFkZXJMaXN0KHsKCQkJa2V5OiAnc2VhcmNoJywKCQkJZm9vdGVyQ29udGVudDogY29udGV4dC5zZWFyY2hGb290ZXJDb250ZW50LAoJCQlhY3RpdmF0aW9uSW5wdXQ6IGNvbnRleHQuc2VhcmNoSW5wdXQsCgkJCWVuZGxlc3NTY3JvbGw6IHRydWUsCgkJCXRpdGxlQ291bnQ6IGZhbHNlLAoJCQlzaG93Q291bnQ6IGZhbHNlLAoJCQljc3NDbGFzczogJ3NlYXJjaCcsCgkJCXdyYXBwZXI6IGNvbnRleHQuYmFubmVyLAoJCQloYW5kaGVsZEJhbm5lckxpbmtzQ291bnQ6IGNvbnRleHQuaGFuZGhlbGRCYW5uZXJMaW5rc0NvdW50LAoJCQlvblNob3dMb2FkaW5nSW5kaWNhdG9yOiBmdW5jdGlvbiAoKSB7CgkJCQlyZXR1cm4gY29udGV4dC5zdXBwb3J0c0lubGluZVNlYXJjaDsKCQkJfSwKCQkJb25Mb2FkOiBmdW5jdGlvbiAocGFnZUluZGV4LCBzaG91bGRSZWZyZXNoVW5yZWFkQ291bnQsIGZpbHRlciwgY29tcGxldGUpIHsKCQkJCWlmICghY29udGV4dC5zdXBwb3J0c0lubGluZVNlYXJjaCkKCQkJCQlyZXR1cm47CgoJCQkJdmFyIGVmZmVjdGl2ZVNlYXJjaEZpbHRlciA9IGZpbHRlciB8fCBnZXRDdXJyZW50U2VhcmNoRmlsdGVycyhjb250ZXh0KTsKCgkJCQkvLyBwcmV2ZW50IGVtcHR5IHNlYXJjaGVzCgkJCQlpZiAoIWVmZmVjdGl2ZVNlYXJjaEZpbHRlci5xdWVyeSB8fCBlZmZlY3RpdmVTZWFyY2hGaWx0ZXIucXVlcnkubGVuZ3RoID09IDApIHsKCQkJCQljb21wbGV0ZSgnJyk7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCXZhciBmaWx0ZXIgPSAkLmdyZXAoY29udGV4dC5zZWFyY2hGaWx0ZXJzLCBmdW5jdGlvbiAoZSkgewoJCQkJCXJldHVybiBlLmtleSA9PSBlZmZlY3RpdmVTZWFyY2hGaWx0ZXIudHlwZQoJCQkJfSlbMF07CgkJCQlpZiAoZmlsdGVyICYmIGZpbHRlci5xdWVyeSkgewoJCQkJCWZpbHRlci5xdWVyeSh7CgkJCQkJCXBhZ2VJbmRleDogcGFnZUluZGV4LAoJCQkJCQlxdWVyeTogZWZmZWN0aXZlU2VhcmNoRmlsdGVyLnF1ZXJ5CgkJCQkJfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7CgkJCQkJCWNvbXBsZXRlKHJlc3BvbnNlKTsKCQkJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5hZGRDbGFzcygnd2l0aC1yZXN1bHRzJyk7CgoJCQkJCQlpZiAoIWNvbnRleHQuY3VycmVudEFkdmFuY2VkU2VhcmNoVXJsKSB7CgkJCQkJCQkkKCcjJyArIGNvbnRleHQuYWR2YW5jZWRTZWFyY2hJZCkuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpOwoJCQkJCQl9CgkJCQkJCWVsc2UgewoJCQkJCQkJJCgnIycgKyBjb250ZXh0LmFkdmFuY2VkU2VhcmNoSWQpLmNzcygndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7CgkJCQkJCX0KCQkJCQl9KTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCXZhciBxdWVyeURhdGEgPSBidWlsZFNlYXJjaERhdGFGcm9tRWZmZWN0aXZlUXVlcnkocGFnZUluZGV4LCBlZmZlY3RpdmVTZWFyY2hGaWx0ZXIpCgoJCQkJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5nZXQoewoJCQkJCQl1cmw6IGNvbnRleHQuc2VhcmNoVXJsLAoJCQkJCQlkYXRhOiBxdWVyeURhdGEsCgkJCQkJCXN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkgewoJCQkJCQkJLy8gYWZ0ZXIgcmVzdWx0cyByZXR1cm4sIG1ha2Ugc3VyZSB0aGUgY3VycmVudCBzZWFyY2ggcGFyYW1ldGVycwoJCQkJCQkJLy8gd291bGQgc3RpbGwgbWF0Y2ggdGhlIHJlcXVlc3QgdGhhdCBtYWRlIHRoaXMgcXVlcnkKCQkJCQkJCS8vIElmIG5vdCwgaWdub3JlIHRoZSByZXN1bHRzCgkJCQkJCQl2YXIgY3VycmVudEVmZmVjdGl2ZVNlYXJjaEZpbHRlciA9IGdldEN1cnJlbnRTZWFyY2hGaWx0ZXJzKGNvbnRleHQpOwoJCQkJCQkJaWYgKCFjdXJyZW50RWZmZWN0aXZlU2VhcmNoRmlsdGVyIHx8ICFjdXJyZW50RWZmZWN0aXZlU2VhcmNoRmlsdGVyLnF1ZXJ5IHx8IGN1cnJlbnRFZmZlY3RpdmVTZWFyY2hGaWx0ZXIucXVlcnkubGVuZ3RoID09IDApIHsKCQkJCQkJCQljb21wbGV0ZShudWxsKTsKCQkJCQkJCQlyZXR1cm47CgkJCQkJCQl9CgkJCQkJCQl2YXIgY3VycmVudFF1ZXJ5RGF0YSA9IGJ1aWxkU2VhcmNoRGF0YUZyb21FZmZlY3RpdmVRdWVyeShwYWdlSW5kZXgsIGN1cnJlbnRFZmZlY3RpdmVTZWFyY2hGaWx0ZXIpOwoJCQkJCQkJaWYgKCQudGVsbGlnZW50LmV2b2x1dGlvbi51cmwuc2VyaWFsaXplUXVlcnkoY3VycmVudFF1ZXJ5RGF0YSkgIT0KCQkJCQkJCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24udXJsLnNlcmlhbGl6ZVF1ZXJ5KHF1ZXJ5RGF0YSkpIHsKCQkJCQkJCQljb21wbGV0ZShudWxsKTsKCQkJCQkJCQlyZXR1cm47CgkJCQkJCQl9CgoJCQkJCQkJLy8gc2hvdyByZXNwb25zZQoJCQkJCQkJY29tcGxldGUocmVzcG9uc2UpOwoJCQkJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5hZGRDbGFzcygnd2l0aC1yZXN1bHRzJyk7CgkJCQkJCX0KCQkJCQl9KTsKCQkJCX0KCQkJfSwKCQkJb25SZWZyZXNoVW5yZWFkQ291bnQ6IGZ1bmN0aW9uIChjb21wbGV0ZSkgewoJCQkJY29tcGxldGUoMCk7CgkJCX0sCgkJCW9uQnVpbGRGaWx0ZXI6IGZ1bmN0aW9uIChmaWx0ZXJlZCkgewoJCQkJbG9hZFNlYXJjaFBsYWNlcyhjb250ZXh0KTsKCQkJCWxvYWRTZWFyY2hGaWx0ZXJzKGNvbnRleHQsIGNvbnRleHQuc2VhcmNoUGxhY2VzLmxlbmd0aCA+IDAgPyBjb250ZXh0LnNlYXJjaFBsYWNlc1swXSA6IHtrZXk6ICdhbnl3aGVyZScsIHZhbHVlOiAnYW55d2hlcmUnfSk7CgoJCQkJdmFyIGZpbHRlclRlbXBsYXRlID0gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnRlbXBsYXRlLmNvbXBpbGUoY29udGV4dC5zZWFyY2hGaWx0ZXJUZW1wbGF0ZSksCgkJCQkJZmlsdGVyVGVtcGxhdGVEYXRhID0gewoJCQkJCQljb250ZW50VHlwZUlkczogJycsCgkJCQkJCWFwcGxpY2F0aW9uQ29udGVudFR5cGVJZHM6ICcnLAoJCQkJCQljb250YWluZXJUeXBlczogW10sCgkJCQkJCWZpbHRlcnM6IGNvbnRleHQuc2VhcmNoRmlsdGVycywKCQkJCQkJcGxhY2VzOiBjb250ZXh0LnNlYXJjaFBsYWNlcwoJCQkJCX07CgoJCQkJY29udGV4dC5zZWFyY2hGaWx0ZXIgPSAkKCc8ZGl2PjwvZGl2PicpLmhpZGUoKS5hcHBlbmRUbygnYm9keScpOwoJCQkJJChmaWx0ZXJUZW1wbGF0ZShmaWx0ZXJUZW1wbGF0ZURhdGEpKS5hcHBlbmRUbyhjb250ZXh0LnNlYXJjaEZpbHRlcik7CgoJCQkJdmFyIGZpbHRlciA9ICQuZ3JlcChjb250ZXh0LnNlYXJjaEZpbHRlcnMsIGZ1bmN0aW9uIChlKSB7CgkJCQkJcmV0dXJuIGUuaXNEZWZhdWx0OwoJCQkJfSlbMF07CgkJCQlpZiAoZmlsdGVyKSB7CgkJCQkJY29udGV4dC5zZWFyY2hGaWx0ZXIuZmluZCgnYS50eXBlW2RhdGEta2V5PSInICsgZmlsdGVyLmtleSArICciXScpLmFkZENsYXNzKCdzZWxlY3RlZCcpOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJY29udGV4dC5zZWFyY2hGaWx0ZXIuZmluZCgnYS50eXBlOmZpcnN0JykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7CgkJCQl9CgkJCQljb250ZXh0LnNlYXJjaEZpbHRlci5maW5kKCdhLnBsYWNlOmZpcnN0JykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7CgkJCQljb250ZXh0LnNlYXJjaEZpbHRlci5vbignY2xpY2snLCAnYScsIGZ1bmN0aW9uIChlKSB7CgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7CgkJCQkJdmFyIHRhcmdldCA9ICQoZS50YXJnZXQpOwoJCQkJCXRhcmdldC5jbG9zZXN0KCd1bCcpLmZpbmQoJ2EnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTsKCQkJCQl0YXJnZXQuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7CgoJCQkJCWlmICh0YXJnZXQuaGFzQ2xhc3MoJ3BsYWNlJykpIHsKCQkJCQkJdmFyIGtleSA9IHRhcmdldC5kYXRhKCdrZXknKSwgdmFsdWUgPSB0YXJnZXQuZGF0YSgndmFsdWUnKTsKCgkJCQkJCWxvYWRTZWFyY2hGaWx0ZXJzKGNvbnRleHQsIHtrZXk6IGtleSwgdmFsdWU6IHZhbHVlfSk7CgkJCQkJCWNvbnRleHQuc2VhcmNoRmlsdGVyLmVtcHR5KCkuYXBwZW5kKCQoZmlsdGVyVGVtcGxhdGUoewoJCQkJCQkJY29udGVudFR5cGVJZHM6ICcnLAoJCQkJCQkJYXBwbGljYXRpb25Db250ZW50VHlwZUlkczogJycsCgkJCQkJCQljb250YWluZXJUeXBlczogW10sCgkJCQkJCQlmaWx0ZXJzOiBjb250ZXh0LnNlYXJjaEZpbHRlcnMsCgkJCQkJCQlwbGFjZXM6IGNvbnRleHQuc2VhcmNoUGxhY2VzCgkJCQkJCX0pKSk7CgoJCQkJCQl2YXIgZmlsdGVyID0gJC5ncmVwKGNvbnRleHQuc2VhcmNoRmlsdGVycywgZnVuY3Rpb24gKGUpIHsKCQkJCQkJCXJldHVybiBlLmlzRGVmYXVsdDsKCQkJCQkJfSlbMF07CgkJCQkJCWlmIChmaWx0ZXIpIHsKCQkJCQkJCWNvbnRleHQuc2VhcmNoRmlsdGVyLmZpbmQoJ2EudHlwZVtkYXRhLWtleT0iJyArIGZpbHRlci5rZXkgKyAnIl0nKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsKCQkJCQkJfQoJCQkJCQllbHNlIHsKCQkJCQkJCWNvbnRleHQuc2VhcmNoRmlsdGVyLmZpbmQoJ2EudHlwZTpmaXJzdCcpLmFkZENsYXNzKCdzZWxlY3RlZCcpOwoJCQkJCQl9CgkJCQkJCWNvbnRleHQuc2VhcmNoRmlsdGVyLmZpbmQoJ2EucGxhY2VbZGF0YS1rZXk9IicgKyBrZXkgKyAnIl1bZGF0YS12YWx1ZT0iJyArIHZhbHVlICsgJyJdJykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7CgkJCQkJfQoKCQkJCQlmaWx0ZXJlZChnZXRDdXJyZW50U2VhcmNoRmlsdGVycyhjb250ZXh0KSk7CgoJCQkJCXZhciBmaWx0ZXIgPSBnZXRDdXJyZW50U2VhcmNoRmlsdGVycyhjb250ZXh0KTsKCQkJCQlpZiAoZmlsdGVyICYmIGZpbHRlci5hZHZhbmNlZFNlYXJjaFVybCkKCQkJCQkJY29udGV4dC5jdXJyZW50QWR2YW5jZWRTZWFyY2hVcmwgPSBmaWx0ZXIuYWR2YW5jZWRTZWFyY2hVcmwoZmlsdGVyLnF1ZXJ5KTsKCQkJCQllbHNlCgkJCQkJCXNldERlZmF1bHRBZHZhbmNlZFNlYXJjaFVybChjb250ZXh0KTsKCQkJCX0pOwoKCQkJCXZhciBsYXN0UXVlcnkgPSBudWxsOwoJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5vbih7CgkJCQkJaW5wdXQ6IHV0aWwudGhyb3R0bGUoZnVuY3Rpb24gKGUpIHsKCQkJCQkJdmFyIGZpbHRlciA9IGdldEN1cnJlbnRTZWFyY2hGaWx0ZXJzKGNvbnRleHQpOwoJCQkJCQlpZiAoZmlsdGVyLnF1ZXJ5ID09IGxhc3RRdWVyeSkgewoJCQkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpCgkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJCX0KCQkJCQkJbGFzdFF1ZXJ5ID0gZmlsdGVyLnF1ZXJ5OwoJCQkJCQlmaWx0ZXJlZChmaWx0ZXIpOwoJCQkJCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubWVzc2FnaW5nLnB1Ymxpc2goJ3NlYXJjaC5xdWVyeScsIHsKCQkJCQkJCXZhbHVlOiAkLnRyaW0oY29udGV4dC5zZWFyY2hJbnB1dC52YWwoKSkKCQkJCQkJfSk7CgkJCQkJfSwgNTAwKSwKCQkJCQljbGljazogZnVuY3Rpb24gKGUpIHsKCQkJCQkJaWYgKCFzdXBwb3J0c1RvdWNoKCkpCgkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfSk7CgkJCQljb250ZXh0LnNlYXJjaElucHV0Lm9uKHsKCQkJCQlpbnB1dDogZnVuY3Rpb24gKGUpIHsKCQkJCQkJdmFyIGZpbHRlciA9IGdldEN1cnJlbnRTZWFyY2hGaWx0ZXJzKGNvbnRleHQpOwoJCQkJCQlpZiAoZmlsdGVyICYmIGZpbHRlci5hZHZhbmNlZFNlYXJjaFVybCkKCQkJCQkJCWNvbnRleHQuY3VycmVudEFkdmFuY2VkU2VhcmNoVXJsID0gZmlsdGVyLmFkdmFuY2VkU2VhcmNoVXJsKGZpbHRlci5xdWVyeSk7CgkJCQkJCWVsc2UKCQkJCQkJCXNldERlZmF1bHRBZHZhbmNlZFNlYXJjaFVybChjb250ZXh0KTsKCQkJCQl9CgkJCQl9KTsKCgkJCQlyZXR1cm4gY29udGV4dC5zZWFyY2hGaWx0ZXIuc2hvdygpOwoJCQl9LAoJCQl0ZW1wbGF0ZTogY29udGV4dC5zZWFyY2hUZW1wbGF0ZSwKCQkJb25TaG93OiBmdW5jdGlvbiAoYWN0aXZhdG9yLCBjb21wbGV0ZSkgewoJCQkJdmFyIGNvbmZpZyA9IHsKCQkJCQlhdHRhY2hUbzogY29udGV4dC5zZWFyY2hJbnB1dCwKCQkJCQl3aWR0aDogY29udGV4dC5zZWFyY2hJbnB1dC5vdXRlcldpZHRoKCkgLSAxLAoJCQkJCW1heEhlaWdodDogKCQoZ2xvYmFsKS5oZWlnaHQoKSAqIC43KSwKCQkJCQljc3NDbGFzczogJ3NlYXJjaC1jb250YWluZXInCgkJCQl9OwoKCQkJCWlmICgkKHdpbmRvdykud2lkdGgoKSA8PSA1NzApIHsKCQkJCQljb25maWcgPSB7CgkJCQkJCWF0dGFjaFRvOiBjb250ZXh0LnNlYXJjaEZpZWxkcywKCQkJCQkJd2lkdGg6IGNvbnRleHQuYmFubmVyLndpZHRoKCksCgkJCQkJCW1heEhlaWdodDogJChnbG9iYWwpLmhlaWdodCgpIC8gMiwKCQkJCQkJY29udGFpbmVyQ3NzQ2xhc3M6ICcnCgkJCQkJfTsKCQkJCX0KCgkJCQkvL3ZhciBzZXR0aW5ncyA9IGJ1aWxkU2hvd1NldHRpbmdzKGNvbnRleHQsIGFjdGl2YXRvciwgY29uZmlnKTsKCgkJCQkvLyBtYWtlIHNlYXJjaCBvcGVuIDEwMCUgd2lkZSwgYW5kIDcwJSBvZiB0aGUgaGVpZ2h0IG9mIHRoZSB2aWV3cG9ydAoJCQkJY29tcGxldGUoY29uZmlnKTsKCgkJCQltb2RpZnlQb3B1cChmYWxzZSk7CgkJCX0sCgkJCW9uSGlkZTogZnVuY3Rpb24gKCkgewoJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5yZW1vdmVDbGFzcygnd2l0aC1yZXN1bHRzJyk7CgkJCX0KCQl9KTsKCgkJLy8gYWR2YW5jZWQgc2VhcmNoCgkJZnVuY3Rpb24gcmVkaXJlY3RUb0FkdmFuY2VkU2VhcmNoKCkgewoJCQlpZiAoY29udGV4dC5zdXBwb3J0c0lubGluZVNlYXJjaCAmJiAhY29udGV4dC5jdXJyZW50QWR2YW5jZWRTZWFyY2hVcmwpCgkJCQlzZXREZWZhdWx0QWR2YW5jZWRTZWFyY2hVcmwoY29udGV4dCk7CgkJCWlmIChjb250ZXh0LmN1cnJlbnRBZHZhbmNlZFNlYXJjaFVybCkKCQkJCXdpbmRvdy5sb2NhdGlvbiA9IGNvbnRleHQuY3VycmVudEFkdmFuY2VkU2VhcmNoVXJsOwoJCX0KCgkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm1lc3NhZ2luZy5zdWJzY3JpYmUoY29udGV4dC5tZXNzYWdlUHJlZml4ICsgJ2FkdmFuY2Vkc2VhcmNoJywgcmVkaXJlY3RUb0FkdmFuY2VkU2VhcmNoKTsKCgkJLy8gaWYgbm90IHRvdWNoLCBzdXBwb3J0IGVudGVyIHRvIHVzZSBhZHZhbmNlZCBzZWFyY2gKCQkkKGNvbnRleHQuc2VhcmNoSW5wdXQpLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHsKCQkJaWYgKGUud2hpY2ggPT09IDEzKSB7CgkJCQlpZiAoIWNvbnRleHQuc3VwcG9ydHNJbmxpbmVTZWFyY2ggfHwgISQoJ2JvZHknKS5oYXNDbGFzcygndG91Y2gnKSkgewoJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQllLnN0b3BQcm9wYWdhdGlvbigpOwoJCQkJCS8vIGlmIHRoZXJlJ3MgYSBzZWxlY3RlZCBpdGVtLCByZWRpcmVjdCB0byBpdCwgb3RoZXJ3aXNlIHJlZGlyZWN0IHRvIGFkdmFuY2VkIHNlYXJjaAoJCQkJCXZhciBzZWxlY3RlZEl0ZW0gPSBjb250ZXh0LnNlYXJjaFBvcHVwLmNvbnRlbnQoKS5jaGlsZHJlbignbGkuY29udGVudC1pdGVtLnNlbGVjdGVkJyk7CgkJCQkJaWYgKHNlbGVjdGVkSXRlbS5sZW5ndGggPiAwKSB7CgkJCQkJCXNlbGVjdGVkSXRlbS5jbGljaygpOwoJCQkJCX0KCQkJCQllbHNlIHsKCQkJCQkJcmVkaXJlY3RUb0FkdmFuY2VkU2VhcmNoKCk7CgkJCQkJfQoJCQkJCWlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3RvdWNoJykpIHsKCQkJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5ibHVyKCk7CgkJCQkJfQoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWNvbnRleHQuc2VhcmNoSW5wdXQuYmx1cigpOwoJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQllLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfQoJCX0pOwoKCQlyZXR1cm4gY29udGV4dC5zZWFyY2hQb3B1cDsKCX0KCglmdW5jdGlvbiBtb2RpZnlQb3B1cChoaWRlU2VhcmNoKSB7CgkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCSQoJy5wb3B1cC1saXN0JykucGFyZW50KCkuY3NzKHsKCQkJCW92ZXJmbG93OiAndmlzaWJsZScKCQkJfSk7CgkJfSwgMjUwKTsKCQkKCQlpZihoaWRlU2VhcmNoKSB7CgkJCXZhciB1dGlsaXR5U2VjdGlvbldyYXBwZXJFbGVtID0gJCgnLnV0aWxpdHktc2VjdGlvbi13cmFwcGVyJyk7CgoJCQkvL0hpZGUgc2VhcmNoIGRyb3Bkb3duLgoJCQlpZiAodXRpbGl0eVNlY3Rpb25XcmFwcGVyRWxlbS5oYXNDbGFzcygnb3Blbi1zZWFyY2gnKSkgewoJCQkJdXRpbGl0eVNlY3Rpb25XcmFwcGVyRWxlbS5yZW1vdmVDbGFzcygnb3Blbi1zZWFyY2gnKTsKCQkJfQoJCX0KCX0KCgkvLyByZXR1cm5zIHNob3cgc2V0dGluZ3MgdG8gdXNlIGZvciBoZWFkZXIgcG9wdXBzCglmdW5jdGlvbiBidWlsZFNob3dTZXR0aW5ncyhjb250ZXh0LCBhY3RpdmF0b3IsIHNldHRpbmdzKSB7CgkJaWYgKCQod2luZG93KS53aWR0aCgpIDw9IDU3MCkgewoJCQlyZXR1cm4gewoJCQkJLy9hdHRhY2hUbzogY29udGV4dC5iYW5uZXIsCgkJCQlhdHRhY2hUbzogY29udGV4dC51dGlsaXR5RHJvcGRvd24sCgkJCQl3aWR0aDogY29udGV4dC5iYW5uZXIud2lkdGgoKSwKCQkJCW1heEhlaWdodDogJChnbG9iYWwpLmhlaWdodCgpIC8gMiwKCQkJCWNvbnRhaW5lckNzc0NsYXNzOiBzZXR0aW5ncy5jb250YWluZXJDc3NDbGFzcwoJCQl9OwoJCX0KCQllbHNlIHsKCQkJc2V0dGluZ3Mud2lkdGggPSAzNTA7CgoJCQlyZXR1cm4gc2V0dGluZ3M7CgkJfQoJfQoKCWZ1bmN0aW9uIGluaXRTaXRlTmF2aWdhdGlvbihjb250ZXh0KSB7CgkJY29udGV4dC5zaXRlTmF2aWdhdGlvbkxpc3QgPSBIZWFkZXJMaXN0KHsKCQkJa2V5OiAnc2l0ZScsCgkJCWFjdGl2YXRpb25MaW5rOiBjb250ZXh0LnNpdGVOYXZpZ2F0aW9uTGluaywKCQkJZW5kbGVzc1Njcm9sbDogdHJ1ZSwKCQkJdGl0bGVDb3VudDogZmFsc2UsCgkJCWNzc0NsYXNzOiAoJ3NpdGUgJyArIChjb250ZXh0LnNpdGVOYXZpZ2F0aW9uVHlwZSA9PT0gJ215X2dyb3VwcycgPyAnZ3JvdXAnIDogY29udGV4dC5zaXRlTmF2aWdhdGlvblR5cGUpICsgJyAnICsgKGNvbnRleHQuc2l0ZU5hdmlnYXRpb25UeXBlID09ICdjdXN0b20nID8gJ3dpdGhvdXQtYXZhdGFyJyA6ICcnKSksCgkJCXdyYXBwZXI6IGNvbnRleHQuYmFubmVyLAoJCQl1bnJlYWRDb3VudE1lc3NhZ2VQbHVyYWw6IGNvbnRleHQuc2l0ZU5hdmlnYXRpb25UaXRsZSwKCQkJdW5yZWFkQ291bnRNZXNzYWdlU2luZ3VsYXI6IGNvbnRleHQuc2l0ZU5hdmlnYXRpb25UaXRsZSwKCQkJb25Mb2FkOiBmdW5jdGlvbiAocGFnZUluZGV4LCBzaG91bGRSZWZyZXNoVW5yZWFkQ291bnQsIGZpbHRlciwgY29tcGxldGUpIHsKCQkJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5nZXQoewoJCQkJCXVybDogY29udGV4dC5zaXRlTmF2aWdhdGlvblVybCwKCQkJCQlkYXRhOiB7CgkJCQkJCXdfc2l0ZU5hdmlnYXRpb25UeXBlOiBjb250ZXh0LnNpdGVOYXZpZ2F0aW9uVHlwZSwKCQkJCQkJd19wYWdlSW5kZXg6IHBhZ2VJbmRleAoJCQkJCX0sCgkJCQkJc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CgkJCQkJCWNvbXBsZXRlKHJlc3BvbnNlKTsKCQkJCQl9CgkJCQl9KTsKCQkJfSwKCQkJb25SZWZyZXNoVW5yZWFkQ291bnQ6IGZ1bmN0aW9uIChjb21wbGV0ZSkgewoJCQkJY29tcGxldGUoMCk7CgkJCX0sCgkJCXRlbXBsYXRlOiBjb250ZXh0LnNpdGVOYXZpZ2F0aW9uVGVtcGxhdGUsCgkJCW9uU2hvdzogZnVuY3Rpb24gKGFjdGl2YXRvciwgY29tcGxldGUpIHsKCQkJCWNvbXBsZXRlKGJ1aWxkU2hvd1NldHRpbmdzKGNvbnRleHQsIGFjdGl2YXRvciwge30pKTsKCQkJfQoJCX0pOwoKCQlpZiAoY29udGV4dC5zaXRlTmF2aWdhdGlvbkN1c3RvbUl0ZW1zICYmCgkJCWNvbnRleHQuc2l0ZU5hdmlnYXRpb25DdXN0b21JdGVtcy5sZW5ndGggPiAwKSB7CgkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCQkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm1lc3NhZ2luZy5wdWJsaXNoKCduYXZpZ2F0aW9uLnNpdGVOYXZpZ2F0aW9uQ29udGVudCcsIHsKCQkJCQlpdGVtczogY29udGV4dC5zaXRlTmF2aWdhdGlvbkN1c3RvbUl0ZW1zCgkJCQl9KTsKCQkJfSwgMTAwKTsKCQl9CgoJCXJldHVybiBjb250ZXh0LnNpdGVOYXZpZ2F0aW9uTGlzdDsKCX0KCglmdW5jdGlvbiBpbml0SGFuZGhlbGRMaW5rcyhjb250ZXh0KSB7CgkJdmFyIG9wZW5IYW5kaGVsZENvbnRhaW5lciA9IG51bGwsIGFjdGl2ZUxpbmssIG9wZW4gPSBmYWxzZTsKCgkJZnVuY3Rpb24gcmVnaXN0ZXJIYW5kaGVsZExpbmsobGluaywgY29udGFpbmVyLCBvblNob3csIG9uSGlkZSkgewoJCQlsaW5rLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7CgkJCQllLnByZXZlbnREZWZhdWx0KCk7CgoJCQkJaWYgKG9wZW5IYW5kaGVsZENvbnRhaW5lciAmJiBvcGVuSGFuZGhlbGRDb250YWluZXIgPT0gY29udGFpbmVyKSB7CgkJCQkJaWYgKGFjdGl2ZUxpbmspIHsKCQkJCQkJYWN0aXZlTGluay5yZW1vdmVDbGFzcygnYWN0aXZlJyk7CgkJCQkJfQoJCQkJCW9uSGlkZSgpOwoJCQkJCW9wZW4gPSBmYWxzZTsKCQkJCQlpZiAob3BlbkhhbmRoZWxkQ29udGFpbmVyKSB7CgkJCQkJCW9wZW5IYW5kaGVsZENvbnRhaW5lci5oaWRlKCk7CgkJCQkJfQoJCQkJCW9wZW5IYW5kaGVsZENvbnRhaW5lciA9IG51bGw7CgkJCQl9CgkJCQllbHNlIGlmIChvcGVuSGFuZGhlbGRDb250YWluZXIpIHsKCQkJCQlpZiAoYWN0aXZlTGluaykgewoJCQkJCQlhY3RpdmVMaW5rLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKCQkJCQl9CgkJCQkJb25IaWRlKCk7CgkJCQkJb3BlbiA9IGZhbHNlOwoJCQkJCWlmIChvcGVuSGFuZGhlbGRDb250YWluZXIpIHsKCQkJCQkJb3BlbkhhbmRoZWxkQ29udGFpbmVyLmhpZGUoKTsKCQkJCQl9CgkJCQkJb3BlbkhhbmRoZWxkQ29udGFpbmVyID0gY29udGFpbmVyOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJb3BlbkhhbmRoZWxkQ29udGFpbmVyID0gY29udGFpbmVyOwoJCQkJfQoKCQkJCWlmIChvcGVuSGFuZGhlbGRDb250YWluZXIgIT09IG51bGwpIHsKCQkJCQlvcGVuSGFuZGhlbGRDb250YWluZXIuc2hvdygpOwoJCQkJCW9uU2hvdygpOwoJCQkJCW9wZW4gPSB0cnVlOwoJCQkJCWlmIChhY3RpdmVMaW5rKSB7CgkJCQkJCWFjdGl2ZUxpbmsucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwoJCQkJCX0KCQkJCQlhY3RpdmVMaW5rID0gbGluay5wYXJlbnRzKCdsaScpLmFkZENsYXNzKCdhY3RpdmUnKTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCW9uU2hvdygpOwoJCQkJCW9wZW4gPSBmYWxzZTsKCQkJCQlpZiAoYWN0aXZlTGluaykgewoJCQkJCQlhY3RpdmVMaW5rLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKCQkJCQl9CgoJCQkJCWlmIChhY3RpdmVMaW5rLmdldCgwKSA9PT0gbGluay5wYXJlbnRzKCdsaScpLmdldCgwKSkgewoJCQkJCQlhY3RpdmVMaW5rID0gbGluay5wYXJlbnRzKCdsaScpOwoJCQkJCX0KCQkJCQllbHNlIHsKCQkJCQkJYWN0aXZlTGluayA9IGxpbmsucGFyZW50cygnbGknKS5hZGRDbGFzcygnYWN0aXZlJyk7CgkJCQkJfQoJCQkJfQoJCQl9KTsKCQl9CgoJCXJlZ2lzdGVySGFuZGhlbGRMaW5rKGNvbnRleHQuaGFuZGhlbGRCYW5uZXJMaW5rc0xpbmssIGNvbnRleHQuaGFuZGhlbGRCYW5uZXJMaW5rcywKCQkJZnVuY3Rpb24gKCkgewoJCQkJY29udGV4dC5iYW5uZXJMaW5rcy5jb250ZW50cygpLmFwcGVuZFRvKGNvbnRleHQuaGFuZGhlbGRCYW5uZXJMaW5rcy5maW5kKCc+IHVsJykpOwoJCQl9LAoJCQlmdW5jdGlvbiAoKSB7CgkJCQljb250ZXh0LmhhbmRoZWxkQmFubmVyTGlua3MuZmluZCgnPiB1bCcpLmNvbnRlbnRzKCkuYXBwZW5kVG8oY29udGV4dC5iYW5uZXJMaW5rcyk7CgkJCX0pOwoKCQlyZWdpc3RlckhhbmRoZWxkTGluayhqUXVlcnkoJy51dGlsaXR5Lm1vYmlsZSAuc2VhcmNoLWJ1dHRvbiBhJyksIGNvbnRleHQuc2VhcmNoRmllbGRzLAoJCQlmdW5jdGlvbiAoKSB7CgkJCX0sCgkJCWZ1bmN0aW9uICgpIHsKCQkJfQoJCSk7Cgl9CgoJdmFyIHBvcHVwTGlzdCA9IFtdOwoJdmFyIHBvcHVwcyA9IHt9OwoKCWZ1bmN0aW9uIHJlZ2lzdGVyUG9wdXAocG9wdXAsIGtleSkgewoJCXZhciBpbmRleCA9IHBvcHVwTGlzdC5sZW5ndGg7CgkJcG9wdXBMaXN0LnB1c2gocG9wdXApOwoJCXBvcHVwc1trZXldID0gewoJCQlwb3B1cDogcG9wdXAsCgkJCWluZGV4OiBpbmRleAoJCX07Cgl9CgoJZnVuY3Rpb24gaW5pdEtleWJvYXJkRXZlbnRzKGNvbnRleHQpIHsKCQl2YXIgaXNBY3RpdmUgPSBmYWxzZTsKCQl2YXIgY3VycmVudEluZGV4ID0gbnVsbDsKCgkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm1lc3NhZ2luZy5zdWJzY3JpYmUoYWN0aXZhdGVNZXNzYWdlLCBmdW5jdGlvbiAoZGF0YSkgewoJCQlpc0FjdGl2ZSA9IHRydWU7CgkJCWN1cnJlbnRJbmRleCA9IHBvcHVwc1tkYXRhLmtleV0uaW5kZXg7CgkJCWlmIChkYXRhLmtleSA9PSAnc2VhcmNoJykgewoJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5mb2N1cygpOwoJCQkJfSwgMTApCgkJCX0KCQl9KTsKCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubWVzc2FnaW5nLnN1YnNjcmliZShkZWFjdGl2YXRlTWVzc2FnZSwgZnVuY3Rpb24gKGRhdGEpIHsKCQkJaWYgKGRhdGEua2V5ICE9ICdzZWFyY2gnKSB7CgkJCQlpc0FjdGl2ZSA9IGZhbHNlOwoJCQl9CgkJCWNsZWFySW50ZXJ2YWwodGVzdEludGVydmFsKTsKCQl9KTsKCgkJdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5LAoJCQlkb2MgPSBkb2N1bWVudCwKCQkJd2luID0gd2luZG93LAoJCQljdXJyZW50U2VsZWN0aW9uID0gbnVsbDsKCgkJdmFyIGtleXMgPSB7CgkJCWVudGVyOiAxMywKCQkJZXNjOiAyNywKCgkJCXNsYXNoOiAxOTEsCgoJCQl1cDogMzgsCgkJCXA6IDgwLAoJCQlrOiA3NSwKCgkJCWRvd246IDQwLAoJCQluOiA3OCwKCQkJajogNzQsCgoJCQlsZWZ0OiAzNywKCQkJcmlnaHQ6IDM5LAoJCQloOiA3MiwKCQkJbDogNzYKCQl9OwoKCQlmdW5jdGlvbiBibG9ja0tleShlKSB7CgkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQl9CgoJCWZ1bmN0aW9uIGdldENhcmV0KGVsKSB7CgkJCWlmIChlbC5zZWxlY3Rpb25TdGFydCkgewoJCQkJcmV0dXJuIGVsLnNlbGVjdGlvblN0YXJ0OwoJCQl9CgkJCWVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikgewoJCQkJZWwuZm9jdXMoKTsKCQkJCXZhciByID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7CgkJCQlpZiAociA9PSBudWxsKSB7CgkJCQkJcmV0dXJuIDA7CgkJCQl9CgkJCQl2YXIgcmUgPSBlbC5jcmVhdGVUZXh0UmFuZ2UoKSwKCQkJCQlyYyA9IHJlLmR1cGxpY2F0ZSgpOwoJCQkJcmUubW92ZVRvQm9va21hcmsoci5nZXRCb29rbWFyaygpKTsKCQkJCXJjLnNldEVuZFBvaW50KCdFbmRUb1N0YXJ0JywgcmUpOwoJCQkJcmV0dXJuIHJjLnRleHQubGVuZ3RoOwoJCQl9CgkJCXJldHVybiAwOwoJCX0KCgkJJCgnYm9keScpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7CgkJCXZhciBpc0Jhbm5lclRhcmdldCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoY29udGV4dC53cmFwcGVyICsgJywgLnBvcHVwLWxpc3QnKS5sZW5ndGggPiAwOwoJCQlpZiAoIWlzQmFubmVyVGFyZ2V0KSB7CgkJCQl2YXIgY3VycmVudFBvcHVwID0gcG9wdXBMaXN0W2N1cnJlbnRJbmRleF07CgkJCQlpc0FjdGl2ZSA9IGZhbHNlOwoJCQkJaWYgKGN1cnJlbnRQb3B1cCkKCQkJCQljdXJyZW50UG9wdXAuZGVhY3RpdmF0ZSgpOwoJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5ibHVyKCk7CgkJCQljdXJyZW50U2VsZWN0aW9uID0gbnVsbDsKCQkJfQoJCX0pOwoKCQkkKGRvY3VtZW50KS5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7CgkJCXZhciBpc1dpbmRvd0V2ZW50ID0gKGUudGFyZ2V0ID09IGJvZHkgfHwgZS50YXJnZXQgPT0gZG9jIHx8IGUudGFyZ2V0ID09IHdpbik7CgkJCXZhciBpc0Jhbm5lckV2ZW50ID0gJChlLnRhcmdldCkuY2xvc2VzdChjb250ZXh0LndyYXBwZXIgKyAnLCAucG9wdXAtbGlzdCcpLmxlbmd0aCA+IDA7CgoJCQkvL3ZhciBpc0Jhbm5lclRhcmdldCA9IGUudGFyZ2V0CgkJCS8vIHNsYXNoIG9wZW5zIHNlYXJjaAoJCQlpZiAoIWlzQWN0aXZlICYmIGlzV2luZG93RXZlbnQgJiYgZS53aGljaCA9PSBrZXlzLnNsYXNoKSB7CgkJCQlibG9ja0tleShlKTsKCQkJCWNvbnRleHQuc2VhcmNoSW5wdXQuZm9jdXMoKTsKCQkJCWlzQWN0aXZlID0gdHJ1ZTsKCQkJCWN1cnJlbnRJbmRleCA9IHBvcHVwc1snc2VhcmNoJ10uaW5kZXg7CgkJCX0KCQkJZWxzZSBpZiAoaXNBY3RpdmUpIHsKCQkJCXZhciBjdXJyZW50UG9wdXAgPSBwb3B1cExpc3RbY3VycmVudEluZGV4XTsKCgkJCQlpZiAoIWlzQmFubmVyRXZlbnQgJiYgIWlzV2luZG93RXZlbnQpIHsKCQkJCQlpc0FjdGl2ZSA9IGZhbHNlOwoJCQkJCWlmIChjdXJyZW50UG9wdXApCgkJCQkJCWN1cnJlbnRQb3B1cC5kZWFjdGl2YXRlKCk7CgkJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5ibHVyKCk7CgkJCQkJY3VycmVudFNlbGVjdGlvbiA9IG51bGw7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgoJCQkJaWYgKCFjdXJyZW50UG9wdXApIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCgkJCQl2YXIgaXNDdXJzb3JJblN0YXJ0ID0gY29udGV4dC5zZWFyY2hJbnB1dC5pcygiOm5vdCg6Zm9jdXMpIikgfHwgZ2V0Q2FyZXQoY29udGV4dC5zZWFyY2hJbnB1dFswXSkgPT0gMDsKCQkJCXZhciBpc0N1cnNvckluRW5kID0gY29udGV4dC5zZWFyY2hJbnB1dC5pcygiOm5vdCg6Zm9jdXMpIikgfHwgZ2V0Q2FyZXQoY29udGV4dC5zZWFyY2hJbnB1dFswXSkgPT0gY29udGV4dC5zZWFyY2hJbnB1dC52YWwoKS5sZW5ndGg7CgoJCQkJLy8gaGlkZSBvbiBlc2Mgb3Igc2xhc2ggaW4gbm9uIGlucHV0CgkJCQlpZiAoZS53aGljaCA9PSBrZXlzLmVzYyB8fCAoZS53aGljaCA9PSBrZXlzLnNsYXNoICYmIGlzV2luZG93RXZlbnQpKSB7CgkJCQkJYmxvY2tLZXkoZSk7CgkJCQkJY3VycmVudFBvcHVwLmRlYWN0aXZhdGUoKTsKCQkJCQljb250ZXh0LnNlYXJjaElucHV0LmJsdXIoKTsKCQkJCQlpc0FjdGl2ZSA9IGZhbHNlOwoJCQkJCWN1cnJlbnRTZWxlY3Rpb24gPSBudWxsOwoJCQkJfQoKCQkJCS8vIGxlZnQvcmlnaHQgdG8gY2hhbmdlIGN1cnJlbnQgb3BlbiBwb3B1cAoJCQkJZWxzZSBpZiAoKGUud2hpY2ggPT0ga2V5cy5sZWZ0ICYmIGlzQ3Vyc29ySW5TdGFydCAmJiAhKGUuY3RybEtleSB8fCBlLm1ldGFLZXkpKSB8fAoJCQkJCShlLndoaWNoID09IGtleXMuaCAmJiBjdXJyZW50UG9wdXAgIT09IGNvbnRleHQuc2VhcmNoUG9wdXApKSB7CgkJCQkJYmxvY2tLZXkoZSk7CgkJCQkJY3VycmVudFBvcHVwLmRlYWN0aXZhdGUoKTsKCQkJCQljb250ZXh0LnNlYXJjaElucHV0LmJsdXIoKTsKCQkJCQljdXJyZW50SW5kZXgtLTsKCQkJCQlpZiAoY3VycmVudEluZGV4IDwgMCkgewoJCQkJCQljdXJyZW50SW5kZXggPSBwb3B1cExpc3QubGVuZ3RoIC0gMTsKCQkJCQl9CgoJCQkJCWN1cnJlbnRQb3B1cCA9IHBvcHVwTGlzdFtjdXJyZW50SW5kZXhdOwoJCQkJCWN1cnJlbnRQb3B1cC5hY3RpdmF0ZSgpOwoJCQkJfQoJCQkJZWxzZSBpZiAoKGUud2hpY2ggPT0ga2V5cy5yaWdodCAmJiBpc0N1cnNvckluRW5kICYmICEoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkpIHx8CgkJCQkJKGUud2hpY2ggPT0ga2V5cy5sICYmIGN1cnJlbnRQb3B1cCAhPT0gY29udGV4dC5zZWFyY2hQb3B1cCkpIHsKCQkJCQlibG9ja0tleShlKTsKCQkJCQljdXJyZW50UG9wdXAuZGVhY3RpdmF0ZSgpOwoJCQkJCWNvbnRleHQuc2VhcmNoSW5wdXQuYmx1cigpOwoJCQkJCWN1cnJlbnRJbmRleCsrOwoJCQkJCWlmIChjdXJyZW50SW5kZXggPj0gcG9wdXBMaXN0Lmxlbmd0aCkgewoJCQkJCQljdXJyZW50SW5kZXggPSAwOwoJCQkJCX0KCgkJCQkJY3VycmVudFBvcHVwID0gcG9wdXBMaXN0W2N1cnJlbnRJbmRleF07CgkJCQkJY3VycmVudFBvcHVwLmFjdGl2YXRlKCk7CgkJCQl9CgoJCQkJLy8gdXAKCQkJCWVsc2UgaWYgKGUud2hpY2ggPT0ga2V5cy51cCB8fAoJCQkJCSgoZS53aGljaCA9PSBrZXlzLnAgfHwgZS53aGljaCA9PSBrZXlzLmspICYmIChjdXJyZW50UG9wdXAgIT09IGNvbnRleHQuc2VhcmNoUG9wdXApKSkgewoJCQkJCWJsb2NrS2V5KGUpOwoJCQkJCWN1cnJlbnRQb3B1cC5tb3ZlVXAoZnVuY3Rpb24gKGl0ZW0pIHsKCQkJCQkJY3VycmVudFNlbGVjdGlvbiA9IGl0ZW07CgkJCQkJfSk7CgkJCQl9CgoJCQkJLy8gZG93bgoJCQkJZWxzZSBpZiAoZS53aGljaCA9PSBrZXlzLmRvd24gfHwKCQkJCQkoKGUud2hpY2ggPT0ga2V5cy5uIHx8IGUud2hpY2ggPT0ga2V5cy5qKSAmJiAoY3VycmVudFBvcHVwICE9PSBjb250ZXh0LnNlYXJjaFBvcHVwKSkpIHsKCQkJCQlibG9ja0tleShlKTsKCQkJCQljdXJyZW50UG9wdXAubW92ZURvd24oZnVuY3Rpb24gKGl0ZW0pIHsKCQkJCQkJY3VycmVudFNlbGVjdGlvbiA9IGl0ZW07CgkJCQkJfSk7CgkJCQl9CgoJCQkJLy8gc2VsZWN0CgkJCQllbHNlIGlmIChlLndoaWNoID09IGtleXMuZW50ZXIpIHsKCQkJCQlibG9ja0tleShlKTsKCQkJCQlpZiAoY3VycmVudFNlbGVjdGlvbikgewoJCQkJCQljdXJyZW50U2VsZWN0aW9uLmNsaWNrKCk7CgkJCQkJfQoJCQkJfQoKCQkJfQoJCX0pOwoJfQoKCXZhciBhcGkgPSB7CgkJcmVnaXN0ZXI6IGZ1bmN0aW9uIChjb250ZXh0KSB7CgkJCWlmIChjb250ZXh0LnNpdGVOYXZpZ2F0aW9uVHlwZSA9PSAicXVlc3QiKSB7CgkJCQlnZXRRdWVzdE5hdmlnYXRpb24oKTsKCQkJfQoJCQllbHNlIGlmIChjb250ZXh0LnNpdGVOYXZpZ2F0aW9uTGluayAmJiBjb250ZXh0LnNpdGVOYXZpZ2F0aW9uTGluay5sZW5ndGggPiAwKSB7CgkJCQlyZWdpc3RlclBvcHVwKGluaXRTaXRlTmF2aWdhdGlvbihjb250ZXh0KSwgJ3NpdGUnKTsKCQkJfQoKCQkJaWYgKGNvbnRleHQudXNlUXVlc3RGb290ZXIgPT0gJ1RydWUnICYmICEkKCcjZm9vdGVyJykubGVuZ3RoKSB7CgkJCQlnZXRRdWVzdEZvb3RlcigpOwoJCQl9CgoJCQlpZiAoY29udGV4dC5zZWFyY2hJbnB1dC5sZW5ndGggPiAwKSB7CgkJCQlpZiAoY29udGV4dC5zZWFyY2hUeXBlID09ICJEZWZhdWx0IikgewoJCQkJCXJlZ2lzdGVyUG9wdXAoaW5pdFNlYXJjaFBvcHVwKGNvbnRleHQpLCAnc2VhcmNoJyk7CgkJCQkJcG9zdFByb2Nlc3NEZWZhdWx0U2VhcmNoKGNvbnRleHQuc2VhcmNoRmllbGRzLCBjb250ZXh0LnNlYXJjaElucHV0KTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWluaXRRdWVzdFNlYXJjaChjb250ZXh0LnNlYXJjaEZpZWxkcywgY29udGV4dC5zZWFyY2hJbnB1dCk7CgkJCQl9CgkJCX0KCgkJCWlmIChjb250ZXh0Lm5vdGlmaWNhdGlvbnNMaW5rLmxlbmd0aCA+IDApCgkJCQlyZWdpc3RlclBvcHVwKGluaXROb3RpZmljYXRpb25MaXN0KGNvbnRleHQpLCAnbm90aWZpY2F0aW9ucycpOwoKCQkJaWYgKGNvbnRleHQuY29udmVyc2F0aW9uc0xpbmsubGVuZ3RoID4gMCkKCQkJCXJlZ2lzdGVyUG9wdXAoaW5pdENvbnZlcnNhdGlvbkxpc3QoY29udGV4dCksICdjb252ZXJzYXRpb25zJyk7CgoJCQlpZiAoY29udGV4dC5ib29rbWFya3NMaW5rLmxlbmd0aCA+IDApCgkJCQlyZWdpc3RlclBvcHVwKGluaXRCb29rbWFya3NMaXN0KGNvbnRleHQpLCAnYm9va21hcmtzJyk7CgoJCQlpZiAoY29udGV4dC51c2VyTGluay5sZW5ndGggPiAwKQoJCQkJcmVnaXN0ZXJQb3B1cChpbml0VXNlclBvcHVwKGNvbnRleHQpLCAndXNlcicpOwoKCQkJaW5pdEhhbmRoZWxkTGlua3MoY29udGV4dCk7CgoJCQlpbml0S2V5Ym9hcmRFdmVudHMoY29udGV4dCk7CgkJfQoJfTsKCgkkLnRlbGxpZ2VudCA9ICQudGVsbGlnZW50IHx8IHt9OwoJJC50ZWxsaWdlbnQuZXZvbHV0aW9uID0gJC50ZWxsaWdlbnQuZXZvbHV0aW9uIHx8IHt9OwoJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLndpZGdldHMgPSAkLnRlbGxpZ2VudC5ldm9sdXRpb24ud2lkZ2V0cyB8fCB7fTsKCSQudGVsbGlnZW50LmV2b2x1dGlvbi53aWRnZXRzLnNpdGVCYW5uZXIgPSBhcGk7CgoJLy9DdXN0b20KCgl2YXIgbG9jYWxpemVkQ29udGVudCA9IFtdLCBwYWdlVHlwZSA9ICcnLCBwYWdlV2lkdGggPSAwOwoJdmFyIFJvb3RQYXRoID0gUm9vdFBhdGggfHwgJyc7CgoJJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkgewoJCXBhZ2VXaWR0aCA9IGdldFBhZ2VQcm9wZXJ0aWVzKCk7CgoJCXByb2Nlc3NIZWFkZXJGb290ZXIoKTsKCgkJJCgnYm9keScpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7CgkJCWlmICghJChlLnRhcmdldCkucGFyZW50cygnaGVhZGVyJykubGVuZ3RoKSB7CgkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKCQkJCQkkKCcudXRpbGl0eScpLmZpbmQoJy5hY3RpdmUnKS5maW5kKCc+IGEnKS50cmlnZ2VyKCdjbGljaycpOwoJCQkJfSwgMTAwKTsKCQkJfQoJCX0pOwoJfSk7CgoJJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbiAoKSB7CgkJcGFnZVdpZHRoID0gZ2V0UGFnZVByb3BlcnRpZXMoKTsKCX0pOwoKCWZ1bmN0aW9uIHBvc3RQcm9jZXNzRGVmYXVsdFNlYXJjaChzZWFyY2hDb250YWluZXIsIHNlYXJjaElucHV0RWxlbSkgewoJCXNlYXJjaENvbnRhaW5lci5vbignY2xpY2snLCAnLmJ0bicsIGZ1bmN0aW9uIChlKSB7CgkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJbG9jYXRpb24uaHJlZiA9ICcvY29tbXVuaXR5L3NlYXJjaD9xPScgKyBzZWFyY2hJbnB1dEVsZW0udmFsKCk7CgkJfSk7CgoJCXBvc3RQcm9jZXNzQWxsU2VhcmNoKHNlYXJjaENvbnRhaW5lcik7Cgl9CgoJZnVuY3Rpb24gaW5pdFF1ZXN0U2VhcmNoKHNlYXJjaENvbnRhaW5lciwgc2VhcmNoRmllbGRFbGVtKSB7CgkJJC5nZXRTY3JpcHQoJy9TdGF0aWMvU2NyaXB0cy9qcXVlcnkuYXV0b2NvbXBsZXRlLm1pbi5qcycsIGZ1bmN0aW9uICgpIHsKCQkJJC5nZXRTY3JpcHQoJy92aWV3U2NyaXB0cy9qcXVlcnkuYWRvYmUuYXV0b2NvbXBsZXRlLmpzJywgZnVuY3Rpb24gKCkgewoJCQkJLy9UT0RPOiBGaWd1cmUgb3V0IHdoYXQgdGhpcyBkb2VzLgoJCQkJdmFyIGIgPSB7fTsKCQkJCShmdW5jdGlvbiAoKSB7CgkJCQkJdmFyIGosIGwgPSAvXCsvZywgayA9IC8oW14mPV0rKT0/KFteJl0qKS9nLCBuID0gZnVuY3Rpb24gKG8pIHsKCQkJCQkJcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChvLnJlcGxhY2UobCwgIiAiKSkKCQkJCQl9LCBtID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7CgkJCQkJd2hpbGUgKGogPSBrLmV4ZWMobSkpIHsKCQkJCQkJYltuKGpbMV0pXSA9IG4oalsyXSkKCQkJCQl9CgkJCQl9KSgpOwoKCQkJCS8vIHNlYXJjaEZpZWxkRWxlbS5hdHRyKCdhdXRvY29tcGxldGUnLCAnb2ZmJyk7CgkJCQlzZWFyY2hGaWVsZEVsZW0ub24oJ2tleXByZXNzJywgZnVuY3Rpb24gKGUpIHsKCQkJCQlpZiAoZS53aGljaCA9PSAxMykgewoJCQkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQkJCWdvU2VhcmNoKCQodGhpcykudmFsKCkpOwoJCQkJCX0KCQkJCX0pOwoKCQkJCXNlYXJjaENvbnRhaW5lci5vbignY2xpY2snLCAnLmJ0bicsIGZ1bmN0aW9uIChlKSB7CgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoKCQkJCQlsb2NhdGlvbi5ocmVmID0gJy9zZWFyY2gvcmVzdWx0cy8/cT0nICsgc2VhcmNoRmllbGRFbGVtLnZhbCgpOwoJCQkJfSk7CgoJCQkJaW5pdEFkb2JlU2VhcmNoKCk7CgkJCQlwb3N0UHJvY2Vzc0FsbFNlYXJjaChzZWFyY2hDb250YWluZXIpOwoJCQl9KTsKCQl9KTsKCgkJZnVuY3Rpb24gaW5pdEFkb2JlU2VhcmNoKCkgewoJCQl2YXIgY29uZmlnID0gewoJCQkJYWNjb3VudDogInNwMTAwNTBjMzMiLAoJCQkJc2VhcmNoRG9tYWluOiAnaHR0cDovL3N0YWdlLnNwMTAwNTBlY2QuZ3VpZGVkLnNzLW9tdHJkYy5uZXQvJywKCQkJCWlucHV0RWxlbWVudDogIlt0eXBlPXNlYXJjaF0iLAoJCQkJLy9pbnB1dEZvcm1FbGVtZW50OiAiI3NlYXJjaC1mb3JtIiwKCQkJCWRlbGF5OiAzMDAsCgkJCQltaW5MZW5ndGg6IDIsCgkJCQltYXhSZXN1bHRzOiAxMCwKCQkJCWJyb3dzZXJBdXRvY29tcGxldGU6IGZhbHNlLAoJCQkJcXVlcnlDYXNlU2Vuc2l0aXZlOiBmYWxzZSwKCQkJCXN0YXJ0c1dpdGg6IGZhbHNlLAoJCQkJc2VhcmNoT25TZWxlY3Q6IHRydWUsCgkJCQlzdWJtaXRPblNlbGVjdDogdHJ1ZSwKCQkJCWhpZ2hsaWdodFdvcmRzOiBmYWxzZSwKCQkJCWhpZ2hsaWdodFdvcmRzQmVnaW46IGZhbHNlCgkJCX07CgoJCQlzZWFyY2hGaWVsZEVsZW0ub24oImF1dG9jb21wbGV0ZW9wZW4iLCBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7CgkJCQkkKCcudWktYXV0b2NvbXBsZXRlJykuY3NzKHsKCQkJCQl3aWR0aDogJCh0aGlzKS5vdXRlcldpZHRoKHRydWUpCgkJCQl9KQoJCQl9KTsKCgkJCXNlYXJjaEZpZWxkRWxlbS5vbigiYXV0b2NvbXBsZXRlc2VsZWN0IiwgZnVuY3Rpb24gKGV2ZW50LCB1aSkgewoJCQkJZ29TZWFyY2goc2VhcmNoRmllbGRFbGVtLnZhbCgpKTsKCQkJfSk7CgoJCQlzZWFyY2hGaWVsZEVsZW0uQWRvYmVBdXRvY29tcGxldGUoY29uZmlnKTsKCQl9CgoJCWZ1bmN0aW9uIGdvU2VhcmNoKHNlYXJjaHRlcm0pIHsKCQkJaWYgKGlzRG91YmxlQnl0ZShzZWFyY2h0ZXJtKSkgewoJCQkJc2VhcmNodGVybSA9IGVuY29kZVVSSUNvbXBvbmVudChzZWFyY2h0ZXJtKTsKCQkJfQoJCQllbHNlIHsKCQkJCS8vc2VhcmNodGVybSA9IGVuY29kZVVSSUNvbXBvbmVudChFbmNvZGVyLmh0bWxFbmNvZGUoc2VhcmNodGVybSkpOwoJCQkJc2VhcmNodGVybSA9IGVuY29kZVVSSUNvbXBvbmVudChzZWFyY2h0ZXJtKTsKCQkJfQoKCQkJbG9jYXRpb24uaHJlZiA9ICIvc2VhcmNoL3Jlc3VsdHMvP3E9IiArIHNlYXJjaHRlcm07CgoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQlmdW5jdGlvbiBpc0RvdWJsZUJ5dGUoc3RyKSB7CgkJCWZvciAodmFyIGkgPSAwLCBuID0gc3RyLmxlbmd0aDsgaSA8IG47IGkrKykgewoJCQkJaWYgKHN0ci5jaGFyQ29kZUF0KGkpID4gMjU1KSB7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIGZhbHNlOwoJCX0KCX0KCglmdW5jdGlvbiBwb3N0UHJvY2Vzc0FsbFNlYXJjaChzZWFyY2hDb250YWluZXIpIHsKCQkvL1V0aWxpdHkgc2VjdGlvbi4gRGVza3RvcAoJCSQoJ2JvZHknKS5vbignY2xpY2snLCAnLnV0aWxpdHkuZGVza3RvcCAuc2VhcmNoLWJ1dHRvbiA+IGEnLCBmdW5jdGlvbiAoKSB7CgkJCSQodGhpcykucGFyZW50cygnLnV0aWxpdHktc2VjdGlvbi13cmFwcGVyJykudG9nZ2xlQ2xhc3MoJ29wZW4tc2VhcmNoJyk7CgkJfSk7Cgl9CgoJLyoKCSBHZXQgbmF2aWdhdGlvbiB2aWEgYWpheC4gU2hvdWxkIG9ubHkgYmUgZXhlY3V0ZWQgb24gbm9uIGhvbWUgcGFnZS4KCgkgTm90ZTogQWxsIG5vbiBob21lIHBhZ2UgKHJlc3BvbnNpdmUpIHdpbGwgdXNlIHRoZSBzcGVjaWFsIHRhZyBWMkxheW91dEhlYWRlckFqYXggd2hpY2ggaGFzIGEgZGF0YS1hamF4PSJ0cnVlIiBhdHRyaWJ1dGUuCgkgVjJMYXlvdXRIZWFkZXJBamF4TmF2IGNvbnRhaW5zIHRoZSBuYXZpZ2F0aW9uIGh0bWwgY29udGVudC4KCSAqLwoJZnVuY3Rpb24gZ2V0UXVlc3ROYXZpZ2F0aW9uKCkgewoJCXZhciBoZWFkZXJOYXZFbGVtID0gJCgnLm1haW4tbmF2LXNlY3Rpb24nKSwKCQkJc3BlY2lhbFRhZyA9IFsnVjJMYXlvdXRIZWFkZXJBamF4TmF2J10sCgkJCXNlc3Npb25OYXZOYW1lID0gJ25hdi0nICsgUm9vdFBhdGgucmVwbGFjZSgvXC8vZywgJycpOwoKCQlpZiAoaGVhZGVyTmF2RWxlbS5kYXRhKCdhamF4JykpIHsKCQkJLy9JZiBzZXNzaW9uIHN0b3JhZ2UgaXMgYXZhaWxhYmxlLCBwb3B1bGF0ZSBuYXZpZ2F0aW9uLiBOb3RlOiBpZiBuYXZpZ2F0aW9uIGhhcyBiZWVuIHVwZGF0ZWQgd2hlbiBuYXYgaXMgYWxyZWFkeSBzdG9yZWQsIGl0J2xsIGJlIG9uZSBwYWdlIHZpZXcgYmVoaW5kLgoJCQlpZiAoc2Vzc2lvblN0b3JhZ2Vbc2Vzc2lvbk5hdk5hbWVdKSB7CgkJCQloZWFkZXJOYXZFbGVtLmFwcGVuZChzZXNzaW9uU3RvcmFnZVtzZXNzaW9uTmF2TmFtZV0pOwoJCQkJYmluZE5hdmlnYXRpb25FdmVudHMoKTsKCQkJfQoKCQkJLy9HZXQgbmF2aWdhdGlvbiBhbmQgc3RvcmUKCQkJZ2V0TG9jYWxpemVkQ29udGVudChzcGVjaWFsVGFnKS5kb25lKGZ1bmN0aW9uIChkYXRhKSB7CgkJCQkvL1BvcHVsYXRlIG5hdmlnYXRpb24gb25seSBpZiBzZXNzaW9uU3RvcmFnZS5uYXYgaXMgbm90IHByZXNlbnQgYmVjYXVzZSBpZiBpdCBpcyBwcmVzZW50LCBpdCB3b3VsZCBoYXZlIGFscmVhZHkgYmVlbiBwb3B1bGF0ZWQgb24gbGluZSAzMi4KCQkJCWlmICghc2Vzc2lvblN0b3JhZ2Vbc2Vzc2lvbk5hdk5hbWVdKSB7CgkJCQkJaGVhZGVyTmF2RWxlbS5hcHBlbmQoZGF0YVtzcGVjaWFsVGFnWzBdXSk7CgkJCQkJYmluZE5hdmlnYXRpb25FdmVudHMoKTsKCQkJCX0KCgkJCQkvL1N0b3JlIGxhdGVzdCBuYXZpZ2F0aW9uLgoJCQkJc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShzZXNzaW9uTmF2TmFtZSwgZGF0YVtzcGVjaWFsVGFnWzBdXSk7CgkJCX0pOwoJCX0KCQllbHNlIHsKCQkJLy9HZXQgbmF2aWdhdGlvbiBhbmQgc3RvcmUKCQkJZ2V0TG9jYWxpemVkQ29udGVudChzcGVjaWFsVGFnKS5kb25lKGZ1bmN0aW9uIChkYXRhKSB7CgkJCQkvL1N0b3JlIGxhdGVzdCBuYXZpZ2F0aW9uLgoJCQkJc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShzZXNzaW9uTmF2TmFtZSwgZGF0YVtzcGVjaWFsVGFnWzBdXSk7CgkJCX0pOwoJCX0KCgkJZnVuY3Rpb24gYmluZE5hdmlnYXRpb25FdmVudHMoKSB7CgkJCS8vUHJldmVudCBhbmNob3IgdGFnIGZyb20gZmlyaW5nIHdoZW4gaHJlZiBpcyBzZXQgdG8gIwoJCQloZWFkZXJOYXZFbGVtLmZpbmQoJy50aWVyMicpLm9uKCdjbGljaycsICdhW2hyZWY9I10nLCBmdW5jdGlvbiAoZSkgewoJCQkJaWYgKHBhZ2VUeXBlID09IDMpIHsKCQkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQl9CgkJCX0pOwoKCQkJLy9Nb2JpbGUgb25seS4KCQkJaGVhZGVyTmF2RWxlbS5vbignY2xpY2snLCAnLnRpZXIyID4gbGkuc3ViTGlua3MgPiBhLCAudGllcjMgPiBsaS5zdWJMaW5rcyA+IGEnLCBmdW5jdGlvbiAoZSkgewoJCQkJaWYgKHBhZ2VUeXBlID09IDMpIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgoJCQkJdmFyIGlzT3BlbiA9ICQodGhpcykucGFyZW50KCkuc2libGluZ3MoKS5oYXNDbGFzcygnb3BlbicpOwoKCQkJCWlmIChpc09wZW4pIHsKCQkJCQkkKHRoaXMpLnBhcmVudCgpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ29wZW4nKTsKCQkJCX0KCgkJCQliZ0FuaW1hdGUodGhpcyk7CgoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJJCh0aGlzKS5wYXJlbnQoKS50b2dnbGVDbGFzcygnb3BlbicpOwoJCQl9KTsKCgkJCS8vU2lhbWFrOiBPcGVuIHRpZXIgMiBvbiBjbGljawoJCQkvL0NoYW5nZSBiZyBjb2xvciBvbiBNb2JpbGUgYW5kIFRhYmxldAoJCQloZWFkZXJOYXZFbGVtLmZpbmQoJy50aWVyMScpLm9uKCdjbGljaycsICc+IC5zdWJMaW5rcyA+IGEnLCBmdW5jdGlvbiAoZSkgewoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCgkJCQl2YXIgaXNPcGVuID0gJCh0aGlzKS5wYXJlbnQoKS5oYXNDbGFzcygnb3BlbicpOwoKCQkJCS8vQ2xvc2luZyBhbGwgb3RoZXIgb3BlbmVkIG5hdmlnYXRpb24KCQkJCWhlYWRlck5hdkVsZW0uZmluZCgnLm9wZW4nKS5yZW1vdmVDbGFzcygnb3BlbicpOwoKCQkJCWlmICghaXNPcGVuKSB7CgkJCQkJLy9BZGRpbmcgLm9wZW4gdG8gdGFyZ2V0IExJCgkJCQkJJCh0aGlzKS5wYXJlbnQoKS50b2dnbGVDbGFzcygnb3BlbicpOwoJCQkJfQoKCQkJCS8vU2lhbWFrOiBDaGFuZ2UgdGllciAxIGJhY2tncm91bmQgd2hlbiBjbGljawoJCQkJaWYgKHBhZ2VUeXBlIDwgMykgewoJCQkJCWJnQW5pbWF0ZSh0aGlzKTsKCQkJCX0KCQkJfSk7CgoJCQkkKCdib2R5Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHsKCQkJCS8vQ2xvc2luZyBhbGwgbmF2aWdhdGlvbiB3aGVuIGNsaWNrIG9uIGJvZHkgKExhcmdlIGRlc2t0b3ApCgkJCQlpZiAocGFnZVR5cGUgPT0gMykgewoJCQkJCSQoJy50aWVyMScpLmZpbmQoJy5vcGVuJykucmVtb3ZlQ2xhc3MoJ29wZW4nKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWZ1bmN0aW9uIGdldFF1ZXN0Rm9vdGVyKCkgewoJCXZhciBzcGVjaWFsVGFnID0gWydWMkxheW91dEZvb3RlclRvcCcsICdWMkxheW91dEZvb3RlckJvdHRvbSddLAoJCQlzZXNzaW9uRm9vdGVyVG9wTmFtZSA9ICdmdC0nICsgUm9vdFBhdGgucmVwbGFjZSgvXC8vZywgJycpLAoJCQlzZXNzaW9uRm9vdGVyQm90dG9tTmFtZSA9ICdmYi0nICsgUm9vdFBhdGgucmVwbGFjZSgvXC8vZywgJycpOwoKCQkvL0lmIHNlc3Npb24gc3RvcmFnZSBpcyBhdmFpbGFibGUsIHBvcHVsYXRlIG5hdmlnYXRpb24uIE5vdGU6IGlmIG5hdmlnYXRpb24gaGFzIGJlZW4gdXBkYXRlZCB3aGVuIG5hdiBpcyBhbHJlYWR5IHN0b3JlZCwgaXQnbGwgYmUgb25lIHBhZ2UgdmlldyBiZWhpbmQuCgkJaWYgKHNlc3Npb25TdG9yYWdlW3Nlc3Npb25Gb290ZXJUb3BOYW1lXSkgewoJCQkkKCdib2R5JykuYXBwZW5kKCc8Zm9vdGVyIGNsYXNzPSJmb290ZXIiIGlkPSJmb290ZXIiPicgKyBzZXNzaW9uU3RvcmFnZVtzZXNzaW9uRm9vdGVyVG9wTmFtZV0gKyBzZXNzaW9uU3RvcmFnZVtzZXNzaW9uRm9vdGVyQm90dG9tTmFtZV0gKyAnPC9mb290ZXI+Jyk7CgkJCWJpbmROYXZpZ2F0aW9uRXZlbnRzKCk7CgkJfQoKCQkvL0dldCBuYXZpZ2F0aW9uIGFuZCBzdG9yZQoJCWdldExvY2FsaXplZENvbnRlbnQoc3BlY2lhbFRhZykuZG9uZShmdW5jdGlvbiAoZGF0YSkgewoJCQkvL1BvcHVsYXRlIG5hdmlnYXRpb24gb25seSBpZiBzZXNzaW9uU3RvcmFnZS5uYXYgaXMgbm90IHByZXNlbnQgYmVjYXVzZSBpZiBpdCBpcyBwcmVzZW50LCBpdCB3b3VsZCBoYXZlIGFscmVhZHkgYmVlbiBwb3B1bGF0ZWQgb24gbGluZSAzMi4KCQkJaWYgKCFzZXNzaW9uU3RvcmFnZVtzZXNzaW9uRm9vdGVyVG9wTmFtZV0pIHsKCQkJCSQoJ2JvZHknKS5hcHBlbmQoJzxmb290ZXIgY2xhc3M9ImZvb3RlciIgaWQ9ImZvb3RlciI+JyArIGRhdGFbc3BlY2lhbFRhZ1swXV0gKyBkYXRhW3NwZWNpYWxUYWdbMV1dICsgJzwvZm9vdGVyPicpOwoJCQkJYmluZE5hdmlnYXRpb25FdmVudHMoKTsKCQkJfQoKCQkJLy9TdG9yZSBsYXRlc3QgbmF2aWdhdGlvbi4KCQkJc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShzZXNzaW9uRm9vdGVyVG9wTmFtZSwgZGF0YVtzcGVjaWFsVGFnWzBdXSk7CgkJCXNlc3Npb25TdG9yYWdlLnNldEl0ZW0oc2Vzc2lvbkZvb3RlckJvdHRvbU5hbWUsIGRhdGFbc3BlY2lhbFRhZ1sxXV0pOwoJCX0pOwoKCQlmdW5jdGlvbiBiaW5kTmF2aWdhdGlvbkV2ZW50cygpIHsKCQkJLy9QcmV2ZW50IGFuY2hvciB0YWcgZnJvbSBmaXJpbmcgd2hlbiBocmVmIGlzIHNldCB0byAjIG9uIG1vYmlsZQoJCQkkKCcuZm9vdGVyLXRvcC1zZWN0aW9uJykub24oJ2NsaWNrJywgJ2FbaHJlZj0jXScsIGZ1bmN0aW9uIChlKSB7CgkJCQlpZiAoJCgnaHRtbCcpLndpZHRoKCkgPCA3NjgpIHsKCQkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCQl9CgkJCX0pOwoKCQkJLy9Jc3N1ZSB3aXRoIGlQYWQgQ2hyb21lIHdoZXJlIGxpbmtzIGNvdWxkbid0IGJlIGNsaWNrZWQuCgkJCS8vUmVhc29uIHdhcyBmb3IgU2l0ZUNhdGFseXN0IGluamVjdGluZyBvbmNsaWNrIGF0dHJpYnV0ZSB0byBhbGwgYW5jaG9yIHRhZy4KCQkJJCgnZm9vdGVyJykub24oJ2NsaWNrJywgJ2EnLCBmdW5jdGlvbiAoZSkgewoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCQkJCS8vYWRkZWQgdGhpcyBjb25kaXRpb24gdG8gb3BlbiBsaW5rcyBpbiBhIG5ldyB0YWIgd2hlbiBuZWVkZWQKCQkJCWlmICgkKHRoaXMpLmF0dHIoJ3RhcmdldCcpICE9IHVuZGVmaW5lZCAmJiAkKHRoaXMpLmF0dHIoJ3RhcmdldCcpID09ICdfYmxhbmsnKSB7CgkJCQkJd2luZG93Lm9wZW4oJCh0aGlzKS5hdHRyKCdocmVmJykpOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJbG9jYXRpb24uaHJlZiA9ICQodGhpcykuYXR0cignaHJlZicpOwoJCQkJfQoJCQl9KTsKCgkJCS8vVG8gb3BlbiBhbmQgY2xvc2UgZm9vdGVyIG9uIE1vYmlsZQoJCQkkKCdib2R5Jykub24oJ2NsaWNrJywgJy5tZW51LWxpbmtzID4gLnN1YkxpbmtzID4gc3BhbicsIGZ1bmN0aW9uIChlKSB7CgkJCQkvL0FkZCBmdW5jdGlvbmFsaXR5IGZvciB3aGVuIHVzZXIgdXNlcyB0b3VjaCBvbiBuYXZpZ2F0aW9uL2Zvb3Rlci4KCgkJCQlpZiAoJCh0aGlzKS5wYXJlbnRzKCcjZm9vdGVyJykubGVuZ3RoICYmIHBhZ2VXaWR0aCA+PSA3NjgpIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCgkJCQl2YXIgZWxlbSA9ICQodGhpcykucGFyZW50KCk7CgoJCQkJLy9SZW1vdmUgYWxsICJvcGVuIiBjbGFzcyB0aGF0IGlzIGEgc2libGluZyB0byB0aGUgY3VycmVudGx5IHRvdWNoZWQgZWxlbWVudC4KCQkJCWVsZW0uc2libGluZ3MoKQoJCQkJCS5maW5kKCcub3BlbicpLnJlbW92ZUNsYXNzKCdvcGVuJykuZW5kKCkKCQkJCQkucmVtb3ZlQ2xhc3MoJ29wZW4nKTsKCgkJCQlpZiAoZWxlbS5oYXNDbGFzcygnb3BlbicpKSB7CgkJCQkJLy9SZW1vdmUgYWxsICJvcGVuIiBjbGFzcyBpbnNpZGUgb2YgdGhlIGN1cnJlbnRseSB0b3VjaGVkIGVsZW1lbnQuCgkJCQkJZWxlbS5maW5kKCcub3BlbicpLnJlbW92ZUNsYXNzKCdvcGVuJykuZW5kKCkucmVtb3ZlQ2xhc3MoJ29wZW4nKTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWVsZW0uYWRkQ2xhc3MoJ29wZW4nKTsKCgkJCQkJLy9maXggZm9yIHNvbmljd2FsbCBoZWlnaHQKCQkJCQkkKCdib2R5JykudHJpZ2dlcignc3VibmF2LnZpc2libGUnKTsKCgkJCQkJaWYgKHBhZ2VUeXBlID09IDApIHsgLy9Nb2JpbGUKCQkJCQkJLy9BbmltYXRlIGJhY2tncm91bmQgY29sb3IgdG8gbm90aWZ5IHVzZXIgdGhhdCB0aGV5IGhhdmUgdG91Y2hlZCB0aGF0IGVsZW1lbnQuCgkJCQkJCS8vUmVxdWlyZTogalF1ZXJ5IENvbG9yIHYyLjEuMiBwbHVnaW4KCQkJCQkJZWxlbS5jc3Moe2JhY2tncm91bmRDb2xvcjogJyNmYjRmMTQnLCBjb2xvcjogJyNmZmZmZmYnfSk7CgkJCQkJCSQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtzY3JvbGxUb3A6ICQodGhpcykub2Zmc2V0KCkudG9wfSwgZnVuY3Rpb24gKCkgewoJCQkJCQkJZWxlbS5jc3MoJ2NvbG9yJywgJyMzMzMzMzMnKTsKCQkJCQkJCWVsZW0uYW5pbWF0ZSh7YmFja2dyb3VuZENvbG9yOiAiI2VlZSJ9LCA1MDAsIGZ1bmN0aW9uICgpIHsKCQkJCQkJCQllbGVtLmNzcygnYmFja2dyb3VuZENvbG9yJywgJycpOwoJCQkJCQkJfSk7CgkJCQkJCX0pOwoJCQkJCX0KCQkJCX0KCQkJfSk7CgoJCQkvKiBDb3VudHJ5IERyb3Bkb3duICovCgkJCSQoJyNjdXJyZW50LWNvdW50cnknKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkgewoJCQkJaWYgKHBhZ2VXaWR0aCA+IDc2NykgewoJCQkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7CgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCS8vJCgnI2NvdW50cnktcG9wdXAnKS50b2dnbGUoKTsKCQkJCQkkKHRoaXMpLnBhcmVudHMoJ2xpJykudG9nZ2xlQ2xhc3MoJ29wZW4nKTsKCQkJCX0KCQkJfSk7CgkJfQoJfQoKCWZ1bmN0aW9uIGdldExvY2FsaXplZENvbnRlbnQodGFncykgewoJCS8vSG93IHRvIGNhbGw6IGdldExvY2FsaXplZENvbnRlbnQoJ1JlZ1dhcm5pbmdNZXNzYWdlRW1haWxSZXF1aXJlZCcpLmRvbmUoZnVuY3Rpb24oZGF0YSkgeyBjb25zb2xlLmxvZyhkYXRhKTsgfSk7CgkJdmFyIHJldHVyblZhbHVlID0ge30sIG5ld1RhZ3MgPSBbXSwgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7CgoJCWlmICh0eXBlb2YgdGFncyA9PSAnc3RyaW5nJykgewoJCQlpZiAobG9jYWxpemVkQ29udGVudFt0YWdzXSkgewoJCQkJcmV0dXJuIGxvY2FsaXplZENvbnRlbnRbdGFnc107CgkJCX0KCQkJZWxzZSB7CgkJCQluZXdUYWdzLnB1c2godGFncyk7CgkJCX0KCQl9CgkJZWxzZSB7CgkJCSQuZWFjaCh0YWdzLCBmdW5jdGlvbiAoaSwgdGFnKSB7CgkJCQlpZiAobG9jYWxpemVkQ29udGVudFt0YWddKSB7CgkJCQkJcmV0dXJuVmFsdWVbdGFnXSA9IGxvY2FsaXplZENvbnRlbnRbdGFnXTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCW5ld1RhZ3MucHVzaCh0YWcpOwoJCQkJfQoJCQl9KTsKCQl9CgoJCWlmIChuZXdUYWdzLmxlbmd0aCkgewoJCQkkLmFqYXgoewoJCQkJdXJsOiAoKCh0eXBlb2YgUm9vdFBhdGggPT0gJ3VuZGVmaW5lZCcgfHwgUm9vdFBhdGggPT0gJy8nKSA/ICcnIDogUm9vdFBhdGgpICsgJy9qc29ucmVxL2V2ZW50LycpLnJlcGxhY2UoJy8vJywgJy8nKSwKCQkJCXR5cGU6ICdQT1NUJywKCQkJCWRhdGFUeXBlOiAnSlNPTicsCgkJCQlkYXRhOiB7CgkJCQkJdHlwZTogJ2xvY2FsaXplZCB0YWdzJywKCQkJCQl0YWdzOiBuZXdUYWdzLmpvaW4oJywnKQoJCQkJfQoJCQl9KS5kb25lKGZ1bmN0aW9uIChkYXRhKSB7CgkJCQkkLmVhY2goZGF0YS5kYXRhLCBmdW5jdGlvbiAoaSwgb2JqKSB7CgkJCQkJcmV0dXJuVmFsdWVbb2JqLmlkXSA9IG9iai52YWx1ZTsKCQkJCQlsb2NhbGl6ZWRDb250ZW50W29iai5pZF0gPSBvYmoudmFsdWU7CgkJCQl9KTsKCgkJCQlkZWZlcnJlZC5yZXNvbHZlKHJldHVyblZhbHVlKTsKCQkJfSk7CgkJfQoJCWVsc2UgewoJCQlkZWZlcnJlZC5yZXNvbHZlKHJldHVyblZhbHVlKTsKCQl9CgoJCXJldHVybiBkZWZlcnJlZDsKCX0KCglmdW5jdGlvbiBiZ0FuaW1hdGUodGFyZ2V0KSB7CgkJdmFyIGVsbSA9ICQodGFyZ2V0KTsKCgkJZWxtLmNzcyh7YmFja2dyb3VuZENvbG9yOiAnI2ZiNGYxNCcsIGNvbG9yOiAnI2ZmZmZmZid9KTsKCQllbG0uYW5pbWF0ZSh7YmFja2dyb3VuZENvbG9yOiAnI2VlZWVlZScsIGNvbG9yOiAnIzMzMzMzMyd9LCA1MDAsIGZ1bmN0aW9uICgpIHsKCQkJZWxtLmNzcyh7CgkJCQknYmFja2dyb3VuZENvbG9yJzogJycsCgkJCQknY29sb3InOiAnJwoJCQl9KTsKCQl9KTsKCX0KCglmdW5jdGlvbiBnZXRQYWdlUHJvcGVydGllcygpIHsKCQkvL1dvcmthcm91bmQgZm9yIEdvb2dsZSBDaHJvbWUuIFRoZSB2ZXJ0aWNhbCBzY3JvbGxiYXIgaXMgbm90IGluY2x1ZGVkIGluIGRldGVybWluaW5nIHRoZSB3aWR0aCBvZiB0aGUgZGV2aWNlLgoJCSQoJ2JvZHknKS5jc3MoJ292ZXJmbG93JywgJ2hpZGRlbicpOwoJCXZhciB3ID0gJCgnaHRtbCcpLndpZHRoKCk7CgoJCSQoJ2JvZHknKS5jc3MoJ292ZXJmbG93JywgJycpOwoKCQkvL0RlZmluZSBwYWdlVHlwZQoJCWlmICh3ID49IDEyMDApIHsKCQkJcGFnZVR5cGUgPSAzOwoJCX0KCQllbHNlIGlmICh3ID49IDk5MikgewoJCQlwYWdlVHlwZSA9IDI7CgkJfQoJCWVsc2UgaWYgKHcgPj0gNzY4KSB7CgkJCXBhZ2VUeXBlID0gMTsKCQl9CgkJZWxzZSB7CgkJCXBhZ2VUeXBlID0gMDsKCQl9CgoJCXJldHVybiB3OwoJfQoKCWZ1bmN0aW9uIHByb2Nlc3NIZWFkZXJGb290ZXIoKSB7CgkJJCgnYm9keScpCgkJCS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkgewoJCQkJLy9DbG9zaW5nIHRvcCBzZWFyY2ggd2hlbiBjbGljayBvbiBib2R5CgkJCQlpZiAoJCgnLm9wZW4tc2VhcmNoJykubGVuZ3RoKSB7CgkJCQkJaWYgKCEkKGUudGFyZ2V0KS5pcygnLnNlYXJjaC1jb250YWluZXIgKiwgLnNlYXJjaC1jb250YWluZXIsIC5zZWFyY2gtYnV0dG9uLCAuc2VhcmNoLWJ1dHRvbiAqJykpIHsKCQkJCQkJJCgnLm9wZW4tc2VhcmNoJykucmVtb3ZlQ2xhc3MoJ29wZW4tc2VhcmNoJyk7CgkJCQkJfQoJCQkJfQoKCQkJCXZhciBjb3VudHJ5U2VsZWN0b3JFbGVtID0gJCgnI2NvdW50cnktc2VsZWN0b3InKTsKCgkJCQlpZiAoY291bnRyeVNlbGVjdG9yRWxlbS5oYXNDbGFzcygnb3BlbicpKSB7CgkJCQkJY291bnRyeVNlbGVjdG9yRWxlbS5yZW1vdmVDbGFzcygnb3BlbicpOwoJCQkJfQoJCQl9KQoJCQkub24oJ2NsaWNrJywgJy5uYXZiYXItdG9nZ2xlJywgZnVuY3Rpb24gKGUpIHsKCQkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7CgoJCQkJLy9IYW1idXJnZXIgLSBNb2JpbGUKCQkJCS8vT3BlbiAmIENsb3NlIHNsaWRlIG91dCBuYXZpZ2F0aW9uLgoJCQkJaWYgKHBhZ2VUeXBlIDwgMykgewoJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQkkKCdodG1sJykudG9nZ2xlQ2xhc3MoJ29wZW5OYXYnKTsKCQkJCQkkKCcudXRpbGl0eScpLmZpbmQoJz4gbGknKS5yZW1vdmVDbGFzcygnb3BlbicpOwoJCQkJfQoJCQl9KTsKCX0KCn0oalF1ZXJ5LCB3aW5kb3cpKTs=</file>
		</files>
	</scriptedContentFragment>
</scriptedContentFragments>