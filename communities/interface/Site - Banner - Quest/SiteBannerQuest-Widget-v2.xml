<scriptedContentFragments>
	<scriptedContentFragment name="${resource:SiteBanner} - Quest" version="9.2.0.1667" description="${resource:SiteBannerDescription}" instanceIdentifier="b8476577f75348f294c9a2e161119e5d" theme="" isCacheable="true" varyCacheByUser="true" showHeaderByDefault="false" cssClass="site-banner">
		<contentScript><![CDATA[#set ($links = $core_v2_page.ParseQueryString($core_v2_widget.GetCustomValue('links','Link=Notifications&amp;Link=Inbox&amp;Link=Bookmarks&amp;Link=User')))
#set ($hasLinks = false)

#set ($user = $core_v2_user.Accessing)
#set ($isRegistered = $core_v2_user.IsRegistered($user.Id))
#set ($isImpersonated = $core_v2_authentication.IsImpersonated())
#set ($impersonator = $core_v2_authentication.Impersonator())

#set ($listTemplate = 'site-banner-list-template')
#set ($notificationPreferenceTemplate = 'site-banner-notification-preferences-template')
#set ($bookmarkFilterTemplate = 'site-banner-bookmark-filter-template')
#set ($notificationFilterTemplate = 'site-banner-notification-filter-template')
#set ($userTemplate = 'site-banner-user-template')
#set ($searchFilterTemplate = 'site-banner-search-filter-template')
#set ($notificationsUnread = 0)
#set ($conversationsUnread = 0)
#set ($includeJavascript = false)
#set ($isBookmarked = false)
#set ($currentContentId = '')

#set ($currentContent = false)
#set ($currentContent = $core_v2_content.Current)
#set ($currentApplication = false)
#set ($currentApplication = $core_v2_application.Current)
#set ($currentGroup = false)
#set ($currentGroup = $core_v2_group.Current)
#set ($rootGroup = false)
#set ($rootGroup = $core_v2_group.Root)
#if ($rootGroup.Id == $currentGroup.Id)
	#set ($currentGroup = false)
#end

#set($siteSearch = $core_v2_widget.GetCustomValue('siteSearch', ''))
#set($useQuestFooter = $core_v2_widget.GetCustomValue('useQuestFooter', ''))
#set($siteBrand = $core_v2_widget.GetCustomValue('siteBrand', 'dsg'))
#set($navHTML = $core_v2_ui.Render($core_v2_widget.GetHtmlValue('navHTML','')))

## mark any unread notifications for the current piece of content as read
#if ($currentContent && $isRegistered)

	## detect if current content is actually an application
	#set ($isApplication = false)
	#set ($application = $currentContent.Application)
	#if (!$application || $application.ApplicationId == $currentContent.ContentId)
		#set ($isApplication = true)
	#end

	#if (!$isApplication)
		## load and mark as read any unread notifications for this content
		#set ($unreadContentNotifications = $core_v2_notification.List("%{ ContentId = $currentContent.ContentId, ContentTypeId = $currentContent.ContentTypeId, IsRead = 'false' }"))
		#foreach ($unreadNotification in $unreadContentNotifications)
			#set ($updatedNotification = $core_v2_notification.Update($unreadNotification.NotificationId, "%{ MarkAsRead = 'true' }"))
		#end

		## Forum Reply Notifications are generally made against Forum Threads, not Replies. So also, mark any notifications for their parent threads, explicitly.
		#if ($currentContent.ContentTypeId == $core_v2_forumReply.ContentTypeId)
			#set ($forumReply = $core_v2_forumReply.Get($currentContent.ContentId))
			#if ($forumReply)
				#set ($forumThread = $core_v2_forumThread.Get($forumReply.ThreadId))
				#if ($forumThread)
					## load and mark as read any unread notifications for this forum thread
					#set ($unreadContentNotifications = $core_v2_notification.List("%{ ContentId = $forumThread.ContentId, ContentTypeId = $forumThread.forumThreadContentTypeId, IsRead = 'false' }"))
					#foreach ($unreadNotification in $unreadContentNotifications)
						#set ($updatedNotification = $core_v2_notification.Update($unreadNotification.NotificationId, "%{ MarkAsRead = 'true' }"))
					#end
				#end
			#end
		#end
	#end

#end

## site navigation
#set ($hasSiteNavigation = false)
#set ($siteNavigationUrl = '')
#set ($siteNavigationType = $core_v2_widget.GetStringValue('siteNavigation', 'exclude'))

#set ($searchId = $core_v2_widget.UniqueId('Search'))
#set ($bannerId = $core_v2_widget.UniqueId('banner'))
#set ($searchFieldsId = $core_v2_widget.UniqueId('searchFields'))
#set ($bannerSiteLinksId = $core_v2_widget.UniqueId('bannerSiteLinks'))
#set ($bannerUserLinksId = $core_v2_widget.UniqueId('bannerLinks'))
#set ($handheldSearchFieldsId = $core_v2_widget.UniqueId('handheldSearchFields'))
#set ($handheldBannerUserLinksId = $core_v2_widget.UniqueId('handheldBannerLinks'))
#set ($handheldSearchFieldsLinkId = $core_v2_widget.UniqueId('handheldSearchFieldsLink'))
#set ($handheldSiteNavigationLinkId = $core_v2_widget.UniqueId('handheldSiteNavigationLink'))
#set ($handheldBannerUserLinksLinkId = $core_v2_widget.UniqueId('handheldBannerLinksLink'))
#set ($handheldBannerUserLinksCountId = $core_v2_widget.UniqueId('handheldBannerLinksCount'))
#set ($handheldSiteLinksLinkId = $core_v2_widget.UniqueId('handheldSiteLinksLink'))
#set ($handheldSiteLinksId = $core_v2_widget.UniqueId('handheldSiteLinks'))
#set ($utilityDropdown = $core_v2_widget.UniqueId('utilityDropdown'))

#set ($currentSeachQuery = '')
#set ($currentSeachQuery = $core_v2_encoding.HtmlEncode($core_v2_page.GetQueryStringValue('q')))

<header class="masthead" id="$core_v2_encoding.HtmlAttributeEncode($bannerId)">
	<nav class="navbar" role="navigation">
		<div class="utility-section-wrapper">
			<div class="utility-section">
				<div class="navbar-brand">
					<a href="/">
					    #if ($siteBrand == "quest")
						<img src="/images/shared/quest-logo.png">
						#elseif ($siteBrand == "dsg")
						<img src="/images/shared/logo-blue.png">
						#end
					</a>
				</div>

				<div id="$core_v2_encoding.HtmlAttributeEncode($searchFieldsId)" class="search-container">
					<div>
						<input class="search-query form-control" autocomplete="off" type="search" placeholder="$core_v2_encoding.HtmlAttributeEncode($core_v2_language.GetResource('Search'))" id="$core_v2_encoding.HtmlAttributeEncode($searchId)" value="$!currentSeachQuery" />
						<button class="btn">
							<i class="glyphicon glyphicon-search"></i>
						</button>
					</div>
					<div class="autocomplete"></div>
				</div>

				<div class="nav-container">
			    #if ($siteNavigationType == "quest")
			    <div class="main-nav-section" data-ajax="true">
			        <div class="shadow-overlay-left"></div>
			    </div>
			    #elseif ($siteNavigationType == "custom")
			    <div class="main-nav-section">
					<div class="shadow-overlay-left"></div>
						$navHTML
					</div>
				  #end
				</div>

				<ul class="utility desktop" id="$core_v2_encoding.HtmlAttributeEncode($bannerUserLinksId)">
					<li class="dropdown mobile-search-button search-button">
						<a href="#">
							<span class="top-search-icon"><i class="glyphicon glyphicon-search"></i></span>
						</a>
					</li>
            #set ($bannerLinks = $links.Values('Link'))
            #foreach($link in $bannerLinks)
            #beforeall
            #each
              #set($url = false)
              #if($link == 'Bookmarks' && $isRegistered)
                <li class="mobile">
                  <a href="#" class="bookmarks" id="$core_v2_widget.UniqueId('bookmarks')" title="$core_v2_encoding.HtmlAttributeEncode($core_v2_language.GetResource('Bookmarks'))">$core_v2_language.GetResource('Bookmarks')</a>
                </li>
                #set ($hasLinks = true)

                ## build dynamic lists of all content types, application types, and container types for filtering
                #set ($allContentTypes = $core_v2_contentType.List())
                #set ($contentTypes = "")
                #set ($applicationContentTypes = "")
                #set ($containerContentTypes = "")
                #foreach ($type in $allContentTypes)
                  #if ($core_v2_bookmark.SupportsBookmarks($type.Id))
                    #set ($containerType = false)
                    #set ($containerType = $core_v2_containerType.Get($type.Id))
                    #if ($containerType && $containerType.Id)
                      #set ($containerContentTypes = "${containerContentTypes}${type.Id}:${type.Name},")
                    #else
                      #set ($applicationType = false)
                      #set ($applicationType = $core_v2_applicationType.Get($type.Id))
                      #if ($applicationType && $applicationType.Id)
                        #set ($applicationContentTypes = "${applicationContentTypes}${type.Id},")
                      #else
                        #set ($contentTypes = "${contentTypes}${type.Id},")
                      #end
                    #end
                  #end
                #end

              #elseif($link == 'Notifications' && $isRegistered)
                <li class="mobile">
                  <a href="#" class="notifications" id="$core_v2_widget.UniqueId('notifications')">$core_v2_language.GetResource('Notifications')</a>
                </li>
                #set ($hasLinks = true)
                #set ($options = "%{ IsRead = 'False', PageSize = 1 }")
                #set ($conversationMessageNotificationFilterName = "_Filters_${core_v2_conversationMessage.NotificationTypeId}")
                $options.Add($conversationMessageNotificationFilterName, 'Exclude')
                #set ($notificationsUnread = $core_v2_notification.List($options).TotalCount)

              #elseif($link == 'User')
                #set ( $avatarAnonymousCheck = '/anonymous\.gif/')
                #set ( $avatarAnonymousCheck = $avatarAnonymousCheck.matches($user.AvatarUrl))
                #if ($isRegistered)
                  <li class="mobile">
                    <a href="#" class="internal-link user" id="$core_v2_encoding.HtmlAttributeEncode($core_v2_widget.UniqueId('user'))" title="$core_v2_encoding.HtmlAttributeEncode($core_v2_user.Accessing.DisplayName)">
                    #if($avatarAnonymousCheck)
                      <span class="glyphicon glyphicon-user"><span class="badge"><i class="glyphicon glyphicon-ok"></i></span></span>
                    #else
	                    $core_v2_ui.GetResizedImageHtml($user.AvatarUrl, 20, 20, "%{ ResizeMethod = 'ZoomAndCrop' }")
                    #end
                    </a>
                  </li>
                  #set($hasLinks = true)
                #else
                  #set($url = $core_v2_urls.Login())
                  #if ($url)
                    <li class="mobile">
                      <a href="$core_v2_encoding.HtmlAttributeEncode($url)" class="internal-link user with-icon" title="$core_v2_encoding.HtmlAttributeEncode($core_v2_language.GetResource('JoinSignIn'))">
                          <span class="glyphicon glyphicon-user"></span>
                      </a>
                    </li>
                    #set($hasLinks = true)
                  #end
                #end
              #elseif($link == 'Inbox' && $isRegistered)
                #set($url = $core_v2_urls.Conversations())
                #if ($url)
                  #set($conversationsUnread = $core_v2_conversation.UnreadCount())
                  <li class="mobile">
                    <a href="#" class="conversations" id="$core_v2_widget.UniqueId('conversations')">$core_v2_language.GetResource('Conversations_Inbox')</a>
                  </li>
                  #set($hasLinks = true)
                #end
              #end
            #afterall
            #end
				</ul>

				<ul class="utility mobile">
					<li class="dropdown mobile-search-button search-button">
            <a href="#">
              <span class="top-search-icon"><i class="glyphicon glyphicon-search"></i></span>
            </a>
          </li>
          #if ($isRegistered)
            <li>
              <a href="#" class="user logged-in" id="$core_v2_encoding.HtmlAttributeEncode($handheldBannerUserLinksLinkId)">
                  $core_v2_language.GetResource('user')
              </a>
              <a href="#" class="popup-list-count" id="$core_v2_encoding.HtmlAttributeEncode($handheldBannerUserLinksCountId)"></a>
            </li>
          #else
            #set($url = $core_v2_urls.Login())
            #if ($url)
            <li>
              <a href="$core_v2_encoding.HtmlAttributeEncode($url)" class="user">
                <span class="glyphicon glyphicon-user"></span>
              </a>
            </li>
            #end
          #end
					<li class="hamburger">
            <a href="#" class="navbar-toggle" data-toggle="site-menu">
              <span class="glyphicon glyphicon-menu-hamburger"></span>
            </a>
          </li>
				</ul>

				<div class="utility-dropdown mobile" id="$core_v2_encoding.HtmlAttributeEncode($utilityDropdown)">
          <div class="user-links" style="display:none" id="$core_v2_encoding.HtmlAttributeEncode($handheldBannerUserLinksId)">
						<ul class="utility"></ul>
          </div>
        </div>

			</div>
		</div>
	</nav>
</header>

#registerEndOfPageHtml('telligent.evolution.widgets.siteBanner')


	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($notificationPreferenceTemplate)">
		<div class="notification-preference">
			<span class="description">$core_v2_language.GetResource('TurnOffQuestion') <strong><%: notificationTypeName %></strong>$core_v2_language.GetResource('TurnOffQuestionSuffix')</span>
			<a href="#" class="confirm internal-link button submit-button" data-notificationtypeid="<%: notificationTypeId %>">$core_v2_language.GetResource('TurnOff')</a>
			<a href="#" class="cancel internal-link button submit-button">$core_v2_language.GetResource('Cancel')</a>
		</div>
	</script>


	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($listTemplate)">
		<div>
			<div class="multiple-column-list columns-1">
				<div class="multiple-column-item column-1">
					<ul class="content-list content">
					</ul>
					<div class="loading">$core_v2_language.GetResource('loading')</div>
					<% if(footerContent) { %>
						<div class="content-list-footer">
							<%= footerContent %>
						</div>
					<% } %>
				</div>
			</div>
		</div>
	</script>


	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($bookmarkFilterTemplate)">
		<ul class="navigation-list filter">
			<% if(contentTypeIds && contentTypeIds.length > 0) { %>
				<li class="navigation-item conversations">
					<a class="internal-link" href="#" data-contenttypeids="<%: contentTypeIds %>">$core_v2_language.GetResource('Bookmark_Filter_Content')</a>
				</li>
			<% } %>
			<% if(applicationContentTypeIds && applicationContentTypeIds.length > 0) { %>
				<li class="navigation-item conversations">
					<a class="internal-link" href="#" data-contenttypeids="<%: applicationContentTypeIds %>">$core_v2_language.GetResource('Bookmark_Filter_Application')</a>
				</li>
			<% } %>
			<% if(containerTypes && containerTypes.length > 0) { %>
				<% foreach(containerTypes, function(containerType) {  %>
					<li class="navigation-item conversations">
						<a class="internal-link" href="#" data-contenttypeids="<%: containerType.id %>"><%: containerType.name %></a>
					</li>
				<% }); %>
			<% } %>
		</ul>
	</script>

	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($notificationFilterTemplate)">
		<ul class="navigation-list filter">
			<li class="navigation-item all">
				<a class="internal-link" href="#" data-filter="all">$core_v2_language.GetResource('Notification_Filter_All')</a>
			</li>
			<li class="navigation-item unread">
				<a class="internal-link" href="#" data-filter="unread">$core_v2_language.GetResource('Notification_Filter_Unread')</a>
			</li>
		</ul>
	</script>

	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($searchFilterTemplate)">
		<% if(places && places.length > 0) { %>
			<ul class="navigation-list filter">
				<% foreach(places, function(place) { %>
					<li class="navigation-item">
						<a class="place internal-link" href="#" data-key="<%: place.key %>" data-value="<%: place.value %>" data-searchparam="<%: place.searchParameter %>" data-searchvalue="<%: place.searchValue %>"><%= place.name %></a>
				<% }); %>
			</ul>
		<% } %>

		<% if(filters && filters.length > 0) { %>
			<ul class="navigation-list filter">
			<% foreach(filters, function(filter) {  %>
				<li class="navigation-item">
					<a class="type internal-link" href="#" data-key="<%: filter.key %>"><%= filter.name %></a>
				</li>
			<% }); %>
			</ul>
		<% } %>
	</script>

	<script type="text/html" id="$core_v2_encoding.HtmlAttributeEncode($userTemplate)">
		<div class="user">
			<div class="avatar">
				<a href="$core_v2_encoding.HtmlAttributeEncode($user.ProfileUrl)">
					$core_v2_ui.GetResizedImageHtml($user.AvatarUrl, 40, 40, "%{ ResizeMethod = 'ZoomAndCrop' }")
				</a>
			</div>
			<span class="user-name">
				<a href="$core_v2_encoding.HtmlAttributeEncode($user.ProfileUrl)">$core_v2_encoding.JavascriptEncode($user.DisplayName)</a>
			</span>

			#set($authType = false)
			#set($authType = $core_v2_authentication.GetLastLoginType())
			#if ($authType && $authType != '')
				#set($oathProvider = false)
				#set($oathProvider = $core_v2_authentication.GetOAuthProvider($authType))
				#if ($oathProvider)
					<span class="oauth-provider">
						$core_v2_ui.GetResizedImageHtml($oathProvider.IconUrl, 18, 18, "%{ border='0', alt = $oathProvider.ClientName, class = 'ui-tip', ResizeMethod = 'ZoomAndCrop' }")
					</span>
				#end
			#end
		</div>

		#set($hasUserLinks = true)
		#set ($userLinks = $links.Values('Link'))
		#foreach($link in $userLinks)
		#beforeall
			<ul class="navigation-list user">
		#each
			#if($link == 'UserInformation')
				#set($url = false)
				#set($url = $user.ProfileUrl)
				#if ($url)
					<li class="navigation-list-item">
						<a href="$core_v2_encoding.HtmlAttributeEncode($user.ProfileUrl)">$core_v2_language.GetResource('Links_User_Profile')</a>
					</li>
					#set($hasUserLinks = true)
				#end
			#elseif($link == 'Settings')
				#set($url = false)
				#set($url = $core_v2_urls.Settings())
				#if ($url)
					<li class="navigation-list-item">
						<a href="$core_v2_encoding.HtmlAttributeEncode($url)">$core_v2_language.GetResource('Links_User_Settings')</a>
					</li>
					#set($hasUserLinks = true)
				#end
			#elseif($link == 'Invite')
				#set($url = false)
				#set($url = $core_v2_urls.Invite())
				#if ($url)
					<li class="navigation-list-item">
						<a href="$core_v2_encoding.HtmlAttributeEncode($url)">$core_v2_language.GetResource('Links_User_Invite')</a>
					</li>
					#set($hasUserLinks = true)
				#end
			#elseif($link == 'SignOut')
				#set($url = false)
				#set($url = $core_v2_urls.LogOut())
				#if ($url)
					<li class="navigation-list-item logout">
						<a href="$core_v2_encoding.HtmlAttributeEncode($url)" class="internal-link logout">
							#if($isImpersonated)$core_v2_language.GetResource('StopImpersonating')#else$core_v2_language.GetResource('Links_User_Logout')#end
						</a>
					</li>
					#set($hasUserLinks = true)
				#end
			#end
		#afterall
			</ul>
		#end
	</script>


	<script type="text/javascript" src="$core_v2_encoding.HtmlAttributeEncode($core_v2_widget.GetFileUrl('ui.js'))"></script>
#end
#registerEndOfPageHtml()
	<script type="text/javascript">
		#set($DQ = '"')

		#set($conversationListFooterContent = "<a href=${DQ}${core_v2_urls.Conversations()}${DQ} class=${DQ}left${DQ}>$core_v2_language.GetResource('Conversations_More')</a><a href=${DQ}#${DQ} data-messagename=${DQ}widget.${core_v2_widget.WrapperElementId}.startconversation${DQ} class=${DQ}right${DQ}>$core_v2_language.GetResource('Conversation_Send')</a>")


		#set($notificationSettingsUrl = $core_v2_urls.Settings())
		#set($notificationListFooterContent = "<a href=${DQ}#${DQ} class=${DQ}mark-read left${DQ} #if ($notificationsUnread == 0) style=${DQ}display:none${DQ} #end>$core_v2_language.GetResource('Notifications_Mark')</a><a class=${DQ}right${DQ} href=${DQ}${notificationSettingsUrl}${DQ}>$core_v2_language.GetResource('Links_User_Settings')</a>")

		#set($bookmarksUrl = $core_v2_urls.Favorites($core_v2_user.Accessing.Id))
		#set($bookmarksListFooterContent = "<a class=${DQ}left${DQ} href=${DQ}${bookmarksUrl}${DQ}>$core_v2_language.GetResource('Bookmarks_More')</a>")
		## possibly show bookmark/unbookmark link
		#if ($isRegistered && $currentContent && $user && $currentContent.ContentId != $user.ContentId)
			#set ($currentContentBookmark = $core_v2_bookmark.Get($currentContent.ContentId))
			#if ($currentContentBookmark)
				#set ($isBookmarked = true)
			#end
			#set ($currentContentId = $currentContent.ContentId)
			#set ($bookmarkComponent = $core_v2_ui.Bookmark($currentContent.ContentId, $currentContent.ContentTypeId, "%{ CssClass = 'right' }"))
			#set ($bookmarksListFooterContent = "${bookmarksListFooterContent}${bookmarkComponent}")
		#end

		#set($searchListFooterContent = "<a data-messagename=${DQ}widget.${core_v2_widget.WrapperElementId}.advancedsearch${DQ} id=${DQ}$core_v2_widget.UniqueId('advancedsearch')${DQ} href=${DQ}#${DQ}>$core_v2_language.GetResource('Advanced_Search')</a>")

		jQuery(function(){
			jQuery.telligent.evolution.widgets.siteBanner.register({
				wrapper: '#$core_v2_widget.WrapperElementId',

				messagePrefix: 'widget.${core_v2_widget.WrapperElementId}.',
				banner: jQuery('#$core_v2_encoding.JavascriptEncode($bannerId)'),

        useQuestFooter: '$core_v2_encoding.JavascriptEncode($useQuestFooter)',
				handheldSearchFieldsLink: jQuery('#$core_v2_encoding.JavascriptEncode($handheldSearchFieldsLinkId)'),
				handheldSearchFields: jQuery('#$core_v2_encoding.JavascriptEncode($searchFieldsId)'),
				handheldBannerLinksLink: jQuery('#$core_v2_encoding.JavascriptEncode($handheldBannerUserLinksLinkId)'),
				handheldBannerLinks: jQuery('#$core_v2_encoding.JavascriptEncode($handheldBannerUserLinksId)'),
				searchFields: jQuery('#$core_v2_encoding.JavascriptEncode($searchFieldsId)'),

				utilityDropdown: jQuery('#$core_v2_encoding.JavascriptEncode($utilityDropdown)'),

				bannerLinks: jQuery('#$core_v2_encoding.JavascriptEncode($bannerUserLinksId)'),
				handheldBannerLinksCount: jQuery('#$core_v2_encoding.JavascriptEncode($handheldBannerUserLinksCountId)'),
				bannerSiteLinks: jQuery('#$core_v2_encoding.JavascriptEncode($bannerSiteLinksId)'),
				handheldSiteLinksLink: jQuery('#$core_v2_encoding.JavascriptEncode($handheldSiteLinksLinkId)'),
				handheldSiteLinks: jQuery('#$core_v2_encoding.JavascriptEncode($handheldSiteLinksId)'),

				notificationsTemplate: '$core_v2_encoding.JavascriptEncode($listTemplate)',
				notificationsUrl: '$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('notifications.vm'))',
				notificationsLink: jQuery('#$core_v2_widget.UniqueId('notifications')'),
				notificationsUnread: $notificationsUnread,
				notificationListFooterContent: '$core_v2_encoding.JavascriptEncode($notificationListFooterContent)',
				notificationPreferenceTemplate: '$core_v2_encoding.JavascriptEncode($notificationPreferenceTemplate)',
				notificationssUnreadCountMessageSingular: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Notifications_UnreadCountMessageSingular'))',
				notificationssUnreadCountMessagePlural: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Notifications_UnreadCountMessagePlural'))',
				notificationsFilterTemplate: '$core_v2_encoding.JavascriptEncode($notificationFilterTemplate)',

				conversationsTemplate: '$core_v2_encoding.JavascriptEncode($listTemplate)',
				conversationsUrl: '$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('conversations.vm'))',
				conversationsLink: jQuery('#$core_v2_widget.UniqueId('conversations')'),
				conversationsUnread: $conversationsUnread,
				conversationNotificationTypeId: '$core_v2_conversationMessage.NotificationTypeId',
				conversationListFooterContent: '$core_v2_encoding.JavascriptEncode($conversationListFooterContent)',
				conversationsUnreadCountMessageSingular: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Conversations_UnreadCountMessageSingular'))',
				conversationsUnreadCountMessagePlural: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Conversations_UnreadCountMessagePlural'))',
				conversationNewConversationModalUrl: '$core_v2_encoding.JavascriptEncode($core_v2_urls.AddConversation())',

				bookmarksTemplate: '$core_v2_encoding.JavascriptEncode($listTemplate)',
				bookmarksUrl: '$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('bookmarks.vm'))',
				bookmarksLink: jQuery('#$core_v2_widget.UniqueId('bookmarks')'),
				bookmarksListFooterContent: '$core_v2_encoding.JavascriptEncode($bookmarksListFooterContent)',
				bookmarksContentTypes: '$core_v2_encoding.JavascriptEncode($contentTypes)',
				bookmarksApplicationContentTypes: '$core_v2_encoding.JavascriptEncode($applicationContentTypes)',
				bookmarksContainerContentTypes: '$core_v2_encoding.JavascriptEncode($containerContentTypes)',
				bookmarksFilterTemplate: '$core_v2_encoding.JavascriptEncode($bookmarkFilterTemplate)',
				bookmarksIsBookmarked: #if($isBookmarked) true #else false #end,
				bookmarksCurrentContentId: '$currentContentId',
				bookmarksBookmarks: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Bookmarks'))',
				bookmarkAdded: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Bookmark_Added'))',
				bookmarkRemoved: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Bookmark_Removed'))',

				userPopupTemplate: '$core_v2_encoding.JavascriptEncode($listTemplate)',
				userContentTemplate: '$core_v2_encoding.JavascriptEncode($userTemplate)',
				userLink: jQuery('#$core_v2_widget.UniqueId('user')'),

				searchType: '$siteSearch',
				#if ($siteSearch == "Default")
				searchTemplate: '$core_v2_encoding.JavascriptEncode($listTemplate)',
				searchUrl: '$core_v2_encoding.JavascriptEncode($core_v2_widget.GetExecutedFileUrl('search.vm'))',
				searchInput: jQuery('#$core_v2_encoding.JavascriptEncode($searchId)'),
				searchFooterContent: '$core_v2_encoding.JavascriptEncode($searchListFooterContent)',
				searchFilterTemplate: '$core_v2_encoding.JavascriptEncode($searchFilterTemplate)',
				searchAdvancedUrl: '$core_v2_encoding.JavascriptEncode($core_v2_urls.Search("%{ QueryString = '{0}' }"))',
				searchAdvancedUserUrl: '$core_v2_encoding.JavascriptEncode($core_v2_urls.UserList("%{ QueryString = '{0}' }"))',
				searchFilterContentName: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Search_Filter_Content'))',
				searchFilterGroupsName: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Search_Filter_Groups'))',
				searchFilterPeopleName: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Search_Filter_People'))',
				searchPlaceApplicationId: #if ($currentApplication) '$currentApplication.ApplicationId' #else null #end,
				searchPlaceApplicationName: #if ($currentApplication) '$core_v2_encoding.JavascriptEncode($core_v2_language.FormatString($core_v2_language.GetResource('Search_Filter_In'), $currentApplication.HtmlName('')))' #else null #end,
				searchPlaceGroupId: #if ($currentGroup) '$currentGroup.ContainerId' #else null #end,
        searchPlaceGroupLocalId: #if ($currentGroup) '$currentGroup.Id' #else null #end,
				searchPlaceGroupName: #if ($currentGroup) '$core_v2_encoding.JavascriptEncode($core_v2_language.FormatString($core_v2_language.GetResource('Search_Filter_In'), $currentGroup.Name))' #else null #end,
				searchPlaceAnywhereName: '$core_v2_encoding.JavascriptEncode($core_v2_language.GetResource('Search_Filter_Anywhere'))',
				advancedSearchId: '$core_v2_widget.UniqueId('advancedsearch')',
				searchShowPeople: #if($core_v2_nodePermission.Get('Site_ReadProfiles').IsAllowed) true#else false#end,
				#else
				searchInput: jQuery('#$core_v2_encoding.JavascriptEncode($searchId)'),
				#end

				siteNavigationType: '$core_v2_encoding.JavascriptEncode($siteNavigationType)'
			});
		});
	</script>
#end]]></contentScript>
		<headerScript><![CDATA[
$core_v2_widget.ApplyTokens($core_v2_widget.GetStringValue('fragmentHeader', '${resource:SiteBanner}'))
			]]></headerScript>
		<configuration><![CDATA[<propertyGroup id="options" resourceName="Options">
	<property id="fragmentHeader" resourceName="CF_Title" dataType="string" defaultValue="${resource:SiteBanner}" controlType="Telligent.Evolution.Controls.ContentFragmentTokenStringControl, Telligent.Evolution.Controls" />
	<property id="siteBrand" dataType="string" resourceName="Site_Brand" descriptionResourceName="Site_Brand_Description" defaultValue="exclude" controlType="Telligent.Evolution.Controls">
		<propertyValue value="dsg" resourceName="Site_Brand_DSG"/>
		<propertyValue value="quest" resourceName="Site_Brand_Quest"/>
	</property>
	<property id="siteSearch" dataType="string" resourceName="Site_Search" descriptionResourceName="Site_Search_Description" defaultValue="Default">
		<propertyValue value="Default" resourceName="Site_Search_Default"/>
		<propertyValue value="Quest" resourceName="Site_Search_Quest"/>
	</property>
	<property id="useQuestFooter" resourceName="CF_Quest_Footer" dataType="bool" defaultValue="false" />
	<property id="links" resourceName="Links" descriptionResourceName="Links_Description" dataType="custom" defaultValue="Link=Notifications&amp;Link=Inbox&amp;Link=Bookmarks&amp;Link=User&amp;Link=Invite&amp;Link=UserInformation&amp;Link=Settings&amp;Link=SignOut" controlType="Telligent.Evolution.Controls.SortableListControl, Telligent.Evolution.Controls" height="275" key="Link" >
		<propertyValue value="Notifications" resourceName="Links_Notifications" />
		<propertyValue value="Inbox" resourceName="Links_Inbox" />
		<propertyValue value="Bookmarks" resourceName="Links_Bookmarks" />
		<propertyValue value="User" resourceName="Links_User" />
		<propertyValue value="Invite" resourceName="Links_User_Invite" />
		<propertyValue value="Settings" resourceName="Links_User_Settings" />
		<propertyValue value="UserInformation" resourceName="Links_User_Profile" />
		<propertyValue value="SignOut" resourceName="Links_User_Logout" />
	</property>
</propertyGroup>
<propertyGroup id="group2" resourceName="NavigationTab">
    <property id="siteNavigation" dataType="string" resourceName="Site_Navigation" descriptionResourceName="Site_Navigation_Description" defaultValue="exclude" controlType="Telligent.Evolution.Controls.PropertyVisibilityValueSelectionControl, Telligent.Evolution.Controls">
		<propertyValue value="exclude" resourceName="Site_Navigation_Exclude" propertiesToHide="navHTML"/>
		<propertyValue value="custom" resourceName="Site_Navigation_Custom" propertiesToShow="navHTML"/>
		<propertyValue value="quest" resourceName="Site_Navigation_Quest" propertiesToHide="navHTML"/>
	</property>
	<property id="navHTML" resourceName="CF_Navigation_Content" dataType="html" controlType="Telligent.Evolution.Controls.HtmlEditorStringControl, Telligent.Evolution.Controls" width="100%" height="250px"/>
</propertyGroup>]]></configuration>
		<languageResources><language key="en-us">
  <resource name="SiteBanner">Site - Banner</resource>
  <resource name="SiteBannerDescription">Provides site-level navigation for users.</resource>
  <resource name="Options">Options</resource>
  <resource name="CF_Title">Widget Title</resource>
  <resource name="Site_Navigation">Site Navigation</resource>
  <resource name="Site_Navigation_Description">Optionally include group browsing or custom navigation alongside search and user links.</resource>
  <resource name="Site_Navigation_Exclude">Exclude</resource>
  <resource name="Site_Navigation_Group">Include Group Navigation</resource>
  <resource name="Site_Navigation_MyGroup">Include Accessing User's Group Navigation</resource>
  <resource name="Site_Navigation_Custom">Include Custom Navigation</resource>
  <resource name="Custom_Navigation">Custom Navigation Items</resource>
  <resource name="Custom_Navigation_Description">Add, edit, delete, and reorder custom navigation items.</resource>
  <resource name="navigation_custom"></resource>
  <resource name="Site_Navigation_Groups_More">All Groups</resource>
  <resource name="GroupInclusion">Include Groups</resource>
  <resource name="Site">Site</resource>
  <resource name="Links">User Links</resource>
  <resource name="Links_Description">Select, rearrange, and enable the links to be displayed</resource>
  <resource name="Links_Notifications">Notifications</resource>
  <resource name="Links_Inbox">Inbox</resource>
  <resource name="Links_Bookmarks">Bookmarks</resource>
  <resource name="Links_User">User</resource>
  <resource name="Links_User_Invite">Invite a member</resource>
  <resource name="Links_User_Settings">Settings</resource>
  <resource name="Links_User_Profile">Profile</resource>
  <resource name="Links_User_Logout">Sign Out</resource>
  <resource name="JoinSignIn">Join or Sign In</resource>
  <resource name="Cancel">Cancel</resource>
  <resource name="Bookmarks">Bookmarks</resource>
  <resource name="Bookmarks_More">View All</resource>
  <resource name="Bookmarks_None">You have no bookmarks.</resource>
  <resource name="Bookmark_Filter_Content">Content</resource>
  <resource name="Bookmark_Filter_Application">Application</resource>
  <resource name="Bookmark_Added">Bookmark Added</resource>
  <resource name="Bookmark_Removed">Bookmark Removed</resource>
  <resource name="Notifications">Notifications</resource>
  <resource name="Notifications_None">No notifications. Go get busy in the community!</resource>
  <resource name="TurnOffNotifications">Turn off</resource>
  <resource name="TurnOff">Confirm</resource>
  <resource name="TurnOffQuestion">Do not notify me when someone</resource>
  <resource name="TurnOffQuestionSuffix">?</resource>
  <resource name="Notifications_UnreadCountMessageSingular">You have {0} unread notification</resource>
  <resource name="Notifications_UnreadCountMessagePlural">You have {0} unread notifications</resource>
  <resource name="Notifications_Mark">Mark as Read</resource>
  <resource name="Notification_Filter_Unread">Unread</resource>
  <resource name="Notification_Filter_All">All</resource>
  <resource name="Conversations_Inbox">Inbox</resource>
  <resource name="Conversations_More">View All</resource>
  <resource name="Conversations_None">You have no messages.</resource>
  <resource name="Conversation_Send">New Message</resource>
  <resource name="Conversations_UnreadCountMessageSingular">You have {0} unread message</resource>
  <resource name="Conversations_UnreadCountMessagePlural">You have {0} unread messages</resource>
  <resource name="user">User</resource>
  <resource name="StopImpersonating">Stop Impersonating</resource>
  <resource name="Search_Filter_In">In {0}</resource>
  <resource name="Search_Filter_Anywhere">Anywhere</resource>
  <resource name="Search_Filter_Content">Content</resource>
  <resource name="Search_Filter_Groups">Groups</resource>
  <resource name="Search_Filter_People">People</resource>
  <resource name="Advanced_Search">Advanced Search</resource>
  <resource name="No_Results">No Results</resource>
  <resource name="Groups_NoGroups">There are no groups created in this site yet.</resource>
  <resource name="Core_SiteUserNavigation_Logo">Logo (optimal image size is 250*88px)</resource>
  <resource name="Core_SiteUserNavigation_Home">Home</resource>
  <resource name="Search">Search</resource>
  <resource name="TourTipSearch">Use search within the community to find people, content and groups. You can also use it to help navigate through the community.</resource>
  <resource name="TourTipNavigation">Navigate the community</resource>
  <resource name="TourTipSignIn">Sign in or Join the community.</resource>
  <resource name="TourTipNotifications">View recent notifications.</resource>
  <resource name="TourTipBookmarks">View bookmarks or bookmark the current page.</resource>
  <resource name="TourTipMessages">View your latest conversations.</resource>
  <resource name="TourTipProfile">Update your profile, change your settings or sign out.</resource>
  <resource name="loading">Loading...</resource>
  <resource name="Site_Navigation_Quest">Use Quest Navigation</resource>
  <resource name="Site_Search">Site Search</resource>
  <resource name="Site_Search_Description">Choose search methods</resource>
  <resource name="Site_Search_Default">Default search provided by Telligent</resource>
  <resource name="Site_Search_Quest">Utilize Quest Search</resource>
  <resource name="CF_Quest_Footer">Use Quest Footer</resource>
  <resource name="Site_Brand_Description">Select Brand</resource>
  <resource name="Site_Brand">Brand</resource>
  <resource name="Site_Brand_DSG">Dell Software</resource>
  <resource name="Site_Brand_Quest">Quest Software</resource>
  <resource name="NavigationTab">Navigation</resource>
  <resource name="CF_Navigation_Content">Please enter navigation HTML</resource>
</language></languageResources>
		<additionalCssScript><![CDATA[masthead-container]]></additionalCssScript>
		<files>
			<file name="bookmarks.vm">77u/I3NldCAoJHBhZ2VJbmRleCA9ICRjb3JlX3YyX3V0aWxpdHkuUGFyc2VJbnQoJGNvcmVfdjJfcGFnZS5HZXRRdWVyeVN0cmluZ1ZhbHVlKCd3X3BhZ2VJbmRleCcpKSkNCiNzZXQgKCRjb250ZW50VHlwZUlkcyA9ICRjb3JlX3YyX3BhZ2UuR2V0UXVlcnlTdHJpbmdWYWx1ZSgnd19jb250ZW50VHlwZUlkcycpKQ0KI2lmICgkY29udGVudFR5cGVJZHMgJiYgJGNvbnRlbnRUeXBlSWRzLkxlbmd0aCA+IDApDQoJI3NldCAoJGJvb2ttYXJrcyA9ICRjb3JlX3YyX2Jvb2ttYXJrLkxpc3QoIiV7IFBhZ2VJbmRleCA9ICRwYWdlSW5kZXgsIFBhZ2VTaXplID0gMTAsIFNvcnRCeSA9ICdEYXRlJywgU29ydE9yZGVyID0gJ0Rlc2NlbmRpbmcnLCBDb250ZW50VHlwZUlkcyA9ICRjb250ZW50VHlwZUlkcyB9IikpDQojZWxzZQ0KCSNzZXQgKCRib29rbWFya3MgPSAkY29yZV92Ml9ib29rbWFyay5MaXN0KCIleyBQYWdlSW5kZXggPSAkcGFnZUluZGV4LCBQYWdlU2l6ZSA9IDEwLCBTb3J0QnkgPSAnRGF0ZScsIFNvcnRPcmRlciA9ICdEZXNjZW5kaW5nJyB9IikpDQojZW5kDQojc2V0ICgkYWNjZXNzaW5nVXNlciA9ICRjb3JlX3YyX3VzZXIuQWNjZXNzaW5nKQ0KDQojc2V0ICgkaGFzTW9yZSA9IGZhbHNlKQ0KI3NldCAoJGN1cnJlbnRQYWdlZFF1YW50aXR5ID0gKCRib29rbWFya3MuUGFnZUluZGV4ICsgMSkgKiAkYm9va21hcmtzLlBhZ2VTaXplKQ0KI2lmICgkYm9va21hcmtzLlRvdGFsQ291bnQgPiAkY3VycmVudFBhZ2VkUXVhbnRpdHkpDQoJI3NldCAoJGhhc01vcmUgPSB0cnVlKQ0KI2VuZA0KDQojc2V0ICgkcm9vdEdyb3VwID0gJGNvcmVfdjJfZ3JvdXAuUm9vdCkNCg0KI2ZvcmVhY2ggKCRib29rbWFyayBpbiAkYm9va21hcmtzKQ0KCSMjIHJlbmRlciBib29rbWFyaw0KCSNzZXQgKCRjb250ZW50ID0gZmFsc2UpDQoJI3NldCAoJGNvbnRlbnQgPSAkYm9va21hcmsuQ29udGVudCkNCgkjaWYgKCRjb250ZW50KQ0KCQkjIyBkZXRlcm1pbmUgYW4gaW1hZ2UgdG8gdXNlLiBQcmVmZXJyaW5nIGNvbnRlbnQgb3ZlciBhcHBsaWNhdGlvbiBvdmVyIGNvbnRhaW5lcg0KCQkjc2V0ICgkaW1hZ2VVcmwgPSBmYWxzZSkNCgkJI3NldCAoJGltYWdlVXJsID0gJGNvbnRlbnQuQXZhdGFyVXJsKQ0KCQkjaWYgKCghJGltYWdlVXJsIHx8ICRpbWFnZVVybCA9PSAnJykgJiYgJGNvbnRlbnQuQXBwbGljYXRpb24pDQoJCQkjc2V0ICgkaW1hZ2VVcmwgPSAkY29udGVudC5BcHBsaWNhdGlvbi5BdmF0YXJVcmwpDQoJCQkjaWYgKCghJGltYWdlVXJsIHx8ICRpbWFnZVVybCA9PSAnJykgJiYgJGNvbnRlbnQuQXBwbGljYXRpb24uQ29udGFpbmVyKQ0KCQkJCSNzZXQgKCRpbWFnZVVybCA9ICRjb250ZW50LkFwcGxpY2F0aW9uLkNvbnRhaW5lci5BdmF0YXJVcmwpDQoJCQkjZW5kDQoJCSNlbmQNCgkJPGxpIGNsYXNzPSJjb250ZW50LWl0ZW0iIGRhdGEtY29udGVudHVybD0iJGNvbnRlbnQuVXJsIiAjaWYoJGhhc01vcmUpIGRhdGEtaGFzbW9yZT0idHJ1ZSIgI2VuZD4NCgkJCSNpZiAoJGltYWdlVXJsKQ0KCQkJCTxkaXYgY2xhc3M9InBvc3QtYXV0aG9yIj4NCgkJCQkJPHNwYW4gY2xhc3M9ImF2YXRhciI+DQoJCQkJCQk8YSBocmVmPSIkY29yZV92Ml9lbmNvZGluZy5IdG1sQXR0cmlidXRlRW5jb2RlKCRjb250ZW50LlVybCkiIGNsYXNzPSJpbnRlcm5hbC1saW5rIj4NCgkJCQkJCQkkY29yZV92Ml91aS5HZXRSZXNpemVkSW1hZ2VIdG1sKCRpbWFnZVVybCwgNDAsIDQwLCAiJXtib3JkZXI9JzAnLCBhbHQ9JGNvbnRlbnQuSHRtbE5hbWUoJ1dlYicpLCBSZXNpemVNZXRob2Q9J1pvb21BbmRDcm9wJyxib3JkZXI9JzAnfSIpDQoJCQkJCQk8L2E+DQoJCQkJCTwvc3Bhbj4NCgkJCQk8L2Rpdj4NCgkJCSNlbmQNCgkJCTxkaXYgY2xhc3M9ImNvbnRlbnQiPg0KCQkJCSNzZXQgKCRuYW1lID0gJGNvcmVfdjJfbGFuZ3VhZ2UuVHJ1bmNhdGUoJGNvbnRlbnQuSHRtbE5hbWUoJ1dlYicpLCA1MCwgJ+KApicpKQ0KCQkJCSNpZiAoJG5hbWUubGVuZ3RoID09IDApDQoJCQkJCSNzZXQgKCRuYW1lID0gJGNvcmVfdjJfbGFuZ3VhZ2UuVHJ1bmNhdGUoJGNvbnRlbnQuSHRtbERlc2NyaXB0aW9uKCdXZWInKSwgNTAsICfigKYnKSkNCgkJCQkjZW5kDQoJCQkJJG5hbWUNCgkJCTwvZGl2Pg0KCQkJI2lmICgkY29udGVudCAmJiAkY29udGVudC5BcHBsaWNhdGlvbiAmJiAkY29udGVudC5BcHBsaWNhdGlvbi5Db250YWluZXIgJiYgJGNvbnRlbnQuVXJsICE9ICRjb250ZW50LkFwcGxpY2F0aW9uLkNvbnRhaW5lci5VcmwpDQoJCQkJI2lmICgkcm9vdEdyb3VwLkNvbnRhaW5lcklkICE9ICRjb250ZW50LkFwcGxpY2F0aW9uLkNvbnRhaW5lci5Db250YWluZXJJZCkNCgkJCQkJPHNwYW4gY2xhc3M9ImNvbnRlbnQtZ3JvdXAiPg0KCQkJCQkJPGEgaHJlZj0iJGNvcmVfdjJfZW5jb2RpbmcuSHRtbEF0dHJpYnV0ZUVuY29kZSgkY29udGVudC5BcHBsaWNhdGlvbi5Db250YWluZXIuVXJsKSI+JGNvbnRlbnQuQXBwbGljYXRpb24uQ29udGFpbmVyLkh0bWxOYW1lKCdXZWInKTwvYT4NCgkJCQkJPC9zcGFuPg0KCQkJCSNlbmQNCgkJCSNlbmQNCgkJPC9saT4NCgkjZW5kDQojbm9kYXRhDQoJPGRpdiBjbGFzcz0ibWVzc2FnZSBub3JlY29yZHMiPiRjb3JlX3YyX2xhbmd1YWdlLkdldFJlc291cmNlKCdCb29rbWFya3NfTm9uZScpPC9kaXY+DQojZW5k</file>
			<file name="conversations.vm">77u/I3NldCAoJHBhZ2VJbmRleCA9ICRjb3JlX3YyX3V0aWxpdHkuUGFyc2VJbnQoJGNvcmVfdjJfcGFnZS5HZXRRdWVyeVN0cmluZ1ZhbHVlKCd3X3BhZ2VJbmRleCcpKSkNCiNzZXQgKCRjb252ZXJzYXRpb25zID0gJGNvcmVfdjJfY29udmVyc2F0aW9uLkxpc3QoIiV7IFBhZ2VJbmRleCA9ICRwYWdlSW5kZXgsIFBhZ2VTaXplID0gMTAgfSIpKQ0KI3NldCAoJGFjY2Vzc2luZ1VzZXIgPSAkY29yZV92Ml91c2VyLkFjY2Vzc2luZykNCiNzZXQgKCRtYXhQYXJ0aWNpcGFudEF2YXRhcnMgPSA1KQ0KDQojc2V0ICgkaGFzTW9yZSA9IGZhbHNlKQ0KI3NldCAoJGN1cnJlbnRQYWdlZFF1YW50aXR5ID0gKCRjb252ZXJzYXRpb25zLlBhZ2VJbmRleCArIDEpICogJGNvbnZlcnNhdGlvbnMuUGFnZVNpemUpDQojaWYgKCRjb252ZXJzYXRpb25zLlRvdGFsQ291bnQgPiAkY3VycmVudFBhZ2VkUXVhbnRpdHkpDQoJI3NldCAoJGhhc01vcmUgPSB0cnVlKQ0KI2VuZA0KDQojZm9yZWFjaCAoJGNvbnZlcnNhdGlvbiBpbiAkY29udmVyc2F0aW9ucykNCgkjc2V0ICgkbGFzdE1lc3NhZ2UgPSAkY29udmVyc2F0aW9uLkxhc3RNZXNzYWdlKQ0KDQoJIyMgcmVuZGVyIGNvbnZlcnNhdGlvbg0KCTxsaSBjbGFzcz0iY29udGVudC1pdGVtICNpZighJGNvbnZlcnNhdGlvbi5IYXNSZWFkKSB1bnJlYWQgI2VuZCIgZGF0YS1jb250ZW50dXJsPSIkY29udmVyc2F0aW9uLlVybCIgI2lmKCRoYXNNb3JlKSBkYXRhLWhhc21vcmU9InRydWUiICNlbmQ+DQoJCTxkaXYgY2xhc3M9InBvc3QtYXV0aG9yIj4NCgkJCTxzcGFuIGNsYXNzPSJhdmF0YXIiPg0KCQkJCTxhIGhyZWY9IiRjb3JlX3YyX2VuY29kaW5nLkh0bWxBdHRyaWJ1dGVFbmNvZGUoJGxhc3RNZXNzYWdlLkF1dGhvci5VcmwpIiBjbGFzcz0iaW50ZXJuYWwtbGluayI+DQoJCQkJCSRjb3JlX3YyX3VpLkdldFJlc2l6ZWRJbWFnZUh0bWwoJGxhc3RNZXNzYWdlLkF1dGhvci5BdmF0YXJVcmwsIDQwLCA0MCwgIiV7Ym9yZGVyPScwJywgYWx0PSRjb250ZW50Lkh0bWxOYW1lKCdXZWInKSwgUmVzaXplTWV0aG9kPSdab29tQW5kQ3JvcCcsYm9yZGVyPScwJ30iKQ0KCQkJCTwvYT4NCgkJCTwvc3Bhbj4NCgkJPC9kaXY+DQoJCTxkaXYgY2xhc3M9InBvc3QtYXV0aG9ycyI+DQoJCQkjc2V0ICgkRFEgPSAnIicpDQoJCQkjc2V0ICgkYXV0aG9ycyA9ICIiKQ0KCQkJI2ZvcmVhY2ggKCRwYXJ0aWNpcGFudCBpbiAkY29udmVyc2F0aW9uLlBhcnRpY2lwYW50cykNCgkJCQkjc2V0ICgkYXV0aG9ycyA9ICIkYXV0aG9yczxhIGNsYXNzPSR7RFF9aW50ZXJuYWwtbGluayB2aWV3LXVzZXItcHJvZmlsZSR7RFF9IGhyZWY9JHtEUX0kY29yZV92Ml9lbmNvZGluZy5IdG1sQXR0cmlidXRlRW5jb2RlKCRwYXJ0aWNpcGFudC5Qcm9maWxlVXJsKSR7RFF9PiRwYXJ0aWNpcGFudC5EaXNwbGF5TmFtZTwvYT4iKQ0KCQkJI2JldHdlZW4NCgkJCQkjc2V0ICgkYXV0aG9ycyA9ICIkYXV0aG9ycywgIikNCgkJCSNlbmQNCgkJCSRhdXRob3JzDQoJCTwvZGl2Pg0KCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4NCgkJCSNzZXQgKCRleGNlcnB0ID0gJGNvcmVfdjJfbGFuZ3VhZ2UuVHJ1bmNhdGUoJGxhc3RNZXNzYWdlLkh0bWxEZXNjcmlwdGlvbignV2ViJyksIDUwLCAn4oCmJykpDQoJCQkjaWYgKCRleGNlcnB0Lmxlbmd0aCA9PSAwKQ0KCQkJCSNzZXQgKCRleGNlcnB0ID0gJGNvcmVfdjJfbGFuZ3VhZ2UuVHJ1bmNhdGUoJGNvbnZlcnNhdGlvbi5GaXJzdE1lc3NhZ2UuU3ViamVjdCwgNTAsICfigKYnKSkNCgkJCSNlbmQNCgkJCSRleGNlcnB0DQoJCTwvZGl2Pg0KCQk8ZGl2IGNsYXNzPSJwb3N0LWRhdGUiPg0KCQkJPHNwYW4gY2xhc3M9InZhbHVlIj4kY29yZV92Ml9sYW5ndWFnZS5Gb3JtYXRBZ29EYXRlKCRjb252ZXJzYXRpb24uTGFzdE1lc3NhZ2UuQ3JlYXRlZERhdGUpPC9zcGFuPg0KCQk8L2Rpdj4NCgk8L2xpPg0KI25vZGF0YQ0KCTxkaXYgY2xhc3M9Im1lc3NhZ2Ugbm9yZWNvcmRzIj4kY29yZV92Ml9sYW5ndWFnZS5HZXRSZXNvdXJjZSgnQ29udmVyc2F0aW9uc19Ob25lJyk8L2Rpdj4NCiNlbmQ=</file>
			<file name="notifications.vm">77u/I3NldCAoJGZpbHRlciA9ICRjb3JlX3YyX3BhZ2UuR2V0UXVlcnlTdHJpbmdWYWx1ZSgnd19maWx0ZXInKSkNCiNzZXQgKCRwYWdlSW5kZXggPSAkY29yZV92Ml91dGlsaXR5LlBhcnNlSW50KCRjb3JlX3YyX3BhZ2UuR2V0UXVlcnlTdHJpbmdWYWx1ZSgnd19wYWdlSW5kZXgnKSkpDQojc2V0ICgkcGFnZVNpemUgPSAxMCkNCg0KI3NldCAoJG9wdGlvbnMgPSAiJXsgUGFnZUluZGV4ID0gJHBhZ2VJbmRleCwgUGFnZVNpemUgPSAkcGFnZVNpemUgfSIpDQojc2V0ICgkY29udmVyc2F0aW9uTWVzc2FnZU5vdGlmaWNhdGlvbkZpbHRlck5hbWUgPSAiX0ZpbHRlcnNfJHtjb3JlX3YyX2NvbnZlcnNhdGlvbk1lc3NhZ2UuTm90aWZpY2F0aW9uVHlwZUlkfSIpDQokb3B0aW9ucy5BZGQoJGNvbnZlcnNhdGlvbk1lc3NhZ2VOb3RpZmljYXRpb25GaWx0ZXJOYW1lLCAnRXhjbHVkZScpDQojaWYgKCRmaWx0ZXIgPT0gJ3VucmVhZCcpDQoJJG9wdGlvbnMuQWRkKCdJc1JlYWQnLCAnZmFsc2UnKQ0KI2VuZA0KI3NldCAoJG5vdGlmaWNhdGlvbnMgPSAkY29yZV92Ml9ub3RpZmljYXRpb24uTGlzdCgkb3B0aW9ucykpDQoNCiNzZXQgKCRoYXNNb3JlID0gZmFsc2UpDQojc2V0ICgkY3VycmVudFBhZ2VkUXVhbnRpdHkgPSAoJG5vdGlmaWNhdGlvbnMuUGFnZUluZGV4ICsgMSkgKiAkbm90aWZpY2F0aW9ucy5QYWdlU2l6ZSkNCiNpZiAoJG5vdGlmaWNhdGlvbnMuVG90YWxDb3VudCA+ICRjdXJyZW50UGFnZWRRdWFudGl0eSkNCgkjc2V0ICgkaGFzTW9yZSA9IHRydWUpDQojZW5kDQoNCiNmb3JlYWNoICgkbm90aWZpY2F0aW9uIGluICRub3RpZmljYXRpb25zKQ0KCSNzZXQgKCRsYXN0QWN0b3IgPSBmYWxzZSkNCgkjc2V0ICgkYWN0b3JzID0gJG5vdGlmaWNhdGlvbi5BY3RvcnMpDQoJI3NldCAoJGxhc3RJbmRleCA9ICRhY3RvcnMuQ291bnQgLSAxKQ0KCSNzZXQgKCRsYXN0QWN0b3IgPSAkYWN0b3JzLlRvQXJyYXkoKS5nZXQoJGxhc3RJbmRleCkuVXNlcikNCgkjc2V0ICgkbm90aWZpY2F0aW9uVHlwZSA9ICRjb3JlX3YyX25vdGlmaWNhdGlvblR5cGUuR2V0KCRub3RpZmljYXRpb24uTm90aWZpY2F0aW9uVHlwZUlkKSkNCg0KCSNpZiAoJG5vdGlmaWNhdGlvblR5cGUuTm90aWZpY2F0aW9uVHlwZUlkID09ICRjb3JlX3YyX3JhdGVkSXRlbS5Ob3RpZmljYXRpb25UeXBlSWQpDQoJCSNzZXQgKCRsYXN0QWN0b3IgPSBmYWxzZSkNCgkjZW5kDQoNCgkjIyByZW5kZXIgbm90aWZpY2F0aW9uDQoJI3NldCAoJG5vdGlmaWNhdGlvbk1lc3NhZ2UgPSBmYWxzZSkNCgkjc2V0ICgkbm90aWZpY2F0aW9uTWVzc2FnZSA9ICRub3RpZmljYXRpb24uTWVzc2FnZSgnSHRtbCcpKQ0KCSNpZiAoJG5vdGlmaWNhdGlvbk1lc3NhZ2UpDQoJCTxsaSBjbGFzcz0iY29udGVudC1pdGVtICNpZighJG5vdGlmaWNhdGlvbi5Jc1JlYWQpIHVucmVhZCAjZW5kICNpZiAoISRsYXN0QWN0b3IpIG5vLWF1dGhvciAjZW5kIiBkYXRhLWNvbnRlbnR1cmw9IiRub3RpZmljYXRpb24uVGFyZ2V0VXJsIg0KCQkJZGF0YS1ub3RpZmljYXRpb25pZD0iJG5vdGlmaWNhdGlvbi5Ob3RpZmljYXRpb25JZCINCgkJCWRhdGEtbm90aWZpY2F0aW9udHlwZWlkPSIkbm90aWZpY2F0aW9uLk5vdGlmaWNhdGlvblR5cGVJZCINCgkJCWRhdGEtbm90aWZpY2F0aW9udHlwZW5hbWU9IiRjb3JlX3YyX2VuY29kaW5nLkh0bWxBdHRyaWJ1dGVFbmNvZGUoJG5vdGlmaWNhdGlvblR5cGUuRGVzY3JpcHRpb24pIg0KCQkJI2lmKCRoYXNNb3JlKSBkYXRhLWhhc21vcmU9InRydWUiICNlbmQ+DQoNCgkJCSNpZiAoJGxhc3RBY3RvcikNCgkJCQk8ZGl2IGNsYXNzPSJwb3N0LWF1dGhvciI+DQoJCQkJCTxzcGFuIGNsYXNzPSJhdmF0YXIiPg0KCQkJCQkJI2lmICgkbGFzdEFjdG9yLlByb2ZpbGVVcmwpDQoJCQkJCQkJPGEgaHJlZj0iJGNvcmVfdjJfZW5jb2RpbmcuSHRtbEF0dHJpYnV0ZUVuY29kZSgkbGFzdEFjdG9yLlByb2ZpbGVVcmwpIiBjbGFzcz0iaW50ZXJuYWwtbGluayB2aWV3LXVzZXItcHJvZmlsZSI+DQoJCQkJCQkJCSRjb3JlX3YyX3VpLkdldFJlc2l6ZWRJbWFnZUh0bWwoJGxhc3RBY3Rvci5BdmF0YXJVcmwsIDQwLCA0MCwgIiV7Ym9yZGVyPScwJywgYWx0PSRsYXN0QWN0b3IuRGlzcGxheU5hbWUsIFJlc2l6ZU1ldGhvZD0nWm9vbUFuZENyb3AnLGJvcmRlcj0nMCd9IikNCgkJCQkJCQk8L2E+DQoJCQkJCQkjZWxzZQ0KCQkJCQkJCSRjb3JlX3YyX3VpLkdldFJlc2l6ZWRJbWFnZUh0bWwoJGxhc3RBY3Rvci5BdmF0YXJVcmwsIDQwLCA0MCwgIiV7Ym9yZGVyPScwJywgYWx0PSRsYXN0QWN0b3IuRGlzcGxheU5hbWUsIFJlc2l6ZU1ldGhvZD0nWm9vbUFuZENyb3AnLGJvcmRlcj0nMCd9IikNCgkJCQkJCSNlbmQNCgkJCQkJPC9zcGFuPg0KCQkJCQk8c3BhbiBjbGFzcz0idXNlci1uYW1lIj4NCgkJCQkJCSNpZiAoJGxhc3RBY3Rvci5Qcm9maWxlVXJsKQ0KCQkJCQkJCTxhIGhyZWY9IiRjb3JlX3YyX2VuY29kaW5nLkh0bWxBdHRyaWJ1dGVFbmNvZGUoJGxhc3RBY3Rvci5Qcm9maWxlVXJsKSIgY2xhc3M9ImludGVybmFsLWxpbmsgdmlldy11c2VyLXByb2ZpbGUiPg0KCQkJCQkJCQkkbGFzdEFjdG9yLkRpc3BsYXlOYW1lDQoJCQkJCQkJPC9hPg0KCQkJCQkJI2Vsc2UNCgkJCQkJCQkkbGFzdEFjdG9yLkRpc3BsYXlOYW1lDQoJCQkJCQkjZW5kDQoJCQkJCTwvc3Bhbj4NCgkJCQk8L2Rpdj4NCgkJCSNlbmQNCgkJCTxkaXYgY2xhc3M9ImNvbnRlbnQiPg0KCQkJCSRub3RpZmljYXRpb25NZXNzYWdlDQoJCQk8L2Rpdj4NCgkJCTxkaXYgY2xhc3M9InBvc3QtZGF0ZSI+DQoJCQkJPHNwYW4gY2xhc3M9InZhbHVlIj4kY29yZV92Ml9sYW5ndWFnZS5Gb3JtYXRBZ29EYXRlKCRub3RpZmljYXRpb24uTGFzdFVwZGF0ZWREYXRlKTwvc3Bhbj4NCgkJCTwvZGl2Pg0KCQkJPGRpdiBjbGFzcz0icHJlZmVyZW5jZSI+DQoJCQkJPGEgaHJlZj0iIyIgdGl0bGU9IiRjb3JlX3YyX2VuY29kaW5nLkh0bWxBdHRyaWJ1dGVFbmNvZGUoJGNvcmVfdjJfbGFuZ3VhZ2UuR2V0UmVzb3VyY2UoJ1R1cm5PZmZOb3RpZmljYXRpb25zJykpIiBjbGFzcz0idWktdGlwIj5YPC9hPg0KCQkJPC9kaXY+DQoJCQkjaWYoISRub3RpZmljYXRpb24uSXNSZWFkKQ0KCQkJCTxkaXYgY2xhc3M9Im1hcmsiPg0KCQkJCQk8YSBocmVmPSIjIiB0aXRsZT0iJGNvcmVfdjJfZW5jb2RpbmcuSHRtbEF0dHJpYnV0ZUVuY29kZSgkY29yZV92Ml9sYW5ndWFnZS5HZXRSZXNvdXJjZSgnTm90aWZpY2F0aW9uc19NYXJrJykpIiBjbGFzcz0idWktdGlwIiBkYXRhLW1lc3NhZ2VuYW1lPSJ0ZWxsaWdlbnQuZXZvbHV0aW9uLndpZGdldHMudGhyZWFkLmhpZGVhdHRhY2htZW50Ij5PPC9hPg0KCQkJCTwvZGl2Pg0KCQkJI2VuZA0KCQk8L2xpPg0KCSNlbmQNCiNub2RhdGENCgk8ZGl2IGNsYXNzPSJtZXNzYWdlIG5vcmVjb3JkcyI+JGNvcmVfdjJfbGFuZ3VhZ2UuR2V0UmVzb3VyY2UoJ05vdGlmaWNhdGlvbnNfTm9uZScpPC9kaXY+DQojZW5kDQo=</file>
			<file name="search.vm">77u/I3NldCAoJHF1ZXJ5ID0gJGNvcmVfdjJfdXRpbGl0eS5UcmltKCRjb3JlX3YyX3BhZ2UuR2V0UXVlcnlTdHJpbmdWYWx1ZSgnd19xdWVyeScpKSkNCiNzZXQgKCRwYWdlU2l6ZSA9IDEwKQ0KI3NldCAoJHBhZ2VJbmRleCA9ICRjb3JlX3YyX3V0aWxpdHkuUGFyc2VJbnQoJGNvcmVfdjJfcGFnZS5HZXRRdWVyeVN0cmluZ1ZhbHVlKCd3X3BhZ2VJbmRleCcpKSkNCiNzZXQgKCRwbGFjZUtleSA9ICRjb3JlX3YyX3BhZ2UuR2V0UXVlcnlTdHJpbmdWYWx1ZSgnd19wbGFjZUtleScpKQ0KI3NldCAoJHBsYWNlVmFsdWUgPSAkY29yZV92Ml9wYWdlLkdldFF1ZXJ5U3RyaW5nVmFsdWUoJ3dfcGxhY2VWYWx1ZScpKQ0KI3NldCAoJHR5cGUgPSAkY29yZV92Ml9wYWdlLkdldFF1ZXJ5U3RyaW5nVmFsdWUoJ3dfdHlwZScpKQ0KDQojc2V0ICgkc2VhcmNoUXVlcnkgPSAiJXt9IikNCiRzZWFyY2hRdWVyeS5BZGQoIlF1ZXJ5IiwgJHF1ZXJ5KQ0KJHNlYXJjaFF1ZXJ5LkFkZCgiUGFnZVNpemUiLCAkcGFnZVNpemUpDQokc2VhcmNoUXVlcnkuQWRkKCJQYWdlSW5kZXgiLCAkcGFnZUluZGV4KQ0KJHNlYXJjaFF1ZXJ5LkFkZCgnQ29sbGFwc2UnLCAnVHJ1ZScpDQoNCiNpZiAoJHBsYWNlS2V5ID09ICdhcHBsaWNhdGlvbicpDQoJJHNlYXJjaFF1ZXJ5LkFkZCgiQXBwbGljYXRpb25JZCIsICRwbGFjZVZhbHVlKQ0KI2Vsc2VpZiAoJHBsYWNlS2V5ID09ICdncm91cCcgJiYgJHR5cGUgIT0gJ2dyb3VwcycpDQoJJHNlYXJjaFF1ZXJ5LkFkZCgiQ29udGFpbmVySWQiLCAkcGxhY2VWYWx1ZSkNCiNlbmQNCg0KI2lmICgkdHlwZSA9PSAnZ3JvdXBzJykNCgkjaWYgKCRwbGFjZUtleSA9PSAnZ3JvdXAnKQ0KCQkjc2V0KCRwYXJlbnRHcm91cEZpbHRlciA9ICcnKQ0KCQkjc2V0KCRncm91cCA9ICRjb3JlX3YyX2dyb3VwLkdldCgkY29yZV92Ml91dGlsaXR5LlBhcnNlR3VpZCgkcGxhY2VWYWx1ZSkpKQ0KCQkjaWYgKCRncm91cCkNCgkJCSNzZXQoJHBhcmVudEdyb3VwRmlsdGVyID0gInx8cGFyZW50Z3JvdXA6OiR7Z3JvdXAuSWR9IikNCgkJI2VuZA0KCQkkc2VhcmNoUXVlcnkuQWRkKCdGaWx0ZXJzJywgImNvbnRlbnR0eXBlaWQ6OiR7Y29yZV92Ml9ncm91cC5Db250ZW50VHlwZUlkfSR7cGFyZW50R3JvdXBGaWx0ZXJ9IikNCgkjZWxzZQ0KCQkkc2VhcmNoUXVlcnkuQWRkKCdGaWx0ZXJzJywgImNvbnRlbnR0eXBlaWQ6OiRjb3JlX3YyX2dyb3VwLkNvbnRlbnRUeXBlSWQiKQ0KCSNlbmQNCiNlbHNlaWYgKCR0eXBlID09ICd1c2VycycpDQoJJHNlYXJjaFF1ZXJ5LkFkZCgnRmlsdGVycycsICJjb250ZW50dHlwZWlkOjokY29yZV92Ml91c2VyLkNvbnRlbnRUeXBlSWQiKQ0KI2Vsc2UNCgkjc2V0KCRmaWx0ZXJzID0gJycpDQoJI2ZvcmVhY2goJGNvbnRlbnRUeXBlIGluICRjb3JlX3YyX2NvbnRlbnRUeXBlLkxpc3QoKSkNCgkJI3NldCgkYXBwbGljYXRpb25UeXBlID0gZmFsc2UpDQoJCSNzZXQoJGFwcGxpY2F0aW9uVHlwZSA9ICRjb3JlX3YyX2FwcGxpY2F0aW9uVHlwZS5HZXQoJGNvbnRlbnRUeXBlLklkKSkNCgkJI3NldCgkY29udGFpbmVyVHlwZSA9IGZhbHNlKQ0KCQkjc2V0KCRjb250YWluZXJUeXBlID0gJGNvcmVfdjJfY29udGFpbmVyVHlwZS5HZXQoJGNvbnRlbnRUeXBlLklkKSkNCgkJI2lmICgoISRhcHBsaWNhdGlvblR5cGUgfHwgJGFwcGxpY2F0aW9uVHlwZS5IYXNFcnJvcnMoKSkgJiYgKCEkY29udGFpbmVyVHlwZSB8fCAkY29udGFpbmVyVHlwZS5IYXNFcnJvcnMoKSkpDQoJCQkjaWYgKCRmaWx0ZXJzLkxlbmd0aCA9PSAwKQ0KCQkJCSNzZXQoJGZpbHRlcnMgPSAiY29udGVudHR5cGVpZDo6KCR7Y29udGVudFR5cGUuSWR9IikNCgkJCSNlbHNlDQoJCQkJI3NldCgkZmlsdGVycyA9ICIke2ZpbHRlcnN9IE9SICR7Y29udGVudFR5cGUuSWR9IikNCgkJI2VuZA0KCQkjZW5kDQoJI2VuZA0KCSNpZigkZmlsdGVycy5MZW5ndGggPiAwKQ0KCQkkc2VhcmNoUXVlcnkuQWRkKCdGaWx0ZXJzJywgIiR7ZmlsdGVyc30pIikNCgkjZW5kDQojZW5kDQoNCg0KI3NldCAoJHNlYXJjaFJlc3VsdHMgPSAkY29yZV92Ml9zZWFyY2hSZXN1bHQuTGlzdCgkc2VhcmNoUXVlcnkpKQ0KDQojc2V0ICgkaGFzTW9yZSA9IGZhbHNlKQ0KI3NldCAoJGN1cnJlbnRQYWdlZFF1YW50aXR5ID0gKCRzZWFyY2hSZXN1bHRzLlBhZ2VJbmRleCArIDEpICogJHNlYXJjaFJlc3VsdHMuUGFnZVNpemUpDQojaWYgKCRzZWFyY2hSZXN1bHRzLlRvdGFsQ291bnQgPiAkY3VycmVudFBhZ2VkUXVhbnRpdHkpDQogICAgI3NldCAoJGhhc01vcmUgPSB0cnVlKQ0KI2VuZA0KDQojZm9yZWFjaCAoJHNlYXJjaFJlc3VsdCBpbiAkc2VhcmNoUmVzdWx0cykNCgk8bGkgY2xhc3M9ImNvbnRlbnQtaXRlbSIgZGF0YS1jb250ZW50dXJsPSIkY29yZV92Ml9lbmNvZGluZy5IdG1sQXR0cmlidXRlRW5jb2RlKCRzZWFyY2hSZXN1bHQuVXJsKSIgI2lmKCRoYXNNb3JlKSBkYXRhLWhhc21vcmU9InRydWUiICNlbmQ+DQoJCSNzZXQgKCRyZXN1bHRIdG1sID0gZmFsc2UpDQoJCSNzZXQgKCRyZXN1bHRIdG1sID0gJHNlYXJjaFJlc3VsdC5WaWV3SHRtbCgpKQ0KCQkjaWYgKCRyZXN1bHRIdG1sKQ0KCQkJJHJlc3VsdEh0bWwNCgkJI2VuZA0KCTwvbGk+DQojbm9kYXRhDQoJPGRpdiBjbGFzcz0ibWVzc2FnZSBub3JlY29yZHMiPiRjb3JlX3YyX2xhbmd1YWdlLkdldFJlc291cmNlKCdOb19SZXN1bHRzJyk8L2Rpdj4NCiNlbmQNCg==</file>
			<file name="ui.js">KGZ1bmN0aW9uICgkLCBnbG9iYWwsIHVuZGVmKSB7DQoJdmFyIG9wZW5IZWFkZXJMaXN0Q29udGV4dCA9IG51bGw7DQoJdmFyIGFjdGl2YXRlTWVzc2FnZSA9ICd0ZWxsaWdlbnQuZXZvbHV0aW9uLndpZGdldHMuc2l0ZUJhbm5lci5hY3RpdmF0ZSc7DQoJdmFyIGRlYWN0aXZhdGVNZXNzYWdlID0gJ3RlbGxpZ2VudC5ldm9sdXRpb24ud2lkZ2V0cy5zaXRlQmFubmVyLmRlYWN0aXZhdGUnOw0KDQoJZnVuY3Rpb24gc3VwcG9ydHNUb3VjaCgpIHsNCgkJcmV0dXJuICdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdzsNCgl9DQoNCgl2YXIgdXRpbCA9IHsNCgkJdGhyb3R0bGU6IGZ1bmN0aW9uIChmbiwgbGltaXQpIHsNCgkJCXZhciBsYXN0UmFuQXQsIHRpbWVvdXQ7DQoJCQlyZXR1cm4gZnVuY3Rpb24gKCkgew0KCQkJCXZhciBzY29wZSA9IHRoaXMsDQoJCQkJCWF0dGVtcHRBdCA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSksDQoJCQkJCWFyZ3MgPSBhcmd1bWVudHM7DQoJCQkJaWYgKGxhc3RSYW5BdCAmJiAobGFzdFJhbkF0ICsgKGxpbWl0IHx8IDUwKSkgPiBhdHRlbXB0QXQpIHsNCgkJCQkJZ2xvYmFsLmNsZWFyVGltZW91dCh0aW1lb3V0KTsNCgkJCQkJdGltZW91dCA9IGdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCQkJCWxhc3RSYW5BdCA9IGF0dGVtcHRBdDsNCgkJCQkJCWZuLmFwcGx5KHNjb3BlLCBhcmdzKTsNCgkJCQkJfSwgKGxpbWl0IHx8IDUwKSk7DQoJCQkJfQ0KCQkJCWVsc2Ugew0KCQkJCQlsYXN0UmFuQXQgPSBhdHRlbXB0QXQ7DQoJCQkJCWZuLmFwcGx5KHNjb3BlLCBhcmdzKTsNCgkJCQl9DQoJCQl9Ow0KCQl9DQoJfTsNCg0KCS8vIFVJIHdoaWNoIGNhbiByZW5kZXIgZW5kbGVzc2x5LXNjcm9sbGluZyBpdGVtcyBpbiBhIHBvcHVwLg0KCS8vIFN1cHBvcnRzIGRlZmluaW5nIGZpbHRlcnMNCgkvLyBVcGRhdGluZyBzaXRlLXdpZGUgYnViYmxlIGNvdW50cw0KCXZhciBIZWFkZXJMaXN0ID0gKGZ1bmN0aW9uICgkKSB7DQoJCS8vIHByaXZhdGUgc3RhdGljIG1lbWJlcnMgb2YgYSBIZWFkZXJMaXN0DQoJCXZhciB0aXRsZUNvdW50ID0gL15cKFswLTldK1wpXHMrLywNCgkJCXRvdGFsVGl0bGVDb3VudCA9IDAsIC8vIHRpdGxlIGJhciBjb3VudCB3aGljaCBtdWx0aXBsZSBpbnN0YW5jZXMgY2FuIGNvbnRyaWJ1dGUgdG8NCgkJCW1hc2ssDQoJCQlkZWZhdWx0cyA9IHsNCgkJCQlrZXk6ICcnLA0KCQkJCWFjdGl2YXRpb25MaW5rOiBudWxsLA0KCQkJCWFjdGl2YXRpb25JbnB1dDogbnVsbCwNCgkJCQlpbml0aWFsVW5yZWFkQ291bnQ6IDAsDQoJCQkJZm9vdGVyQ29udGVudDogbnVsbCwNCgkJCQlzaG93Q291bnQ6IHRydWUsDQoJCQkJZW5kbGVzc1Njcm9sbDogZmFsc2UsDQoJCQkJY3NzQ2xhc3M6ICcnLA0KCQkJCXRlbXBsYXRlOiAnJywNCgkJCQlsb2FkaW5nOiBmYWxzZSwNCgkJCQl0aXRsZUNvdW50OiBmYWxzZSwNCgkJCQl0aXRsZUNvdW50Q2xhc3M6ICcnLA0KCQkJCXByZXZpb3VzQ291bnQ6IDAsDQoJCQkJd3JhcHBlcjogbnVsbCwNCgkJCQl1bnJlYWRDb3VudE1lc3NhZ2VTaW5ndWxhcjogJ1lvdSBoYXZlIHswfSB1bnJlYWQgaXRlbScsDQoJCQkJdW5yZWFkQ291bnRNZXNzYWdlUGx1cmFsOiAnWW91IGhhdmUgezB9IHVucmVhZCBpdGVtcycsDQoJCQkJb25TaG93TG9hZGluZ0luZGljYXRvcjogZnVuY3Rpb24gKCkgew0KCQkJCQlyZXR1cm4gdHJ1ZTsNCgkJCQl9LA0KCQkJCW9uTG9hZDogZnVuY3Rpb24gKHBhZ2VJbmRleCwgc2hvdWxkUmVmcmVzaFVucmVhZENvdW50LCBmaWx0ZXIsIGNvbXBsZXRlKSB7DQoJCQkJCS8vIGxvYWQgbW9yZSBpdGVtcw0KCQkJCQkvLyBmb3IgZWFjaCBpdGVtIGxvYWRlZCwgbWFya3MgaXQgYXMgcmVhZA0KCQkJCQkvLyBhZnRlciBpdGVtcyBsb2FkZWQgYW5kIG1hcmtzIGFzIHJlYWQsIGdldHMgbmV3IHVucmVhZCBjb3VudCBhbmQgdXBkYXRlcyB2aWEgdXBkYXRlVW5yZWFkQ291bnQgdmlhIHJlZnJlc2hVbnJlYWRDb3VudA0KCQkJCQkvLyBjb21wbGV0ZShjb250ZW50VG9TaG93KQ0KCQkJCQljb21wbGV0ZSgnJyk7DQoJCQkJfSwNCgkJCQlvblJlZnJlc2hVbnJlYWRDb3VudDogZnVuY3Rpb24gKGNvbXBsZXRlKSB7DQoJCQkJCS8vIGdldCBuZXcgdW5yZWFkIGNvdW50DQoJCQkJCS8vIHVwZGF0ZSBpdCB2aWEgY29tcGxldGUoKQ0KCQkJCQljb21wbGV0ZSg1KTsNCgkJCQl9LA0KCQkJCW9uQnVpbGRGaWx0ZXI6IG51bGwsIC8vIGZ1bmN0aW9uKGZpbHRlcmVkKSB7DQoJCQkJLy8gd2hlbiBkZWZpbmVkLCByZXR1cm5zIGEgRE9NIG5vZGUgdG8gYmUgaW5zZXJ0ZWQgYXQgdGhlIHRvcCB3aGljaCBwcmVzZW50ZXMgYSBmaWx0ZXJpbmcgVUkNCgkJCQkvLyBmaWx0ZXJlZChmaWx0ZXIpIGNhbiBiZSBjYWxsZWQgdG8gcmFpc2UgYSBmaWx0ZXINCgkJCQkvLyB9DQoJCQkJb25TaG93OiBmdW5jdGlvbiAoYWN0aXZhdG9yLCBjb21wbGV0ZSkgeyAvLyBkZWZlcnJlZCBkaXNwbGF5IG9wdGlvbnMNCgkJCQkJLy8gY2FsbHMgY29tcGxldGUgd2l0aCBkaXNwbGF5IG9wdGlvbnMgdG8gdXNlIHdoZW4gZGlzcGxheWluZw0KCQkJCQkvLyBjb21wbGV0ZSh7DQoJCQkJCS8vd2lkdGg6IDI4MA0KCQkJCQkvL21heEhlaWdodDogMzAwDQoJCQkJCS8vYXR0YWNoVG86IGFjdGl2YXRvcg0KCQkJCQkvL30pDQoJCQkJCWNvbXBsZXRlKHt9KTsNCgkJCQl9LA0KCQkJCW9uSGlkZTogZnVuY3Rpb24gKCkgew0KDQoJCQkJfSwNCgkJCQlvblNlbGVjdDogZnVuY3Rpb24gKGl0ZW0pIHsNCgkJCQkJdmFyIHVybCA9ICQoaXRlbSkuZGF0YSgnY29udGVudHVybCcpOw0KCQkJCQlpZiAodXJsKSB7DQoJCQkJCQl3aW5kb3cubG9jYXRpb24gPSB1cmw7DQoJCQkJCX0NCgkJCQl9DQoJCQl9LA0KCQkJZGVmYXVsdFNob3dTZXR0aW5ncyA9IHsNCgkJCQlhdHRhY2hUbzogbnVsbCwNCgkJCQl3aWR0aDogMjgwLA0KCQkJCW1heEhlaWdodDogMzAwLA0KCQkJCWNzc0NsYXNzOiBudWxsDQoJCQl9Ow0KDQoJCWZ1bmN0aW9uIHVwZGF0ZVRpdGxlKGNvbnRleHQpIHsNCgkJCWlmICh0b3RhbFRpdGxlQ291bnQgPD0gMCkgew0KCQkJCWNvbnRleHQuaGFuZGhlbGRCYW5uZXJMaW5rc0NvdW50LmhpZGUoKTsNCgkJCQlkb2N1bWVudC50aXRsZSA9IGRvY3VtZW50LnRpdGxlLnJlcGxhY2UodGl0bGVDb3VudCwgJycpOw0KCQkJfQ0KCQkJZWxzZSB7DQoJCQkJY29udGV4dC5oYW5kaGVsZEJhbm5lckxpbmtzQ291bnQuaHRtbCh0b3RhbFRpdGxlQ291bnQpLnNob3coKTsNCgkJCQlkb2N1bWVudC50aXRsZSA9ICcoJyArIHRvdGFsVGl0bGVDb3VudCArICcpICcgKyBkb2N1bWVudC50aXRsZS5yZXBsYWNlKHRpdGxlQ291bnQsICcnKTsNCgkJCX0NCgkJfQ0KDQoJCWZ1bmN0aW9uIGJsb2NrV2luZG93U2Nyb2xsaW5nKGNvbnRleHQpIHsNCgkJCWlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3N0b3Atc2Nyb2xsaW5nJykpDQoJCQkJcmV0dXJuOw0KDQoJCQkvLyBibG9jayB3aW5kb3cgc2Nyb2xsaW5nIG5vdCBpbiB0aGUgcG9wdXAsIG9yIHBvcHVwIHNjcm9sbGluZyBhdCBpdHMgYm91bmRhcmllcw0KCQkJY29udGV4dC5wb3B1cENvbnRlbnRMaXN0Lm9uKCdET01Nb3VzZVNjcm9sbCBtb3VzZXdoZWVsJywgZnVuY3Rpb24gKGUpIHsNCgkJCQl2YXIgZSA9IGUgfHwgd2luZG93LmV2ZW50LA0KCQkJCQlvcmlnaW5hbEV2ZW50ID0gZS5vcmlnaW5hbEV2ZW50IHx8IGUsDQoJCQkJCWRlbHRhID0gMCwNCgkJCQkJc2Nyb2xsVG9wID0gY29udGV4dC5wb3B1cENvbnRlbnRMaXN0LmdldCgwKS5zY3JvbGxUb3AsDQoJCQkJCXNjcm9sbEhlaWdodCA9IGNvbnRleHQucG9wdXBDb250ZW50TGlzdC5nZXQoMCkuc2Nyb2xsSGVpZ2h0LA0KCQkJCQloZWlnaHQgPSBjb250ZXh0LnBvcHVwQ29udGVudExpc3QuaGVpZ2h0KCk7DQoNCgkJCQlpZiAob3JpZ2luYWxFdmVudC53aGVlbERlbHRhKQ0KCQkJCQlkZWx0YSA9IG9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSAvIDEyMDsNCgkJCQlpZiAob3JpZ2luYWxFdmVudC5kZXRhaWwpDQoJCQkJCWRlbHRhID0gLW9yaWdpbmFsRXZlbnQuZGV0YWlsIC8gMzsNCg0KCQkJCWlmICgoc2Nyb2xsVG9wID09PSAoc2Nyb2xsSGVpZ2h0IC0gaGVpZ2h0KSAmJiBkZWx0YSA8IDApIHx8DQoJCQkJCShzY3JvbGxUb3AgPT09IDAgJiYgZGVsdGEgPiAwKSkgew0KCQkJCQlpZiAoZS5wcmV2ZW50RGVmYXVsdCkNCgkJCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQkJZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOw0KCQkJCX0NCgkJCX0pOw0KDQoJCQkvLyBibG9jayB0b3VjaCBzY3JvbGxpbmcNCgkJCXZhciBsYXN0WTsNCgkJCSQoJ2JvZHknKS5hZGRDbGFzcygnc3RvcC1zY3JvbGxpbmcnKQ0KCQkJCS5vbigncG9pbnRlcnN0YXJ0LnNjcm9sbGZpeCcsIGZ1bmN0aW9uIChlKSB7DQoJCQkJCWxhc3RZID0gZS5wb2ludGVyc1swXS5wYWdlWTsNCgkJCQl9KQ0KCQkJCS5vbigncG9pbnRlcmVuZC5zY3JvbGxmaXgnLCBmdW5jdGlvbiAoZSkgew0KCQkJCQlsYXN0WSA9IG51bGw7DQoJCQkJfSkNCgkJCQkub24oJ3BvaW50ZXJtb3ZlLnNjcm9sbGZpeCcsIGZ1bmN0aW9uIChlKSB7DQoJCQkJCWlmICghZS5wb2ludGVycyB8fCBlLnBvaW50ZXJzLmxlbmd0aCA9PSAwKQ0KCQkJCQkJcmV0dXJuOw0KDQoJCQkJCXZhciBpc0RpcmVjdGlvbkRvd24gPSBlLnBvaW50ZXJzWzBdLnBhZ2VZIC0gbGFzdFkgPiAwOw0KDQoJCQkJCXZhciBsaXN0ID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLnBvcHVwLWxpc3QgdWwuY29udGVudC1saXN0LmNvbnRlbnQnKTsNCgkJCQkJaWYgKCFsaXN0IHx8IGxpc3QubGVuZ3RoID09IDApIHsNCgkJCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJfQ0KDQoJCQkJCXZhciB1bCA9IGNvbnRleHQucG9wdXBDb250ZW50TGlzdC5nZXQoMCksDQoJCQkJCQl1bFNjcm9sbFRvcCA9IHVsLnNjcm9sbFRvcCwNCgkJCQkJCXVsU2Nyb2xsSGVpZ2h0ID0gdWwuc2Nyb2xsSGVpZ2h0LA0KCQkJCQkJdWxIZWlnaHQgPSB1bC5vZmZzZXRIZWlnaHQ7DQoNCgkJCQkJaWYgKHVsSGVpZ2h0ID09IDAgfHwgdWxTY3JvbGxIZWlnaHQgPT0gMCkNCgkJCQkJCXJldHVybjsNCg0KCQkJCQkvLyBsaXN0IGlzbid0IHNjcm9sbGFibGUsIHNvIGJsb2NrIHNjcm9sbGluZw0KCQkJCQlpZiAodWxTY3JvbGxIZWlnaHQgLSB1bEhlaWdodCA8PSAwKSB7DQoJCQkJCQllLnByZXZlbnREZWZhdWx0KCkNCgkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJfQ0KDQoJCQkJCS8vIGxpc3QgaXMgc2Nyb2xsYWJsZSBhbmQgYXQgdGhlIHRvcA0KCQkJCQlpZiAodWxTY3JvbGxUb3AgPT0gMCAmJiBpc0RpcmVjdGlvbkRvd24pIHsNCgkJCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJfQ0KCQkJCQkvLyBsaXN0IGlzIHNjcm9sbGFibGUgYW5kIGF0IGVuZA0KCQkJCQlpZiAoKHVsU2Nyb2xsVG9wICsgdWxIZWlnaHQgPj0gdWxTY3JvbGxIZWlnaHQpICYmICFpc0RpcmVjdGlvbkRvd24pIHsNCgkJCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJfQ0KCQkJCX0pOw0KDQoJCQlpZiAoIW1hc2spDQoJCQkJbWFzayA9ICQoJzxkaXY+PC9kaXY+JykNCgkJCQkJLmFkZENsYXNzKCdtYXNrJykNCgkJCQkJLmFwcGVuZFRvKCdib2R5JykNCgkJCQkJLmNzcyh7b3BhY2l0eTogMC4wMSwgekluZGV4OiAxfSkNCgkJCQkJLmV2b2x1dGlvblRyYW5zZm9ybSh7b3BhY2l0eTogMC43fSwge2R1cmF0aW9uOiAxNTB9KQ0KCQkJCQkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgew0KCQkJCQkJYXBpLmhpZGVDdXJyZW50KCk7DQoJCQkJCX0pOw0KDQoJCQlwcmV2ZW50Qm9keUJvdW5jZSgkKCdib2R5JykuY2hpbGRyZW4oKS5maXJzdCgpKTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIHVuYmxvY2tXaW5kb3dTY3JvbGxpbmcoY29udGV4dCkgew0KCQkJaWYgKCEkKCdib2R5JykuaGFzQ2xhc3MoJ3N0b3Atc2Nyb2xsaW5nJykpDQoJCQkJcmV0dXJuDQoNCgkJCSQoJ2JvZHknKS5yZW1vdmVDbGFzcygnc3RvcC1zY3JvbGxpbmcnKS5vZmYoJy5zY3JvbGxmaXgnKTsNCg0KCQkJaWYgKGNvbnRleHQucG9wdXBDb250ZW50TGlzdCkNCgkJCQljb250ZXh0LnBvcHVwQ29udGVudExpc3Qub2ZmKCdET01Nb3VzZVNjcm9sbCBtb3VzZXdoZWVsJyk7DQoNCgkJCWlmIChtYXNrKSB7DQoJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQoJCQkJCWlmIChtYXNrKSB7DQoJCQkJCQlpZiAoISQoJ2JvZHknKS5oYXNDbGFzcygnc3RvcC1zY3JvbGxpbmcnKSkgew0KCQkJCQkJCW1hc2suZXZvbHV0aW9uVHJhbnNmb3JtKHtvcGFjaXR5OiAwLjAxfSwge2R1cmF0aW9uOiAxMDB9KTsNCgkJCQkJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCQkJCQkJaWYgKG1hc2spDQoJCQkJCQkJCQltYXNrLnJlbW92ZSgpOw0KCQkJCQkJCQltYXNrID0gbnVsbDsNCgkJCQkJCQl9LCAxMDApOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfSwgMTAwKTsNCgkJCX0NCg0KCQkJYWxsb3dCb2R5Qm91bmNlKCQoJ2JvZHknKS5jaGlsZHJlbigpLmZpcnN0KCkpOw0KCQl9DQoNCgkJZnVuY3Rpb24gYWxsb3dCb2R5Qm91bmNlKHNlbGVjdGlvbikgew0KCQkJc2VsZWN0aW9uLm9mZignLnNjcm9sbGZpeCcpOw0KCQl9DQoNCgkJZnVuY3Rpb24gcHJldmVudEJvZHlCb3VuY2Uoc2VsZWN0aW9uKSB7DQoJCQl2YXIgb3JpZ2luYWxTY3JvbGxUb3AsDQoJCQkJZWxlbSA9IHNlbGVjdGlvbi5nZXQoMCk7DQoJCQlzZWxlY3Rpb24ub24oJ3BvaW50ZXJzdGFydC5zY3JvbGxmaXgnLCBmdW5jdGlvbiAoZSkgew0KCQkJCW9yaWdpbmFsU2Nyb2xsVG9wID0gZWxlbS5zY3JvbGxUb3A7DQoNCgkJCQlpZiAob3JpZ2luYWxTY3JvbGxUb3AgPD0gMCkNCgkJCQkJZWxlbS5zY3JvbGxUb3AgPSAxOw0KDQoJCQkJaWYgKG9yaWdpbmFsU2Nyb2xsVG9wICsgZWxlbS5vZmZzZXRIZWlnaHQgPj0gZWxlbS5zY3JvbGxIZWlnaHQpDQoJCQkJCWVsZW0uc2Nyb2xsVG9wID0gZWxlbS5zY3JvbGxIZWlnaHQgLSBlbGVtLm9mZnNldEhlaWdodCAtIDE7DQoNCgkJCQlvcmlnaW5hbFNjcm9sbExlZnQgPSBlbGVtLnNjcm9sbExlZnQ7DQoNCgkJCQlpZiAob3JpZ2luYWxTY3JvbGxMZWZ0IDw9IDApDQoJCQkJCWVsZW0uc2Nyb2xsTGVmdCA9IDE7DQoNCgkJCQlpZiAob3JpZ2luYWxTY3JvbGxMZWZ0ICsgZWxlbS5vZmZzZXRXaWR0aCA+PSBlbGVtLnNjcm9sbFdpZHRoKQ0KCQkJCQllbGVtLnNjcm9sbExlZnQgPSBlbGVtLnNjcm9sbFdpZHRoIC0gZWxlbS5vZmZzZXRXaWR0aCAtIDE7DQoJCQl9KTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGJ1aWxkQ291bnRCdWJibGUoY29udGV4dCkgew0KCQkJLyp2YXIgd3JhcHBlciA9IGNvbnRleHQuYWN0aXZhdGlvbkxpbmsud3JhcCgnPHNwYW4+PC9zcGFuPicpLnBhcmVudCgnc3BhbicpLmNzcyh7DQoJCQkgcG9zaXRpb246ICdyZWxhdGl2ZScNCgkJCSB9KTsqLw0KCQkJdmFyIHdyYXBwZXIgPSBjb250ZXh0LmFjdGl2YXRpb25MaW5rLnBhcmVudCgpOw0KCQkJdmFyIGNvdW50ID0gJCgnPGEgaHJlZj0iIyIgY2xhc3M9InBvcHVwLWxpc3QtY291bnQgJyArIGNvbnRleHQudGl0bGVDb3VudENsYXNzICsgJyI+PC9hPicpOw0KCQkJY291bnQuYXBwZW5kVG8od3JhcHBlcikuaGlkZSgpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7DQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCWNvbnRleHQuYWN0aXZhdGlvbkxpbmsuY2xpY2soKTsNCgkJCX0pOw0KCQkJcmV0dXJuIGNvdW50Ow0KCQl9DQoNCgkJZnVuY3Rpb24gYnVpbGRVbnJlYWRDb3VudE1lc3NhZ2UoY29udGV4dCwgY291bnQpIHsNCgkJCWNvdW50ID0gY291bnQgfHwgMDsNCgkJCWlmIChjb3VudCA9PT0gMSkgew0KCQkJCXJldHVybiBjb250ZXh0LnVucmVhZENvdW50TWVzc2FnZVNpbmd1bGFyLnJlcGxhY2UoL1x7MFx9L2dpLCBjb3VudCk7DQoJCQl9DQoJCQllbHNlIHsNCgkJCQlyZXR1cm4gY29udGV4dC51bnJlYWRDb3VudE1lc3NhZ2VQbHVyYWwucmVwbGFjZSgvXHswXH0vZ2ksIGNvdW50KTsNCgkJCX0NCgkJfQ0KDQoJCWZ1bmN0aW9uIHNob3dVbnJlYWRDb3VudChjb250ZXh0LCBjb3VudCkgew0KCQkJaWYgKCFjb250ZXh0LnNob3dDb3VudCkNCgkJCQlyZXR1cm47DQoJCQl2YXIgZGlmZmVyZW5jZSA9IGNvdW50IC0gY29udGV4dC5wcmV2aW91c0NvdW50Ow0KCQkJY29udGV4dC5wcmV2aW91c0NvdW50ID0gY291bnQ7DQoJCQlpZiAoY29udGV4dC50aXRsZUNvdW50KSB7DQoJCQkJdG90YWxUaXRsZUNvdW50ICs9IGRpZmZlcmVuY2U7DQoJCQkJdXBkYXRlVGl0bGUoY29udGV4dCk7DQoJCQl9DQoJCQl2YXIgdW5yZWFkQ291bnRNZXNzYWdlID0gYnVpbGRVbnJlYWRDb3VudE1lc3NhZ2UoY29udGV4dCwgY291bnQpOw0KCQkJaWYgKGNvdW50IDw9IDApIHsNCgkJCQkvLyByZW1vdmUgYnViYmxlIHVpDQoJCQkJaWYgKGNvbnRleHQuY291bnQpDQoJCQkJCWNvbnRleHQuY291bnQuZmFkZU91dCgyMDApOw0KCQkJCWNvbnRleHQuYWN0aXZhdGlvbkxpbmsuYXR0cignZGF0YS10aXAnLCB1bnJlYWRDb3VudE1lc3NhZ2UpLmF0dHIoJ3RpdGxlJywgdW5yZWFkQ291bnRNZXNzYWdlKTsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCS8vIGFkZCBidWJibGUgdWkgaWYgbm90IHRoZXJlDQoJCQkJY29udGV4dC5jb3VudCA9IGNvbnRleHQuY291bnQgfHwgYnVpbGRDb3VudEJ1YmJsZShjb250ZXh0KTsNCgkJCQkvLyBzZXQgdGhlIGNvdW50IGFuZCBkaXNwbGF5IGl0DQoJCQkJY29udGV4dC5jb3VudA0KCQkJCQkuaHRtbCgoY29udGV4dC5saW1pdENvdW50ICYmIGNvbnRleHQubGltaXRDb3VudCA8IGNvdW50KSA/IGNvbnRleHQubGltaXRDb3VudCArICIrIiA6IGNvdW50KQ0KCQkJCQkuYXR0cigndGl0bGUnLCB1bnJlYWRDb3VudE1lc3NhZ2UpDQoJCQkJCS5mYWRlSW4oMjAwKTsNCgkJCQljb250ZXh0LmFjdGl2YXRpb25MaW5rLmF0dHIoJ2RhdGEtdGlwJywgdW5yZWFkQ291bnRNZXNzYWdlKS5hdHRyKCd0aXRsZScsIHVucmVhZENvdW50TWVzc2FnZSk7DQoJCQl9DQoJCX0NCg0KCQlmdW5jdGlvbiBsb2FkU2hvd1NldHRpbmdzKGFjdGl2YXRvciwgY29udGV4dCkgew0KCQkJcmV0dXJuICQuRGVmZXJyZWQoZnVuY3Rpb24gKGRmZCkgew0KCQkJCWNvbnRleHQub25TaG93KGFjdGl2YXRvciwgZnVuY3Rpb24gKHNldHRpbmdzKSB7DQoJCQkJCWRmZC5yZXNvbHZlKCQuZXh0ZW5kKHt9LCBkZWZhdWx0U2hvd1NldHRpbmdzLCBzZXR0aW5ncyB8fCB7fSkpOw0KCQkJCX0pOw0KCQkJfSkucHJvbWlzZSgpOw0KCQl9DQoNCgkJZnVuY3Rpb24gbG9hZENvbnRlbnQoY29udGV4dCwgcGFnZUluZGV4LCBzaG91bGRSZWZyZXNoVW5yZWFkQ291bnQpIHsNCgkJCWNvbnRleHQubG9hZGluZyA9IHRydWU7DQoJCQkvLyBjYWxsIHRoZSBpbmplY3RlZCBsb2FkaW5nIG1ldGhvZCwgYW5kIHJldHVybiBhIHByb21pc2UNCgkJCS8vIHdoaWNoLCB3aGVuIGRvbmUsIHByb3ZpZGVzIHRoZSBjb250ZW50IGZyb20gdGhlIGxvYWRpbmcgbWV0aG9kDQoJCQlyZXR1cm4gJC5EZWZlcnJlZChmdW5jdGlvbiAoZGZkKSB7DQoJCQkJaWYgKGNvbnRleHQub25TaG93TG9hZGluZ0luZGljYXRvcigpKSB7DQoJCQkJCXNob3dMb2FkaW5nKGNvbnRleHQsIChwYWdlSW5kZXggPiAwKSk7DQoJCQkJfQ0KCQkJCWNvbnRleHQub25Mb2FkKHBhZ2VJbmRleCwgc2hvdWxkUmVmcmVzaFVucmVhZENvdW50LCBjb250ZXh0LmZpbHRlciB8fCAnJywgZnVuY3Rpb24gKGNvbnRlbnQpIHsNCgkJCQkJaWYgKGNvbnRlbnQgPT09IG51bGwgfHwgY29udGVudCA9PT0gdW5kZWYpIHsNCgkJCQkJCWRmZC5yZWplY3QoKTsNCgkJCQkJfQ0KCQkJCQllbHNlIHsNCgkJCQkJCWlmIChjb250ZXh0Lm9uU2hvd0xvYWRpbmdJbmRpY2F0b3IoKSkNCgkJCQkJCQloaWRlTG9hZGluZyhjb250ZXh0LCAocGFnZUluZGV4ID4gMCkpOw0KCQkJCQkJZGZkLnJlc29sdmUoY29udGVudCk7DQoJCQkJCX0NCgkJCQl9KTsNCgkJCX0pLnByb21pc2UoKTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGJ1aWxkUG9wVXAoY29udGV4dCkgew0KCQkJY29udGV4dC5jb21waWxlZFRlbXBsYXRlID0gY29udGV4dC5jb21waWxlZFRlbXBsYXRlIHx8ICQudGVsbGlnZW50LmV2b2x1dGlvbi50ZW1wbGF0ZS5jb21waWxlKGNvbnRleHQudGVtcGxhdGUpOw0KDQoJCQljb250ZXh0LnBvcHVwID0gJChjb250ZXh0LmNvbXBpbGVkVGVtcGxhdGUoY29udGV4dCkpOw0KCQkJY29udGV4dC5sb2FkaW5nSW5kaWNhdG9yID0gY29udGV4dC5wb3B1cC5maW5kKCcubG9hZGluZycpLmhpZGUoKTsNCgkJCWNvbnRleHQucG9wdXBDb250ZW50TGlzdCA9IGNvbnRleHQucG9wdXAuZmluZCgnLmNvbnRlbnQtbGlzdCcpOw0KCQkJY29udGV4dC5mb290ZXIgPSBjb250ZXh0LnBvcHVwLmZpbmQoJy5jb250ZW50LWxpc3QtZm9vdGVyJyk7DQoJCQljb250ZXh0LnBvcHVwLmdsb3dQb3BVcFBhbmVsKHsNCgkJCQljc3NDbGFzczogJ3BvcHVwLWxpc3QgJyArIGNvbnRleHQuY3NzQ2xhc3MsDQoJCQkJaGlkZU9uRG9jdW1lbnRDbGljazogZmFsc2UsDQoJCQkJaGlkZU9uUmVzaXplOiAoc3VwcG9ydHNUb3VjaCgpID8gZmFsc2UgOiB0cnVlKSwNCgkJCQlwb3NpdGlvbjogJ2Rvd24nLA0KCQkJCXpJbmRleDogMTAwMA0KCQkJfSkub24oJ2dsb3dQb3BVcFBhbmVsSGlkZGVuJywgZnVuY3Rpb24gKCkgew0KCQkJCShjb250ZXh0LmFjdGl2YXRvcikucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCWNvbnRleHQub25IaWRlKCk7DQoJCQkJdW5ibG9ja1dpbmRvd1Njcm9sbGluZyhjb250ZXh0KTsNCgkJCX0pOw0KCQkJJChkb2N1bWVudCkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgew0KCQkJCWNvbnRleHQucG9wdXAuZ2xvd1BvcFVwUGFuZWwoJ2hpZGUnKTsNCgkJCX0pOw0KCQkJaWYgKGNvbnRleHQub25CdWlsZEZpbHRlciAhPT0gbnVsbCkgew0KCQkJCXZhciBmaWx0ZXIgPSBjb250ZXh0Lm9uQnVpbGRGaWx0ZXIoZnVuY3Rpb24gKHJlc3VsdCkgew0KCQkJCQlpZiAoIWlzT3Blbk9yT3BlbmluZyhjb250ZXh0KSkNCgkJCQkJCXJldHVybjsNCgkJCQkJY29udGV4dC5maWx0ZXIgPSByZXN1bHQ7DQoJCQkJCWNvbnRleHQuY3VycmVudFBhZ2VJbmRleCA9IDA7DQoJCQkJCWxvYWRDb250ZW50KGNvbnRleHQsIGNvbnRleHQuY3VycmVudFBhZ2VJbmRleCwgdHJ1ZSkudGhlbihmdW5jdGlvbiAoY29udGVudCkgew0KCQkJCQkJYXBwZW5kVG9Qb3B1cChjb250ZXh0LCBjb250ZW50LCB0cnVlKTsNCgkJCQkJfSk7DQoJCQkJfSk7DQoJCQkJaWYgKGZpbHRlcikgew0KCQkJCQkkKGZpbHRlcikuaW5zZXJ0QmVmb3JlKGNvbnRleHQucG9wdXBDb250ZW50TGlzdCk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCgkJZnVuY3Rpb24gc2hvd0xvYWRpbmcoY29udGV4dCwgYXBwZW5kKSB7DQoJCQlpZiAoYXBwZW5kKSB7DQoJCQkJY29udGV4dC5sb2FkaW5nSW5kaWNhdG9yLnNob3coKTsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KCQkJCQlpZiAoIWNvbnRleHQubG9hZGluZykNCgkJCQkJCXJldHVybjsNCgkJCQkJaWYgKG9wZW5IZWFkZXJMaXN0Q29udGV4dCkgew0KCQkJCQkJaGlkZVBvcHVwKG9wZW5IZWFkZXJMaXN0Q29udGV4dCk7DQoJCQkJCX0NCgkJCQkJb3BlbkhlYWRlckxpc3RDb250ZXh0ID0gY29udGV4dDsNCgkJCQkJY29udGV4dC5wb3B1cC5nbG93UG9wVXBQYW5lbCgnc2hvdycsIChjb250ZXh0LnNob3dTZXR0aW5ncy5hdHRhY2hUbyB8fCBjb250ZXh0LmFjdGl2YXRvciksIHRydWUpOw0KCQkJCQljb250ZXh0LmxvYWRpbmdJbmRpY2F0b3Iuc2hvdygpOw0KCQkJCQkoY29udGV4dC5hY3RpdmF0b3IpLnBhcmVudCgpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCQkJYmxvY2tXaW5kb3dTY3JvbGxpbmcoY29udGV4dCk7DQoJCQkJfSwgMjApOw0KCQkJfQ0KCQl9DQoNCgkJZnVuY3Rpb24gaGlkZUxvYWRpbmcoY29udGV4dCwgYXBwZW5kKSB7DQoJCQljb250ZXh0LmxvYWRpbmdJbmRpY2F0b3IuaGlkZSgpLnJlbW92ZSgpOw0KCQl9DQoNCgkJZnVuY3Rpb24gc2hvd1BvcHVwKGNvbnRleHQsIGNvbnRlbnQsIHNob3dTZXR0aW5ncykgew0KCQkJaWYgKG9wZW5IZWFkZXJMaXN0Q29udGV4dCkgew0KCQkJCWhpZGVQb3B1cChvcGVuSGVhZGVyTGlzdENvbnRleHQpOw0KCQkJfQ0KCQkJb3BlbkhlYWRlckxpc3RDb250ZXh0ID0gY29udGV4dDsNCgkJCWNvbnRleHQucG9wdXBDb250ZW50TGlzdC5odG1sKGNvbnRlbnQpOw0KCQkJY29udGV4dC5wb3B1cC5nbG93UG9wVXBQYW5lbCgnc2hvdycsIChzaG93U2V0dGluZ3MuYXR0YWNoVG8gfHwgY29udGV4dC5hY3RpdmF0b3IpLCB0cnVlKTsNCgkJCWNvbnRleHQubG9hZGluZyA9IGZhbHNlOw0KCQkJY29udGV4dC5oYXNNb3JlID0gY29udGV4dC5wb3B1cENvbnRlbnRMaXN0LmNoaWxkcmVuKCdsaTpsYXN0JykuZGF0YSgnaGFzbW9yZScpID8gdHJ1ZSA6IGZhbHNlOw0KCQkJKGNvbnRleHQuYWN0aXZhdG9yKS5wYXJlbnQoKS5hZGRDbGFzcygnYWN0aXZlJyk7DQoJCQljb250ZXh0LnBvcHVwQ29udGVudCA9IGNvbnRleHQucG9wdXBDb250ZW50TGlzdC5jbG9zZXN0KCcucG9wdXAtbGlzdCcpOw0KCQkJY29udGV4dC5wb3B1cENvbnRhaW5lciA9IGNvbnRleHQucG9wdXBDb250ZW50LnBhcmVudCgpOw0KCQkJY29udGV4dC5wb3B1cENvbnRhaW5lci5jc3Moe2hlaWdodDogY29udGV4dC5wb3B1cENvbnRlbnQub3V0ZXJIZWlnaHQoKX0pOw0KCQkJY29udGV4dC5wb3B1cENvbnRlbnQuZmluZCgnLnVpLXZpZXdodG1sJykub24oJ3JlbmRlcmVkJywgZnVuY3Rpb24gKCkgew0KCQkJCWdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCQkJY29udGV4dC5wb3B1cENvbnRhaW5lci5jc3Moe2hlaWdodDogY29udGV4dC5wb3B1cENvbnRlbnQub3V0ZXJIZWlnaHQoKX0pOw0KCQkJCX0sIDI1MCk7DQoJCQl9KTsNCgkJCWJsb2NrV2luZG93U2Nyb2xsaW5nKGNvbnRleHQpOw0KCQkJY29udGV4dC5jdXJyZW50SXRlbUluZGV4ID0gbnVsbDsNCgkJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5tZXNzYWdpbmcucHVibGlzaChhY3RpdmF0ZU1lc3NhZ2UsIHtrZXk6IGNvbnRleHQua2V5fSk7DQoJCX0NCg0KCQlmdW5jdGlvbiBoaWRlUG9wdXAoY29udGV4dCkgew0KCQkJY29udGV4dC5wb3B1cC5nbG93UG9wVXBQYW5lbCgnaGlkZScpOw0KCQkJdW5ibG9ja1dpbmRvd1Njcm9sbGluZyhjb250ZXh0KTsNCgkJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5tZXNzYWdpbmcucHVibGlzaChkZWFjdGl2YXRlTWVzc2FnZSwge2tleTogY29udGV4dC5rZXl9KTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGFwcGVuZFRvUG9wdXAoY29udGV4dCwgY29udGVudCwgc2hvdWxkUmVwbGFjZSkgew0KCQkJaWYgKGNvbnRlbnQgPT09IG51bGwpDQoJCQkJcmV0dXJuOw0KCQkJaWYgKHNob3VsZFJlcGxhY2UpIHsNCgkJCQljb250ZXh0LnBvcHVwQ29udGVudExpc3QuaHRtbChjb250ZW50KTsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCWNvbnRleHQucG9wdXBDb250ZW50TGlzdC5hcHBlbmQoY29udGVudCk7DQoJCQl9DQoJCQljb250ZXh0LmxvYWRpbmcgPSBmYWxzZTsNCgkJCWNvbnRleHQuaGFzTW9yZSA9IGNvbnRleHQucG9wdXBDb250ZW50TGlzdC5jaGlsZHJlbignbGk6bGFzdCcpLmRhdGEoJ2hhc21vcmUnKSA/IHRydWUgOiBmYWxzZTsNCgkJCWNvbnRleHQucG9wdXBDb250ZW50ID0gY29udGV4dC5wb3B1cENvbnRlbnRMaXN0LmNsb3Nlc3QoJy5wb3B1cC1saXN0Jyk7DQoJCQljb250ZXh0LnBvcHVwQ29udGFpbmVyID0gY29udGV4dC5wb3B1cENvbnRlbnQucGFyZW50KCk7DQoJCQljb250ZXh0LnBvcHVwQ29udGFpbmVyLmNzcyh7aGVpZ2h0OiBjb250ZXh0LnBvcHVwQ29udGVudC5vdXRlckhlaWdodCgpfSk7DQoJCQljb250ZXh0LnBvcHVwQ29udGVudC5maW5kKCcudWktdmlld2h0bWwnKS5vbigncmVuZGVyZWQnLCBmdW5jdGlvbiAoKSB7DQoJCQkJZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KCQkJCQljb250ZXh0LnBvcHVwQ29udGFpbmVyLmNzcyh7aGVpZ2h0OiBjb250ZXh0LnBvcHVwQ29udGVudC5vdXRlckhlaWdodCgpfSk7DQoJCQkJfSwgMjUwKTsNCgkJCX0pOw0KCQl9DQoNCgkJZnVuY3Rpb24gZGVhY3RpdmF0ZShjb250ZXh0KSB7DQoJCQloaWRlUG9wdXAoY29udGV4dCk7DQoJCX0NCg0KCQlmdW5jdGlvbiBhY3RpdmF0ZShhY3RpdmF0b3IsIGNvbnRleHQpIHsNCgkJCWNvbnRleHQuY3VycmVudFBhZ2VJbmRleCA9IDA7DQoJCQljb250ZXh0Lmhhc01vcmUgPSB0cnVlOw0KCQkJYWN0aXZhdG9yLnBhcmVudCgpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCWxvYWRTaG93U2V0dGluZ3MoYWN0aXZhdG9yLCBjb250ZXh0KS50aGVuKGZ1bmN0aW9uIChzaG93U2V0dGluZ3MpIHsNCgkJCQljb250ZXh0LnNob3dTZXR0aW5ncyA9IHNob3dTZXR0aW5nczsNCgkJCQljb250ZXh0LnBvcHVwQ29udGVudExpc3QuY3NzKHsNCgkJCQkJd2lkdGg6IHNob3dTZXR0aW5ncy53aWR0aCwNCgkJCQkJbWF4SGVpZ2h0OiBzaG93U2V0dGluZ3MubWF4SGVpZ2h0DQoJCQkJfSk7DQoJCQkJbG9hZENvbnRlbnQoY29udGV4dCwgY29udGV4dC5jdXJyZW50UGFnZUluZGV4LCB0cnVlKS50aGVuKGZ1bmN0aW9uIChjb250ZW50KSB7DQoJCQkJCXNob3dQb3B1cChjb250ZXh0LCBjb250ZW50LCBzaG93U2V0dGluZ3MpOw0KCQkJCQljb250ZXh0LnBvcHVwQ29udGFpbmVyLnJlbW92ZUNsYXNzKCkuYWRkQ2xhc3Moc2hvd1NldHRpbmdzLmNvbnRhaW5lckNzc0NsYXNzKTsNCgkJCQl9KTsNCgkJCX0pOw0KCQl9DQoNCgkJZnVuY3Rpb24gaGFuZGxlUG9wb3VwT3BlbmVyQ2xpY2sobGluaywgY29udGV4dCkgew0KCQkJaWYgKGNvbnRleHQucG9wdXAuZ2xvd1BvcFVwUGFuZWwoJ2lzT3BlbmluZycpKSB7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KCQkJZWxzZSBpZiAoY29udGV4dC5wb3B1cC5nbG93UG9wVXBQYW5lbCgnaXNTaG93bicpKSB7DQoJCQkJaGlkZVBvcHVwKGNvbnRleHQpOw0KCQkJCWRlYWN0aXZhdGUoY29udGV4dCk7DQoJCQl9DQoJCQllbHNlIHsNCgkJCQlhY3RpdmF0ZShsaW5rLCBjb250ZXh0KTsNCgkJCX0NCgkJfQ0KDQoJCWZ1bmN0aW9uIGlzT3Blbk9yT3BlbmluZyhjb250ZXh0KSB7DQoJCQlyZXR1cm4gY29udGV4dC5wb3B1cC5nbG93UG9wVXBQYW5lbCgnaXNPcGVuaW5nJykgfHwNCgkJCQljb250ZXh0LnBvcHVwLmdsb3dQb3BVcFBhbmVsKCdpc1Nob3duJyk7DQoJCX0NCg0KCQlmdW5jdGlvbiBtb3ZlKGNvbnRleHQsIGRpcmVjdGlvbiwgaGFuZGxlcikgew0KCQkJdmFyIGF2YWlsYWJsZUl0ZW1zID0gJChjb250ZXh0LnBvcHVwQ29udGVudExpc3QuY2hpbGRyZW4oJ2xpLmNvbnRlbnQtaXRlbScpKTsNCgkJCWlmIChhdmFpbGFibGVJdGVtcy5sZW5ndGggPT0gMCkNCgkJCQlyZXR1cm47DQoNCgkJCWF2YWlsYWJsZUl0ZW1zLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpOw0KDQoJCQlpZiAoY29udGV4dC5jdXJyZW50SXRlbUluZGV4ID09PSBudWxsKSB7DQoJCQkJY29udGV4dC5jdXJyZW50SXRlbUluZGV4ID0gMDsNCgkJCX0NCgkJCWVsc2UgaWYgKGRpcmVjdGlvbiA9PSAnZG93bicpIHsNCgkJCQljb250ZXh0LmN1cnJlbnRJdGVtSW5kZXgrKzsNCgkJCQlpZiAoY29udGV4dC5jdXJyZW50SXRlbUluZGV4ID49IGF2YWlsYWJsZUl0ZW1zLmxlbmd0aCkNCgkJCQkJY29udGV4dC5jdXJyZW50SXRlbUluZGV4ID0gMDsNCgkJCX0NCgkJCWVsc2UgaWYgKGRpcmVjdGlvbiA9PSAndXAnKSB7DQoJCQkJY29udGV4dC5jdXJyZW50SXRlbUluZGV4LS07DQoJCQkJaWYgKGNvbnRleHQuY3VycmVudEl0ZW1JbmRleCA8IDApDQoJCQkJCWNvbnRleHQuY3VycmVudEl0ZW1JbmRleCA9IChhdmFpbGFibGVJdGVtcy5sZW5ndGggLSAxKTsNCgkJCX0NCg0KCQkJLy8gZ2V0IGl0ZW0gdG8gc2Nyb2xsIHRvDQoJCQl2YXIgc2VsZWN0ZWRJdGVtID0gJChhdmFpbGFibGVJdGVtc1tjb250ZXh0LmN1cnJlbnRJdGVtSW5kZXhdKTsNCgkJCWlmICghc2VsZWN0ZWRJdGVtKQ0KCQkJCXJldHVybjsNCg0KCQkJLy8gc2Nyb2xsIHRvIGl0DQoJCQljb250ZXh0LnBvcHVwQ29udGVudExpc3QuYW5pbWF0ZSh7DQoJCQkJc2Nyb2xsVG9wOiAoY29udGV4dC5wb3B1cENvbnRlbnRMaXN0LnNjcm9sbFRvcCgpIC0NCgkJCQljb250ZXh0LnBvcHVwQ29udGVudExpc3Qub2Zmc2V0KCkudG9wICsNCgkJCQlzZWxlY3RlZEl0ZW0ub2Zmc2V0KCkudG9wIC0NCgkJCQlzZWxlY3RlZEl0ZW0uaGVpZ2h0KCkpDQoJCQl9LCAxMDApOw0KDQoJCQkvLyBoaWdobGlnaHQgaXQNCgkJCXNlbGVjdGVkSXRlbS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsNCg0KCQkJLy8gaW5mb3JtIGNhbGxpbmcgY29kZSBvZiBzZWxlY3Rpb24NCgkJCWhhbmRsZXIoc2VsZWN0ZWRJdGVtKTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGhhbmRsZUV2ZW50cyhjb250ZXh0KSB7DQoJCQljb250ZXh0LmFjdGl2YXRpb25MaW5rLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7DQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCWhhbmRsZVBvcG91cE9wZW5lckNsaWNrKGNvbnRleHQuYWN0aXZhdGlvbkxpbmssIGNvbnRleHQpOw0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0pOw0KCQkJLy8gZ28gYWhlYWQgYW5kIGltbWVpZGF0ZWx5IGhhbmRsZSwgYXMgaGFuZGxlRXZlbnRzIGlzIG9ubHkNCgkJCS8vIGZpcnN0IGNhbGxlZCBmcm9tIGEgZGVmZXJyZWQgY2xpY2sNCgkJCS8vIGhhbmRsZVBvcG91cE9wZW5lckNsaWNrKGNvbnRleHQuYWN0aXZhdGlvbkxpbmssIGNvbnRleHQpOw0KDQoJCQljb250ZXh0LmFjdGl2YXRpb25JbnB1dC5vbih7DQoJCQkJZm9jdXM6IGZ1bmN0aW9uIChlKSB7DQoJCQkJCWUucHJldmVudERlZmF1bHQoKTsNCg0KCQkJCQl2YXIgdmFsID0gJC50cmltKGNvbnRleHQuYWN0aXZhdGlvbklucHV0LnZhbCgpKTsNCgkJCQkJaWYgKCFpc09wZW5Pck9wZW5pbmcoY29udGV4dCkgJiYgdmFsLmxlbmd0aCA+PSAzKSB7DQoJCQkJCQlhY3RpdmF0ZSgkKGUudGFyZ2V0KSwgY29udGV4dCk7DQoJCQkJCX0NCg0KCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJfSwNCgkJCQlibHVyOiBmdW5jdGlvbiAoZSkgew0KCQkJCX0sDQoJCQkJJ2lucHV0IHByb3BlcnR5Y2hhbmdlJzogZnVuY3Rpb24gKGUpIHsNCgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KDQoJCQkJCWlmIChlLnR5cGUgPT0gJ3Byb3BlcnR5Y2hhbmdlJyAmJiBlLm9yaWdpbmFsRXZlbnQucHJvcGVydHlOYW1lICE9ICJ2YWx1ZSIpDQoJCQkJCQlyZXR1cm4gZmFsc2U7DQoNCgkJCQkJdmFyIHZhbCA9ICQudHJpbShjb250ZXh0LmFjdGl2YXRpb25JbnB1dC52YWwoKSk7DQoJCQkJCWlmICghaXNPcGVuT3JPcGVuaW5nKGNvbnRleHQpICYmIHZhbC5sZW5ndGggPj0gMykgew0KCQkJCQkJYWN0aXZhdGUoJChlLnRhcmdldCksIGNvbnRleHQpOw0KCQkJCQl9DQoJCQkJCWVsc2UgaWYgKGlzT3Blbk9yT3BlbmluZyhjb250ZXh0KSAmJiB2YWwubGVuZ3RoIDwgMykgew0KCQkJCQkJZGVhY3RpdmF0ZShjb250ZXh0KTsNCgkJCQkJfQ0KDQoJCQkJCXJldHVybiBmYWxzZTsNCgkJCQl9DQoNCg0KCQkJfSk7DQoJCQkvLyBoYW5kbGUgZW5kbGVzcyBzY3JvbGxpbmcgaWYgZW5hYmxlZA0KCQkJaWYgKGNvbnRleHQuZW5kbGVzc1Njcm9sbCkgew0KCQkJCWNvbnRleHQucG9wdXBDb250ZW50TGlzdC5vbignc2Nyb2xsZW5kJywgZnVuY3Rpb24gKCkgew0KCQkJCQlpZiAoIWNvbnRleHQuaGFzTW9yZSkgew0KCQkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCQl9DQoJCQkJCWlmIChjb250ZXh0LmxvYWRpbmcpIHsNCgkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJfQ0KCQkJCQljb250ZXh0LmN1cnJlbnRQYWdlSW5kZXgrKzsNCgkJCQkJbG9hZENvbnRlbnQoY29udGV4dCwgY29udGV4dC5jdXJyZW50UGFnZUluZGV4LCB0cnVlKS5kb25lKGZ1bmN0aW9uIChjb250ZW50KSB7DQoJCQkJCQlhcHBlbmRUb1BvcHVwKGNvbnRleHQsIGNvbnRlbnQpOw0KCQkJCQl9KTsNCgkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCX0pOw0KCQkJfQ0KDQoJCQljb250ZXh0LnBvcHVwQ29udGVudExpc3Qub24oJ2NsaWNrJywgJy5jb250ZW50LWl0ZW0nLCBmdW5jdGlvbiAoZSkgew0KCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQljb250ZXh0Lm9uU2VsZWN0KHRoaXMpOw0KCQkJfSk7DQoJCQljb250ZXh0LnBvcHVwQ29udGVudExpc3Qub24oJ2NsaWNrJywgJ2EnLCBmdW5jdGlvbiAoZSkgew0KCQkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7DQoJCQl9KTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGluaXRDb250ZXh0KGNvbnRleHQpIHsNCgkJCWNvbnRleHQuYWN0aXZhdGlvbkxpbmsgPSAkKGNvbnRleHQuYWN0aXZhdGlvbkxpbmspOw0KCQkJY29udGV4dC5hY3RpdmF0aW9uSW5wdXQgPSAkKGNvbnRleHQuYWN0aXZhdGlvbklucHV0KTsNCgkJCWNvbnRleHQuYWN0aXZhdG9yID0gY29udGV4dC5hY3RpdmF0aW9uTGluay5sZW5ndGggPiAwID8gY29udGV4dC5hY3RpdmF0aW9uTGluayA6IGNvbnRleHQuYWN0aXZhdGlvbklucHV0Ow0KCQl9DQoNCgkJZnVuY3Rpb24gYXBpKG9wdGlvbnMpIHsNCgkJCS8vIHByaXZhdGUgaW5zdGFuY2UgbWVtYmVycyBvZiBhIEhlYWRlckxpc3QNCgkJCXZhciBjb250ZXh0ID0gJC5leHRlbmQoe30sIGRlZmF1bHRzLCBvcHRpb25zIHx8IHt9KTsNCgkJCWluaXRDb250ZXh0KGNvbnRleHQpOw0KCQkJdmFyIGluaXRlZCA9IGZhbHNlOw0KDQoJCQlmdW5jdGlvbiBpbml0KCkgew0KCQkJCWlmIChpbml0ZWQpDQoJCQkJCXJldHVybjsNCgkJCQlpbml0ZWQgPSB0cnVlOw0KCQkJCWJ1aWxkUG9wVXAoY29udGV4dCk7DQoJCQkJaGFuZGxlRXZlbnRzKGNvbnRleHQpOw0KCQkJfQ0KDQoJCQkvLyBsYXp5LXNldHVwIHVudGlsIGNsaWNrZWQNCgkJCWNvbnRleHQuYWN0aXZhdGlvbkxpbmsub25lKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7DQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCWluaXQoKTsNCgkJCQljb250ZXh0LmFjdGl2YXRpb25MaW5rLmNsaWNrKCk7DQoJCQl9KTsNCgkJCWNvbnRleHQuYWN0aXZhdGlvbklucHV0Lm9uZSgnZm9jdXMnLCBmdW5jdGlvbiAoZSkgew0KCQkJCWluaXQoKTsNCgkJCQljb250ZXh0LmFjdGl2YXRpb25JbnB1dC5mb2N1cygpOw0KCQkJfSk7DQoJCQlzaG93VW5yZWFkQ291bnQoY29udGV4dCwgY29udGV4dC5pbml0aWFsVW5yZWFkQ291bnQpOw0KDQoJCQkvLyBwdWJsaWMgaW5zdGFuY2UgbWVtYmVycyBvZiBhIEhlYWRlckxpc3QNCgkJCXJldHVybiB7DQoJCQkJcmVmcmVzaFVucmVhZENvdW50OiBmdW5jdGlvbiAoKSB7DQoJCQkJCXJldHVybiBjb250ZXh0Lm9uUmVmcmVzaFVucmVhZENvdW50KGZ1bmN0aW9uIChuZXdDb3VudCkgew0KCQkJCQkJc2hvd1VucmVhZENvdW50KGNvbnRleHQsIG5ld0NvdW50KTsNCgkJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KCQkJCQkJCWlmIChjb250ZXh0LnBvcHVwQ29udGFpbmVyKQ0KCQkJCQkJCQljb250ZXh0LnBvcHVwQ29udGFpbmVyLmNzcyh7aGVpZ2h0OiBjb250ZXh0LnBvcHVwQ29udGVudC5vdXRlckhlaWdodCgpfSk7DQoJCQkJCQl9LCAxMTApDQoJCQkJCX0pOw0KCQkJCX0sDQoJCQkJcmVmcmVzaENvbnRlbnQ6IGZ1bmN0aW9uICgpIHsNCgkJCQkJLy8gcmVmcmVzaGluZyBjb250ZW50IG9ubHkgaGFzIGFuIGVmZmVjdCBpZiBhbHJlYWR5IHNob3duDQoJCQkJCWlmIChjb250ZXh0LnBvcHVwICYmIGNvbnRleHQucG9wdXAuZ2xvd1BvcFVwUGFuZWwoJ2lzU2hvd24nKSkgew0KCQkJCQkJY29udGV4dC5jdXJyZW50UGFnZUluZGV4ID0gMDsNCgkJCQkJCWxvYWRDb250ZW50KGNvbnRleHQsIGNvbnRleHQuY3VycmVudFBhZ2VJbmRleCwgZmFsc2UpLnRoZW4oZnVuY3Rpb24gKGNvbnRlbnQpIHsNCgkJCQkJCQlhcHBlbmRUb1BvcHVwKGNvbnRleHQsIGNvbnRlbnQsIHRydWUpOw0KCQkJCQkJfSk7DQoJCQkJCX0NCgkJCQl9LA0KCQkJCWNvbnRlbnQ6IGZ1bmN0aW9uICgpIHsNCgkJCQkJcmV0dXJuIGNvbnRleHQucG9wdXBDb250ZW50TGlzdDsNCgkJCQl9LA0KCQkJCWZvb3RlcjogZnVuY3Rpb24gKCkgew0KCQkJCQlyZXR1cm4gY29udGV4dC5mb290ZXI7DQoJCQkJfSwNCgkJCQlhY3RpdmF0ZTogZnVuY3Rpb24gKCkgew0KCQkJCQlpbml0KCk7DQoJCQkJCWFjdGl2YXRlKCQoY29udGV4dC5hY3RpdmF0aW9uSW5wdXQgfHwgY29udGV4dC5hY3RpdmF0aW9uTGluayksIGNvbnRleHQpOw0KCQkJCX0sDQoJCQkJZGVhY3RpdmF0ZTogZnVuY3Rpb24gKCkgew0KCQkJCQlkZWFjdGl2YXRlKGNvbnRleHQpOw0KCQkJCX0sDQoJCQkJbW92ZVVwOiBmdW5jdGlvbiAoaGFuZGxlcikgew0KCQkJCQltb3ZlKGNvbnRleHQsICd1cCcsIGhhbmRsZXIpOw0KCQkJCX0sDQoJCQkJbW92ZURvd246IGZ1bmN0aW9uIChoYW5kbGVyKSB7DQoJCQkJCW1vdmUoY29udGV4dCwgJ2Rvd24nLCBoYW5kbGVyKTsNCgkJCQl9DQoJCQl9Ow0KCQl9DQoNCgkJLy8gcHVibGljIHN0YXRpYyBtZW1iZXJzIG9mIGEgSGVhZGVyTGlzdA0KCQlhcGkuaGlkZUN1cnJlbnQgPSBmdW5jdGlvbiAoKSB7DQoJCQlpZiAob3BlbkhlYWRlckxpc3RDb250ZXh0KSB7DQoJCQkJaGlkZVBvcHVwKG9wZW5IZWFkZXJMaXN0Q29udGV4dCk7DQoJCQl9DQoJCX07DQoNCgkJcmV0dXJuIGFwaTsNCg0KCX0pKCQpOw0KDQoJZnVuY3Rpb24gaW5pdE5vdGlmaWNhdGlvbkxpc3QoY29udGV4dCkgew0KCQl2YXIgZGVib3VuY2VkTm90aWZpY2F0aW9uUmVhZFRpbWVvdXQ7DQoJCXZhciBzdXBwcmVzc05vdGlmaWNhdGlvbnNSZWFkTWVzc2FnZSA9IGZhbHNlOw0KCQl2YXIgc3VwcHJlc3NOb3RpZmljYXRpb25zUmVhZE1lc3NhZ2VUaW1lb3V0Ow0KCQl2YXIgY3VycmVudFRvdGFsQ291bnQgPSAwOw0KDQoJCWZ1bmN0aW9uIGRpc3BsYXlOb3RpZmljYXRpb25QcmVmZXJlbmNlKGNvbnRleHQsIG5vdGlmaWNhdGlvbkl0ZW0pIHsNCgkJCS8vIHNldCB0aGUgbm90aWZpY2F0aW9uIGxpc3Qgc2l6ZSBkdXJpbmcgcHJlZmVyZW5jZS1kaXNwbGF5aW5nIHNvIHRoYXQgaXQgZG9lcyBub3QgcmVzaXplIG91dCBvZiB0aGUgYm91bmRzIG9mIHRoZSBwb3B1cA0KCQkJY29udGV4dC5ub3RpZmljYXRpb25MaXN0ID0gY29udGV4dC5ub3RpZmljYXRpb25MaXN0IHx8IG5vdGlmaWNhdGlvbkl0ZW0uY2xvc2VzdCgndWwnKTsNCgkJCWNvbnRleHQubm90aWZpY2F0aW9uTGlzdC5jc3Moew0KCQkJCWhlaWdodDogY29udGV4dC5ub3RpZmljYXRpb25MaXN0LmhlaWdodCgpDQoJCQl9KTsNCgkJCWlmIChjb250ZXh0LnByZWZlcmVuY2VVaSkgew0KCQkJCWhpZGVOb3RpZmljYXRpb25QcmVmZXJlbmNlKGNvbnRleHQsIGNvbnRleHQucHJlZmVyZW5jZVVpKTsNCgkJCQljb250ZXh0LnByZWZlcmVuY2VVaSA9IG51bGw7DQoJCQl9DQoJCQljb250ZXh0LnByZWZlcmVuY2VUZW1wbGF0ZSA9IGNvbnRleHQucHJlZmVyZW5jZVRlbXBsYXRlIHx8ICQudGVsbGlnZW50LmV2b2x1dGlvbi50ZW1wbGF0ZS5jb21waWxlKGNvbnRleHQubm90aWZpY2F0aW9uUHJlZmVyZW5jZVRlbXBsYXRlKTsNCgkJCWNvbnRleHQucHJlZmVyZW5jZVVpID0gJChjb250ZXh0LnByZWZlcmVuY2VUZW1wbGF0ZSh7DQoJCQkJbm90aWZpY2F0aW9uVHlwZU5hbWU6IG5vdGlmaWNhdGlvbkl0ZW0uZGF0YSgnbm90aWZpY2F0aW9udHlwZW5hbWUnKSwNCgkJCQlub3RpZmljYXRpb25UeXBlSWQ6IG5vdGlmaWNhdGlvbkl0ZW0uZGF0YSgnbm90aWZpY2F0aW9udHlwZWlkJykNCgkJCX0pKQ0KCQkJCS5oaWRlKCkNCgkJCQkuYXBwZW5kVG8obm90aWZpY2F0aW9uSXRlbSk7DQoJCQljb250ZXh0LnByZWZlcmVuY2VVaS5jc3Moew0KCQkJCXBvc2l0aW9uOiAnYWJzb2x1dGUnLA0KCQkJCXRvcDogMCwNCgkJCQlsZWZ0OiAwLA0KCQkJCXpJbmRleDogMjAwMA0KCQkJfSk7DQoNCgkJCW5vdGlmaWNhdGlvbkl0ZW0uYWRkQ2xhc3MoJ3dpdGgtcHJlZmVyZW5jZScpOw0KCQkJbm90aWZpY2F0aW9uSXRlbS5kYXRhKCdvcmlnaW5hbEhlaWdodCcsIG5vdGlmaWNhdGlvbkl0ZW0ub3V0ZXJIZWlnaHQoKSk7DQoJCQlub3RpZmljYXRpb25JdGVtLmFuaW1hdGUoe2hlaWdodDogY29udGV4dC5wcmVmZXJlbmNlVWkuaGVpZ2h0KCl9LCAxNTApOw0KDQoJCQljb250ZXh0LnByZWZlcmVuY2VVaS5mYWRlVG8oMTUwLCAwLjk4KTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGhpZGVOb3RpZmljYXRpb25QcmVmZXJlbmNlKGNvbnRleHQsIHByZWZlcmVuY2VJdGVtKSB7DQoJCQljb250ZXh0Lm5vdGlmaWNhdGlvbkxpc3QuY3NzKHtoZWlnaHQ6ICdhdXRvJ30pOw0KCQkJaWYgKHByZWZlcmVuY2VJdGVtKSB7DQoJCQkJdmFyIG5vdGlmaWNhdGlvbkl0ZW0gPSBwcmVmZXJlbmNlSXRlbS5wYXJlbnQoKTsNCgkJCQlub3RpZmljYXRpb25JdGVtLmFuaW1hdGUoe2hlaWdodDogbm90aWZpY2F0aW9uSXRlbS5kYXRhKCdvcmlnaW5hbEhlaWdodCcpfSwgMTUwKTsNCgkJCQlwcmVmZXJlbmNlSXRlbS5mYWRlT3V0KDE1MCwgZnVuY3Rpb24gKCkgew0KCQkJCQlub3RpZmljYXRpb25JdGVtLnJlbW92ZUNsYXNzKCd3aXRoLXByZWZlcmVuY2UnKTsNCgkJCQkJcHJlZmVyZW5jZUl0ZW0ucmVtb3ZlKCk7DQoJCQkJfSk7DQoJCQl9DQoJCX0NCg0KCQlmdW5jdGlvbiBkaXNhYmxlTm90aWZpY2F0aW9uVHlwZShjb250ZXh0LCBub3RpZmljYXRpb25UeXBlSWQpIHsNCgkJCXJldHVybiAkLnRlbGxpZ2VudC5ldm9sdXRpb24ucHV0KHsNCgkJCQl1cmw6ICQudGVsbGlnZW50LmV2b2x1dGlvbi5zaXRlLmdldEJhc2VVcmwoKSArICdhcGkuYXNoeC92Mi9ub3RpZmljYXRpb25wcmVmZXJlbmNlLmpzb24nLA0KCQkJCWRhdGE6IHsNCgkJCQkJTm90aWZpY2F0aW9uVHlwZUlkOiBub3RpZmljYXRpb25UeXBlSWQsDQoJCQkJCUlzRW5hYmxlZDogZmFsc2UNCgkJCQl9LA0KCQkJCWRhdGFUeXBlOiAnanNvbicNCgkJCX0pOw0KCQl9DQoNCgkJZnVuY3Rpb24gaW5pdE5vdGlmaWNhdGlvbkl0ZW1IYW5kbGVycygpIHsNCgkJCS8vIG1hcmsgaW5kaXZpZHVhbCBub3RpZmljYXRpb25zIGFzIHJlYWQNCgkJCWNvbnRleHQubm90aWZpY2F0aW9uc0xpc3QuY29udGVudCgpLm9uKCdjbGljaycsICcubWFyayBhJywgZnVuY3Rpb24gKGUpIHsNCgkJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQkJdmFyIG1hcmtMaW5rID0gJChlLnRhcmdldCk7DQoJCQkJdmFyIG5vdGlmaWNhdGlvbkxpbmVJdGVtID0gJCh0aGlzKS5jbG9zZXN0KCdsaScpOw0KCQkJCXZhciBub3RpZmljYXRpb25JZCA9IG5vdGlmaWNhdGlvbkxpbmVJdGVtLmRhdGEoJ25vdGlmaWNhdGlvbmlkJyk7DQoJCQkJbWFya05vdGlmaWNhdGlvbkFzUmVhZChub3RpZmljYXRpb25JZCkudGhlbihmdW5jdGlvbiAoKSB7DQoJCQkJCW1hcmtMaW5rLmhpZGUoKTsNCgkJCQkJbm90aWZpY2F0aW9uTGluZUl0ZW0ucmVtb3ZlQ2xhc3MoJ3VucmVhZCcpOw0KCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LnJlZnJlc2hVbnJlYWRDb3VudCgpDQoJCQkJfSk7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfSk7DQoNCgkJCS8vIGRpc3BsYXkgcHJlZmVyZW5jZSBjaGFuZ2UgdWkgb24gJ3gnIGNsaWNrDQoJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LmNvbnRlbnQoKS5vbignY2xpY2snLCAnLnByZWZlcmVuY2UgYScsIGZ1bmN0aW9uIChlKSB7DQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCWRpc3BsYXlOb3RpZmljYXRpb25QcmVmZXJlbmNlKGNvbnRleHQsICQodGhpcykuY2xvc2VzdCgnbGknKSk7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfSk7DQoNCgkJCS8vIGhhbmRsZSBjYW5jZWxzIG9mIHByZWZlcmVuY2UgY2hhbmdlIHdoZW4gY2xpY2tpbmcgJ2NhbmNlbCcNCgkJCWNvbnRleHQubm90aWZpY2F0aW9uc0xpc3QuY29udGVudCgpLm9uKCdjbGljaycsICcubm90aWZpY2F0aW9uLXByZWZlcmVuY2UgLmNhbmNlbCcsIGZ1bmN0aW9uIChlKSB7DQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7DQoJCQkJaGlkZU5vdGlmaWNhdGlvblByZWZlcmVuY2UoY29udGV4dCwgJCh0aGlzKS5jbG9zZXN0KCcubm90aWZpY2F0aW9uLXByZWZlcmVuY2UnKSk7DQoJCQkJY29udGV4dC5wcmVmZXJlbmNlVWkgPSBudWxsOw0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0pOw0KDQoJCQkvLyBoYW5kbGUgY2FuY2VscyBvZiBwcmVmZXJlbmNlIGNoYW5nZSBieSBjbGlja2luZyBhbnl0aGluZyBvdGhlciB0aGFuICd0dXJuIG9mZicNCgkJCWNvbnRleHQubm90aWZpY2F0aW9uc0xpc3QuY29udGVudCgpLm9uKCdjbGljaycsICcubm90aWZpY2F0aW9uLXByZWZlcmVuY2UnLCBmdW5jdGlvbiAoZSkgew0KCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQllLnN0b3BQcm9wYWdhdGlvbigpOw0KCQkJCWhpZGVOb3RpZmljYXRpb25QcmVmZXJlbmNlKGNvbnRleHQsICQodGhpcykpOw0KCQkJCWNvbnRleHQucHJlZmVyZW5jZVVpID0gbnVsbDsNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9KTsNCg0KCQkJLy8gaGFuZGxlIGNvbmZpcm1lZCBwcmVmZXJlbmNlIGNoYW5nZXMNCgkJCWNvbnRleHQubm90aWZpY2F0aW9uc0xpc3QuY29udGVudCgpLm9uKCdjbGljaycsICcubm90aWZpY2F0aW9uLXByZWZlcmVuY2UgLmNvbmZpcm0nLCBmdW5jdGlvbiAoZSkgew0KCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQl2YXIgbm90aWZpY2F0aW9uUHJlZmVyZW5jZSA9ICQodGhpcykuY2xvc2VzdCgnLm5vdGlmaWNhdGlvbi1wcmVmZXJlbmNlJyksDQoJCQkJCW5vdGlmaWNhdGlvbkl0ZW0gPSBub3RpZmljYXRpb25QcmVmZXJlbmNlLmNsb3Nlc3QoJ2xpJyk7DQoJCQkJZGlzYWJsZU5vdGlmaWNhdGlvblR5cGUoY29udGV4dCwgJCh0aGlzKS5kYXRhKCdub3RpZmljYXRpb250eXBlaWQnKSkudGhlbihmdW5jdGlvbiAoKSB7DQoJCQkJCW5vdGlmaWNhdGlvbkl0ZW0uZmFkZU91dCgyMDAsIGZ1bmN0aW9uICgpIHsNCgkJCQkJCW5vdGlmaWNhdGlvblByZWZlcmVuY2UucmVtb3ZlKCk7DQoJCQkJCQlub3RpZmljYXRpb25JdGVtLnJlbW92ZSgpOw0KCQkJCQl9KTsNCgkJCQkJY29udGV4dC5wcmVmZXJlbmNlVWkgPSBudWxsOw0KCQkJCX0pOw0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0pOw0KCQl9DQoNCgkJZnVuY3Rpb24gbWFya05vdGlmaWNhdGlvbkFzUmVhZChub3RpZmljYXRpb25JZCkgew0KCQkJY2xlYXJUaW1lb3V0KHN1cHByZXNzTm90aWZpY2F0aW9uc1JlYWRNZXNzYWdlVGltZW91dCk7DQoJCQlzdXBwcmVzc05vdGlmaWNhdGlvbnNSZWFkTWVzc2FnZSA9IHRydWU7DQoJCQl2YXIgbWFya05vdGlmaWNhdGlvblByb21pc2UgPSAkLnRlbGxpZ2VudC5ldm9sdXRpb24ucHV0KHsNCgkJCQl1cmw6ICQudGVsbGlnZW50LmV2b2x1dGlvbi5zaXRlLmdldEJhc2VVcmwoKSArICdhcGkuYXNoeC92Mi9ub3RpZmljYXRpb24ve05vdGlmaWNhdGlvbklkfS5qc29uJywNCgkJCQlkYXRhOiB7DQoJCQkJCU5vdGlmaWNhdGlvbklkOiBub3RpZmljYXRpb25JZCwNCgkJCQkJTWFya0FzUmVhZDogdHJ1ZQ0KCQkJCX0NCgkJCX0pOw0KCQkJbWFya05vdGlmaWNhdGlvblByb21pc2UuZG9uZShmdW5jdGlvbiAoKSB7DQoJCQkJc3VwcHJlc3NOb3RpZmljYXRpb25zUmVhZE1lc3NhZ2VUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQoJCQkJCXN1cHByZXNzTm90aWZpY2F0aW9uc1JlYWRNZXNzYWdlID0gZmFsc2U7DQoJCQkJfSwgNTAwMCk7DQoJCQl9KTsNCgkJCXJldHVybiBtYXJrTm90aWZpY2F0aW9uUHJvbWlzZTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIG1hcmtBbGxBc1JlYWQoKSB7DQoJCQl2YXIgdW5yZWFkSXRlbXMgPSBjb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LmNvbnRlbnQoKS5maW5kKCc+IGxpLnVucmVhZCcpOw0KCQkJLy8gcmVtb3ZlIHVucmVhZCBVSSBzdGF0ZSBpbW1lZGlhdGVseSBiZWZvcmUgd2FpdGluZyBmb3Igc2VydmVyIGNoYW5nZQ0KCQkJdW5yZWFkSXRlbXMucmVtb3ZlQ2xhc3MoJ3VucmVhZCcpOw0KCQkJY2xlYXJUaW1lb3V0KHN1cHByZXNzTm90aWZpY2F0aW9uc1JlYWRNZXNzYWdlVGltZW91dCk7DQoJCQlzdXBwcmVzc05vdGlmaWNhdGlvbnNSZWFkTWVzc2FnZSA9IHRydWU7DQoJCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24uYmF0Y2goZnVuY3Rpb24gKCkgew0KCQkJCS8vIGxvb3AgdGhyb3VnaCBhbGwgb2YgdGhlIGN1cnJlbnRseSB2aXNpYmxlIHVucmVhZCBub3RpZmljYXRpb24gaXRlbXMNCgkJCQl1bnJlYWRJdGVtcy5lYWNoKGZ1bmN0aW9uICgpIHsNCgkJCQkJLy8gYW5kIG1hcmsgdGhlIG5vdGlmaWNhaXRvbiBhcyByZWFkDQoJCQkJCW1hcmtOb3RpZmljYXRpb25Bc1JlYWQoJCh0aGlzKS5kYXRhKCdub3RpZmljYXRpb25pZCcpKTsNCgkJCQl9KTsNCgkJCX0pLnRoZW4oZnVuY3Rpb24gKCkgew0KCQkJCWNvbnRleHQubm90aWZpY2F0aW9uc0xpc3QucmVmcmVzaENvbnRlbnQoKTsNCgkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LnJlZnJlc2hVbnJlYWRDb3VudCgpDQoJCQkJc3VwcHJlc3NOb3RpZmljYXRpb25zUmVhZE1lc3NhZ2VUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQoJCQkJCXN1cHByZXNzTm90aWZpY2F0aW9uc1JlYWRNZXNzYWdlID0gZmFsc2U7DQoJCQkJfSwgNTAwMCk7DQoJCQl9KTsNCgkJfQ0KDQoJCWNvbnRleHQubm90aWZpY2F0aW9uc0xpc3QgPSBIZWFkZXJMaXN0KHsNCgkJCWtleTogJ25vdGlmaWNhdGlvbnMnLA0KCQkJZm9vdGVyQ29udGVudDogY29udGV4dC5ub3RpZmljYXRpb25MaXN0Rm9vdGVyQ29udGVudCwNCgkJCWluaXRpYWxVbnJlYWRDb3VudDogY29udGV4dC5ub3RpZmljYXRpb25zVW5yZWFkLA0KCQkJYWN0aXZhdGlvbkxpbms6IGNvbnRleHQubm90aWZpY2F0aW9uc0xpbmssDQoJCQllbmRsZXNzU2Nyb2xsOiB0cnVlLA0KCQkJdGl0bGVDb3VudDogdHJ1ZSwNCgkJCWxpbWl0Q291bnQ6IDk5LA0KCQkJY3NzQ2xhc3M6ICdub3RpZmljYXRpb25zJywNCgkJCXVucmVhZENvdW50TWVzc2FnZVNpbmd1bGFyOiBjb250ZXh0Lm5vdGlmaWNhdGlvbnNzVW5yZWFkQ291bnRNZXNzYWdlU2luZ3VsYXIsDQoJCQl1bnJlYWRDb3VudE1lc3NhZ2VQbHVyYWw6IGNvbnRleHQubm90aWZpY2F0aW9uc3NVbnJlYWRDb3VudE1lc3NhZ2VQbHVyYWwsDQoJCQl3cmFwcGVyOiBjb250ZXh0LmJhbm5lciwNCgkJCWhhbmRoZWxkQmFubmVyTGlua3NDb3VudDogY29udGV4dC5oYW5kaGVsZEJhbm5lckxpbmtzQ291bnQsDQoJCQlvbkxvYWQ6IGZ1bmN0aW9uIChwYWdlSW5kZXgsIHNob3VsZFJlZnJlc2hVbnJlYWRDb3VudCwgZmlsdGVyLCBjb21wbGV0ZSkgew0KCQkJCWlmICghY29udGV4dC5pc0luaXRlZCkgew0KCQkJCQljb250ZXh0LmlzSW5pdGVkID0gdHJ1ZTsNCgkJCQkJaW5pdE5vdGlmaWNhdGlvbkl0ZW1IYW5kbGVycygpOw0KCQkJCX0NCgkJCQlpZiAoY29udGV4dC5ub3RpZmljYXRpb25MaXN0KSB7DQoJCQkJCWNvbnRleHQubm90aWZpY2F0aW9uTGlzdC5jc3Moe2hlaWdodDogJ2F1dG8nfSk7DQoJCQkJfQ0KCQkJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5nZXQoew0KCQkJCQl1cmw6IGNvbnRleHQubm90aWZpY2F0aW9uc1VybCwNCgkJCQkJZGF0YTogew0KCQkJCQkJd19wYWdlSW5kZXg6IHBhZ2VJbmRleCwNCgkJCQkJCXdfZmlsdGVyOiAoY3VycmVudFRvdGFsQ291bnQgPiAwID8gKGZpbHRlciB8fCAnYWxsJykgOiAnYWxsJykNCgkJCQkJfSwNCgkJCQkJc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7DQoJCQkJCQkvLyBzaG93IHJlc3BvbnNlDQoJCQkJCQljb21wbGV0ZShyZXNwb25zZSk7DQoJCQkJCQkvLyB1cGRhdGUgY291bnQNCgkJCQkJCWlmIChzaG91bGRSZWZyZXNoVW5yZWFkQ291bnQpDQoJCQkJCQkJY29udGV4dC5ub3RpZmljYXRpb25zTGlzdC5yZWZyZXNoVW5yZWFkQ291bnQoKTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfSwNCgkJCW9uUmVmcmVzaFVucmVhZENvdW50OiBmdW5jdGlvbiAoY29tcGxldGUpIHsNCgkJCQkvLyBmaW5kIHRoZSBtYXJrIGFzIHJlYWQgbGluayBpZiBub3QgYWxyZWFkeSBmb3VuZA0KCQkJCWlmICghY29udGV4dC5ub3RpZmljYXRpb25NYXJrQXNSZWFkTGluayAmJiBjb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0KSB7DQoJCQkJCXZhciBmb290ZXIgPSBjb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LmZvb3RlcigpOw0KCQkJCQlpZiAoZm9vdGVyKSB7DQoJCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbk1hcmtBc1JlYWRMaW5rID0gZm9vdGVyLmZpbmQoJ2EubWFyay1yZWFkJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHsNCgkJCQkJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQkJCQkJbWFya0FsbEFzUmVhZCgpOw0KCQkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJCX0pOw0KCQkJCQl9DQoJCQkJfQ0KCQkJCXZhciBxdWVyeSA9IHsNCgkJCQkJSXNSZWFkOiBmYWxzZSwNCgkJCQkJUGFnZVNpemU6IDEsDQoJCQkJCVBhZ2VJbmRleDogMA0KCQkJCX07DQoJCQkJLy8gZXhjbHVkZSBjb252ZXJzYXRpb24gbm90aWZpY2F0aW9ucw0KCQkJCXF1ZXJ5WydfRmlsdGVyc18nICsgY29udGV4dC5jb252ZXJzYXRpb25Ob3RpZmljYXRpb25UeXBlSWRdID0gJ0V4Y2x1ZGUnOw0KCQkJCXJldHVybiAkLnRlbGxpZ2VudC5ldm9sdXRpb24uZ2V0KHsNCgkJCQkJdXJsOiAkLnRlbGxpZ2VudC5ldm9sdXRpb24uc2l0ZS5nZXRCYXNlVXJsKCkgKyAnYXBpLmFzaHgvdjIvbm90aWZpY2F0aW9ucy5qc29uJywNCgkJCQkJY2FjaGU6IGZhbHNlLA0KCQkJCQlkYXRhOiBxdWVyeSwNCgkJCQkJc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7DQoJCQkJCQljb21wbGV0ZShyZXNwb25zZS5Ub3RhbENvdW50KTsNCgkJCQkJCWlmIChjb250ZXh0Lm5vdGlmaWNhdGlvbk1hcmtBc1JlYWRMaW5rKSB7DQoJCQkJCQkJY3VycmVudFRvdGFsQ291bnQgPSByZXNwb25zZS5Ub3RhbENvdW50Ow0KCQkJCQkJCWlmIChyZXNwb25zZS5Ub3RhbENvdW50ID4gMCkgew0KCQkJCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbk1hcmtBc1JlYWRMaW5rLnNob3coKTsNCgkJCQkJCQkJY29udGV4dC5ub3RpZmljYXRpb25zRmlsdGVyLnNsaWRlRG93bigxMDApOw0KCQkJCQkJCX0NCgkJCQkJCQllbHNlIHsNCgkJCQkJCQkJY29udGV4dC5ub3RpZmljYXRpb25NYXJrQXNSZWFkTGluay5oaWRlKCk7DQoJCQkJCQkJCWNvbnRleHQubm90aWZpY2F0aW9uc0ZpbHRlci5zbGlkZVVwKDEwMCk7DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KCQkJCQl9LA0KCQkJCQllcnJvcjoge30NCgkJCQl9KTsNCgkJCX0sDQoJCQl0ZW1wbGF0ZTogY29udGV4dC5ub3RpZmljYXRpb25zVGVtcGxhdGUsDQoJCQlvblNob3c6IGZ1bmN0aW9uIChhY3RpdmF0b3IsIGNvbXBsZXRlKSB7DQoJCQkJY29tcGxldGUoYnVpbGRTaG93U2V0dGluZ3NVdGlsaXR5RHJvcGRvd24oY29udGV4dCwgYWN0aXZhdG9yLCB7fSkpOw0KCQkJfSwNCgkJCW9uU2VsZWN0OiBmdW5jdGlvbiAoaXRlbSkgew0KCQkJCWl0ZW0gPSAkKGl0ZW0pOw0KCQkJCXZhciBub3RpZmljYXRpb25JZCA9IGl0ZW0uZGF0YSgnbm90aWZpY2F0aW9uaWQnKSwNCgkJCQkJY29udGVudFVybCA9IGl0ZW0uZGF0YSgnY29udGVudHVybCcpOw0KDQoJCQkJaWYgKGl0ZW0uaGFzQ2xhc3MoJ3VucmVhZCcpKSB7DQoJCQkJCS8vIG1hcmsgYXMgcmVhZA0KCQkJCQltYXJrTm90aWZpY2F0aW9uQXNSZWFkKG5vdGlmaWNhdGlvbklkKS50aGVuKGZ1bmN0aW9uICgpIHsNCgkJCQkJCS8vIHRoZW4gbmF2aWdhdGUgdG8gaXQgaWYgZGlmZmVyZW50IG9yIGp1c3QgcmVmcmVzaCB0aGUgdW5yZWFkIGNvdW50DQoJCQkJCQlpZiAod2luZG93LmxvY2F0aW9uLmhyZWYgIT0gY29udGVudFVybCkgew0KCQkJCQkJCXdpbmRvdy5sb2NhdGlvbi5ocmVmID0gY29udGVudFVybDsNCgkJCQkJCX0NCgkJCQkJCWVsc2Ugew0KCQkJCQkJCWNvbnRleHQubm90aWZpY2F0aW9uc0xpc3QucmVmcmVzaFVucmVhZENvdW50KCk7DQoJCQkJCQl9DQoJCQkJCX0pOw0KCQkJCX0NCgkJCQllbHNlIHsNCgkJCQkJd2luZG93LmxvY2F0aW9uLmhyZWYgPSBjb250ZW50VXJsOw0KCQkJCX0NCgkJCX0sDQoJCQlvbkJ1aWxkRmlsdGVyOiBmdW5jdGlvbiAoZmlsdGVyZWQpIHsNCgkJCQl2YXIgZmlsdGVyVGVtcGxhdGUgPSAkLnRlbGxpZ2VudC5ldm9sdXRpb24udGVtcGxhdGUuY29tcGlsZShjb250ZXh0Lm5vdGlmaWNhdGlvbnNGaWx0ZXJUZW1wbGF0ZSk7DQoJCQkJY29udGV4dC5ub3RpZmljYXRpb25zRmlsdGVyID0gJChmaWx0ZXJUZW1wbGF0ZSh7fSkpOw0KCQkJCWNvbnRleHQubm90aWZpY2F0aW9uc0ZpbHRlci5maW5kKCdhOmZpcnN0JykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7DQoJCQkJY29udGV4dC5ub3RpZmljYXRpb25zRmlsdGVyLm9uKCdjbGljaycsICdhJywgZnVuY3Rpb24gKGUpIHsNCgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCQllLnN0b3BQcm9wYWdhdGlvbigpOw0KCQkJCQl2YXIgdGFyZ2V0ID0gJChlLnRhcmdldCk7DQoJCQkJCXRhcmdldC5jbG9zZXN0KCd1bCcpLmZpbmQoJ2EnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTsNCgkJCQkJdGFyZ2V0LmFkZENsYXNzKCdzZWxlY3RlZCcpOw0KCQkJCQlmaWx0ZXJlZCh0YXJnZXQuZGF0YSgnZmlsdGVyJykpOw0KCQkJCX0pOw0KDQoJCQkJcmV0dXJuIGNvbnRleHQubm90aWZpY2F0aW9uc0ZpbHRlci5oaWRlKCk7DQoJCQl9DQoJCX0pOw0KDQoJCS8vIHVwZGF0ZSB0aGUgbm90aWZpY2F0aW9uIGxpc3QncyBjb3VudCB3aGVuIGEgbmV3IG5vdGlmaWNhdGlvbiBpcyByZWNlaXZlZCB3aGljaCBpc24ndCBhIGNvbnZlcnNhdGlvbiB0eXBlDQoJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5tZXNzYWdpbmcuc3Vic2NyaWJlKCdub3RpZmljYXRpb24ucmFpc2VkJywgZnVuY3Rpb24gKG5vdGlmaWNhdGlvbikgew0KCQkJaWYgKG5vdGlmaWNhdGlvbi50eXBlSWQgIT09IGNvbnRleHQuY29udmVyc2F0aW9uTm90aWZpY2F0aW9uVHlwZUlkKSB7DQoJCQkJY29udGV4dC5ub3RpZmljYXRpb25zTGlzdC5yZWZyZXNoVW5yZWFkQ291bnQoKS50aGVuKGZ1bmN0aW9uICgpIHsNCgkJCQkJY29udGV4dC5ub3RpZmljYXRpb25zTGlzdC5yZWZyZXNoQ29udGVudCgpOw0KCQkJCX0pOw0KCQkJfQ0KCQl9KTsNCg0KCQkvLyB1cGRhdGUgdGhlIG5vdGlmaWNhdGlvbiBsaXN0J3MgY291bnQgd2hlbiBhIG5ldyBub3RpZmljYXRpb24gaXMgcmVjZWl2ZWQgd2hpY2ggaXNuJ3QgYSBjb252ZXJzYXRpb24gdHlwZQ0KCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubWVzc2FnaW5nLnN1YnNjcmliZSgnbm90aWZpY2F0aW9uLnJlYWQnLCBmdW5jdGlvbiAobm90aWZpY2F0aW9uKSB7DQoJCQlpZiAobm90aWZpY2F0aW9uLnR5cGVJZCAhPT0gY29udGV4dC5jb252ZXJzYXRpb25Ob3RpZmljYXRpb25UeXBlSWQpIHsNCgkJCQkvLyB3YWl0IHVudGlsIGEgZ2FwIGluIG5vdGlmaWNhdGlvbi5yZWFkIGV2ZW50cywgaW4gY2FzZSBtYW55IGhhdmUganVzdCBiZWVuIHJlY2VpdmVkDQoJCQkJY2xlYXJUaW1lb3V0KGRlYm91bmNlZE5vdGlmaWNhdGlvblJlYWRUaW1lb3V0KTsNCgkJCQlkZWJvdW5jZWROb3RpZmljYXRpb25SZWFkVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KCQkJCQlpZiAoc3VwcHJlc3NOb3RpZmljYXRpb25zUmVhZE1lc3NhZ2UpIHsNCgkJCQkJCXJldHVybjsNCgkJCQkJfQ0KCQkJCQljb250ZXh0Lm5vdGlmaWNhdGlvbnNMaXN0LnJlZnJlc2hVbnJlYWRDb3VudCgpLnRoZW4oZnVuY3Rpb24gKCkgew0KCQkJCQkJY29udGV4dC5ub3RpZmljYXRpb25zTGlzdC5yZWZyZXNoQ29udGVudCgpOw0KCQkJCQl9KTsNCgkJCQl9LCAxMDApOw0KCQkJfQ0KCQl9KTsNCg0KCQlyZXR1cm4gY29udGV4dC5ub3RpZmljYXRpb25zTGlzdDsNCgl9DQoNCglmdW5jdGlvbiBpbml0Q29udmVyc2F0aW9uTGlzdChjb250ZXh0KSB7DQoNCgkJY29udGV4dC5jb252ZXJzYXRpb25zTGlzdCA9IEhlYWRlckxpc3Qoew0KCQkJa2V5OiAnY29udmVyc2F0aW9ucycsDQoJCQlmb290ZXJDb250ZW50OiBjb250ZXh0LmNvbnZlcnNhdGlvbkxpc3RGb290ZXJDb250ZW50LA0KCQkJaW5pdGlhbFVucmVhZENvdW50OiBjb250ZXh0LmNvbnZlcnNhdGlvbnNVbnJlYWQsDQoJCQlhY3RpdmF0aW9uTGluazogY29udGV4dC5jb252ZXJzYXRpb25zTGluaywNCgkJCWVuZGxlc3NTY3JvbGw6IHRydWUsDQoJCQl0aXRsZUNvdW50OiB0cnVlLA0KCQkJY3NzQ2xhc3M6ICdjb252ZXJzYXRpb25zJywNCgkJCXVucmVhZENvdW50TWVzc2FnZVNpbmd1bGFyOiBjb250ZXh0LmNvbnZlcnNhdGlvbnNVbnJlYWRDb3VudE1lc3NhZ2VTaW5ndWxhciwNCgkJCXVucmVhZENvdW50TWVzc2FnZVBsdXJhbDogY29udGV4dC5jb252ZXJzYXRpb25zVW5yZWFkQ291bnRNZXNzYWdlUGx1cmFsLA0KCQkJd3JhcHBlcjogY29udGV4dC5iYW5uZXIsDQoJCQloYW5kaGVsZEJhbm5lckxpbmtzQ291bnQ6IGNvbnRleHQuaGFuZGhlbGRCYW5uZXJMaW5rc0NvdW50LA0KCQkJb25Mb2FkOiBmdW5jdGlvbiAocGFnZUluZGV4LCBzaG91bGRSZWZyZXNoVW5yZWFkQ291bnQsIGZpbHRlciwgY29tcGxldGUpIHsNCgkJCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24uZ2V0KHsNCgkJCQkJdXJsOiBjb250ZXh0LmNvbnZlcnNhdGlvbnNVcmwsDQoJCQkJCWRhdGE6IHsNCgkJCQkJCXdfcGFnZUluZGV4OiBwYWdlSW5kZXgNCgkJCQkJfSwNCgkJCQkJc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7DQoJCQkJCQkvLyBzaG93IHJlc3BvbnNlDQoJCQkJCQljb21wbGV0ZShyZXNwb25zZSk7DQoJCQkJCQkvLyB1cGRhdGUgY291bnQNCgkJCQkJCWlmIChzaG91bGRSZWZyZXNoVW5yZWFkQ291bnQpDQoJCQkJCQkJY29udGV4dC5jb252ZXJzYXRpb25zTGlzdC5yZWZyZXNoVW5yZWFkQ291bnQoKTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfSwNCgkJCW9uUmVmcmVzaFVucmVhZENvdW50OiBmdW5jdGlvbiAoY29tcGxldGUpIHsNCgkJCQlyZXR1cm4gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLmdldCh7DQoJCQkJCXVybDogJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnNpdGUuZ2V0QmFzZVVybCgpICsgJ2FwaS5hc2h4L3YyL2NvbnZlcnNhdGlvbnMuanNvbicsDQoJCQkJCWNhY2hlOiBmYWxzZSwNCgkJCQkJZGF0YTogew0KCQkJCQkJUmVhZFN0YXR1czogJ1VucmVhZCcNCgkJCQkJfSwNCgkJCQkJc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7DQoJCQkJCQljb21wbGV0ZShyZXNwb25zZS5Ub3RhbENvdW50KTsNCgkJCQkJfSwNCgkJCQkJZXJyb3I6IHt9DQoJCQkJfSk7DQoJCQl9LA0KCQkJdGVtcGxhdGU6IGNvbnRleHQuY29udmVyc2F0aW9uc1RlbXBsYXRlLA0KCQkJb25TaG93OiBmdW5jdGlvbiAoYWN0aXZhdG9yLCBjb21wbGV0ZSkgew0KCQkJCWNvbXBsZXRlKGJ1aWxkU2hvd1NldHRpbmdzVXRpbGl0eURyb3Bkb3duKGNvbnRleHQsIGFjdGl2YXRvciwge30pKTsNCgkJCX0NCgkJfSk7DQoNCgkJLy8gdXBkYXRlIHRoZSBtZXNzYWdlIGxpc3QncyBjb3VudCB3aGVuIGEgbmV3IG5vdGlmaWNhdGlvbiBpcyByZWNlaXZlZCB3aGljaCBpcyBhIGNvbnZlcnNhdGlvbiB0eXBlDQoJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5tZXNzYWdpbmcuc3Vic2NyaWJlKCdub3RpZmljYXRpb24ucmFpc2VkJywgZnVuY3Rpb24gKG5vdGlmaWNhdGlvbikgew0KCQkJaWYgKG5vdGlmaWNhdGlvbi50eXBlSWQgPT09IGNvbnRleHQuY29udmVyc2F0aW9uTm90aWZpY2F0aW9uVHlwZUlkKSB7DQoJCQkJY29udGV4dC5jb252ZXJzYXRpb25zTGlzdC5yZWZyZXNoVW5yZWFkQ291bnQoKS50aGVuKGZ1bmN0aW9uICgpIHsNCgkJCQkJY29udGV4dC5jb252ZXJzYXRpb25zTGlzdC5yZWZyZXNoQ29udGVudCgpOw0KCQkJCX0pOw0KCQkJfQ0KCQl9KTsNCg0KCQkvLyB1cGRhdGUgdGhlIG1lc3NhZ2UgbGlzdCdzIGNvdW50IHdoZW4gYSBtZXNzYWdlIHdhcyByZWFkIG9uIHRoZSBjb252ZXJzYXRpb24gbGlzdA0KCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubWVzc2FnaW5nLnN1YnNjcmliZSgndWkubWVzc2FnZXJlYWQnLCBmdW5jdGlvbiAobm90aWZpY2F0aW9uKSB7DQoJCQljb250ZXh0LmNvbnZlcnNhdGlvbnNMaXN0LnJlZnJlc2hVbnJlYWRDb3VudCgpOw0KCQl9KTsNCg0KCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubWVzc2FnaW5nLnN1YnNjcmliZShjb250ZXh0Lm1lc3NhZ2VQcmVmaXggKyAnc3RhcnRjb252ZXJzYXRpb24nLCBmdW5jdGlvbiAoKSB7DQoJCQkkLmdsb3dNb2RhbChjb250ZXh0LmNvbnZlcnNhdGlvbk5ld0NvbnZlcnNhdGlvbk1vZGFsVXJsLCB7DQoJCQkJd2lkdGg6IDU1MCwNCgkJCQloZWlnaHQ6IDM2MA0KCQkJfSk7DQoJCX0pOw0KDQoJCXJldHVybiBjb250ZXh0LmNvbnZlcnNhdGlvbnNMaXN0Ow0KCX0NCg0KCWZ1bmN0aW9uIGluaXRCb29rbWFya3NMaXN0KGNvbnRleHQpIHsNCgkJLy8gZ2V0cyBhbGwgc2VsZWN0ZWQgY29udGVudCB0eXBlcyBmcm9tIHRoZSBjb250ZW50IHR5cGUgZmlsdGVyDQoJCWZ1bmN0aW9uIGdldEN1cnJlbnRDb250ZW50VHlwZXMoYm9va21hcmtGaWx0ZXIpIHsNCgkJCXZhciBjb250ZW50VHlwZXMgPSBbXTsNCgkJCXZhciBzZWxlY3RlZEZpbHRlcnMgPSBjb250ZXh0LmJvb2ttYXJrRmlsdGVyLmZpbmQoJ2Euc2VsZWN0ZWQnKS5lYWNoKGZ1bmN0aW9uICgpIHsNCgkJCQljb250ZW50VHlwZXMucHVzaCgkKHRoaXMpLmRhdGEoJ2NvbnRlbnR0eXBlaWRzJykpOw0KCQkJfSk7DQoJCQlyZXR1cm4gY29udGVudFR5cGVzLmpvaW4oJywnKTsNCgkJfTsNCg0KCQljb250ZXh0LmJvb2ttYXJrc0xpc3QgPSBIZWFkZXJMaXN0KHsNCgkJCWtleTogJ2Jvb2ttYXJrcycsDQoJCQlmb290ZXJDb250ZW50OiBjb250ZXh0LmJvb2ttYXJrc0xpc3RGb290ZXJDb250ZW50LA0KCQkJYWN0aXZhdGlvbkxpbms6IGNvbnRleHQuYm9va21hcmtzTGluaywNCgkJCWVuZGxlc3NTY3JvbGw6IHRydWUsDQoJCQlpbml0aWFsVW5yZWFkQ291bnQ6IGNvbnRleHQuYm9va21hcmtzSXNCb29rbWFya2VkID8gMSA6IDAsDQoJCQl0aXRsZUNvdW50OiBmYWxzZSwNCgkJCXNob3dDb3VudDogZmFsc2UsDQoJCQljc3NDbGFzczogJ2Jvb2ttYXJrcycsDQoJCQl3cmFwcGVyOiBjb250ZXh0LmJhbm5lciwNCgkJCWhhbmRoZWxkQmFubmVyTGlua3NDb3VudDogY29udGV4dC5oYW5kaGVsZEJhbm5lckxpbmtzQ291bnQsDQoJCQl1bnJlYWRDb3VudE1lc3NhZ2VTaW5ndWxhcjogY29udGV4dC5ib29rbWFya3NCb29rbWFya3MsDQoJCQl1bnJlYWRDb3VudE1lc3NhZ2VQbHVyYWw6IGNvbnRleHQuYm9va21hcmtzQm9va21hcmtzLA0KCQkJb25Mb2FkOiBmdW5jdGlvbiAocGFnZUluZGV4LCBzaG91bGRSZWZyZXNoVW5yZWFkQ291bnQsIGZpbHRlciwgY29tcGxldGUpIHsNCgkJCQl2YXIgZmlsdGVyZWRDb250ZW50VHlwZUlkcyA9IGZpbHRlciB8fCBnZXRDdXJyZW50Q29udGVudFR5cGVzKGNvbnRleHQuYm9va21hcmtGaWx0ZXIpOw0KCQkJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5nZXQoew0KCQkJCQl1cmw6IGNvbnRleHQuYm9va21hcmtzVXJsLA0KCQkJCQlkYXRhOiB7DQoJCQkJCQl3X3BhZ2VJbmRleDogcGFnZUluZGV4LA0KCQkJCQkJd19jb250ZW50VHlwZUlkczogZmlsdGVyZWRDb250ZW50VHlwZUlkcw0KCQkJCQl9LA0KCQkJCQlzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsNCgkJCQkJCWlmIChmaWx0ZXJlZENvbnRlbnRUeXBlSWRzICYmIGZpbHRlcmVkQ29udGVudFR5cGVJZHMubGVuZ3RoID4gMCAmJiBnZXRDdXJyZW50Q29udGVudFR5cGVzKGNvbnRleHQuYm9va21hcmtGaWx0ZXIpICE9PSBmaWx0ZXJlZENvbnRlbnRUeXBlSWRzKQ0KCQkJCQkJCXJldHVybjsNCgkJCQkJCS8vIHNob3cgcmVzcG9uc2UNCgkJCQkJCWNvbXBsZXRlKHJlc3BvbnNlKTsNCgkJCQkJCS8vIHVwZGF0ZSBjb3VudA0KCQkJCQkJaWYgKHNob3VsZFJlZnJlc2hVbnJlYWRDb3VudCkNCgkJCQkJCQljb250ZXh0LmJvb2ttYXJrc0xpc3QucmVmcmVzaFVucmVhZENvdW50KCk7DQoJCQkJCX0NCgkJCQl9KTsNCgkJCX0sDQoJCQlvblJlZnJlc2hVbnJlYWRDb3VudDogZnVuY3Rpb24gKGNvbXBsZXRlKSB7DQoJCQkJY29tcGxldGUoY29udGV4dC5ib29rbWFya3NJc0Jvb2ttYXJrZWQgPyAxIDogMCk7DQoJCQl9LA0KCQkJb25CdWlsZEZpbHRlcjogZnVuY3Rpb24gKGZpbHRlcmVkKSB7DQoJCQkJdmFyIGZpbHRlclRlbXBsYXRlID0gJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnRlbXBsYXRlLmNvbXBpbGUoY29udGV4dC5ib29rbWFya3NGaWx0ZXJUZW1wbGF0ZSksDQoJCQkJCWZpbHRlclRlbXBsYXRlRGF0YSA9IHsNCgkJCQkJCWNvbnRlbnRUeXBlSWRzOiAnJywNCgkJCQkJCWFwcGxpY2F0aW9uQ29udGVudFR5cGVJZHM6ICcnLA0KCQkJCQkJY29udGFpbmVyVHlwZXM6IFtdDQoJCQkJCX07DQoJCQkJaWYgKGNvbnRleHQuYm9va21hcmtzQ29udGVudFR5cGVzLmxlbmd0aCA+IDApDQoJCQkJCWZpbHRlclRlbXBsYXRlRGF0YS5jb250ZW50VHlwZUlkcyA9IGNvbnRleHQuYm9va21hcmtzQ29udGVudFR5cGVzLnN1YnN0cigwLCBjb250ZXh0LmJvb2ttYXJrc0NvbnRlbnRUeXBlcy5sZW5ndGggLSAxKQ0KCQkJCWlmIChjb250ZXh0LmJvb2ttYXJrc0FwcGxpY2F0aW9uQ29udGVudFR5cGVzLmxlbmd0aCA+IDApDQoJCQkJCWZpbHRlclRlbXBsYXRlRGF0YS5hcHBsaWNhdGlvbkNvbnRlbnRUeXBlSWRzID0gY29udGV4dC5ib29rbWFya3NBcHBsaWNhdGlvbkNvbnRlbnRUeXBlcy5zdWJzdHIoMCwgY29udGV4dC5ib29rbWFya3NBcHBsaWNhdGlvbkNvbnRlbnRUeXBlcy5sZW5ndGggLSAxKQ0KCQkJCWlmIChjb250ZXh0LmJvb2ttYXJrc0NvbnRhaW5lckNvbnRlbnRUeXBlcy5sZW5ndGggPiAwKSB7DQoJCQkJCXZhciByYXdDb250YWluZXJzID0gY29udGV4dC5ib29rbWFya3NDb250YWluZXJDb250ZW50VHlwZXMuc3BsaXQoJywnKTsNCgkJCQkJJC5lYWNoKHJhd0NvbnRhaW5lcnMsIGZ1bmN0aW9uIChpLCByYXdDb250YWluZXIpIHsNCgkJCQkJCWlmIChyYXdDb250YWluZXIgJiYgcmF3Q29udGFpbmVyLmxlbmd0aCA+IDApIHsNCgkJCQkJCQl2YXIgY29udGFpbmVyQ29tcG9uZW50cyA9IHJhd0NvbnRhaW5lci5zcGxpdCgnOicsIDIpOw0KCQkJCQkJCWlmIChjb250YWluZXJDb21wb25lbnRzLmxlbmd0aCA9PT0gMikgew0KCQkJCQkJCQlmaWx0ZXJUZW1wbGF0ZURhdGEuY29udGFpbmVyVHlwZXMucHVzaCh7DQoJCQkJCQkJCQluYW1lOiBjb250YWluZXJDb21wb25lbnRzWzFdLA0KCQkJCQkJCQkJaWQ6IGNvbnRhaW5lckNvbXBvbmVudHNbMF0NCgkJCQkJCQkJfSk7DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KCQkJCQl9KTsNCgkJCQl9DQoNCgkJCQljb250ZXh0LmJvb2ttYXJrRmlsdGVyID0gJChmaWx0ZXJUZW1wbGF0ZShmaWx0ZXJUZW1wbGF0ZURhdGEpKTsNCgkJCQljb250ZXh0LmJvb2ttYXJrRmlsdGVyLmZpbmQoJ2E6Zmlyc3QnKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsNCgkJCQljb250ZXh0LmJvb2ttYXJrRmlsdGVyLm9uKCdjbGljaycsICdhJywgZnVuY3Rpb24gKGUpIHsNCgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCQllLnN0b3BQcm9wYWdhdGlvbigpOw0KCQkJCQl2YXIgdGFyZ2V0ID0gJChlLnRhcmdldCk7DQoJCQkJCXRhcmdldC5jbG9zZXN0KCd1bCcpLmZpbmQoJ2EnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTsNCgkJCQkJdGFyZ2V0LmFkZENsYXNzKCdzZWxlY3RlZCcpOw0KCQkJCQlmaWx0ZXJlZChnZXRDdXJyZW50Q29udGVudFR5cGVzKGNvbnRleHQuYm9va21hcmtGaWx0ZXIpKTsNCgkJCQl9KTsNCg0KCQkJCXJldHVybiBjb250ZXh0LmJvb2ttYXJrRmlsdGVyOw0KCQkJfSwNCgkJCXRlbXBsYXRlOiBjb250ZXh0LmJvb2ttYXJrc1RlbXBsYXRlLA0KCQkJb25TaG93OiBmdW5jdGlvbiAoYWN0aXZhdG9yLCBjb21wbGV0ZSkgew0KCQkJCWNvbXBsZXRlKGJ1aWxkU2hvd1NldHRpbmdzVXRpbGl0eURyb3Bkb3duKGNvbnRleHQsIGFjdGl2YXRvciwge30pKTsNCgkJCX0NCgkJfSk7DQoNCgkJLy8gcmVmcmVzaCBjb250ZW50IHdoZW4gYm9va21hcmtzIGFyZSBhZGRlZC9yZW1vdmVkDQoJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5tZXNzYWdpbmcuc3Vic2NyaWJlKCd1aS5ib29rbWFyaycsIGZ1bmN0aW9uIChkYXRhKSB7DQoJCQkvLyBpZiB0aGlzIHJlcHJlc2VudHMgYSBjaGFuZ2UgaW4gYm9va21hcmsgc3RhdGUgb2YgY3VycmVudCBjb250ZW50LA0KCQkJLy8gdHJhY2sgdGhhdA0KCQkJaWYgKGRhdGEuY29udGVudElkID09IGNvbnRleHQuYm9va21hcmtzQ3VycmVudENvbnRlbnRJZCkgew0KCQkJCWNvbnRleHQuYm9va21hcmtzSXNCb29rbWFya2VkID0gZGF0YS5ib29rbWFya2VkOw0KCQkJCWNvbnRleHQuYm9va21hcmtzTGlzdC5yZWZyZXNoVW5yZWFkQ291bnQoKTsNCgkJCQlpZiAoZGF0YS5ib29rbWFya2VkKSB7DQoJCQkJCWNvbnRleHQuYm9va21hcmtzTGluay5hZGRDbGFzcygnYm9va21hcmtlZCcpOw0KCQkJCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubm90aWZpY2F0aW9ucy5zaG93KGNvbnRleHQuYm9va21hcmtBZGRlZCwgew0KCQkJCQkJaWQ6ICdib29rbWFyay0nICsgZGF0YS5jb250ZW50SWQNCgkJCQkJfSk7DQoJCQkJfQ0KCQkJCWVsc2Ugew0KCQkJCQljb250ZXh0LmJvb2ttYXJrc0xpbmsucmVtb3ZlQ2xhc3MoJ2Jvb2ttYXJrZWQnKTsNCgkJCQkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm5vdGlmaWNhdGlvbnMuc2hvdyhjb250ZXh0LmJvb2ttYXJrUmVtb3ZlZCwgew0KCQkJCQkJaWQ6ICdib29rbWFyay0nICsgZGF0YS5jb250ZW50SWQNCgkJCQkJfSk7DQoJCQkJfQ0KCQkJfQ0KCQkJY29udGV4dC5ib29rbWFya3NMaXN0LnJlZnJlc2hDb250ZW50KCk7DQoJCX0pOw0KDQoJCWlmIChjb250ZXh0LmJvb2ttYXJrc0lzQm9va21hcmtlZCkNCgkJCWNvbnRleHQuYm9va21hcmtzTGluay5hZGRDbGFzcygnYm9va21hcmtlZCcpOw0KDQoJCXJldHVybiBjb250ZXh0LmJvb2ttYXJrc0xpc3Q7DQoJfQ0KDQoJZnVuY3Rpb24gaW5pdFVzZXJQb3B1cChjb250ZXh0KSB7DQoJCXZhciB1c2VyQ29udGVudCA9ICQoJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnRlbXBsYXRlLmNvbXBpbGUoY29udGV4dC51c2VyQ29udGVudFRlbXBsYXRlKSgpKTsNCg0KCQljb250ZXh0LnVzZXJQb3B1cCA9IEhlYWRlckxpc3Qoew0KCQkJa2V5OiAndXNlcicsDQoJCQlhY3RpdmF0aW9uTGluazogY29udGV4dC51c2VyTGluaywNCgkJCWVuZGxlc3NTY3JvbGw6IGZhbHNlLA0KCQkJdGl0bGVDb3VudDogZmFsc2UsDQoJCQljc3NDbGFzczogJ3VzZXInLA0KCQkJc2hvd0NvdW50OiBmYWxzZSwNCgkJCXdyYXBwZXI6IGNvbnRleHQuYmFubmVyLA0KCQkJaGFuZGhlbGRCYW5uZXJMaW5rc0NvdW50OiBjb250ZXh0LmhhbmRoZWxkQmFubmVyTGlua3NDb3VudCwNCgkJCW9uTG9hZDogZnVuY3Rpb24gKHBhZ2VJbmRleCwgc2hvdWxkUmVmcmVzaFVucmVhZENvdW50LCBmaWx0ZXIsIGNvbXBsZXRlKSB7DQoJCQkJZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KCQkJCQljb21wbGV0ZSh1c2VyQ29udGVudCkNCgkJCQl9LCAxMCkNCgkJCX0sDQoJCQl0ZW1wbGF0ZTogY29udGV4dC51c2VyUG9wdXBUZW1wbGF0ZSwNCgkJCW9uU2hvdzogZnVuY3Rpb24gKGFjdGl2YXRvciwgY29tcGxldGUpIHsNCgkJCQljb21wbGV0ZShidWlsZFNob3dTZXR0aW5nc1V0aWxpdHlEcm9wZG93bihjb250ZXh0LCBhY3RpdmF0b3IsIHt9KSk7DQoJCQl9DQoJCX0pOw0KDQoJCXJldHVybiBjb250ZXh0LnVzZXJQb3B1cDsNCgl9DQoNCglmdW5jdGlvbiBpbml0U2VhcmNoUG9wdXAoY29udGV4dCkgew0KCQkvLyBnZXRzIGFsbCBzZWxlY3RlZCBjb250ZW50IHR5cGVzIGZyb20gdGhlIGNvbnRlbnQgdHlwZSBmaWx0ZXINCgkJZnVuY3Rpb24gZ2V0Q3VycmVudFNlYXJjaEZpbHRlcnMoY29udGV4dCkgew0KCQkJdmFyIHNlbGVjdGVkUGxhY2UgPSBjb250ZXh0LnNlYXJjaEZpbHRlci5maW5kKCdhLnBsYWNlLnNlbGVjdGVkJyk7DQoJCQl2YXIgc2VsZWN0ZWRUeXBlID0gY29udGV4dC5zZWFyY2hGaWx0ZXIuZmluZCgnYS50eXBlLnNlbGVjdGVkJyk7DQoJCQl2YXIgZmlsdGVycyA9IHsNCgkJCQlwbGFjZUtleTogc2VsZWN0ZWRQbGFjZS5kYXRhKCdrZXknKSB8fCAnYW55d2hlcmUnLA0KCQkJCXBsYWNlVmFsdWU6IHNlbGVjdGVkUGxhY2UuZGF0YSgndmFsdWUnKSB8fCAnYW55d2hlcmUnLA0KCQkJCXR5cGU6IHNlbGVjdGVkVHlwZS5kYXRhKCdrZXknKSwNCgkJCQlxdWVyeTogJC50cmltKGNvbnRleHQuc2VhcmNoSW5wdXQudmFsKCkpLA0KCQkJCXNlYXJjaFBhcmFtZXRlcjogc2VsZWN0ZWRQbGFjZS5kYXRhKCdzZWFyY2hwYXJhbScpLA0KCQkJCXNlYXJjaFZhbHVlOiBzZWxlY3RlZFBsYWNlLmRhdGEoJ3NlYXJjaHZhbHVlJykNCgkJCX07DQoNCgkJCXZhciB0ID0gJC5ncmVwKGNvbnRleHQuc2VhcmNoRmlsdGVycywgZnVuY3Rpb24gKGUpIHsNCgkJCQlyZXR1cm4gZS5rZXkgPT0gc2VsZWN0ZWRUeXBlLmRhdGEoJ2tleScpOw0KCQkJfSlbMF07DQoJCQlpZiAodCAmJiB0LmFkdmFuY2VkU2VhcmNoVXJsKSB7DQoJCQkJZmlsdGVycy5hZHZhbmNlZFNlYXJjaFVybCA9IHQuYWR2YW5jZWRTZWFyY2hVcmw7DQoJCQl9DQoNCgkJCXJldHVybiBmaWx0ZXJzOw0KCQl9DQoNCgkJZnVuY3Rpb24gbG9hZFNlYXJjaFBsYWNlcyhjb250ZXh0KSB7DQoJCQl2YXIgcGxhY2VzID0gW107DQoNCgkJCWlmIChjb250ZXh0LnNlYXJjaFBsYWNlQXBwbGljYXRpb25JZCkgew0KCQkJCXBsYWNlcy5wdXNoKHsNCgkJCQkJa2V5OiAnYXBwbGljYXRpb24nLA0KCQkJCQl2YWx1ZTogY29udGV4dC5zZWFyY2hQbGFjZUFwcGxpY2F0aW9uSWQsDQoJCQkJCW5hbWU6IGNvbnRleHQuc2VhcmNoUGxhY2VBcHBsaWNhdGlvbk5hbWUsDQoJCQkJCXNlYXJjaFBhcmFtZXRlcjogJ2dyb3VwJywNCgkJCQkJc2VhcmNoVmFsdWU6IGNvbnRleHQuc2VhcmNoUGxhY2VHcm91cExvY2FsSWQNCgkJCQl9KTsNCgkJCX0NCg0KCQkJaWYgKGNvbnRleHQuc2VhcmNoUGxhY2VHcm91cElkKSB7DQoJCQkJcGxhY2VzLnB1c2goew0KCQkJCQlrZXk6ICdncm91cCcsDQoJCQkJCXZhbHVlOiBjb250ZXh0LnNlYXJjaFBsYWNlR3JvdXBJZCwNCgkJCQkJbmFtZTogY29udGV4dC5zZWFyY2hQbGFjZUdyb3VwTmFtZSwNCgkJCQkJc2VhcmNoUGFyYW1ldGVyOiAnZ3JvdXAnLA0KCQkJCQlzZWFyY2hWYWx1ZTogY29udGV4dC5zZWFyY2hQbGFjZUdyb3VwTG9jYWxJZA0KCQkJCX0pOw0KCQkJfQ0KDQoJCQlpZiAocGxhY2VzLmxlbmd0aCA+IDApIHsNCgkJCQlwbGFjZXMucHVzaCh7DQoJCQkJCWtleTogJ2FueXdoZXJlJywNCgkJCQkJdmFsdWU6ICdhbnl3aGVyZScsDQoJCQkJCW5hbWU6IGNvbnRleHQuc2VhcmNoUGxhY2VBbnl3aGVyZU5hbWUsDQoJCQkJCXNlYXJjaFBhcmFtZXRlcjogJycsDQoJCQkJCXNlYXJjaFZhbHVlOiAnJw0KCQkJCX0pOw0KCQkJfQ0KDQoJCQljb250ZXh0LnNlYXJjaFBsYWNlcyA9IHBsYWNlczsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGxvYWRTZWFyY2hGaWx0ZXJzKGNvbnRleHQsIHNjb3BlKSB7DQoJCQl2YXIgZmlsdGVycyA9IFtdOw0KDQoJCQkvLyBidWlsZCBmaXJzdCBwYXJ0eSBmaWx0ZXJzIGZpcnN0DQoJCQlmaWx0ZXJzLnB1c2goew0KCQkJCWtleTogJ2NvbnRlbnQnLA0KCQkJCW5hbWU6IGNvbnRleHQuc2VhcmNoRmlsdGVyQ29udGVudE5hbWUsDQoJCQkJc2VhcmNoUGFyYW1ldGVyOiAnJywNCgkJCQlzZWFyY2hWYWx1ZTogJycNCgkJCX0pOw0KDQoJCQlpZiAoc2NvcGUua2V5ID09ICdhbnl3aGVyZScgfHwgc2NvcGUua2V5ID09ICdncm91cCcpIHsNCgkJCQlmaWx0ZXJzLnB1c2goew0KCQkJCQlrZXk6ICdncm91cHMnLA0KCQkJCQluYW1lOiBjb250ZXh0LnNlYXJjaEZpbHRlckdyb3Vwc05hbWUsDQoJCQkJCXNlYXJjaFBhcmFtZXRlcjogJycsDQoJCQkJCXNlYXJjaFZhbHVlOiAnJw0KCQkJCX0pOw0KCQkJfQ0KDQoJCQlpZiAoc2NvcGUua2V5ID09ICdhbnl3aGVyZScgJiYgY29udGV4dC5zZWFyY2hTaG93UGVvcGxlKSB7DQoJCQkJZmlsdGVycy5wdXNoKHsNCgkJCQkJa2V5OiAndXNlcnMnLA0KCQkJCQluYW1lOiBjb250ZXh0LnNlYXJjaEZpbHRlclBlb3BsZU5hbWUsDQoJCQkJCWFkdmFuY2VkU2VhcmNoVXJsOiBmdW5jdGlvbiAocXVlcnkpIHsNCgkJCQkJCXZhciBwYXJhbXMgPSB7cTogcXVlcnl9Ow0KCQkJCQkJcmV0dXJuIGNvbnRleHQuc2VhcmNoQWR2YW5jZWRVc2VyVXJsDQoJCQkJCQkJLnJlcGxhY2UoL1x7MFx9L2dpLCAkLnBhcmFtKHBhcmFtcykpDQoJCQkJCQkJLnJlcGxhY2UoL1wrL2dpLCAnJTIwJykNCgkJCQkJCQkucmVwbGFjZSgvJy9naSwgJyUyNycpOw0KCQkJCQl9DQoJCQkJfSk7DQoJCQl9DQoNCgkJCS8vIGFkZCBjdXN0b20gZmlsdGVycw0KCQkJdmFyIGkgPSAxOw0KCQkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm1lc3NhZ2luZy5wdWJsaXNoKCdzZWFyY2gucmVnaXN0ZXJGaWx0ZXJzJywgew0KCQkJCXNjb3BlOiBzY29wZSwNCgkJCQlyZWdpc3RlcjogZnVuY3Rpb24gKHNldHRpbmdzKSB7DQoJCQkJCWZpbHRlcnMucHVzaCgkLmV4dGVuZCgNCgkJCQkJCXsNCgkJCQkJCQluYW1lOiAnJywNCgkJCQkJCQlxdWVyeTogZnVuY3Rpb24gKHF1ZXJ5RGF0YSwgY29tcGxldGUpIHsNCgkJCQkJCQl9LA0KCQkJCQkJCWFkdmFuY2VkU2VhcmNoVXJsOiBmdW5jdGlvbiAocXVlcnlUZXh0KSB7DQoJCQkJCQkJCXJldHVybiBudWxsOw0KCQkJCQkJCX0sDQoJCQkJCQkJaXNEZWZhdWx0OiBmYWxzZSwNCgkJCQkJCQlzZWFyY2hQYXJhbWV0ZXI6ICcnLA0KCQkJCQkJCXNlYXJjaFZhbHVlOiAnJw0KCQkJCQkJfSwNCgkJCQkJCXNldHRpbmdzLA0KCQkJCQkJew0KCQkJCQkJCWtleTogJ2N1c3RvbScgKyAoaSsrKQ0KCQkJCQkJfQ0KCQkJCQkpKTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJY29udGV4dC5zZWFyY2hGaWx0ZXJzID0gZmlsdGVyczsNCgkJfQ0KDQoJCWZ1bmN0aW9uIHNldERlZmF1bHRBZHZhbmNlZFNlYXJjaFVybChjb250ZXh0KSB7DQoNCgkJCXZhciBmaWx0ZXIgPSBnZXRDdXJyZW50U2VhcmNoRmlsdGVycyhjb250ZXh0KTsNCg0KCQkJdmFyIHF1ZXJ5ID0gJC50cmltKGZpbHRlci5xdWVyeSk7DQoJCQlpZiAocXVlcnkgJiYgcXVlcnkubGVuZ3RoID4gMCkgew0KCQkJCXZhciBwYXJhbXMgPSB7cTogcXVlcnl9Ow0KDQoJCQkJaWYgKGZpbHRlci5zZWFyY2hQYXJhbWV0ZXIgJiYgZmlsdGVyLnNlYXJjaFZhbHVlKSB7DQoJCQkJCXBhcmFtc1tmaWx0ZXIuc2VhcmNoUGFyYW1ldGVyXSA9IGZpbHRlci5zZWFyY2hWYWx1ZTsNCgkJCQl9DQoNCgkJCQljb250ZXh0LmN1cnJlbnRBZHZhbmNlZFNlYXJjaFVybCA9IGNvbnRleHQuc2VhcmNoQWR2YW5jZWRVcmwNCgkJCQkJLnJlcGxhY2UoL1x7MFx9L2dpLCAkLnBhcmFtKHBhcmFtcykpDQoJCQkJCS5yZXBsYWNlKC9cKy9naSwgJyUyMCcpDQoJCQkJCS5yZXBsYWNlKC8nL2dpLCAnJTI3Jyk7DQoJCQkJJCgnIycgKyBjb250ZXh0LmFkdmFuY2VkU2VhcmNoSWQpLmNzcygndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7DQoJCQl9DQoJCQllbHNlIHsNCgkJCQkkKCcjJyArIGNvbnRleHQuYWR2YW5jZWRTZWFyY2hJZCkuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpOw0KCQkJfQ0KCQl9DQoNCgkJLy8gZGVmYXVsdCB0byBzdXBwb3J0aW5nIGlubGluZVNlYXJjaCB0aG91Z2ggc2VhcmNoLnJlYWR5IGNhbiBvdmVycmlkZSBpdA0KCQljb250ZXh0LnN1cHBvcnRzSW5saW5lU2VhcmNoID0gdHJ1ZTsNCg0KCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5tZXNzYWdpbmcucHVibGlzaCgnc2VhcmNoLnJlYWR5Jywgew0KCQkJCWluaXQ6IGZ1bmN0aW9uIChzZXR0aW5ncykgew0KCQkJCQl2YXIgaW5qZWN0ZWRTZXR0aW5ncyA9ICQuZXh0ZW5kKHsNCgkJCQkJCWN1c3RvbVJlc3VsdFJlbmRlcmluZzogZmFsc2UsDQoJCQkJCQlpbml0aWFsUXVlcnk6ICcnDQoJCQkJCX0sIHNldHRpbmdzKTsNCgkJCQkJY29udGV4dC5zdXBwb3J0c0lubGluZVNlYXJjaCA9ICFpbmplY3RlZFNldHRpbmdzLmN1c3RvbVJlc3VsdFJlbmRlcmluZzsNCgkJCQkJaWYgKGluamVjdGVkU2V0dGluZ3MuaW5pdGlhbFF1ZXJ5ICE9PSBudWxsKSB7DQoJCQkJCQljb250ZXh0LnNlYXJjaElucHV0LnZhbChpbmplY3RlZFNldHRpbmdzLmluaXRpYWxRdWVyeSk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9KTsNCgkJfSwgNTApOw0KDQoJCWZ1bmN0aW9uIGJ1aWxkU2VhcmNoRGF0YUZyb21FZmZlY3RpdmVRdWVyeShwYWdlSW5kZXgsIGVmZmVjdGl2ZVNlYXJjaEZpbHRlcikgew0KCQkJcmV0dXJuIHsNCgkJCQl3X3BhZ2VJbmRleDogcGFnZUluZGV4LA0KCQkJCXdfcXVlcnk6IGVmZmVjdGl2ZVNlYXJjaEZpbHRlci5xdWVyeSwNCgkJCQl3X3BsYWNlS2V5OiBlZmZlY3RpdmVTZWFyY2hGaWx0ZXIucGxhY2VLZXksDQoJCQkJd19wbGFjZVZhbHVlOiBlZmZlY3RpdmVTZWFyY2hGaWx0ZXIucGxhY2VWYWx1ZSwNCgkJCQl3X3R5cGU6IGVmZmVjdGl2ZVNlYXJjaEZpbHRlci50eXBlDQoJCQl9Ow0KCQl9DQoNCgkJY29udGV4dC5zZWFyY2hQb3B1cCA9IEhlYWRlckxpc3Qoew0KCQkJa2V5OiAnc2VhcmNoJywNCgkJCWZvb3RlckNvbnRlbnQ6IGNvbnRleHQuc2VhcmNoRm9vdGVyQ29udGVudCwNCgkJCWFjdGl2YXRpb25JbnB1dDogY29udGV4dC5zZWFyY2hJbnB1dCwNCgkJCWVuZGxlc3NTY3JvbGw6IHRydWUsDQoJCQl0aXRsZUNvdW50OiBmYWxzZSwNCgkJCXNob3dDb3VudDogZmFsc2UsDQoJCQljc3NDbGFzczogJ3NlYXJjaCcsDQoJCQl3cmFwcGVyOiBjb250ZXh0LmJhbm5lciwNCgkJCWhhbmRoZWxkQmFubmVyTGlua3NDb3VudDogY29udGV4dC5oYW5kaGVsZEJhbm5lckxpbmtzQ291bnQsDQoJCQlvblNob3dMb2FkaW5nSW5kaWNhdG9yOiBmdW5jdGlvbiAoKSB7DQoJCQkJcmV0dXJuIGNvbnRleHQuc3VwcG9ydHNJbmxpbmVTZWFyY2g7DQoJCQl9LA0KCQkJb25Mb2FkOiBmdW5jdGlvbiAocGFnZUluZGV4LCBzaG91bGRSZWZyZXNoVW5yZWFkQ291bnQsIGZpbHRlciwgY29tcGxldGUpIHsNCgkJCQlpZiAoIWNvbnRleHQuc3VwcG9ydHNJbmxpbmVTZWFyY2gpDQoJCQkJCXJldHVybjsNCg0KCQkJCXZhciBlZmZlY3RpdmVTZWFyY2hGaWx0ZXIgPSBmaWx0ZXIgfHwgZ2V0Q3VycmVudFNlYXJjaEZpbHRlcnMoY29udGV4dCk7DQoNCgkJCQkvLyBwcmV2ZW50IGVtcHR5IHNlYXJjaGVzDQoJCQkJaWYgKCFlZmZlY3RpdmVTZWFyY2hGaWx0ZXIucXVlcnkgfHwgZWZmZWN0aXZlU2VhcmNoRmlsdGVyLnF1ZXJ5Lmxlbmd0aCA9PSAwKSB7DQoJCQkJCWNvbXBsZXRlKCcnKTsNCgkJCQkJcmV0dXJuOw0KCQkJCX0NCg0KCQkJCXZhciBmaWx0ZXIgPSAkLmdyZXAoY29udGV4dC5zZWFyY2hGaWx0ZXJzLCBmdW5jdGlvbiAoZSkgew0KCQkJCQlyZXR1cm4gZS5rZXkgPT0gZWZmZWN0aXZlU2VhcmNoRmlsdGVyLnR5cGUNCgkJCQl9KVswXTsNCgkJCQlpZiAoZmlsdGVyICYmIGZpbHRlci5xdWVyeSkgew0KCQkJCQlmaWx0ZXIucXVlcnkoew0KCQkJCQkJcGFnZUluZGV4OiBwYWdlSW5kZXgsDQoJCQkJCQlxdWVyeTogZWZmZWN0aXZlU2VhcmNoRmlsdGVyLnF1ZXJ5DQoJCQkJCX0sIGZ1bmN0aW9uIChyZXNwb25zZSkgew0KCQkJCQkJY29tcGxldGUocmVzcG9uc2UpOw0KCQkJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5hZGRDbGFzcygnd2l0aC1yZXN1bHRzJyk7DQoNCgkJCQkJCWlmICghY29udGV4dC5jdXJyZW50QWR2YW5jZWRTZWFyY2hVcmwpIHsNCgkJCQkJCQkkKCcjJyArIGNvbnRleHQuYWR2YW5jZWRTZWFyY2hJZCkuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpOw0KCQkJCQkJfQ0KCQkJCQkJZWxzZSB7DQoJCQkJCQkJJCgnIycgKyBjb250ZXh0LmFkdmFuY2VkU2VhcmNoSWQpLmNzcygndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7DQoJCQkJCQl9DQoJCQkJCX0pOw0KCQkJCX0NCgkJCQllbHNlIHsNCgkJCQkJdmFyIHF1ZXJ5RGF0YSA9IGJ1aWxkU2VhcmNoRGF0YUZyb21FZmZlY3RpdmVRdWVyeShwYWdlSW5kZXgsIGVmZmVjdGl2ZVNlYXJjaEZpbHRlcikNCg0KCQkJCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24uZ2V0KHsNCgkJCQkJCXVybDogY29udGV4dC5zZWFyY2hVcmwsDQoJCQkJCQlkYXRhOiBxdWVyeURhdGEsDQoJCQkJCQlzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsNCgkJCQkJCQkvLyBhZnRlciByZXN1bHRzIHJldHVybiwgbWFrZSBzdXJlIHRoZSBjdXJyZW50IHNlYXJjaCBwYXJhbWV0ZXJzDQoJCQkJCQkJLy8gd291bGQgc3RpbGwgbWF0Y2ggdGhlIHJlcXVlc3QgdGhhdCBtYWRlIHRoaXMgcXVlcnkNCgkJCQkJCQkvLyBJZiBub3QsIGlnbm9yZSB0aGUgcmVzdWx0cw0KCQkJCQkJCXZhciBjdXJyZW50RWZmZWN0aXZlU2VhcmNoRmlsdGVyID0gZ2V0Q3VycmVudFNlYXJjaEZpbHRlcnMoY29udGV4dCk7DQoJCQkJCQkJaWYgKCFjdXJyZW50RWZmZWN0aXZlU2VhcmNoRmlsdGVyIHx8ICFjdXJyZW50RWZmZWN0aXZlU2VhcmNoRmlsdGVyLnF1ZXJ5IHx8IGN1cnJlbnRFZmZlY3RpdmVTZWFyY2hGaWx0ZXIucXVlcnkubGVuZ3RoID09IDApIHsNCgkJCQkJCQkJY29tcGxldGUobnVsbCk7DQoJCQkJCQkJCXJldHVybjsNCgkJCQkJCQl9DQoJCQkJCQkJdmFyIGN1cnJlbnRRdWVyeURhdGEgPSBidWlsZFNlYXJjaERhdGFGcm9tRWZmZWN0aXZlUXVlcnkocGFnZUluZGV4LCBjdXJyZW50RWZmZWN0aXZlU2VhcmNoRmlsdGVyKTsNCgkJCQkJCQlpZiAoJC50ZWxsaWdlbnQuZXZvbHV0aW9uLnVybC5zZXJpYWxpemVRdWVyeShjdXJyZW50UXVlcnlEYXRhKSAhPQ0KCQkJCQkJCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24udXJsLnNlcmlhbGl6ZVF1ZXJ5KHF1ZXJ5RGF0YSkpIHsNCgkJCQkJCQkJY29tcGxldGUobnVsbCk7DQoJCQkJCQkJCXJldHVybjsNCgkJCQkJCQl9DQoNCgkJCQkJCQkvLyBzaG93IHJlc3BvbnNlDQoJCQkJCQkJY29tcGxldGUocmVzcG9uc2UpOw0KCQkJCQkJCWNvbnRleHQuc2VhcmNoSW5wdXQuYWRkQ2xhc3MoJ3dpdGgtcmVzdWx0cycpOw0KCQkJCQkJfQ0KCQkJCQl9KTsNCgkJCQl9DQoJCQl9LA0KCQkJb25SZWZyZXNoVW5yZWFkQ291bnQ6IGZ1bmN0aW9uIChjb21wbGV0ZSkgew0KCQkJCWNvbXBsZXRlKDApOw0KCQkJfSwNCgkJCW9uQnVpbGRGaWx0ZXI6IGZ1bmN0aW9uIChmaWx0ZXJlZCkgew0KCQkJCWxvYWRTZWFyY2hQbGFjZXMoY29udGV4dCk7DQoJCQkJbG9hZFNlYXJjaEZpbHRlcnMoY29udGV4dCwgY29udGV4dC5zZWFyY2hQbGFjZXMubGVuZ3RoID4gMCA/IGNvbnRleHQuc2VhcmNoUGxhY2VzWzBdIDoge2tleTogJ2FueXdoZXJlJywgdmFsdWU6ICdhbnl3aGVyZSd9KTsNCg0KCQkJCXZhciBmaWx0ZXJUZW1wbGF0ZSA9ICQudGVsbGlnZW50LmV2b2x1dGlvbi50ZW1wbGF0ZS5jb21waWxlKGNvbnRleHQuc2VhcmNoRmlsdGVyVGVtcGxhdGUpLA0KCQkJCQlmaWx0ZXJUZW1wbGF0ZURhdGEgPSB7DQoJCQkJCQljb250ZW50VHlwZUlkczogJycsDQoJCQkJCQlhcHBsaWNhdGlvbkNvbnRlbnRUeXBlSWRzOiAnJywNCgkJCQkJCWNvbnRhaW5lclR5cGVzOiBbXSwNCgkJCQkJCWZpbHRlcnM6IGNvbnRleHQuc2VhcmNoRmlsdGVycywNCgkJCQkJCXBsYWNlczogY29udGV4dC5zZWFyY2hQbGFjZXMNCgkJCQkJfTsNCg0KCQkJCWNvbnRleHQuc2VhcmNoRmlsdGVyID0gJCgnPGRpdj48L2Rpdj4nKS5oaWRlKCkuYXBwZW5kVG8oJ2JvZHknKTsNCgkJCQkkKGZpbHRlclRlbXBsYXRlKGZpbHRlclRlbXBsYXRlRGF0YSkpLmFwcGVuZFRvKGNvbnRleHQuc2VhcmNoRmlsdGVyKTsNCg0KCQkJCXZhciBmaWx0ZXIgPSAkLmdyZXAoY29udGV4dC5zZWFyY2hGaWx0ZXJzLCBmdW5jdGlvbiAoZSkgew0KCQkJCQlyZXR1cm4gZS5pc0RlZmF1bHQ7DQoJCQkJfSlbMF07DQoJCQkJaWYgKGZpbHRlcikgew0KCQkJCQljb250ZXh0LnNlYXJjaEZpbHRlci5maW5kKCdhLnR5cGVbZGF0YS1rZXk9IicgKyBmaWx0ZXIua2V5ICsgJyJdJykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7DQoJCQkJfQ0KCQkJCWVsc2Ugew0KCQkJCQljb250ZXh0LnNlYXJjaEZpbHRlci5maW5kKCdhLnR5cGU6Zmlyc3QnKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsNCgkJCQl9DQoJCQkJY29udGV4dC5zZWFyY2hGaWx0ZXIuZmluZCgnYS5wbGFjZTpmaXJzdCcpLmFkZENsYXNzKCdzZWxlY3RlZCcpOw0KCQkJCWNvbnRleHQuc2VhcmNoRmlsdGVyLm9uKCdjbGljaycsICdhJywgZnVuY3Rpb24gKGUpIHsNCgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCQllLnN0b3BQcm9wYWdhdGlvbigpOw0KCQkJCQl2YXIgdGFyZ2V0ID0gJChlLnRhcmdldCk7DQoJCQkJCXRhcmdldC5jbG9zZXN0KCd1bCcpLmZpbmQoJ2EnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTsNCgkJCQkJdGFyZ2V0LmFkZENsYXNzKCdzZWxlY3RlZCcpOw0KDQoJCQkJCWlmICh0YXJnZXQuaGFzQ2xhc3MoJ3BsYWNlJykpIHsNCgkJCQkJCXZhciBrZXkgPSB0YXJnZXQuZGF0YSgna2V5JyksIHZhbHVlID0gdGFyZ2V0LmRhdGEoJ3ZhbHVlJyk7DQoNCgkJCQkJCWxvYWRTZWFyY2hGaWx0ZXJzKGNvbnRleHQsIHtrZXk6IGtleSwgdmFsdWU6IHZhbHVlfSk7DQoJCQkJCQljb250ZXh0LnNlYXJjaEZpbHRlci5lbXB0eSgpLmFwcGVuZCgkKGZpbHRlclRlbXBsYXRlKHsNCgkJCQkJCQljb250ZW50VHlwZUlkczogJycsDQoJCQkJCQkJYXBwbGljYXRpb25Db250ZW50VHlwZUlkczogJycsDQoJCQkJCQkJY29udGFpbmVyVHlwZXM6IFtdLA0KCQkJCQkJCWZpbHRlcnM6IGNvbnRleHQuc2VhcmNoRmlsdGVycywNCgkJCQkJCQlwbGFjZXM6IGNvbnRleHQuc2VhcmNoUGxhY2VzDQoJCQkJCQl9KSkpOw0KDQoJCQkJCQl2YXIgZmlsdGVyID0gJC5ncmVwKGNvbnRleHQuc2VhcmNoRmlsdGVycywgZnVuY3Rpb24gKGUpIHsNCgkJCQkJCQlyZXR1cm4gZS5pc0RlZmF1bHQ7DQoJCQkJCQl9KVswXTsNCgkJCQkJCWlmIChmaWx0ZXIpIHsNCgkJCQkJCQljb250ZXh0LnNlYXJjaEZpbHRlci5maW5kKCdhLnR5cGVbZGF0YS1rZXk9IicgKyBmaWx0ZXIua2V5ICsgJyJdJykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7DQoJCQkJCQl9DQoJCQkJCQllbHNlIHsNCgkJCQkJCQljb250ZXh0LnNlYXJjaEZpbHRlci5maW5kKCdhLnR5cGU6Zmlyc3QnKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsNCgkJCQkJCX0NCgkJCQkJCWNvbnRleHQuc2VhcmNoRmlsdGVyLmZpbmQoJ2EucGxhY2VbZGF0YS1rZXk9IicgKyBrZXkgKyAnIl1bZGF0YS12YWx1ZT0iJyArIHZhbHVlICsgJyJdJykuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7DQoJCQkJCX0NCg0KCQkJCQlmaWx0ZXJlZChnZXRDdXJyZW50U2VhcmNoRmlsdGVycyhjb250ZXh0KSk7DQoNCgkJCQkJdmFyIGZpbHRlciA9IGdldEN1cnJlbnRTZWFyY2hGaWx0ZXJzKGNvbnRleHQpOw0KCQkJCQlpZiAoZmlsdGVyICYmIGZpbHRlci5hZHZhbmNlZFNlYXJjaFVybCkNCgkJCQkJCWNvbnRleHQuY3VycmVudEFkdmFuY2VkU2VhcmNoVXJsID0gZmlsdGVyLmFkdmFuY2VkU2VhcmNoVXJsKGZpbHRlci5xdWVyeSk7DQoJCQkJCWVsc2UNCgkJCQkJCXNldERlZmF1bHRBZHZhbmNlZFNlYXJjaFVybChjb250ZXh0KTsNCgkJCQl9KTsNCg0KCQkJCXZhciBsYXN0UXVlcnkgPSBudWxsOw0KCQkJCWNvbnRleHQuc2VhcmNoSW5wdXQub24oew0KCQkJCQlpbnB1dDogdXRpbC50aHJvdHRsZShmdW5jdGlvbiAoZSkgew0KCQkJCQkJdmFyIGZpbHRlciA9IGdldEN1cnJlbnRTZWFyY2hGaWx0ZXJzKGNvbnRleHQpOw0KCQkJCQkJaWYgKGZpbHRlci5xdWVyeSA9PSBsYXN0UXVlcnkpIHsNCgkJCQkJCQllLnByZXZlbnREZWZhdWx0KCkNCgkJCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJCQl9DQoJCQkJCQlsYXN0UXVlcnkgPSBmaWx0ZXIucXVlcnk7DQoJCQkJCQlmaWx0ZXJlZChmaWx0ZXIpOw0KCQkJCQkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm1lc3NhZ2luZy5wdWJsaXNoKCdzZWFyY2gucXVlcnknLCB7DQoJCQkJCQkJdmFsdWU6ICQudHJpbShjb250ZXh0LnNlYXJjaElucHV0LnZhbCgpKQ0KCQkJCQkJfSk7DQoJCQkJCX0sIDUwMCksDQoJCQkJCWNsaWNrOiBmdW5jdGlvbiAoZSkgew0KCQkJCQkJaWYgKCFzdXBwb3J0c1RvdWNoKCkpDQoJCQkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCQl9DQoJCQkJfSk7DQoJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5vbih7DQoJCQkJCWlucHV0OiBmdW5jdGlvbiAoZSkgew0KCQkJCQkJdmFyIGZpbHRlciA9IGdldEN1cnJlbnRTZWFyY2hGaWx0ZXJzKGNvbnRleHQpOw0KCQkJCQkJaWYgKGZpbHRlciAmJiBmaWx0ZXIuYWR2YW5jZWRTZWFyY2hVcmwpDQoJCQkJCQkJY29udGV4dC5jdXJyZW50QWR2YW5jZWRTZWFyY2hVcmwgPSBmaWx0ZXIuYWR2YW5jZWRTZWFyY2hVcmwoZmlsdGVyLnF1ZXJ5KTsNCgkJCQkJCWVsc2UNCgkJCQkJCQlzZXREZWZhdWx0QWR2YW5jZWRTZWFyY2hVcmwoY29udGV4dCk7DQoJCQkJCX0NCgkJCQl9KTsNCg0KCQkJCXJldHVybiBjb250ZXh0LnNlYXJjaEZpbHRlci5zaG93KCk7DQoJCQl9LA0KCQkJdGVtcGxhdGU6IGNvbnRleHQuc2VhcmNoVGVtcGxhdGUsDQoJCQlvblNob3c6IGZ1bmN0aW9uIChhY3RpdmF0b3IsIGNvbXBsZXRlKSB7DQoJCQkJdmFyIGNvbmZpZyA9IHsNCgkJCQkJYXR0YWNoVG86IGNvbnRleHQuc2VhcmNoSW5wdXQsDQoJCQkJCXdpZHRoOiBjb250ZXh0LnNlYXJjaElucHV0Lm91dGVyV2lkdGgoKSwNCgkJCQkJbWF4SGVpZ2h0OiAoJChnbG9iYWwpLmhlaWdodCgpICogLjcpLA0KCQkJCQljc3NDbGFzczogJ3NlYXJjaC1jb250YWluZXInDQoJCQkJfTsNCg0KCQkJCWlmICgkKHdpbmRvdykud2lkdGgoKSA8PSA1NzApIHsNCgkJCQkJY29uZmlnID0gew0KCQkJCQkJYXR0YWNoVG86IGNvbnRleHQuc2VhcmNoRmllbGRzLA0KCQkJCQkJd2lkdGg6IGNvbnRleHQuYmFubmVyLndpZHRoKCksDQoJCQkJCQltYXhIZWlnaHQ6ICQoZ2xvYmFsKS5oZWlnaHQoKSAvIDIsDQoJCQkJCQljb250YWluZXJDc3NDbGFzczogJycNCgkJCQkJfTsNCgkJCQl9DQoNCgkJCQkvL3ZhciBzZXR0aW5ncyA9IGJ1aWxkU2hvd1NldHRpbmdzKGNvbnRleHQsIGFjdGl2YXRvciwgY29uZmlnKTsNCg0KCQkJCS8vIG1ha2Ugc2VhcmNoIG9wZW4gMTAwJSB3aWRlLCBhbmQgNzAlIG9mIHRoZSBoZWlnaHQgb2YgdGhlIHZpZXdwb3J0DQoJCQkJY29tcGxldGUoY29uZmlnKTsNCgkJCX0sDQoJCQlvbkhpZGU6IGZ1bmN0aW9uICgpIHsNCgkJCQljb250ZXh0LnNlYXJjaElucHV0LnJlbW92ZUNsYXNzKCd3aXRoLXJlc3VsdHMnKTsNCgkJCX0NCgkJfSk7DQoNCgkJLy8gYWR2YW5jZWQgc2VhcmNoDQoJCWZ1bmN0aW9uIHJlZGlyZWN0VG9BZHZhbmNlZFNlYXJjaCgpIHsNCgkJCWlmIChjb250ZXh0LnN1cHBvcnRzSW5saW5lU2VhcmNoICYmICFjb250ZXh0LmN1cnJlbnRBZHZhbmNlZFNlYXJjaFVybCkNCgkJCQlzZXREZWZhdWx0QWR2YW5jZWRTZWFyY2hVcmwoY29udGV4dCk7DQoJCQlpZiAoY29udGV4dC5jdXJyZW50QWR2YW5jZWRTZWFyY2hVcmwpDQoJCQkJd2luZG93LmxvY2F0aW9uID0gY29udGV4dC5jdXJyZW50QWR2YW5jZWRTZWFyY2hVcmw7DQoJCX0NCg0KCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubWVzc2FnaW5nLnN1YnNjcmliZShjb250ZXh0Lm1lc3NhZ2VQcmVmaXggKyAnYWR2YW5jZWRzZWFyY2gnLCByZWRpcmVjdFRvQWR2YW5jZWRTZWFyY2gpOw0KDQoJCS8vIGlmIG5vdCB0b3VjaCwgc3VwcG9ydCBlbnRlciB0byB1c2UgYWR2YW5jZWQgc2VhcmNoDQoJCSQoY29udGV4dC5zZWFyY2hJbnB1dCkub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkgew0KCQkJaWYgKGUud2hpY2ggPT09IDEzKSB7DQoJCQkJaWYgKCFjb250ZXh0LnN1cHBvcnRzSW5saW5lU2VhcmNoIHx8ICEkKCdib2R5JykuaGFzQ2xhc3MoJ3RvdWNoJykpIHsNCgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCQllLnN0b3BQcm9wYWdhdGlvbigpOw0KCQkJCQkvLyBpZiB0aGVyZSdzIGEgc2VsZWN0ZWQgaXRlbSwgcmVkaXJlY3QgdG8gaXQsIG90aGVyd2lzZSByZWRpcmVjdCB0byBhZHZhbmNlZCBzZWFyY2gNCgkJCQkJdmFyIHNlbGVjdGVkSXRlbSA9IGNvbnRleHQuc2VhcmNoUG9wdXAuY29udGVudCgpLmNoaWxkcmVuKCdsaS5jb250ZW50LWl0ZW0uc2VsZWN0ZWQnKTsNCgkJCQkJaWYgKHNlbGVjdGVkSXRlbS5sZW5ndGggPiAwKSB7DQoJCQkJCQlzZWxlY3RlZEl0ZW0uY2xpY2soKTsNCgkJCQkJfQ0KCQkJCQllbHNlIHsNCgkJCQkJCXJlZGlyZWN0VG9BZHZhbmNlZFNlYXJjaCgpOw0KCQkJCQl9DQoJCQkJCWlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3RvdWNoJykpIHsNCgkJCQkJCWNvbnRleHQuc2VhcmNoSW5wdXQuYmx1cigpOw0KCQkJCQl9DQoJCQkJCXJldHVybiBmYWxzZTsNCgkJCQl9DQoJCQkJZWxzZSB7DQoJCQkJCWNvbnRleHQuc2VhcmNoSW5wdXQuYmx1cigpOw0KCQkJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQkJCWUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7DQoJCQkJCXJldHVybiBmYWxzZTsNCgkJCQl9DQoJCQl9DQoJCX0pOw0KDQoJCXJldHVybiBjb250ZXh0LnNlYXJjaFBvcHVwOw0KCX0NCg0KCS8vIHJldHVybnMgc2hvdyBzZXR0aW5ncyB0byB1c2UgZm9yIGhlYWRlciBwb3B1cHMNCglmdW5jdGlvbiBidWlsZFNob3dTZXR0aW5ncyhjb250ZXh0LCBhY3RpdmF0b3IsIHNldHRpbmdzKSB7DQoJCWlmICgkKHdpbmRvdykud2lkdGgoKSA8PSA1NzApIHsNCgkJCXJldHVybiB7DQoJCQkJYXR0YWNoVG86IGNvbnRleHQuYmFubmVyLA0KCQkJCXdpZHRoOiBjb250ZXh0LmJhbm5lci53aWR0aCgpLA0KCQkJCW1heEhlaWdodDogJChnbG9iYWwpLmhlaWdodCgpIC8gMiwNCgkJCQljb250YWluZXJDc3NDbGFzczogc2V0dGluZ3MuY29udGFpbmVyQ3NzQ2xhc3MNCgkJCX07DQoJCX0NCgkJZWxzZSB7DQoJCQlyZXR1cm4gc2V0dGluZ3M7DQoJCX0NCgl9DQoNCglmdW5jdGlvbiBidWlsZFNob3dTZXR0aW5nc1V0aWxpdHlEcm9wZG93bihjb250ZXh0LCBhY3RpdmF0b3IsIHNldHRpbmdzKSB7DQoJCWlmICgkKHdpbmRvdykud2lkdGgoKSA8PSA1NzApIHsNCgkJCXJldHVybiB7DQoJCQkJYXR0YWNoVG86IGNvbnRleHQudXRpbGl0eURyb3Bkb3duLA0KCQkJCXdpZHRoOiBjb250ZXh0LmJhbm5lci53aWR0aCgpLA0KCQkJCW1heEhlaWdodDogJChnbG9iYWwpLmhlaWdodCgpIC8gMiwNCgkJCQljb250YWluZXJDc3NDbGFzczogc2V0dGluZ3MuY29udGFpbmVyQ3NzQ2xhc3MNCgkJCX07DQoJCX0NCgkJZWxzZSB7DQoJCQlyZXR1cm4gc2V0dGluZ3M7DQoJCX0NCgl9DQoNCglmdW5jdGlvbiBpbml0U2l0ZU5hdmlnYXRpb24oY29udGV4dCkgew0KCQljb250ZXh0LnNpdGVOYXZpZ2F0aW9uTGlzdCA9IEhlYWRlckxpc3Qoew0KCQkJa2V5OiAnc2l0ZScsDQoJCQlhY3RpdmF0aW9uTGluazogY29udGV4dC5zaXRlTmF2aWdhdGlvbkxpbmssDQoJCQllbmRsZXNzU2Nyb2xsOiB0cnVlLA0KCQkJdGl0bGVDb3VudDogZmFsc2UsDQoJCQljc3NDbGFzczogKCdzaXRlICcgKyAoY29udGV4dC5zaXRlTmF2aWdhdGlvblR5cGUgPT09ICdteV9ncm91cHMnID8gJ2dyb3VwJyA6IGNvbnRleHQuc2l0ZU5hdmlnYXRpb25UeXBlKSArICcgJyArIChjb250ZXh0LnNpdGVOYXZpZ2F0aW9uVHlwZSA9PSAnY3VzdG9tJyA/ICd3aXRob3V0LWF2YXRhcicgOiAnJykpLA0KCQkJd3JhcHBlcjogY29udGV4dC5iYW5uZXIsDQoJCQl1bnJlYWRDb3VudE1lc3NhZ2VQbHVyYWw6IGNvbnRleHQuc2l0ZU5hdmlnYXRpb25UaXRsZSwNCgkJCXVucmVhZENvdW50TWVzc2FnZVNpbmd1bGFyOiBjb250ZXh0LnNpdGVOYXZpZ2F0aW9uVGl0bGUsDQoJCQlvbkxvYWQ6IGZ1bmN0aW9uIChwYWdlSW5kZXgsIHNob3VsZFJlZnJlc2hVbnJlYWRDb3VudCwgZmlsdGVyLCBjb21wbGV0ZSkgew0KCQkJCSQudGVsbGlnZW50LmV2b2x1dGlvbi5nZXQoew0KCQkJCQl1cmw6IGNvbnRleHQuc2l0ZU5hdmlnYXRpb25VcmwsDQoJCQkJCWRhdGE6IHsNCgkJCQkJCXdfc2l0ZU5hdmlnYXRpb25UeXBlOiBjb250ZXh0LnNpdGVOYXZpZ2F0aW9uVHlwZSwNCgkJCQkJCXdfcGFnZUluZGV4OiBwYWdlSW5kZXgNCgkJCQkJfSwNCgkJCQkJc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7DQoJCQkJCQljb21wbGV0ZShyZXNwb25zZSk7DQoJCQkJCX0NCgkJCQl9KTsNCgkJCX0sDQoJCQlvblJlZnJlc2hVbnJlYWRDb3VudDogZnVuY3Rpb24gKGNvbXBsZXRlKSB7DQoJCQkJY29tcGxldGUoMCk7DQoJCQl9LA0KCQkJdGVtcGxhdGU6IGNvbnRleHQuc2l0ZU5hdmlnYXRpb25UZW1wbGF0ZSwNCgkJCW9uU2hvdzogZnVuY3Rpb24gKGFjdGl2YXRvciwgY29tcGxldGUpIHsNCgkJCQljb21wbGV0ZShidWlsZFNob3dTZXR0aW5ncyhjb250ZXh0LCBhY3RpdmF0b3IsIHt9KSk7DQoJCQl9DQoJCX0pOw0KDQoJCWlmIChjb250ZXh0LnNpdGVOYXZpZ2F0aW9uQ3VzdG9tSXRlbXMgJiYNCgkJCWNvbnRleHQuc2l0ZU5hdmlnYXRpb25DdXN0b21JdGVtcy5sZW5ndGggPiAwKSB7DQoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubWVzc2FnaW5nLnB1Ymxpc2goJ25hdmlnYXRpb24uc2l0ZU5hdmlnYXRpb25Db250ZW50Jywgew0KCQkJCQlpdGVtczogY29udGV4dC5zaXRlTmF2aWdhdGlvbkN1c3RvbUl0ZW1zDQoJCQkJfSk7DQoJCQl9LCAxMDApOw0KCQl9DQoNCgkJcmV0dXJuIGNvbnRleHQuc2l0ZU5hdmlnYXRpb25MaXN0Ow0KCX0NCg0KCWZ1bmN0aW9uIGluaXRIYW5kaGVsZExpbmtzKGNvbnRleHQpIHsNCgkJdmFyIG9wZW5IYW5kaGVsZENvbnRhaW5lciA9IG51bGwsIGFjdGl2ZUxpbmssIG9wZW4gPSBmYWxzZTsNCg0KCQlmdW5jdGlvbiByZWdpc3RlckhhbmRoZWxkTGluayhsaW5rLCBjb250YWluZXIsIG9uU2hvdywgb25IaWRlKSB7DQoJCQlsaW5rLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7DQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KDQoJCQkJaWYgKG9wZW5IYW5kaGVsZENvbnRhaW5lciAmJiBvcGVuSGFuZGhlbGRDb250YWluZXIgPT0gY29udGFpbmVyKSB7DQoJCQkJCWlmIChhY3RpdmVMaW5rKSB7DQoJCQkJCQlhY3RpdmVMaW5rLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJCQkJfQ0KCQkJCQlvbkhpZGUoKTsNCgkJCQkJb3BlbiA9IGZhbHNlOw0KCQkJCQlpZiAob3BlbkhhbmRoZWxkQ29udGFpbmVyKSB7DQoJCQkJCQlvcGVuSGFuZGhlbGRDb250YWluZXIuaGlkZSgpOw0KCQkJCQl9DQoJCQkJCW9wZW5IYW5kaGVsZENvbnRhaW5lciA9IG51bGw7DQoJCQkJfQ0KCQkJCWVsc2UgaWYgKG9wZW5IYW5kaGVsZENvbnRhaW5lcikgew0KCQkJCQlpZiAoYWN0aXZlTGluaykgew0KCQkJCQkJYWN0aXZlTGluay5yZW1vdmVDbGFzcygnYWN0aXZlJyk7DQoJCQkJCX0NCgkJCQkJb25IaWRlKCk7DQoJCQkJCW9wZW4gPSBmYWxzZTsNCgkJCQkJaWYgKG9wZW5IYW5kaGVsZENvbnRhaW5lcikgew0KCQkJCQkJb3BlbkhhbmRoZWxkQ29udGFpbmVyLmhpZGUoKTsNCgkJCQkJfQ0KCQkJCQlvcGVuSGFuZGhlbGRDb250YWluZXIgPSBjb250YWluZXI7DQoJCQkJfQ0KCQkJCWVsc2Ugew0KCQkJCQlvcGVuSGFuZGhlbGRDb250YWluZXIgPSBjb250YWluZXI7DQoJCQkJfQ0KDQoJCQkJaWYgKG9wZW5IYW5kaGVsZENvbnRhaW5lciAhPT0gbnVsbCkgew0KCQkJCQlvcGVuSGFuZGhlbGRDb250YWluZXIuc2hvdygpOw0KCQkJCQlvblNob3coKTsNCgkJCQkJb3BlbiA9IHRydWU7DQoJCQkJCWlmIChhY3RpdmVMaW5rKSB7DQoJCQkJCQlhY3RpdmVMaW5rLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJCQkJfQ0KCQkJCQlhY3RpdmVMaW5rID0gbGluay5wYXJlbnRzKCdsaScpLmFkZENsYXNzKCdhY3RpdmUnKTsNCgkJCQl9DQoJCQkJZWxzZSB7DQoJCQkJCW9uU2hvdygpOw0KCQkJCQlvcGVuID0gZmFsc2U7DQoJCQkJCWlmIChhY3RpdmVMaW5rKSB7DQoJCQkJCQlhY3RpdmVMaW5rLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsNCgkJCQkJfQ0KDQoJCQkJCWlmIChhY3RpdmVMaW5rLmdldCgwKSA9PT0gbGluay5wYXJlbnRzKCdsaScpLmdldCgwKSkgew0KCQkJCQkJYWN0aXZlTGluayA9IGxpbmsucGFyZW50cygnbGknKTsNCgkJCQkJfQ0KCQkJCQllbHNlIHsNCgkJCQkJCWFjdGl2ZUxpbmsgPSBsaW5rLnBhcmVudHMoJ2xpJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfSk7DQoJCX0NCg0KCQlyZWdpc3RlckhhbmRoZWxkTGluayhjb250ZXh0LmhhbmRoZWxkQmFubmVyTGlua3NMaW5rLCBjb250ZXh0LmhhbmRoZWxkQmFubmVyTGlua3MsDQoJCQlmdW5jdGlvbiAoKSB7DQoJCQkJY29udGV4dC5iYW5uZXJMaW5rcy5jb250ZW50cygpLmFwcGVuZFRvKGNvbnRleHQuaGFuZGhlbGRCYW5uZXJMaW5rcy5maW5kKCc+IHVsJykpOw0KCQkJfSwNCgkJCWZ1bmN0aW9uICgpIHsNCgkJCQljb250ZXh0LmhhbmRoZWxkQmFubmVyTGlua3MuZmluZCgnPiB1bCcpLmNvbnRlbnRzKCkuYXBwZW5kVG8oY29udGV4dC5iYW5uZXJMaW5rcyk7DQoJCQl9KTsNCg0KCQlyZWdpc3RlckhhbmRoZWxkTGluayhqUXVlcnkoJy51dGlsaXR5Lm1vYmlsZSAuc2VhcmNoLWJ1dHRvbiBhJyksIGNvbnRleHQuc2VhcmNoRmllbGRzLA0KCQkJZnVuY3Rpb24gKCkgew0KCQkJfSwNCgkJCWZ1bmN0aW9uICgpIHsNCgkJCX0NCgkJKTsNCgl9DQoNCgl2YXIgcG9wdXBMaXN0ID0gW107DQoJdmFyIHBvcHVwcyA9IHt9Ow0KDQoJZnVuY3Rpb24gcmVnaXN0ZXJQb3B1cChwb3B1cCwga2V5KSB7DQoJCXZhciBpbmRleCA9IHBvcHVwTGlzdC5sZW5ndGg7DQoJCXBvcHVwTGlzdC5wdXNoKHBvcHVwKTsNCgkJcG9wdXBzW2tleV0gPSB7DQoJCQlwb3B1cDogcG9wdXAsDQoJCQlpbmRleDogaW5kZXgNCgkJfTsNCgl9DQoNCglmdW5jdGlvbiBpbml0S2V5Ym9hcmRFdmVudHMoY29udGV4dCkgew0KCQl2YXIgaXNBY3RpdmUgPSBmYWxzZTsNCgkJdmFyIGN1cnJlbnRJbmRleCA9IG51bGw7DQoNCgkJJC50ZWxsaWdlbnQuZXZvbHV0aW9uLm1lc3NhZ2luZy5zdWJzY3JpYmUoYWN0aXZhdGVNZXNzYWdlLCBmdW5jdGlvbiAoZGF0YSkgew0KCQkJaXNBY3RpdmUgPSB0cnVlOw0KCQkJY3VycmVudEluZGV4ID0gcG9wdXBzW2RhdGEua2V5XS5pbmRleDsNCgkJCWlmIChkYXRhLmtleSA9PSAnc2VhcmNoJykgew0KCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KCQkJCQljb250ZXh0LnNlYXJjaElucHV0LmZvY3VzKCk7DQoJCQkJfSwgMTApDQoJCQl9DQoJCX0pOw0KCQkkLnRlbGxpZ2VudC5ldm9sdXRpb24ubWVzc2FnaW5nLnN1YnNjcmliZShkZWFjdGl2YXRlTWVzc2FnZSwgZnVuY3Rpb24gKGRhdGEpIHsNCgkJCWlmIChkYXRhLmtleSAhPSAnc2VhcmNoJykgew0KCQkJCWlzQWN0aXZlID0gZmFsc2U7DQoJCQl9DQoJCQljbGVhckludGVydmFsKHRlc3RJbnRlcnZhbCk7DQoJCX0pOw0KDQoJCXZhciBib2R5ID0gZG9jdW1lbnQuYm9keSwNCgkJCWRvYyA9IGRvY3VtZW50LA0KCQkJd2luID0gd2luZG93LA0KCQkJY3VycmVudFNlbGVjdGlvbiA9IG51bGw7DQoNCgkJdmFyIGtleXMgPSB7DQoJCQllbnRlcjogMTMsDQoJCQllc2M6IDI3LA0KDQoJCQlzbGFzaDogMTkxLA0KDQoJCQl1cDogMzgsDQoJCQlwOiA4MCwNCgkJCWs6IDc1LA0KDQoJCQlkb3duOiA0MCwNCgkJCW46IDc4LA0KCQkJajogNzQsDQoNCgkJCWxlZnQ6IDM3LA0KCQkJcmlnaHQ6IDM5LA0KCQkJaDogNzIsDQoJCQlsOiA3Ng0KCQl9Ow0KDQoJCWZ1bmN0aW9uIGJsb2NrS2V5KGUpIHsNCgkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7DQoJCX0NCg0KCQlmdW5jdGlvbiBnZXRDYXJldChlbCkgew0KCQkJaWYgKGVsLnNlbGVjdGlvblN0YXJ0KSB7DQoJCQkJcmV0dXJuIGVsLnNlbGVjdGlvblN0YXJ0Ow0KCQkJfQ0KCQkJZWxzZSBpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7DQoJCQkJZWwuZm9jdXMoKTsNCgkJCQl2YXIgciA9IGRvY3VtZW50LnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpOw0KCQkJCWlmIChyID09IG51bGwpIHsNCgkJCQkJcmV0dXJuIDA7DQoJCQkJfQ0KCQkJCXZhciByZSA9IGVsLmNyZWF0ZVRleHRSYW5nZSgpLA0KCQkJCQlyYyA9IHJlLmR1cGxpY2F0ZSgpOw0KCQkJCXJlLm1vdmVUb0Jvb2ttYXJrKHIuZ2V0Qm9va21hcmsoKSk7DQoJCQkJcmMuc2V0RW5kUG9pbnQoJ0VuZFRvU3RhcnQnLCByZSk7DQoJCQkJcmV0dXJuIHJjLnRleHQubGVuZ3RoOw0KCQkJfQ0KCQkJcmV0dXJuIDA7DQoJCX0NCg0KCQkkKCdib2R5Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHsNCgkJCXZhciBpc0Jhbm5lclRhcmdldCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoY29udGV4dC53cmFwcGVyICsgJywgLnBvcHVwLWxpc3QnKS5sZW5ndGggPiAwOw0KCQkJaWYgKCFpc0Jhbm5lclRhcmdldCkgew0KCQkJCXZhciBjdXJyZW50UG9wdXAgPSBwb3B1cExpc3RbY3VycmVudEluZGV4XTsNCgkJCQlpc0FjdGl2ZSA9IGZhbHNlOw0KCQkJCWlmIChjdXJyZW50UG9wdXApDQoJCQkJCWN1cnJlbnRQb3B1cC5kZWFjdGl2YXRlKCk7DQoJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5ibHVyKCk7DQoJCQkJY3VycmVudFNlbGVjdGlvbiA9IG51bGw7DQoJCQl9DQoJCX0pOw0KDQoJCSQoZG9jdW1lbnQpLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHsNCgkJCXZhciBpc1dpbmRvd0V2ZW50ID0gKGUudGFyZ2V0ID09IGJvZHkgfHwgZS50YXJnZXQgPT0gZG9jIHx8IGUudGFyZ2V0ID09IHdpbik7DQoJCQl2YXIgaXNCYW5uZXJFdmVudCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoY29udGV4dC53cmFwcGVyICsgJywgLnBvcHVwLWxpc3QnKS5sZW5ndGggPiAwOw0KDQoJCQkvL3ZhciBpc0Jhbm5lclRhcmdldCA9IGUudGFyZ2V0DQoJCQkvLyBzbGFzaCBvcGVucyBzZWFyY2gNCgkJCWlmICghaXNBY3RpdmUgJiYgaXNXaW5kb3dFdmVudCAmJiBlLndoaWNoID09IGtleXMuc2xhc2gpIHsNCgkJCQlibG9ja0tleShlKTsNCgkJCQljb250ZXh0LnNlYXJjaElucHV0LmZvY3VzKCk7DQoJCQkJaXNBY3RpdmUgPSB0cnVlOw0KCQkJCWN1cnJlbnRJbmRleCA9IHBvcHVwc1snc2VhcmNoJ10uaW5kZXg7DQoJCQl9DQoJCQllbHNlIGlmIChpc0FjdGl2ZSkgew0KCQkJCXZhciBjdXJyZW50UG9wdXAgPSBwb3B1cExpc3RbY3VycmVudEluZGV4XTsNCg0KCQkJCWlmICghaXNCYW5uZXJFdmVudCAmJiAhaXNXaW5kb3dFdmVudCkgew0KCQkJCQlpc0FjdGl2ZSA9IGZhbHNlOw0KCQkJCQlpZiAoY3VycmVudFBvcHVwKQ0KCQkJCQkJY3VycmVudFBvcHVwLmRlYWN0aXZhdGUoKTsNCgkJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5ibHVyKCk7DQoJCQkJCWN1cnJlbnRTZWxlY3Rpb24gPSBudWxsOw0KCQkJCQlyZXR1cm4gdHJ1ZTsNCgkJCQl9DQoNCgkJCQlpZiAoIWN1cnJlbnRQb3B1cCkgew0KCQkJCQlyZXR1cm4gdHJ1ZTsNCgkJCQl9DQoNCgkJCQl2YXIgaXNDdXJzb3JJblN0YXJ0ID0gY29udGV4dC5zZWFyY2hJbnB1dC5pcygiOm5vdCg6Zm9jdXMpIikgfHwgZ2V0Q2FyZXQoY29udGV4dC5zZWFyY2hJbnB1dFswXSkgPT0gMDsNCgkJCQl2YXIgaXNDdXJzb3JJbkVuZCA9IGNvbnRleHQuc2VhcmNoSW5wdXQuaXMoIjpub3QoOmZvY3VzKSIpIHx8IGdldENhcmV0KGNvbnRleHQuc2VhcmNoSW5wdXRbMF0pID09IGNvbnRleHQuc2VhcmNoSW5wdXQudmFsKCkubGVuZ3RoOw0KDQoJCQkJLy8gaGlkZSBvbiBlc2Mgb3Igc2xhc2ggaW4gbm9uIGlucHV0DQoJCQkJaWYgKGUud2hpY2ggPT0ga2V5cy5lc2MgfHwgKGUud2hpY2ggPT0ga2V5cy5zbGFzaCAmJiBpc1dpbmRvd0V2ZW50KSkgew0KCQkJCQlibG9ja0tleShlKTsNCgkJCQkJY3VycmVudFBvcHVwLmRlYWN0aXZhdGUoKTsNCgkJCQkJY29udGV4dC5zZWFyY2hJbnB1dC5ibHVyKCk7DQoJCQkJCWlzQWN0aXZlID0gZmFsc2U7DQoJCQkJCWN1cnJlbnRTZWxlY3Rpb24gPSBudWxsOw0KCQkJCX0NCg0KCQkJCS8vIGxlZnQvcmlnaHQgdG8gY2hhbmdlIGN1cnJlbnQgb3BlbiBwb3B1cA0KCQkJCWVsc2UgaWYgKChlLndoaWNoID09IGtleXMubGVmdCAmJiBpc0N1cnNvckluU3RhcnQgJiYgIShlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSkgfHwNCgkJCQkJKGUud2hpY2ggPT0ga2V5cy5oICYmIGN1cnJlbnRQb3B1cCAhPT0gY29udGV4dC5zZWFyY2hQb3B1cCkpIHsNCgkJCQkJYmxvY2tLZXkoZSk7DQoJCQkJCWN1cnJlbnRQb3B1cC5kZWFjdGl2YXRlKCk7DQoJCQkJCWNvbnRleHQuc2VhcmNoSW5wdXQuYmx1cigpOw0KCQkJCQljdXJyZW50SW5kZXgtLTsNCgkJCQkJaWYgKGN1cnJlbnRJbmRleCA8IDApIHsNCgkJCQkJCWN1cnJlbnRJbmRleCA9IHBvcHVwTGlzdC5sZW5ndGggLSAxOw0KCQkJCQl9DQoNCgkJCQkJY3VycmVudFBvcHVwID0gcG9wdXBMaXN0W2N1cnJlbnRJbmRleF07DQoJCQkJCWN1cnJlbnRQb3B1cC5hY3RpdmF0ZSgpOw0KCQkJCX0NCgkJCQllbHNlIGlmICgoZS53aGljaCA9PSBrZXlzLnJpZ2h0ICYmIGlzQ3Vyc29ySW5FbmQgJiYgIShlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSkgfHwNCgkJCQkJKGUud2hpY2ggPT0ga2V5cy5sICYmIGN1cnJlbnRQb3B1cCAhPT0gY29udGV4dC5zZWFyY2hQb3B1cCkpIHsNCgkJCQkJYmxvY2tLZXkoZSk7DQoJCQkJCWN1cnJlbnRQb3B1cC5kZWFjdGl2YXRlKCk7DQoJCQkJCWNvbnRleHQuc2VhcmNoSW5wdXQuYmx1cigpOw0KCQkJCQljdXJyZW50SW5kZXgrKzsNCgkJCQkJaWYgKGN1cnJlbnRJbmRleCA+PSBwb3B1cExpc3QubGVuZ3RoKSB7DQoJCQkJCQljdXJyZW50SW5kZXggPSAwOw0KCQkJCQl9DQoNCgkJCQkJY3VycmVudFBvcHVwID0gcG9wdXBMaXN0W2N1cnJlbnRJbmRleF07DQoJCQkJCWN1cnJlbnRQb3B1cC5hY3RpdmF0ZSgpOw0KCQkJCX0NCg0KCQkJCS8vIHVwDQoJCQkJZWxzZSBpZiAoZS53aGljaCA9PSBrZXlzLnVwIHx8DQoJCQkJCSgoZS53aGljaCA9PSBrZXlzLnAgfHwgZS53aGljaCA9PSBrZXlzLmspICYmIChjdXJyZW50UG9wdXAgIT09IGNvbnRleHQuc2VhcmNoUG9wdXApKSkgew0KCQkJCQlibG9ja0tleShlKTsNCgkJCQkJY3VycmVudFBvcHVwLm1vdmVVcChmdW5jdGlvbiAoaXRlbSkgew0KCQkJCQkJY3VycmVudFNlbGVjdGlvbiA9IGl0ZW07DQoJCQkJCX0pOw0KCQkJCX0NCg0KCQkJCS8vIGRvd24NCgkJCQllbHNlIGlmIChlLndoaWNoID09IGtleXMuZG93biB8fA0KCQkJCQkoKGUud2hpY2ggPT0ga2V5cy5uIHx8IGUud2hpY2ggPT0ga2V5cy5qKSAmJiAoY3VycmVudFBvcHVwICE9PSBjb250ZXh0LnNlYXJjaFBvcHVwKSkpIHsNCgkJCQkJYmxvY2tLZXkoZSk7DQoJCQkJCWN1cnJlbnRQb3B1cC5tb3ZlRG93bihmdW5jdGlvbiAoaXRlbSkgew0KCQkJCQkJY3VycmVudFNlbGVjdGlvbiA9IGl0ZW07DQoJCQkJCX0pOw0KCQkJCX0NCg0KCQkJCS8vIHNlbGVjdA0KCQkJCWVsc2UgaWYgKGUud2hpY2ggPT0ga2V5cy5lbnRlcikgew0KCQkJCQlibG9ja0tleShlKTsNCgkJCQkJaWYgKGN1cnJlbnRTZWxlY3Rpb24pIHsNCgkJCQkJCWN1cnJlbnRTZWxlY3Rpb24uY2xpY2soKTsNCgkJCQkJfQ0KCQkJCX0NCg0KCQkJfQ0KCQl9KTsNCgl9DQoNCgl2YXIgYXBpID0gew0KCQlyZWdpc3RlcjogZnVuY3Rpb24gKGNvbnRleHQpIHsNCgkJCWlmIChjb250ZXh0LnNpdGVOYXZpZ2F0aW9uVHlwZSA9PSAicXVlc3QiKSB7DQoJCQkJZ2V0UXVlc3ROYXZpZ2F0aW9uKCk7DQoJCQl9DQoJCQllbHNlIGlmIChjb250ZXh0LnNpdGVOYXZpZ2F0aW9uTGluayAmJiBjb250ZXh0LnNpdGVOYXZpZ2F0aW9uTGluay5sZW5ndGggPiAwKSB7DQoJCQkJcmVnaXN0ZXJQb3B1cChpbml0U2l0ZU5hdmlnYXRpb24oY29udGV4dCksICdzaXRlJyk7DQoJCQl9DQoNCgkJCWlmIChjb250ZXh0LnVzZVF1ZXN0Rm9vdGVyID09ICdUcnVlJykgew0KCQkJCWdldFF1ZXN0Rm9vdGVyKCk7DQoJCQl9DQoNCgkJCWlmIChjb250ZXh0LnNlYXJjaElucHV0Lmxlbmd0aCA+IDApIHsNCgkJCQlpZiAoY29udGV4dC5zZWFyY2hUeXBlID09ICJEZWZhdWx0Iikgew0KCQkJCQlyZWdpc3RlclBvcHVwKGluaXRTZWFyY2hQb3B1cChjb250ZXh0KSwgJ3NlYXJjaCcpOw0KCQkJCQlwb3N0UHJvY2Vzc0RlZmF1bHRTZWFyY2goY29udGV4dC5zZWFyY2hGaWVsZHMsIGNvbnRleHQuc2VhcmNoSW5wdXQpOw0KCQkJCX0NCgkJCQllbHNlIHsNCgkJCQkJaW5pdFF1ZXN0U2VhcmNoKGNvbnRleHQuc2VhcmNoRmllbGRzLCBjb250ZXh0LnNlYXJjaElucHV0KTsNCgkJCQl9DQoJCQl9DQoNCgkJCWlmIChjb250ZXh0Lm5vdGlmaWNhdGlvbnNMaW5rLmxlbmd0aCA+IDApDQoJCQkJcmVnaXN0ZXJQb3B1cChpbml0Tm90aWZpY2F0aW9uTGlzdChjb250ZXh0KSwgJ25vdGlmaWNhdGlvbnMnKTsNCg0KCQkJaWYgKGNvbnRleHQuY29udmVyc2F0aW9uc0xpbmsubGVuZ3RoID4gMCkNCgkJCQlyZWdpc3RlclBvcHVwKGluaXRDb252ZXJzYXRpb25MaXN0KGNvbnRleHQpLCAnY29udmVyc2F0aW9ucycpOw0KDQoJCQlpZiAoY29udGV4dC5ib29rbWFya3NMaW5rLmxlbmd0aCA+IDApDQoJCQkJcmVnaXN0ZXJQb3B1cChpbml0Qm9va21hcmtzTGlzdChjb250ZXh0KSwgJ2Jvb2ttYXJrcycpOw0KDQoJCQlpZiAoY29udGV4dC51c2VyTGluay5sZW5ndGggPiAwKQ0KCQkJCXJlZ2lzdGVyUG9wdXAoaW5pdFVzZXJQb3B1cChjb250ZXh0KSwgJ3VzZXInKTsNCg0KCQkJaW5pdEhhbmRoZWxkTGlua3MoY29udGV4dCk7DQoNCgkJCWluaXRLZXlib2FyZEV2ZW50cyhjb250ZXh0KTsNCgkJfQ0KCX07DQoNCgkkLnRlbGxpZ2VudCA9ICQudGVsbGlnZW50IHx8IHt9Ow0KCSQudGVsbGlnZW50LmV2b2x1dGlvbiA9ICQudGVsbGlnZW50LmV2b2x1dGlvbiB8fCB7fTsNCgkkLnRlbGxpZ2VudC5ldm9sdXRpb24ud2lkZ2V0cyA9ICQudGVsbGlnZW50LmV2b2x1dGlvbi53aWRnZXRzIHx8IHt9Ow0KCSQudGVsbGlnZW50LmV2b2x1dGlvbi53aWRnZXRzLnNpdGVCYW5uZXIgPSBhcGk7DQoNCgkvL0N1c3RvbQ0KDQoJdmFyIGxvY2FsaXplZENvbnRlbnQgPSBbXSwgcGFnZVR5cGUgPSAnJywgcGFnZVdpZHRoID0gMDsNCgl2YXIgUm9vdFBhdGggPSBSb290UGF0aCB8fCAnJzsNCg0KCSQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHsNCgkJcGFnZVdpZHRoID0gZ2V0UGFnZVByb3BlcnRpZXMoKTsNCg0KCQlwcm9jZXNzSGVhZGVyRm9vdGVyKCk7DQoNCgkJaWYgKCQoJy5zb2NpYWwtbWVkaWEtdG9vbGJhcicpLmxlbmd0aCkgew0KCQkJc29jaWFsTWVkaWFUb29sYmFyKCk7DQoJCX0NCg0KCQkkKCdib2R5Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHsNCgkJCWlmICghJChlLnRhcmdldCkucGFyZW50cygnaGVhZGVyJykubGVuZ3RoKSB7DQoJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQoJCQkJCSQoJy51dGlsaXR5JykuZmluZCgnLmFjdGl2ZScpLmZpbmQoJz4gYScpLnRyaWdnZXIoJ2NsaWNrJyk7DQoJCQkJfSwgMTAwKTsNCgkJCX0NCgkJfSk7DQoJfSk7DQoNCgkkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uICgpIHsNCgkJcGFnZVdpZHRoID0gZ2V0UGFnZVByb3BlcnRpZXMoKTsNCgl9KTsNCg0KCWZ1bmN0aW9uIHBvc3RQcm9jZXNzRGVmYXVsdFNlYXJjaChzZWFyY2hDb250YWluZXIsIHNlYXJjaElucHV0RWxlbSkgew0KCQlzZWFyY2hDb250YWluZXIub24oJ2NsaWNrJywgJy5idG4nLCBmdW5jdGlvbiAoZSkgew0KCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJbG9jYXRpb24uaHJlZiA9ICcvY29tbXVuaXR5L3NlYXJjaD9xPScgKyBzZWFyY2hJbnB1dEVsZW0udmFsKCk7DQoJCX0pOw0KDQoJCXBvc3RQcm9jZXNzQWxsU2VhcmNoKHNlYXJjaENvbnRhaW5lcik7DQoJfQ0KDQoJZnVuY3Rpb24gaW5pdFF1ZXN0U2VhcmNoKHNlYXJjaENvbnRhaW5lciwgc2VhcmNoRmllbGRFbGVtKSB7DQoJCSQuZ2V0U2NyaXB0KCcvU3RhdGljL1NjcmlwdHMvanF1ZXJ5LmF1dG9jb21wbGV0ZS5taW4uanMnLCBmdW5jdGlvbiAoKSB7DQoJCQkkLmdldFNjcmlwdCgnL3ZpZXdTY3JpcHRzL2pxdWVyeS5hZG9iZS5hdXRvY29tcGxldGUuanMnLCBmdW5jdGlvbiAoKSB7DQoJCQkJLy9UT0RPOiBGaWd1cmUgb3V0IHdoYXQgdGhpcyBkb2VzLg0KCQkJCXZhciBiID0ge307DQoJCQkJKGZ1bmN0aW9uICgpIHsNCgkJCQkJdmFyIGosIGwgPSAvXCsvZywgayA9IC8oW14mPV0rKT0/KFteJl0qKS9nLCBuID0gZnVuY3Rpb24gKG8pIHsNCgkJCQkJCXJldHVybiBkZWNvZGVVUklDb21wb25lbnQoby5yZXBsYWNlKGwsICIgIikpDQoJCQkJCX0sIG0gPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKTsNCgkJCQkJd2hpbGUgKGogPSBrLmV4ZWMobSkpIHsNCgkJCQkJCWJbbihqWzFdKV0gPSBuKGpbMl0pDQoJCQkJCX0NCgkJCQl9KSgpOw0KDQoJCQkJLy8gc2VhcmNoRmllbGRFbGVtLmF0dHIoJ2F1dG9jb21wbGV0ZScsICdvZmYnKTsNCgkJCQlzZWFyY2hGaWVsZEVsZW0ub24oJ2tleXByZXNzJywgZnVuY3Rpb24gKGUpIHsNCgkJCQkJaWYgKGUud2hpY2ggPT0gMTMpIHsNCgkJCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQkJCWdvU2VhcmNoKCQodGhpcykudmFsKCkpOw0KCQkJCQl9DQoJCQkJfSk7DQoNCgkJCQlzZWFyY2hDb250YWluZXIub24oJ2NsaWNrJywgJy5idG4nLCBmdW5jdGlvbiAoZSkgew0KCQkJCQllLnByZXZlbnREZWZhdWx0KCk7DQoNCgkJCQkJbG9jYXRpb24uaHJlZiA9ICcvc2VhcmNoL3Jlc3VsdHMvP3E9JyArIHNlYXJjaEZpZWxkRWxlbS52YWwoKTsNCgkJCQl9KTsNCg0KCQkJCWluaXRBZG9iZVNlYXJjaCgpOw0KCQkJCXBvc3RQcm9jZXNzQWxsU2VhcmNoKHNlYXJjaENvbnRhaW5lcik7DQoJCQl9KTsNCgkJfSk7DQoNCgkJZnVuY3Rpb24gaW5pdEFkb2JlU2VhcmNoKCkgew0KCQkJdmFyIGNvbmZpZyA9IHsNCgkJCQlhY2NvdW50OiAic3AxMDA1MGMzMyIsDQoJCQkJc2VhcmNoRG9tYWluOiAnaHR0cDovL3N0YWdlLnNwMTAwNTBlY2QuZ3VpZGVkLnNzLW9tdHJkYy5uZXQvJywNCgkJCQlpbnB1dEVsZW1lbnQ6ICJbdHlwZT1zZWFyY2hdIiwNCgkJCQkvL2lucHV0Rm9ybUVsZW1lbnQ6ICIjc2VhcmNoLWZvcm0iLA0KCQkJCWRlbGF5OiAzMDAsDQoJCQkJbWluTGVuZ3RoOiAyLA0KCQkJCW1heFJlc3VsdHM6IDEwLA0KCQkJCWJyb3dzZXJBdXRvY29tcGxldGU6IGZhbHNlLA0KCQkJCXF1ZXJ5Q2FzZVNlbnNpdGl2ZTogZmFsc2UsDQoJCQkJc3RhcnRzV2l0aDogZmFsc2UsDQoJCQkJc2VhcmNoT25TZWxlY3Q6IHRydWUsDQoJCQkJc3VibWl0T25TZWxlY3Q6IHRydWUsDQoJCQkJaGlnaGxpZ2h0V29yZHM6IGZhbHNlLA0KCQkJCWhpZ2hsaWdodFdvcmRzQmVnaW46IGZhbHNlDQoJCQl9Ow0KDQoJCQlzZWFyY2hGaWVsZEVsZW0ub24oImF1dG9jb21wbGV0ZW9wZW4iLCBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7DQoJCQkJJCgnLnVpLWF1dG9jb21wbGV0ZScpLmNzcyh7DQoJCQkJCXdpZHRoOiAkKHRoaXMpLm91dGVyV2lkdGgodHJ1ZSkNCgkJCQl9KQ0KCQkJfSk7DQoNCgkJCXNlYXJjaEZpZWxkRWxlbS5vbigiYXV0b2NvbXBsZXRlc2VsZWN0IiwgZnVuY3Rpb24gKGV2ZW50LCB1aSkgew0KCQkJCWdvU2VhcmNoKHNlYXJjaEZpZWxkRWxlbS52YWwoKSk7DQoJCQl9KTsNCg0KCQkJc2VhcmNoRmllbGRFbGVtLkFkb2JlQXV0b2NvbXBsZXRlKGNvbmZpZyk7DQoJCX0NCg0KCQlmdW5jdGlvbiBnb1NlYXJjaChzZWFyY2h0ZXJtKSB7DQoJCQlpZiAoaXNEb3VibGVCeXRlKHNlYXJjaHRlcm0pKSB7DQoJCQkJc2VhcmNodGVybSA9IGVuY29kZVVSSUNvbXBvbmVudChzZWFyY2h0ZXJtKTsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCS8vc2VhcmNodGVybSA9IGVuY29kZVVSSUNvbXBvbmVudChFbmNvZGVyLmh0bWxFbmNvZGUoc2VhcmNodGVybSkpOw0KCQkJCXNlYXJjaHRlcm0gPSBlbmNvZGVVUklDb21wb25lbnQoc2VhcmNodGVybSk7DQoJCQl9DQoNCgkJCWxvY2F0aW9uLmhyZWYgPSAiL3NlYXJjaC9yZXN1bHRzLz9xPSIgKyBzZWFyY2h0ZXJtOw0KDQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCg0KCQlmdW5jdGlvbiBpc0RvdWJsZUJ5dGUoc3RyKSB7DQoJCQlmb3IgKHZhciBpID0gMCwgbiA9IHN0ci5sZW5ndGg7IGkgPCBuOyBpKyspIHsNCgkJCQlpZiAoc3RyLmNoYXJDb2RlQXQoaSkgPiAyNTUpIHsNCgkJCQkJcmV0dXJuIHRydWU7DQoJCQkJfQ0KCQkJfQ0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJfQ0KDQoJZnVuY3Rpb24gcG9zdFByb2Nlc3NBbGxTZWFyY2goc2VhcmNoQ29udGFpbmVyKSB7DQoJCS8vVXRpbGl0eSBzZWN0aW9uLiBEZXNrdG9wDQoJCSQoJ2JvZHknKS5vbignY2xpY2snLCAnLnV0aWxpdHkuZGVza3RvcCAuc2VhcmNoLWJ1dHRvbiA+IGEnLCBmdW5jdGlvbiAoKSB7DQoJCQkkKHRoaXMpLnBhcmVudHMoJy51dGlsaXR5LXNlY3Rpb24td3JhcHBlcicpLnRvZ2dsZUNsYXNzKCdvcGVuLXNlYXJjaCcpOw0KCQl9KTsNCgl9DQoNCgkvKg0KCSBHZXQgbmF2aWdhdGlvbiB2aWEgYWpheC4gU2hvdWxkIG9ubHkgYmUgZXhlY3V0ZWQgb24gbm9uIGhvbWUgcGFnZS4NCg0KCSBOb3RlOiBBbGwgbm9uIGhvbWUgcGFnZSAocmVzcG9uc2l2ZSkgd2lsbCB1c2UgdGhlIHNwZWNpYWwgdGFnIFYyTGF5b3V0SGVhZGVyQWpheCB3aGljaCBoYXMgYSBkYXRhLWFqYXg9InRydWUiIGF0dHJpYnV0ZS4NCgkgVjJMYXlvdXRIZWFkZXJBamF4TmF2IGNvbnRhaW5zIHRoZSBuYXZpZ2F0aW9uIGh0bWwgY29udGVudC4NCgkgKi8NCglmdW5jdGlvbiBnZXRRdWVzdE5hdmlnYXRpb24oKSB7DQoJCXZhciBoZWFkZXJOYXZFbGVtID0gJCgnLm1haW4tbmF2LXNlY3Rpb24nKSwNCgkJCXNwZWNpYWxUYWcgPSBbJ1YyTGF5b3V0SGVhZGVyQWpheE5hdiddLA0KCQkJc2Vzc2lvbk5hdk5hbWUgPSAnbmF2LScgKyBSb290UGF0aC5yZXBsYWNlKC9cLy9nLCAnJyk7DQoNCgkJaWYgKGhlYWRlck5hdkVsZW0uZGF0YSgnYWpheCcpKSB7DQoJCQkvL0lmIHNlc3Npb24gc3RvcmFnZSBpcyBhdmFpbGFibGUsIHBvcHVsYXRlIG5hdmlnYXRpb24uIE5vdGU6IGlmIG5hdmlnYXRpb24gaGFzIGJlZW4gdXBkYXRlZCB3aGVuIG5hdiBpcyBhbHJlYWR5IHN0b3JlZCwgaXQnbGwgYmUgb25lIHBhZ2UgdmlldyBiZWhpbmQuDQoJCQlpZiAoc2Vzc2lvblN0b3JhZ2Vbc2Vzc2lvbk5hdk5hbWVdKSB7DQoJCQkJaGVhZGVyTmF2RWxlbS5hcHBlbmQoc2Vzc2lvblN0b3JhZ2Vbc2Vzc2lvbk5hdk5hbWVdKTsNCgkJCQliaW5kTmF2aWdhdGlvbkV2ZW50cygpOw0KCQkJfQ0KDQoJCQkvL0dldCBuYXZpZ2F0aW9uIGFuZCBzdG9yZQ0KCQkJZ2V0TG9jYWxpemVkQ29udGVudChzcGVjaWFsVGFnKS5kb25lKGZ1bmN0aW9uIChkYXRhKSB7DQoJCQkJLy9Qb3B1bGF0ZSBuYXZpZ2F0aW9uIG9ubHkgaWYgc2Vzc2lvblN0b3JhZ2UubmF2IGlzIG5vdCBwcmVzZW50IGJlY2F1c2UgaWYgaXQgaXMgcHJlc2VudCwgaXQgd291bGQgaGF2ZSBhbHJlYWR5IGJlZW4gcG9wdWxhdGVkIG9uIGxpbmUgMzIuDQoJCQkJaWYgKCFzZXNzaW9uU3RvcmFnZVtzZXNzaW9uTmF2TmFtZV0pIHsNCgkJCQkJaGVhZGVyTmF2RWxlbS5hcHBlbmQoZGF0YVtzcGVjaWFsVGFnWzBdXSk7DQoJCQkJCWJpbmROYXZpZ2F0aW9uRXZlbnRzKCk7DQoJCQkJfQ0KDQoJCQkJLy9TdG9yZSBsYXRlc3QgbmF2aWdhdGlvbi4NCgkJCQlzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHNlc3Npb25OYXZOYW1lLCBkYXRhW3NwZWNpYWxUYWdbMF1dKTsNCgkJCX0pOw0KCQl9DQoJCWVsc2Ugew0KCQkJLy9HZXQgbmF2aWdhdGlvbiBhbmQgc3RvcmUNCgkJCWdldExvY2FsaXplZENvbnRlbnQoc3BlY2lhbFRhZykuZG9uZShmdW5jdGlvbiAoZGF0YSkgew0KCQkJCS8vU3RvcmUgbGF0ZXN0IG5hdmlnYXRpb24uDQoJCQkJc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShzZXNzaW9uTmF2TmFtZSwgZGF0YVtzcGVjaWFsVGFnWzBdXSk7DQoJCQl9KTsNCgkJfQ0KDQoJCWZ1bmN0aW9uIGJpbmROYXZpZ2F0aW9uRXZlbnRzKCkgew0KCQkJLy9QcmV2ZW50IGFuY2hvciB0YWcgZnJvbSBmaXJpbmcgd2hlbiBocmVmIGlzIHNldCB0byAjDQoJCQloZWFkZXJOYXZFbGVtLmZpbmQoJy50aWVyMicpLm9uKCdjbGljaycsICdhW2hyZWY9I10nLCBmdW5jdGlvbiAoZSkgew0KCQkJCWlmIChwYWdlVHlwZSA9PSAzKSB7DQoJCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJLy9Nb2JpbGUgb25seS4NCgkJCWhlYWRlck5hdkVsZW0ub24oJ2NsaWNrJywgJy50aWVyMiA+IGxpLnN1YkxpbmtzID4gYSwgLnRpZXIzID4gbGkuc3ViTGlua3MgPiBhJywgZnVuY3Rpb24gKGUpIHsNCgkJCQlpZiAocGFnZVR5cGUgPT0gMykgew0KCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJfQ0KDQoJCQkJdmFyIGlzT3BlbiA9ICQodGhpcykucGFyZW50KCkuc2libGluZ3MoKS5oYXNDbGFzcygnb3BlbicpOw0KDQoJCQkJaWYgKGlzT3Blbikgew0KCQkJCQkkKHRoaXMpLnBhcmVudCgpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ29wZW4nKTsNCgkJCQl9DQoNCgkJCQliZ0FuaW1hdGUodGhpcyk7DQoNCgkJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQkJJCh0aGlzKS5wYXJlbnQoKS50b2dnbGVDbGFzcygnb3BlbicpOw0KCQkJfSk7DQoNCgkJCS8vU2lhbWFrOiBPcGVuIHRpZXIgMiBvbiBjbGljaw0KCQkJLy9DaGFuZ2UgYmcgY29sb3Igb24gTW9iaWxlIGFuZCBUYWJsZXQNCgkJCWhlYWRlck5hdkVsZW0uZmluZCgnLnRpZXIxJykub24oJ2NsaWNrJywgJz4gLnN1YkxpbmtzID4gYScsIGZ1bmN0aW9uIChlKSB7DQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7DQoNCgkJCQl2YXIgaXNPcGVuID0gJCh0aGlzKS5wYXJlbnQoKS5oYXNDbGFzcygnb3BlbicpOw0KDQoJCQkJLy9DbG9zaW5nIGFsbCBvdGhlciBvcGVuZWQgbmF2aWdhdGlvbg0KCQkJCWhlYWRlck5hdkVsZW0uZmluZCgnLm9wZW4nKS5yZW1vdmVDbGFzcygnb3BlbicpOw0KDQoJCQkJaWYgKCFpc09wZW4pIHsNCgkJCQkJLy9BZGRpbmcgLm9wZW4gdG8gdGFyZ2V0IExJDQoJCQkJCSQodGhpcykucGFyZW50KCkudG9nZ2xlQ2xhc3MoJ29wZW4nKTsNCgkJCQl9DQoNCgkJCQkvL1NpYW1hazogQ2hhbmdlIHRpZXIgMSBiYWNrZ3JvdW5kIHdoZW4gY2xpY2sNCgkJCQlpZiAocGFnZVR5cGUgPCAzKSB7DQoJCQkJCWJnQW5pbWF0ZSh0aGlzKTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJJCgnYm9keScpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7DQoJCQkJLy9DbG9zaW5nIGFsbCBuYXZpZ2F0aW9uIHdoZW4gY2xpY2sgb24gYm9keSAoTGFyZ2UgZGVza3RvcCkNCgkJCQlpZiAocGFnZVR5cGUgPT0gMykgew0KCQkJCQkkKCcudGllcjEnKS5maW5kKCcub3BlbicpLnJlbW92ZUNsYXNzKCdvcGVuJyk7DQoJCQkJfQ0KCQkJfSk7DQoJCX0NCgl9DQoNCglmdW5jdGlvbiBnZXRRdWVzdEZvb3RlcigpIHsNCgkJdmFyIHNwZWNpYWxUYWcgPSBbJ1YyTGF5b3V0Rm9vdGVyVG9wJywgJ1YyTGF5b3V0Rm9vdGVyQm90dG9tJ10sDQoJCQlzZXNzaW9uRm9vdGVyVG9wTmFtZSA9ICdmdC0nICsgUm9vdFBhdGgucmVwbGFjZSgvXC8vZywgJycpLA0KCQkJc2Vzc2lvbkZvb3RlckJvdHRvbU5hbWUgPSAnZmItJyArIFJvb3RQYXRoLnJlcGxhY2UoL1wvL2csICcnKTsNCg0KCQkvL0lmIHNlc3Npb24gc3RvcmFnZSBpcyBhdmFpbGFibGUsIHBvcHVsYXRlIG5hdmlnYXRpb24uIE5vdGU6IGlmIG5hdmlnYXRpb24gaGFzIGJlZW4gdXBkYXRlZCB3aGVuIG5hdiBpcyBhbHJlYWR5IHN0b3JlZCwgaXQnbGwgYmUgb25lIHBhZ2UgdmlldyBiZWhpbmQuDQoJCWlmIChzZXNzaW9uU3RvcmFnZVtzZXNzaW9uRm9vdGVyVG9wTmFtZV0pIHsNCgkJCSQoJ2JvZHknKS5hcHBlbmQoJzxmb290ZXIgY2xhc3M9ImZvb3RlciIgaWQ9ImZvb3RlciI+JyArIHNlc3Npb25TdG9yYWdlW3Nlc3Npb25Gb290ZXJUb3BOYW1lXSArIHNlc3Npb25TdG9yYWdlW3Nlc3Npb25Gb290ZXJCb3R0b21OYW1lXSArICc8L2Zvb3Rlcj4nKTsNCgkJCWJpbmROYXZpZ2F0aW9uRXZlbnRzKCk7DQoJCX0NCg0KCQkvL0dldCBuYXZpZ2F0aW9uIGFuZCBzdG9yZQ0KCQlnZXRMb2NhbGl6ZWRDb250ZW50KHNwZWNpYWxUYWcpLmRvbmUoZnVuY3Rpb24gKGRhdGEpIHsNCgkJCS8vUG9wdWxhdGUgbmF2aWdhdGlvbiBvbmx5IGlmIHNlc3Npb25TdG9yYWdlLm5hdiBpcyBub3QgcHJlc2VudCBiZWNhdXNlIGlmIGl0IGlzIHByZXNlbnQsIGl0IHdvdWxkIGhhdmUgYWxyZWFkeSBiZWVuIHBvcHVsYXRlZCBvbiBsaW5lIDMyLg0KCQkJaWYgKCFzZXNzaW9uU3RvcmFnZVtzZXNzaW9uRm9vdGVyVG9wTmFtZV0pIHsNCgkJCQkkKCdib2R5JykuYXBwZW5kKCc8Zm9vdGVyIGNsYXNzPSJmb290ZXIiIGlkPSJmb290ZXIiPicgKyBkYXRhW3NwZWNpYWxUYWdbMF1dICsgZGF0YVtzcGVjaWFsVGFnWzFdXSArICc8L2Zvb3Rlcj4nKTsNCgkJCQliaW5kTmF2aWdhdGlvbkV2ZW50cygpOw0KCQkJfQ0KDQoJCQkvL1N0b3JlIGxhdGVzdCBuYXZpZ2F0aW9uLg0KCQkJc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShzZXNzaW9uRm9vdGVyVG9wTmFtZSwgZGF0YVtzcGVjaWFsVGFnWzBdXSk7DQoJCQlzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHNlc3Npb25Gb290ZXJCb3R0b21OYW1lLCBkYXRhW3NwZWNpYWxUYWdbMV1dKTsNCgkJfSk7DQoNCgkJZnVuY3Rpb24gYmluZE5hdmlnYXRpb25FdmVudHMoKSB7DQoJCQkvL1ByZXZlbnQgYW5jaG9yIHRhZyBmcm9tIGZpcmluZyB3aGVuIGhyZWYgaXMgc2V0IHRvICMgb24gbW9iaWxlDQoJCQkkKCcuZm9vdGVyLXRvcC1zZWN0aW9uJykub24oJ2NsaWNrJywgJ2FbaHJlZj0jXScsIGZ1bmN0aW9uIChlKSB7DQoJCQkJaWYgKCQoJ2h0bWwnKS53aWR0aCgpIDwgNzY4KSB7DQoJCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJLy9Jc3N1ZSB3aXRoIGlQYWQgQ2hyb21lIHdoZXJlIGxpbmtzIGNvdWxkbid0IGJlIGNsaWNrZWQuDQoJCQkvL1JlYXNvbiB3YXMgZm9yIFNpdGVDYXRhbHlzdCBpbmplY3Rpbmcgb25jbGljayBhdHRyaWJ1dGUgdG8gYWxsIGFuY2hvciB0YWcuDQoJCQkkKCdmb290ZXInKS5vbignY2xpY2snLCAnYScsIGZ1bmN0aW9uIChlKSB7DQoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCWUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7DQoJCQkJLy9hZGRlZCB0aGlzIGNvbmRpdGlvbiB0byBvcGVuIGxpbmtzIGluIGEgbmV3IHRhYiB3aGVuIG5lZWRlZA0KCQkJCWlmICgkKHRoaXMpLmF0dHIoJ3RhcmdldCcpICE9IHVuZGVmaW5lZCAmJiAkKHRoaXMpLmF0dHIoJ3RhcmdldCcpID09ICdfYmxhbmsnKSB7DQoJCQkJCXdpbmRvdy5vcGVuKCQodGhpcykuYXR0cignaHJlZicpKTsNCgkJCQl9DQoJCQkJZWxzZSB7DQoJCQkJCWxvY2F0aW9uLmhyZWYgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJLy9UbyBvcGVuIGFuZCBjbG9zZSBmb290ZXIgb24gTW9iaWxlDQoJCQkkKCdib2R5Jykub24oJ2NsaWNrJywgJy5tZW51LWxpbmtzID4gLnN1YkxpbmtzID4gc3BhbicsIGZ1bmN0aW9uIChlKSB7DQoJCQkJLy9BZGQgZnVuY3Rpb25hbGl0eSBmb3Igd2hlbiB1c2VyIHVzZXMgdG91Y2ggb24gbmF2aWdhdGlvbi9mb290ZXIuDQoNCgkJCQlpZiAoJCh0aGlzKS5wYXJlbnRzKCcjZm9vdGVyJykubGVuZ3RoICYmIHBhZ2VXaWR0aCA+PSA3NjgpIHsNCgkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCX0NCg0KCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQllLnN0b3BQcm9wYWdhdGlvbigpOw0KDQoJCQkJdmFyIGVsZW0gPSAkKHRoaXMpLnBhcmVudCgpOw0KDQoJCQkJLy9SZW1vdmUgYWxsICJvcGVuIiBjbGFzcyB0aGF0IGlzIGEgc2libGluZyB0byB0aGUgY3VycmVudGx5IHRvdWNoZWQgZWxlbWVudC4NCgkJCQllbGVtLnNpYmxpbmdzKCkNCgkJCQkJLmZpbmQoJy5vcGVuJykucmVtb3ZlQ2xhc3MoJ29wZW4nKS5lbmQoKQ0KCQkJCQkucmVtb3ZlQ2xhc3MoJ29wZW4nKTsNCg0KCQkJCWlmIChlbGVtLmhhc0NsYXNzKCdvcGVuJykpIHsNCgkJCQkJLy9SZW1vdmUgYWxsICJvcGVuIiBjbGFzcyBpbnNpZGUgb2YgdGhlIGN1cnJlbnRseSB0b3VjaGVkIGVsZW1lbnQuDQoJCQkJCWVsZW0uZmluZCgnLm9wZW4nKS5yZW1vdmVDbGFzcygnb3BlbicpLmVuZCgpLnJlbW92ZUNsYXNzKCdvcGVuJyk7DQoJCQkJfQ0KCQkJCWVsc2Ugew0KCQkJCQllbGVtLmFkZENsYXNzKCdvcGVuJyk7DQoNCgkJCQkJLy9maXggZm9yIHNvbmljd2FsbCBoZWlnaHQNCgkJCQkJJCgnYm9keScpLnRyaWdnZXIoJ3N1Ym5hdi52aXNpYmxlJyk7DQoNCgkJCQkJaWYgKHBhZ2VUeXBlID09IDApIHsgLy9Nb2JpbGUNCgkJCQkJCS8vQW5pbWF0ZSBiYWNrZ3JvdW5kIGNvbG9yIHRvIG5vdGlmeSB1c2VyIHRoYXQgdGhleSBoYXZlIHRvdWNoZWQgdGhhdCBlbGVtZW50Lg0KCQkJCQkJLy9SZXF1aXJlOiBqUXVlcnkgQ29sb3IgdjIuMS4yIHBsdWdpbg0KCQkJCQkJZWxlbS5jc3Moe2JhY2tncm91bmRDb2xvcjogJyNmYjRmMTQnLCBjb2xvcjogJyNmZmZmZmYnfSk7DQoJCQkJCQkkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7c2Nyb2xsVG9wOiAkKHRoaXMpLm9mZnNldCgpLnRvcH0sIGZ1bmN0aW9uICgpIHsNCgkJCQkJCQllbGVtLmNzcygnY29sb3InLCAnIzMzMzMzMycpOw0KCQkJCQkJCWVsZW0uYW5pbWF0ZSh7YmFja2dyb3VuZENvbG9yOiAiI2VlZSJ9LCA1MDAsIGZ1bmN0aW9uICgpIHsNCgkJCQkJCQkJZWxlbS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICcnKTsNCgkJCQkJCQl9KTsNCgkJCQkJCX0pOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCS8qIENvdW50cnkgRHJvcGRvd24gKi8NCgkJCSQoJyNjdXJyZW50LWNvdW50cnknKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkgew0KCQkJCWlmIChwYWdlV2lkdGggPiA3NjcpIHsNCgkJCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsNCgkJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCQkvLyQoJyNjb3VudHJ5LXBvcHVwJykudG9nZ2xlKCk7DQoJCQkJCSQodGhpcykucGFyZW50cygnbGknKS50b2dnbGVDbGFzcygnb3BlbicpOw0KCQkJCX0NCgkJCX0pOw0KCQl9DQoJfQ0KDQoJZnVuY3Rpb24gZ2V0TG9jYWxpemVkQ29udGVudCh0YWdzKSB7DQoJCS8vSG93IHRvIGNhbGw6IGdldExvY2FsaXplZENvbnRlbnQoJ1JlZ1dhcm5pbmdNZXNzYWdlRW1haWxSZXF1aXJlZCcpLmRvbmUoZnVuY3Rpb24oZGF0YSkgeyBjb25zb2xlLmxvZyhkYXRhKTsgfSk7DQoJCXZhciByZXR1cm5WYWx1ZSA9IHt9LCBuZXdUYWdzID0gW10sIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpOw0KDQoJCWlmICh0eXBlb2YgdGFncyA9PSAnc3RyaW5nJykgew0KCQkJaWYgKGxvY2FsaXplZENvbnRlbnRbdGFnc10pIHsNCgkJCQlyZXR1cm4gbG9jYWxpemVkQ29udGVudFt0YWdzXTsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCW5ld1RhZ3MucHVzaCh0YWdzKTsNCgkJCX0NCgkJfQ0KCQllbHNlIHsNCgkJCSQuZWFjaCh0YWdzLCBmdW5jdGlvbiAoaSwgdGFnKSB7DQoJCQkJaWYgKGxvY2FsaXplZENvbnRlbnRbdGFnXSkgew0KCQkJCQlyZXR1cm5WYWx1ZVt0YWddID0gbG9jYWxpemVkQ29udGVudFt0YWddOw0KCQkJCX0NCgkJCQllbHNlIHsNCgkJCQkJbmV3VGFncy5wdXNoKHRhZyk7DQoJCQkJfQ0KCQkJfSk7DQoJCX0NCg0KCQlpZiAobmV3VGFncy5sZW5ndGgpIHsNCgkJCSQuYWpheCh7DQoJCQkJdXJsOiAoKCh0eXBlb2YgUm9vdFBhdGggPT0gJ3VuZGVmaW5lZCcgfHwgUm9vdFBhdGggPT0gJy8nKSA/ICcnIDogUm9vdFBhdGgpICsgJy9qc29ucmVxL2V2ZW50LycpLnJlcGxhY2UoJy8vJywgJy8nKSwNCgkJCQl0eXBlOiAnUE9TVCcsDQoJCQkJZGF0YVR5cGU6ICdKU09OJywNCgkJCQlkYXRhOiB7DQoJCQkJCXR5cGU6ICdsb2NhbGl6ZWQgdGFncycsDQoJCQkJCXRhZ3M6IG5ld1RhZ3Muam9pbignLCcpDQoJCQkJfQ0KCQkJfSkuZG9uZShmdW5jdGlvbiAoZGF0YSkgew0KCQkJCSQuZWFjaChkYXRhLmRhdGEsIGZ1bmN0aW9uIChpLCBvYmopIHsNCgkJCQkJcmV0dXJuVmFsdWVbb2JqLmlkXSA9IG9iai52YWx1ZTsNCgkJCQkJbG9jYWxpemVkQ29udGVudFtvYmouaWRdID0gb2JqLnZhbHVlOw0KCQkJCX0pOw0KDQoJCQkJZGVmZXJyZWQucmVzb2x2ZShyZXR1cm5WYWx1ZSk7DQoJCQl9KTsNCgkJfQ0KCQllbHNlIHsNCgkJCWRlZmVycmVkLnJlc29sdmUocmV0dXJuVmFsdWUpOw0KCQl9DQoNCgkJcmV0dXJuIGRlZmVycmVkOw0KCX0NCg0KCWZ1bmN0aW9uIGJnQW5pbWF0ZSh0YXJnZXQpIHsNCgkJdmFyIGVsbSA9ICQodGFyZ2V0KTsNCg0KCQllbG0uY3NzKHtiYWNrZ3JvdW5kQ29sb3I6ICcjZmI0ZjE0JywgY29sb3I6ICcjZmZmZmZmJ30pOw0KCQllbG0uYW5pbWF0ZSh7YmFja2dyb3VuZENvbG9yOiAnI2VlZWVlZScsIGNvbG9yOiAnIzMzMzMzMyd9LCA1MDAsIGZ1bmN0aW9uICgpIHsNCgkJCWVsbS5jc3Moew0KCQkJCSdiYWNrZ3JvdW5kQ29sb3InOiAnJywNCgkJCQknY29sb3InOiAnJw0KCQkJfSk7DQoJCX0pOw0KCX0NCg0KCWZ1bmN0aW9uIGdldFBhZ2VQcm9wZXJ0aWVzKCkgew0KCQkvL1dvcmthcm91bmQgZm9yIEdvb2dsZSBDaHJvbWUuIFRoZSB2ZXJ0aWNhbCBzY3JvbGxiYXIgaXMgbm90IGluY2x1ZGVkIGluIGRldGVybWluaW5nIHRoZSB3aWR0aCBvZiB0aGUgZGV2aWNlLg0KCQkkKCdib2R5JykuY3NzKCdvdmVyZmxvdycsICdoaWRkZW4nKTsNCgkJdmFyIHcgPSAkKCdodG1sJykud2lkdGgoKTsNCg0KCQkkKCdib2R5JykuY3NzKCdvdmVyZmxvdycsICcnKTsNCg0KCQkvL0RlZmluZSBwYWdlVHlwZQ0KCQlpZiAodyA+PSAxMjAwKSB7DQoJCQlwYWdlVHlwZSA9IDM7DQoJCX0NCgkJZWxzZSBpZiAodyA+PSA5OTIpIHsNCgkJCXBhZ2VUeXBlID0gMjsNCgkJfQ0KCQllbHNlIGlmICh3ID49IDc2OCkgew0KCQkJcGFnZVR5cGUgPSAxOw0KCQl9DQoJCWVsc2Ugew0KCQkJcGFnZVR5cGUgPSAwOw0KCQl9DQoNCgkJcmV0dXJuIHc7DQoJfQ0KDQoJZnVuY3Rpb24gc29jaWFsTWVkaWFUb29sYmFyKCkgew0KCQl2YXIgYml0bHlVUkwgPSBsb2NhdGlvbi5ocmVmOw0KDQoJCWlmICgkKCcuZy1wbHVzb25lJykubGVuZ3RoKSB7DQoJCQkkKCcuZy1wbHVzb25lJykuYXR0cignZGF0YS1ocmVmJywgYml0bHlVUkwpOw0KDQoJCQkvL0dvb2dsZSsNCgkJCShmdW5jdGlvbiAoKSB7DQoJCQkJdmFyIHBvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQoJCQkJcG8udHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOw0KCQkJCXBvLmFzeW5jID0gdHJ1ZTsNCgkJCQlwby5zcmMgPSAnLy9hcGlzLmdvb2dsZS5jb20vanMvcGx1c29uZS5qcyc7DQoJCQkJdmFyIHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0JylbMF07DQoJCQkJcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShwbywgcyk7DQoJCQl9KSgpOw0KCQl9DQoNCgkJLy9SZXRyaWV2ZSBiaXQubHkgdXJsLg0KCQlpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0ICYmIGxvY2F0aW9uLmhvc3QgPT0gJ3NvZnR3YXJlLmRlbGwuY29tJyAmJiAhL1wvZW1haWxjbFwvLy50ZXN0KGxvY2F0aW9uLnBhdGhuYW1lKSkgew0KCQkJdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KCQkJeGhyLm9wZW4oIkdFVCIsICIvaGlkZGVuL2JpdGx5LmFzbXgvZ2V0P1VSST0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHVybCkpOw0KCQkJeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsNCgkJCQlpZiAoeGhyLnJlYWR5U3RhdGUgPT0gNCkgew0KCQkJCQlpZiAoeGhyLnN0YXR1cyA9PSAyMDApIHsNCgkJCQkJCXhtbCA9ICQoJC5wYXJzZVhNTCh4aHIucmVzcG9uc2VUZXh0KSk7DQoJCQkJCQl2YXIgb2JqID0galF1ZXJ5LnBhcnNlSlNPTih4bWwuZmluZCgic3RyaW5nIikudGV4dCgpKTsNCg0KCQkJCQkJaWYgKHR5cGVvZiBvYmouZGF0YSAhPSAndW5kZWZpbmVkJykgew0KCQkJCQkJCWJpdGx5VVJMID0gb2JqLmRhdGEudXJsOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJfTsNCgkJCXhoci5zZW5kKCk7DQoJCX0NCg0KCQkkKCcuc29jaWFsLW1lZGlhLXRvb2xiYXInKS5vbignY2xpY2snLCAnYScsIGZ1bmN0aW9uIChlKSB7DQoJCQl2YXIgcGFyZW50ID0gJCh0aGlzKS5wYXJlbnQoKSwgdGl0bGUgPSBkb2N1bWVudC50aXRsZTsNCg0KCQkJaWYgKHBhcmVudC5oYXNDbGFzcygnZmFjZWJvb2snKSkgew0KCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQl3aW5kb3cub3BlbignaHR0cDovL3d3dy5mYWNlYm9vay5jb20vc2hhcmVyLnBocD91PScgKyBlbmNvZGVVUklDb21wb25lbnQoYml0bHlVUkwpICsgJyZ0PScgKyBlbmNvZGVVUklDb21wb25lbnQodGl0bGUpLCAnZmFjZWJvb2snLCAnd2lkdGg9NDgwLGhlaWdodD0yNDAsdG9vbGJhcj0wLHN0YXR1cz0wLHJlc2l6YWJsZT0xJyk7DQoJCQl9DQoJCQllbHNlIGlmIChwYXJlbnQuaGFzQ2xhc3MoJ3R3aXR0ZXInKSkgew0KCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQl3aW5kb3cub3BlbignaHR0cDovL3R3aXR0ZXIuY29tL3NoYXJlP3ZpYT1EZWxsU29mdHdhcmUmdXJsPScgKyBlbmNvZGVVUklDb21wb25lbnQoYml0bHlVUkwpICsgJyZ0ZXh0PScgKyBlbmNvZGVVUklDb21wb25lbnQodGl0bGUpICsgJywlMjAmY291bnR1cmw9JyArIGVuY29kZVVSSUNvbXBvbmVudCh1cmwpLCAndHdpdHRlcicsICd3aWR0aD00ODAsaGVpZ2h0PTM4MCx0b29sYmFyPTAsc3RhdHVzPTAscmVzaXphYmxlPTEnKTsNCgkJCX0NCgkJCWVsc2UgaWYgKHBhcmVudC5oYXNDbGFzcygnbGlua2VkaW4nKSkgew0KCQkJCWUucHJldmVudERlZmF1bHQoKTsNCgkJCQl3aW5kb3cub3BlbignaHR0cDovL3d3dy5saW5rZWRpbi5jb20vc2hhcmVBcnRpY2xlP21pbmk9dHJ1ZSZ1cmw9JyArIGVuY29kZVVSSUNvbXBvbmVudChiaXRseVVSTCkgKyAnJnRpdGxlPScgKyBlbmNvZGVVUklDb21wb25lbnQodGl0bGUpLCAnbGlua2VkaW4nLCAnd2lkdGg9NDgwLGhlaWdodD0zNjAsdG9vbGJhcj0wLHN0YXR1cz0wLHJlc2l6YWJsZT0xJyk7DQoJCQl9DQoJCQllbHNlIGlmIChwYXJlbnQuaGFzQ2xhc3MoJ2dvb2dsZXNoYXJlJykpIHsNCgkJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQkJd2luZG93Lm9wZW4oJ2h0dHBzOi8vcGx1cy5nb29nbGUuY29tL3NoYXJlP3VybD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGxvY2F0aW9uLmhyZWYpLCAnJywgJ21lbnViYXI9bm8sdG9vbGJhcj1ubyxyZXNpemFibGU9eWVzLHNjcm9sbGJhcnM9eWVzLGhlaWdodD02MDAsd2lkdGg9NjAwJyk7DQoJCQl9DQoJCX0pOw0KCX0NCg0KCWZ1bmN0aW9uIHByb2Nlc3NIZWFkZXJGb290ZXIoKSB7DQoJCSQoJ2JvZHknKQ0KCQkJLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7DQoJCQkJLy9DbG9zaW5nIHRvcCBzZWFyY2ggd2hlbiBjbGljayBvbiBib2R5DQoJCQkJaWYgKCQoJy5vcGVuLXNlYXJjaCcpLmxlbmd0aCkgew0KCQkJCQlpZiAoISQoZS50YXJnZXQpLmlzKCcuc2VhcmNoLWNvbnRhaW5lciAqLCAuc2VhcmNoLWNvbnRhaW5lciwgLnNlYXJjaC1idXR0b24sIC5zZWFyY2gtYnV0dG9uIConKSkgew0KCQkJCQkJJCgnLm9wZW4tc2VhcmNoJykucmVtb3ZlQ2xhc3MoJ29wZW4tc2VhcmNoJyk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9KQ0KCQkJLm9uKCdjbGljaycsICcubmF2YmFyLXRvZ2dsZScsIGZ1bmN0aW9uIChlKSB7DQoJCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsNCg0KCQkJCS8vSGFtYnVyZ2VyIC0gTW9iaWxlDQoJCQkJLy9PcGVuICYgQ2xvc2Ugc2xpZGUgb3V0IG5hdmlnYXRpb24uDQoJCQkJaWYgKHBhZ2VUeXBlIDwgMykgew0KCQkJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQkJCSQoJ2h0bWwnKS50b2dnbGVDbGFzcygnb3Blbk5hdicpOw0KCQkJCQkkKCcudXRpbGl0eScpLmZpbmQoJz4gbGknKS5yZW1vdmVDbGFzcygnb3BlbicpOw0KCQkJCX0NCgkJCX0pOw0KCX0NCg0KfShqUXVlcnksIHdpbmRvdykpOw==</file>
		</files>
	</scriptedContentFragment>
</scriptedContentFragments>